NexT.utils=NexT.$u={wrapImageWithFancyBox:function(){$('.content img').not('[hidden]').not('.group-picture img, .post-gallery img').each(function(){var $image=$(this);var imageTitle=$image.attr('title');var $imageWrapLink=$image.parent('a');if($imageWrapLink.size()<1){var imageLink=($image.attr('data-original'))?this.getAttribute('data-original'):this.getAttribute('src');$imageWrapLink=$image.wrap('<a href="'+imageLink+'"></a>').parent('a')}$imageWrapLink.addClass('fancybox fancybox.image');$imageWrapLink.attr('rel','group');if(imageTitle){$imageWrapLink.append('<p class="image-caption">'+imageTitle+'</p>');$imageWrapLink.attr('title',imageTitle)}});$('.fancybox').fancybox({helpers:{overlay:{locked:false}}})},lazyLoadPostsImages:function(){$('#posts').find('img').lazyload({effect:'fadeIn',threshold:0})},registerESCKeyEvent:function(){$(document).on('keyup',function(event){var shouldDismissSearchPopup=event.which===27&&$('.search-popup').is(':visible');if(shouldDismissSearchPopup){$('.search-popup').hide();$('.search-popup-overlay').remove();$('body').css('overflow','')}})},registerBackToTop:function(){var THRESHOLD=50;var $top=$('.back-to-top');$(window).on('scroll',function(){$top.toggleClass('back-to-top-on',window.pageYOffset>THRESHOLD);var scrollTop=$(window).scrollTop();var docHeight=$('#content').height();var winHeight=$(window).height();var contentMath=(docHeight>winHeight)?(docHeight-winHeight):($(document).height()-winHeight);var scrollPercent=(scrollTop)/(contentMath);var scrollPercentRounded=Math.round(scrollPercent*100);var scrollPercentMaxed=(scrollPercentRounded>100)?100:scrollPercentRounded;$('#scrollpercent>span').html(scrollPercentMaxed)});$top.on('click',function(){$('body').velocity('scroll')})},embeddedVideoTransformer:function(){var $iframes=$('iframe');var SUPPORTED_PLAYERS=['www.youtube.com','player.vimeo.com','player.youku.com','music.163.com','www.tudou.com'];var pattern=new RegExp(SUPPORTED_PLAYERS.join('|'));$iframes.each(function(){var iframe=this;var $iframe=$(this);var oldDimension=getDimension($iframe);var newDimension;if(this.src.search(pattern)>0){var videoRatio=getAspectRadio(oldDimension.width,oldDimension.height);$iframe.width('100%').height('100%').css({position:'absolute',top:'0',left:'0'});var wrap=document.createElement('div');wrap.className='fluid-vids';wrap.style.position='relative';wrap.style.marginBottom='20px';wrap.style.width='100%';wrap.style.paddingTop=videoRatio+'%';var iframeParent=iframe.parentNode;iframeParent.insertBefore(wrap,iframe);wrap.appendChild(iframe);if(this.src.search('music.163.com')>0){newDimension=getDimension($iframe);var shouldRecalculateAspect=newDimension.width>oldDimension.width||newDimension.height<oldDimension.height;if(shouldRecalculateAspect){wrap.style.paddingTop=getAspectRadio(newDimension.width,oldDimension.height)+'%'}}}});function getDimension($element){return{width:$element.width(),height:$element.height()}}function getAspectRadio(width,height){return height/width*100}},addActiveClassToMenuItem:function(){var path=window.location.pathname.toLowerCase();path=path==='/'?path:path.substring(0,path.length-1).toLowerCase()+"/";$('.menu-item a[href="'+path+'"]').parent().addClass('menu-item-active')},hasMobileUA:function(){var nav=window.navigator;var ua=nav.userAgent;var pa=/iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;return pa.test(ua)},isTablet:function(){return window.screen.width<992&&window.screen.width>767&&this.hasMobileUA()},isMobile:function(){return window.screen.width<767&&this.hasMobileUA()},isDesktop:function(){return!this.isTablet()&&!this.isMobile()},escapeSelector:function(selector){return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,'\\$&')},displaySidebar:function(){if(!this.isDesktop()||this.isPisces()){return}$('.sidebar-toggle').trigger('click')},isMist:function(){return CONFIG.scheme==='Mist'},isPisces:function(){return CONFIG.scheme==='Pisces'},getScrollbarWidth:function(){var $div=$('<div />').addClass('scrollbar-measure').prependTo('body');var div=$div[0];var scrollbarWidth=div.offsetWidth-div.clientWidth;$div.remove();return scrollbarWidth},needAffix:function(){return this.isPisces()}};