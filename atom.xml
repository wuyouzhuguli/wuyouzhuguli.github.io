<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>MrBird</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://mrbird.cc/"/>
  <updated>2020-01-21T10:30:56.818Z</updated>
  <id>http://mrbird.cc/</id>
  
  <author>
    <name>MrBird</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring Cloud å¾®æœåŠ¡æƒé™ç³»ç»Ÿæ­å»ºæ•™ç¨‹</title>
    <link href="http://mrbird.cc/book.html"/>
    <id>http://mrbird.cc/book.html</id>
    <published>2222-10-24T06:20:57.000Z</published>
    <updated>2020-01-21T10:30:56.818Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --><p>ğŸ“–ã€Š<a href="https://www.kancloud.cn/mrbird/spring-cloud" target="_blank" rel="noopener"> Spring Cloud å¾®æœåŠ¡æƒé™ç³»ç»Ÿæ­å»ºæ•™ç¨‹ </a>ã€‹ä¸€æœ¬åŸºäºSpring Cloud Hoxton.RELEASE&amp;Spring Cloud Oauth2&amp;Spring Cloud Alibabaçš„å¾®æœåŠ¡æƒé™ç³»ç»Ÿæ­å»ºæ•™ç¨‹ä¹¦ç±ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ ä»é›¶åˆ°K8Sé›†ç¾¤éƒ¨ç½²ã€‚</p><a id="more"></a><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263686" target="_blank" rel="noopener">ç¬¬ä¸€ç«  åŸºç¡€æ¡†æ¶æ­å»º</a><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263687" target="_blank" rel="noopener">1.1 æ¶æ„é¢„è§ˆ</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263688" target="_blank" rel="noopener">1.2 æ­å»ºå¾®æœåŠ¡æ³¨å†Œä¸­å¿ƒ</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263689" target="_blank" rel="noopener">1.3 æ­å»ºè®¤è¯æœåŠ¡å™¨</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263690" target="_blank" rel="noopener">1.4 æ­å»ºå¾®æœåŠ¡ç½‘å…³</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263691" target="_blank" rel="noopener">1.5 æ­å»ºå¾®æœåŠ¡æä¾›è€…ï¼ˆèµ„æºæœåŠ¡å™¨ï¼‰</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263692" target="_blank" rel="noopener">1.6 æœ¬ç« å°ç»“</a></li></ul></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263693" target="_blank" rel="noopener">ç¬¬äºŒç«  æ¶æ„å®Œå–„</a><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263694" target="_blank" rel="noopener">2.1 å‚æ•°é…ç½®åŒ–</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263695" target="_blank" rel="noopener">2.2 å¼‚å¸¸å¤„ç†</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263696" target="_blank" rel="noopener">2.3 Feignçš„ä½¿ç”¨</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263697" target="_blank" rel="noopener">2.4 å¾®æœåŠ¡é˜²æŠ¤</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263698" target="_blank" rel="noopener">2.5 è·¨åŸŸå¤„ç†</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263699" target="_blank" rel="noopener">2.6 æœ¬ç« å°ç»“</a></li></ul></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263700" target="_blank" rel="noopener">ç¬¬ä¸‰ç«  å®Œå–„ç™»å½•æµç¨‹</a><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263701" target="_blank" rel="noopener">3.1 è¡¨ç»“æ„è®¾è®¡</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263702" target="_blank" rel="noopener">3.2 å®Œå–„ç™»å½•</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263703" target="_blank" rel="noopener">3.3 æ•´åˆå›¾å½¢éªŒè¯ç </a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263704" target="_blank" rel="noopener">3.4 SentineléªŒè¯ç é™æµ</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263705" target="_blank" rel="noopener">3.5 æœ¬ç« å°ç»“</a></li></ul></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263706" target="_blank" rel="noopener">ç¬¬å››ç«  æ•´åˆSwagger</a><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263707" target="_blank" rel="noopener">4.1 å®Œå–„febs-server-system</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263708" target="_blank" rel="noopener">4.2 æ¥å…¥Swagger</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263709" target="_blank" rel="noopener">4.3 Swagger OAuth2è®¤è¯</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263710" target="_blank" rel="noopener">4.4 æœ¬ç« å°ç»“</a></li></ul></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263711" target="_blank" rel="noopener">ç¬¬äº”ç«  æ•´åˆç¬¬ä¸‰æ–¹æœåŠ¡</a><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263712" target="_blank" rel="noopener">5.1 æ•´åˆSpring Boot Admin</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263713" target="_blank" rel="noopener">5.2 Sleuth Zipkiné“¾è·¯è¿½è¸ª</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263714" target="_blank" rel="noopener">5.3 logbackæ—¥å¿—æ‰“å°</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263715" target="_blank" rel="noopener">5.4 ELKæ—¥å¿—æ”¶é›†</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263716" target="_blank" rel="noopener">5.5 æœ¬ç« å°ç»“</a></li></ul></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263717" target="_blank" rel="noopener">ç¬¬å…­ç«  å‰ç«¯ç³»ç»Ÿä»‹ç»</a><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263718" target="_blank" rel="noopener">6.1 å°è£…Axios</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263719" target="_blank" rel="noopener">6.2 Vueå¯¼èˆªå®ˆå«</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263720" target="_blank" rel="noopener">6.3 åŠ¨æ€è·¯ç”±æ„å»º</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263721" target="_blank" rel="noopener">6.4 å¤„ç†ç”¨æˆ·ç™»å½•</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263722" target="_blank" rel="noopener">6.5 å¤„ç†ä»¤ç‰Œåˆ·æ–°</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263723" target="_blank" rel="noopener">6.6 è‡ªå®šä¹‰Vueæƒé™æŒ‡ä»¤</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263724" target="_blank" rel="noopener">6.7 æœ¬ç« å°ç»“</a></li></ul></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263725" target="_blank" rel="noopener">ç¬¬ä¸ƒç«  å¾®æœåŠ¡éƒ¨ç½²</a><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263726" target="_blank" rel="noopener">7.1 å¾®æœåŠ¡DokceråŒ–</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263727" target="_blank" rel="noopener">7.2 ä½¿ç”¨Docker Composeéƒ¨ç½²</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263728" target="_blank" rel="noopener">7.3 æœ¬ç« å°ç»“</a></li></ul></li><li><p><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263729" target="_blank" rel="noopener">ç¬¬å…«ç«  å¾®æœåŠ¡è¿›é˜¶</a></p><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1277531" target="_blank" rel="noopener">8.1 ä»¤ç‰Œå­˜å‚¨ç­–ç•¥</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1263731" target="_blank" rel="noopener">8.2 ä½¿ç”¨Cloud Gatewayæ­å»ºç½‘å…³</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1271133" target="_blank" rel="noopener">8.3 ä½¿ç”¨Alibaba Nacosæ³¨å†Œä¸­å¿ƒ</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1289434" target="_blank" rel="noopener">8.4 ä½¿ç”¨Alibaba Nacoså­˜å‚¨é…ç½®</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1333138" target="_blank" rel="noopener">8.5 æ¥å…¥Prometheus + Grafana</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1337996" target="_blank" rel="noopener">8.6 æ•´åˆskywalkingåˆ†å¸ƒå¼è¿½è¸ª</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1411735" target="_blank" rel="noopener">8.7 å‡çº§åˆ°Hoxton.RELEASE</a></li></ul></li><li><p><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426914" target="_blank" rel="noopener">ç¬¬ä¹ç«  K8Sé›†ç¾¤éƒ¨ç½²</a></p><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426916" target="_blank" rel="noopener">9.1 é›†ç¾¤ç¯å¢ƒå‡†å¤‡</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426917" target="_blank" rel="noopener">9.2 å®‰è£…ç¬¬ä¸‰æ–¹æœåŠ¡</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426918" target="_blank" rel="noopener">9.3 Kubeadmæ­å»ºK8S 1.16.2é›†ç¾¤</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426919" target="_blank" rel="noopener">9.4 NFSæœåŠ¡å™¨æ­å»º</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426920" target="_blank" rel="noopener">9.5 æ­å»ºDockeré•œåƒä»“åº“Harbor</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426921" target="_blank" rel="noopener">9.6 K8Sæ„å»ºé«˜å¯ç”¨Nacos</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426922" target="_blank" rel="noopener">9.7 K8Sæ„å»ºFEBS CloudæœåŠ¡é›†ç¾¤</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426923" target="_blank" rel="noopener">9.8 éƒ¨ç½²å‰ç«¯æµ‹è¯•</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1426924" target="_blank" rel="noopener">9.9 K8Så®è·µæ€»ç»“</a></li></ul></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1456142" target="_blank" rel="noopener">ç¬¬åç«  åˆ†å¸ƒå¼äº‹åŠ¡ç ”ç©¶</a><ul><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1456143" target="_blank" rel="noopener">10.1 åˆ†å¸ƒå¼æ¶æ„äº‹åŠ¡æŒ‘æˆ˜</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1456144" target="_blank" rel="noopener">10.2 åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1456145" target="_blank" rel="noopener">10.3 åŸºäºæ¶ˆæ¯ä¸­é—´ä»¶RocketMQæ–¹æ¡ˆï¼ˆä¸€ï¼‰</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1456146" target="_blank" rel="noopener">10.4 åŸºäºæ¶ˆæ¯ä¸­é—´ä»¶RocketMQæ–¹æ¡ˆï¼ˆäºŒï¼‰</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1456147" target="_blank" rel="noopener">10.5 åŸºäºTX-LCNæ–¹æ¡ˆ</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1456148" target="_blank" rel="noopener">10.6 åŸºäºé˜¿é‡ŒSeataæ–¹æ¡ˆ</a></li><li><a href="https://www.kancloud.cn/mrbird/spring-cloud/1456149" target="_blank" rel="noopener">10.7 æœ¬ç« æ€»ç»“</a></li></ul></li></ul><script>$(function(){$("#comment-div").remove(),$(".post-copyright").remove(),$("#reward-div").remove(),$(".post-footer").remove()})</script><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;ğŸ“–ã€Š&lt;a href=&quot;https://www.kancloud.cn/mrbird/spring-cloud&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt; Spring Cloud å¾®æœåŠ¡æƒé™ç³»ç»Ÿæ­å»ºæ•™ç¨‹ &lt;/a&gt;ã€‹ä¸€æœ¬åŸºäºSpring Cloud Hoxton.RELEASE&amp;amp;Spring Cloud Oauth2&amp;amp;Spring Cloud Alibabaçš„å¾®æœåŠ¡æƒé™ç³»ç»Ÿæ­å»ºæ•™ç¨‹ä¹¦ç±ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ ä»é›¶åˆ°K8Sé›†ç¾¤éƒ¨ç½²ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spring Cloud" scheme="http://mrbird.cc/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥ç†è§£Springäº‹ä»¶å‘å¸ƒä¸ç›‘å¬</title>
    <link href="http://mrbird.cc/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Spring%E4%BA%8B%E4%BB%B6%E5%8F%91%E5%B8%83%E4%B8%8E%E7%9B%91%E5%90%AC.html"/>
    <id>http://mrbird.cc/æ·±å…¥ç†è§£Springäº‹ä»¶å‘å¸ƒä¸ç›‘å¬.html</id>
    <published>2020-06-22T10:18:58.000Z</published>
    <updated>2020-12-23T06:35:34.023Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --><p>åœ¨ä½¿ç”¨Springæ„å»ºçš„åº”ç”¨ç¨‹åºä¸­ï¼Œé€‚å½“ä½¿ç”¨äº‹ä»¶å‘å¸ƒä¸ç›‘å¬çš„æœºåˆ¶å¯ä»¥ä½¿æˆ‘ä»¬çš„ä»£ç çµæ´»åº¦æ›´é«˜ï¼Œé™ä½è€¦åˆåº¦ã€‚Springæä¾›äº†å®Œæ•´çš„äº‹ä»¶å‘å¸ƒä¸ç›‘å¬æ¨¡å‹ï¼Œåœ¨è¯¥æ¨¡å‹ä¸­ï¼Œäº‹ä»¶å‘å¸ƒæ–¹åªéœ€å°†äº‹ä»¶å‘å¸ƒå‡ºå»ï¼Œæ— éœ€å…³å¿ƒæœ‰å¤šå°‘ä¸ªå¯¹åº”çš„äº‹ä»¶ç›‘å¬å™¨ï¼›ç›‘å¬å™¨æ— éœ€å…³å¿ƒæ˜¯è°å‘å¸ƒäº†äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶ç›‘å¬æ¥è‡ªå¤šä¸ªäº‹ä»¶å‘å¸ƒæ–¹å‘å¸ƒçš„äº‹ä»¶ï¼Œé€šè¿‡è¿™ç§æœºåˆ¶ï¼Œäº‹ä»¶å‘å¸ƒä¸ç›‘å¬æ˜¯è§£è€¦çš„ã€‚</p><p>æœ¬èŠ‚å°†ä¸¾ä¾‹äº‹ä»¶å‘å¸ƒä¸ç›‘å¬çš„ä½¿ç”¨ï¼Œå¹¶ä»‹ç»å†…éƒ¨å®ç°åŸç†ã€‚</p><a id="more"></a><h2 id="äº‹ä»¶å‘å¸ƒç›‘å¬ä¾‹å­"><a href="#äº‹ä»¶å‘å¸ƒç›‘å¬ä¾‹å­" class="headerlink" title="äº‹ä»¶å‘å¸ƒç›‘å¬ä¾‹å­"></a>äº‹ä»¶å‘å¸ƒç›‘å¬ä¾‹å­</h2><p>æ–°å»ºspringbootåº”ç”¨ï¼Œbootç‰ˆæœ¬2.4.0ï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="è‡ªå®šä¹‰äº‹ä»¶"><a href="#è‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="è‡ªå®šä¹‰äº‹ä»¶"></a>è‡ªå®šä¹‰äº‹ä»¶</h3><p>Springä¸­ä½¿ç”¨ApplicationEventæ¥å£æ¥è¡¨ç¤ºä¸€ä¸ªäº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå®šä¹‰äº‹ä»¶MyEventéœ€è¦å®ç°è¯¥æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyEvent</span><span class="params">(Object source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ„é€ å™¨sourceå‚æ•°è¡¨ç¤ºå½“å‰äº‹ä»¶çš„äº‹ä»¶æºï¼Œä¸€èˆ¬ä¼ å…¥Springçš„contextä¸Šä¸‹æ–‡å¯¹è±¡å³å¯ã€‚</p><h3 id="äº‹ä»¶å‘å¸ƒå™¨"><a href="#äº‹ä»¶å‘å¸ƒå™¨" class="headerlink" title="äº‹ä»¶å‘å¸ƒå™¨"></a>äº‹ä»¶å‘å¸ƒå™¨</h3><p>äº‹ä»¶å‘å¸ƒé€šè¿‡äº‹ä»¶å‘å¸ƒå™¨ApplicationEventPublisherå®Œæˆï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªäº‹ä»¶å‘å¸ƒå™¨MyEventPublisherï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEventPublisher</span> <span class="keyword">implements</span> <span class="title">ApplicationEventPublisherAware</span>, <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher applicationEventPublisher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationEventPublisher = applicationEventPublisher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishEvent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"å¼€å§‹å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶MyEvent"</span>);</span><br><span class="line">        MyEvent myEvent = <span class="keyword">new</span> MyEvent(applicationContext);</span><br><span class="line">        applicationEventPublisher.publishEvent(myEvent);</span><br><span class="line">        logger.info(<span class="string">"å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶MyEventç»“æŸ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨è‡ªå®šä¹‰äº‹ä»¶å‘å¸ƒå™¨MyEventPublisherä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ApplicationEventPublisheræ¥å‘å¸ƒäº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å®ç°äº†ApplicationEventPublisherAwareæ¥å£ï¼Œé€šè¿‡å›è°ƒæ–¹æ³•setApplicationEventPublisherä¸ºMyEventPublisherçš„ApplicationEventPublisherå±æ€§èµ‹å€¼ï¼›åŒæ ·çš„ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„äº‹ä»¶MyEventæ„é€ å‡½æ•°éœ€è¦ä¼ å…¥Springä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥MyEventPublisherè¿˜å®ç°äº†ApplicationContextAwareæ¥å£ï¼Œæ³¨å…¥äº†ä¸Šä¸‹æ–‡å¯¹è±¡ApplicationContextã€‚</p><p>publishEventæ–¹æ³•å‘å¸ƒäº†ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶MyEventã€‚äº‹ä»¶å‘å¸ƒå‡ºå»åï¼Œæˆ‘ä»¬æ¥ç€ç¼–å†™ç›¸åº”çš„äº‹ä»¶ç›‘å¬å™¨ã€‚</p><h3 id="æ³¨è§£ç›‘å¬"><a href="#æ³¨è§£ç›‘å¬" class="headerlink" title="æ³¨è§£ç›‘å¬"></a>æ³¨è§£ç›‘å¬</h3><p>æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°é€šè¿‡@EventListeneræ³¨è§£å®ç°äº‹ä»¶ç›‘å¬ï¼Œç¼–å†™MyEventPublisherï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotationEventListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMyEventPublished</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶MyEvent -- MyAnnotationEventListener"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¢«@EventListeneræ³¨è§£æ ‡æ³¨çš„æ–¹æ³•å…¥å‚ä¸ºMyEventç±»å‹ï¼Œæ‰€ä»¥åªè¦MyEventäº‹ä»¶è¢«å‘å¸ƒäº†ï¼Œè¯¥ç›‘å¬å™¨å°±ä¼šèµ·ä½œç”¨ï¼Œå³è¯¥æ–¹æ³•ä¼šè¢«å›è°ƒã€‚</p><h3 id="ç¼–ç¨‹å®ç°ç›‘å¬"><a href="#ç¼–ç¨‹å®ç°ç›‘å¬" class="headerlink" title="ç¼–ç¨‹å®ç°ç›‘å¬"></a>ç¼–ç¨‹å®ç°ç›‘å¬</h3><p>é™¤äº†ä½¿ç”¨@EventListeneræ³¨è§£å®ç°äº‹ä»¶çš„ç›‘å¬å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®ç°ApplicationListener<t>æ¥å£æ¥å®ç°äº‹ä»¶çš„ç›‘å¬ï¼ˆæ³›å‹ä¸ºç›‘å¬çš„äº‹ä»¶ç±»å‹ï¼‰ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEventListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">MyEvent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(MyEvent event)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶MyEvent"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></t></p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>åœ¨springbootçš„å…¥å£ç±»ä¸­æµ‹è¯•äº‹ä»¶çš„å‘å¸ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(MyApplication.class, args);</span><br><span class="line">        MyEventPublisher publisher = context.getBean(MyEventPublisher.class);</span><br><span class="line">        publisher.publishEvent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿è¡Œç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-06-22 16:31:46.667  INFO 83600 --- [           main] c.m.demo.publisher.MyEventPublisher      : å¼€å§‹å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶MyEvent</span><br><span class="line">2020-06-22 16:31:46.668  INFO 83600 --- [           main] cc.mrbird.demo.listener.MyEventListener  : æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶MyEvent</span><br><span class="line">2020-06-22 16:31:46.668  INFO 83600 --- [           main] c.m.d.l.MyAnnotationEventListener        : æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶MyEvent -- MyAnnotationEventListener</span><br><span class="line">2020-06-22 16:31:46.668  INFO 83600 --- [           main] c.m.demo.publisher.MyEventPublisher      : å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶MyEventç»“æŸ</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªç›‘å¬å™¨éƒ½ç›‘å¬åˆ°äº†äº‹ä»¶çš„å‘å¸ƒã€‚æ­¤å¤–ç»†å¿ƒçš„è¯»è€…ä¼šå‘ç°ï¼Œäº‹ä»¶å‘å¸ƒå’Œäº‹ä»¶ç›‘å¬æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å®Œæˆçš„ï¼Œè¿‡ç¨‹ä¸ºåŒæ­¥æ“ä½œï¼Œåªæœ‰å½“æ‰€æœ‰å¯¹åº”äº‹ä»¶ç›‘å¬å™¨çš„é€»è¾‘æ‰§è¡Œå®Œæ¯•åï¼Œäº‹ä»¶å‘å¸ƒæ–¹æ³•æ‰èƒ½å‡ºæ ˆã€‚åé¢è¿›é˜¶ä½¿ç”¨ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œäº‹ä»¶ç›‘å¬ã€‚</p><h2 id="äº‹ä»¶å‘å¸ƒç›‘å¬åŸç†"><a href="#äº‹ä»¶å‘å¸ƒç›‘å¬åŸç†" class="headerlink" title="äº‹ä»¶å‘å¸ƒç›‘å¬åŸç†"></a>äº‹ä»¶å‘å¸ƒç›‘å¬åŸç†</h2><h3 id="äº‹ä»¶å‘å¸ƒç›‘å¬è¿‡ç¨‹"><a href="#äº‹ä»¶å‘å¸ƒç›‘å¬è¿‡ç¨‹" class="headerlink" title="äº‹ä»¶å‘å¸ƒç›‘å¬è¿‡ç¨‹"></a>äº‹ä»¶å‘å¸ƒç›‘å¬è¿‡ç¨‹</h3><p>åœ¨äº‹ä»¶å‘å¸ƒæ–¹æ³•ä¸Šæ‰“ä¸ªæ–­ç‚¹ï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥16-45-07.png" alt="2020å¹´12æœˆ22æ—¥16-45-07"></p><p>ä»¥debugçš„æ–¹å¼å¯åŠ¨ç¨‹åºï¼Œç¨‹åºæ‰§è¡Œåˆ°è¯¥æ–­ç‚¹åç‚¹å‡»Step IntoæŒ‰é’®ï¼Œç¨‹åºè·³è½¬åˆ°AbstractApplicationContextçš„publishEvent(ApplicationEvent event)æ–¹æ³•ï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥16-46-47.png" alt="2020å¹´12æœˆ22æ—¥16-46-47"></p><p>ç»§ç»­ç‚¹å‡»Step Intoï¼Œç¨‹åºè·³è½¬åˆ°AbstractApplicationContextçš„publishEvent(Object event, @Nullable ResolvableType eventType)æ–¹æ³•ï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥16-51-23.png" alt="2020å¹´12æœˆ22æ—¥16-51-23"></p><ol><li><p>getApplicationEventMulticasteræ–¹æ³•ç”¨äºè·å–å¹¿æ’­äº‹ä»¶ç”¨çš„å¤šæ’­å™¨ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥16-53-28.png" alt="2020å¹´12æœˆ22æ—¥16-53-28"></p><p>é‚£ä¹ˆAbstractApplicationContextçš„applicationEventMulticasterå±æ€§æ˜¯ä½•æ—¶èµ‹å€¼çš„å‘¢ï¼Œä¸‹é¢å°†ä¼šä»‹ç»åˆ°ã€‚</p></li><li><p>è·å–åˆ°äº‹ä»¶å¤šæ’­å™¨åï¼Œè°ƒç”¨å…¶multicastEventæ–¹æ³•å¹¿æ’­äº‹ä»¶ï¼Œç‚¹å‡»Step Intoè¿›å…¥è¯¥æ–¹æ³•å†…éƒ¨æŸ¥çœ‹å…·ä½“é€»è¾‘ï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥16-59-42.png" alt="2020å¹´12æœˆ22æ—¥16-59-42"></p><p>æŸ¥çœ‹invokeListeneræ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥17-00-58.png" alt="2020å¹´12æœˆ22æ—¥17-00-58"></p><p>ç»§ç»­æŸ¥çœ‹doInvokeListeneræ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥17-02-48.png" alt="2020å¹´12æœˆ22æ—¥17-02-48"></p></li></ol><p>ä¸Šè¿°è¿‡ç¨‹å°±æ˜¯æ•´ä¸ªäº‹ä»¶å‘å¸ƒä¸ç›‘å¬çš„è¿‡ç¨‹ã€‚</p><h3 id="å¤šæ’­å™¨åˆ›å»ºè¿‡ç¨‹"><a href="#å¤šæ’­å™¨åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="å¤šæ’­å™¨åˆ›å»ºè¿‡ç¨‹"></a>å¤šæ’­å™¨åˆ›å»ºè¿‡ç¨‹</h3><p>ä¸ºäº†å¼„æ¸…æ¥šAbstractApplicationContextçš„applicationEventMulticasterå±æ€§æ˜¯ä½•æ—¶èµ‹å€¼çš„ï¼ˆå³äº‹ä»¶å¤šæ’­å™¨æ˜¯ä½•æ—¶åˆ›å»ºçš„ï¼‰ï¼Œæˆ‘ä»¬åœ¨AbstractApplicationContextçš„applicationEventMulticasterå±æ€§ä¸Šæ‰“ä¸ªæ–­ç‚¹ï¼š</p><p><img src="img/QQ20201222-170637@2x.png" alt="QQ20201222-170637@2x"></p><p>ä»¥debugçš„æ–¹å¼å¯åŠ¨ç¨‹åºï¼Œç¨‹åºè·³è½¬åˆ°äº†AbstractApplicationContextçš„initApplicationEventMulticasteræ–¹æ³•ä¸­ï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥18-28-25.png" alt="2020å¹´12æœˆ22æ—¥18-28-25"></p><p>é€šè¿‡è·Ÿè¸ªæ–¹æ³•è°ƒç”¨æ ˆï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºç¨‹åºæ‰§è¡Œåˆ°ä¸Šè¿°æˆªå›¾çš„è¿‡ç¨‹ï¼š</p><ol><li><p>SpringBootå…¥å£ç±»çš„mainæ–¹æ³•æ‰§è¡ŒSpringApplication.run(MyApplication.class, args)å¯åŠ¨åº”ç”¨ï¼š</p><p><img src="img/QQ20201222-183103@2x.png" alt="QQ20201222-183103@2x"></p></li><li><p>runæ–¹æ³•å†…éƒ¨åŒ…å«refreshContextæ–¹æ³•ï¼ˆåˆ·æ–°ä¸Šä¸‹æ–‡ï¼‰ï¼š</p><p><img src="img/QQ20201222-183201@2x.png" alt="QQ20201222-183201@2x"></p></li><li><p>refreshæ–¹æ³•å†…éƒ¨åŒ…å«initApplicationEventMulticasteræ–¹æ³•ï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥18-33-42.png" alt="2020å¹´12æœˆ22æ—¥18-33-42"></p></li><li><p>initApplicationEventMulticasteræ–¹æ³•åˆ›å»ºå¤šæ’­å™¨ã€‚</p></li></ol><h3 id="ç›‘å¬å™¨è·å–è¿‡ç¨‹"><a href="#ç›‘å¬å™¨è·å–è¿‡ç¨‹" class="headerlink" title="ç›‘å¬å™¨è·å–è¿‡ç¨‹"></a>ç›‘å¬å™¨è·å–è¿‡ç¨‹</h3><p>åœ¨è¿½è¸ªäº‹ä»¶å‘å¸ƒä¸ç›‘å¬çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº‹ä»¶å¯¹åº”çš„ç›‘å¬å™¨æ˜¯é€šè¿‡getApplicationListenersæ–¹æ³•è·å–çš„ï¼š</p><p><img src="img/QQ20201222-183704@2x.png" alt="QQ20201222-183704@2x"></p><p>æ–¹æ³•è¿”å›ä¸‰ä¸ªMyEventäº‹ä»¶å¯¹åº”çš„ç›‘å¬å™¨ï¼Œç´¢å¼•ä¸º0çš„ç›‘å¬å™¨ä¸ºDelegatingApplicationListenerï¼Œå®ƒæ²¡æœ‰å®è´¨æ€§çš„å¤„ç†æŸäº‹ä»¶ï¼Œå¿½ç•¥ï¼›ç´¢å¼•ä¸º1çš„ç›‘å¬å™¨ä¸ºé€šè¿‡å®ç°ApplicationEventListeneræ¥å£çš„ç›‘å¬å™¨ï¼›ç´¢å¼•ä¸º2çš„ç›‘å¬å™¨ä¸ºé€šè¿‡@EventListenerå®ç°çš„ç›‘å¬å™¨ã€‚</p><h4 id="ç¼–ç¨‹å®ç°ç›‘å¬å™¨æ³¨å†Œè¿‡ç¨‹"><a href="#ç¼–ç¨‹å®ç°ç›‘å¬å™¨æ³¨å†Œè¿‡ç¨‹" class="headerlink" title="ç¼–ç¨‹å®ç°ç›‘å¬å™¨æ³¨å†Œè¿‡ç¨‹"></a>ç¼–ç¨‹å®ç°ç›‘å¬å™¨æ³¨å†Œè¿‡ç¨‹</h4><p>æŸ¥çœ‹getApplicationListenersæºç ï¼š</p><p><img src="img/2020å¹´12æœˆ23æ—¥10-07-36.png" alt="2020å¹´12æœˆ23æ—¥10-07-36"></p><p>å…¶ä¸­retrieverCacheçš„å®šä¹‰ä¸º<code>final Map&lt;ListenerCacheKey, CachedListenerRetriever&gt; retrieverCache = new ConcurrentHashMap&lt;&gt;(64)</code>ã€‚</p><p>æ¥ç€æŸ¥çœ‹retrieveApplicationListenersæ–¹æ³•ï¼ˆæ–¹æ³•è§åçŸ¥æ„ï¼Œç¨‹åºç¬¬ä¸€æ¬¡è·å–äº‹ä»¶å¯¹åº”çš„ç›‘å¬å™¨æ—¶ï¼Œç¼“å­˜ä¸­æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ç»§ç»­æ£€ç´¢è·å–äº‹ä»¶å¯¹åº”çš„ç›‘å¬å™¨ï¼‰ï¼š</p><p><img src="img/2020å¹´12æœˆ23æ—¥10-26-32.png" alt="2020å¹´12æœˆ23æ—¥10-26-32"></p><p>ä»ä¸Šé¢è¿™æ®µä»£ç æˆ‘ä»¬çŸ¥é“ï¼Œç”¨äºéå†çš„ç›‘å¬å™¨é›†åˆå¯¹è±¡listenerså’ŒlistenerBeansçš„å€¼æ˜¯ä»this.defaultRetrieverçš„applicationListenerså’ŒapplicationListenerBeanså±æ€§è·å–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…³æ³¨è¿™äº›å±æ€§æ˜¯ä½•æ—¶è¢«èµ‹å€¼çš„ã€‚defaultRetrieverçš„ç±»å‹ä¸ºDefaultListenerRetrieverï¼š</p><p><img src="img/2020å¹´12æœˆ23æ—¥10-32-02.png" alt="2020å¹´12æœˆ23æ—¥10-32-02"></p><p>æˆ‘ä»¬åœ¨applicationListenerså±æ€§ä¸Šå³é”®é€‰æ‹©Find UsagesæŸ¥çœ‹èµ‹å€¼ç›¸å…³æ“ä½œï¼š</p><p><img src="img/QQ20201223-103808@2x.png" alt="QQ20201223-103808@2x"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œèµ‹å€¼æ“ä½œå‘ç”Ÿåœ¨AbstractApplicationEventMulticasterçš„addApplicationListeneræ–¹æ³•ä¸­ï¼Œ</p><p>ç»§ç»­åœ¨addApplicationListeneræ–¹æ³•ä¸Šå³é”®é€‰æ‹©Find UsagesæŸ¥çœ‹è°ƒç”¨æºï¼š</p><p><img src="img/QQ20201223-104122@2x.png" alt="QQ20201223-104122@2x"></p><p>æˆ‘ä»¬åœ¨registerListenersæ–¹æ³•ä¸Šæ‰“ä¸ªæ–­ç‚¹ï¼Œé‡æ–°å¯åŠ¨ç¨‹åºï¼ŒæŸ¥çœ‹æ–¹æ³•è°ƒç”¨æ ˆï¼š</p><p><img src="img/QQ20201223-104340@2x.png" alt="QQ20201223-104340@2x"></p><p>ä»æ–¹æ³•è°ƒç”¨æ ˆæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºthis.defaultRetrieverçš„applicationListenerså’ŒapplicationListenerBeanså±æ€§å€¼èµ‹å€¼çš„è¿‡ç¨‹ï¼š</p><ol><li><p><code>SpringApplication.run(MyApplication.class, args)</code>å¯åŠ¨Bootç¨‹åºï¼›</p></li><li><p><code>run</code>æ–¹æ³•å†…éƒ¨è°ƒç”¨<code>refreshContext</code>åˆ·æ–°å®¹å™¨æ–¹æ³•ï¼š</p><p><img src="img/QQ20201223-104458@2x.png" alt="QQ20201223-104458@2x"></p></li><li><p><code>refresh</code>æ–¹æ³•å†…éƒ¨è°ƒç”¨äº†<code>registerListener</code>æ–¹æ³•æ³¨å†Œç›‘å¬å™¨ï¼š</p><p><img src="img/QQ20201223-104621@2x.png" alt="QQ20201223-104621@2x"></p></li><li><p><code>registerListeners</code>æ–¹æ³•å†…éƒ¨ä»IOCå®¹å™¨è·å–æ‰€æœ‰ApplicationListenerç±»å‹Beanï¼Œç„¶åèµ‹å€¼ç»™this.defaultRetrieverçš„applicationListenerså’ŒapplicationListenerBeanså±æ€§ã€‚</p></li></ol><h4 id="æ³¨è§£ç›‘å¬å™¨æ³¨å†Œè¿‡ç¨‹"><a href="#æ³¨è§£ç›‘å¬å™¨æ³¨å†Œè¿‡ç¨‹" class="headerlink" title="æ³¨è§£ç›‘å¬å™¨æ³¨å†Œè¿‡ç¨‹"></a>æ³¨è§£ç›‘å¬å™¨æ³¨å†Œè¿‡ç¨‹</h4><p>æŸ¥çœ‹<code>@EventListener</code>æ³¨è§£æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ23æ—¥11-17-54.png" alt="2020å¹´12æœˆ23æ—¥11-17-54"></p><p>æŸ¥çœ‹EventListenerMethodProcessoræºç ï¼š</p><p><img src="img/QQ20201223-111901@2x.png" alt="QQ20201223-111901@2x"></p><p>å…¶å®ç°äº†SmartInitializingSingletonæ¥å£ï¼Œè¯¥æ¥å£åŒ…å«afterSingletonsInstantiatedæ–¹æ³•ï¼š</p><p><img src="img/QQ20201223-111939@2x.png" alt="QQ20201223-111939@2x"></p><p>é€šè¿‡æ³¨é‡Šå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨æ—¶æœºä¸ºï¼šå•å®ä¾‹Beanå®ä¾‹åŒ–åè¢«è°ƒç”¨ï¼Œæ­¤æ—¶Beanå·²ç»è¢«åˆ›å»ºå‡ºæ¥ã€‚</p><p>æˆ‘ä»¬æŸ¥çœ‹EventListenerMethodProcessoræ˜¯å¦‚ä½•å®ç°è¯¥æ–¹æ³•çš„ï¼š</p><p><img src="img/2020å¹´12æœˆ23æ—¥11-23-53.png" alt="2020å¹´12æœˆ23æ—¥11-23-53"></p><p>ç»§ç»­æŸ¥çœ‹processBeanæ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ23æ—¥11-34-06.png" alt="2020å¹´12æœˆ23æ—¥11-34-06"></p><p>è‡³æ­¤ï¼Œä¸¤ç§æ–¹å¼æ³¨å†Œç›‘å¬å™¨çš„åŸç†éƒ½ææ¸…æ¥šäº†ã€‚</p><h2 id="ä½¿ç”¨è¿›é˜¶ä¸æ‹“å±•"><a href="#ä½¿ç”¨è¿›é˜¶ä¸æ‹“å±•" class="headerlink" title="ä½¿ç”¨è¿›é˜¶ä¸æ‹“å±•"></a>ä½¿ç”¨è¿›é˜¶ä¸æ‹“å±•</h2><h3 id="äº‹ä»¶ç›‘å¬å¼‚æ­¥åŒ–"><a href="#äº‹ä»¶ç›‘å¬å¼‚æ­¥åŒ–" class="headerlink" title="äº‹ä»¶ç›‘å¬å¼‚æ­¥åŒ–"></a>äº‹ä»¶ç›‘å¬å¼‚æ­¥åŒ–</h3><p>é€šè¿‡å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“äº‹ä»¶å¹¿æ’­å’Œç›‘å¬æ˜¯ä¸€ä¸ªçº¿ç¨‹å®Œæˆçš„åŒæ­¥æ“ä½œï¼Œæœ‰æ—¶å€™ä¸ºäº†è®©å¹¿æ’­æ›´æœ‰æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†äº‹ä»¶ç›‘å¬è¿‡ç¨‹å¼‚æ­¥åŒ–ã€‚</p><h4 id="å•ä¸ªå¼‚æ­¥"><a href="#å•ä¸ªå¼‚æ­¥" class="headerlink" title="å•ä¸ªå¼‚æ­¥"></a>å•ä¸ªå¼‚æ­¥</h4><p>å…ˆæ¥çœ‹çœ‹å¦‚ä½•å®ç°å•ä¸ªç›‘å¬å™¨å¼‚æ­¥ã€‚</p><p>é¦–å…ˆéœ€è¦åœ¨springbootå…¥å£ç±»ä¸Šé€šè¿‡<code>@EnableAsync</code>æ³¨è§£å¼€å¯å¼‚æ­¥ï¼Œç„¶ååœ¨éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„ç›‘å¬å™¨æ–¹æ³•ä¸Šä½¿ç”¨<code>@Async</code>æ³¨è§£æ ‡æ³¨ï¼Œä»¥MyAnnotationEventListenerä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotationEventListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span> <span class="comment">// å¼‚æ­¥</span></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMyEventPublished</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶MyEvent -- MyAnnotationEventListener"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯åŠ¨ç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="img/QQ20201223-115052@2x.png" alt="QQ20201223-115052@2x"></p><p>é€šè¿‡æ—¥å¿—å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¯¥ç›‘å¬å™¨æ–¹æ³•å·²ç»å¼‚æ­¥åŒ–ï¼Œæ‰§è¡Œçº¿ç¨‹ä¸ºtask-1ã€‚</p><h4 id="æ•´ä½“å¼‚æ­¥"><a href="#æ•´ä½“å¼‚æ­¥" class="headerlink" title="æ•´ä½“å¼‚æ­¥"></a>æ•´ä½“å¼‚æ­¥</h4><p>é€šè¿‡å‰é¢æºç åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“å¤šæ’­å™¨åœ¨å¹¿æ’­äº‹ä»¶æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­æ˜¯å¦æœ‰æŒ‡å®šexecutorï¼Œæœ‰çš„è¯é€šè¿‡executoræ‰§è¡Œç›‘å¬å™¨é€»è¾‘ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šexecutorçš„æ–¹å¼æ¥è®©æ‰€æœ‰çš„ç›‘å¬æ–¹æ³•éƒ½å¼‚æ­¥æ‰§è¡Œï¼š</p><p><img src="img/QQ20201223-135028@2x.png" alt="QQ20201223-135028@2x"></p><p>æ–°å»ºä¸€ä¸ªé…ç½®ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncEventConfigure</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = AbstractApplicationContext.APPLICATION_EVENT_MULTICASTER_BEAN_NAME)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApplicationEventMulticaster <span class="title">simpleApplicationEventMulticaster</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SimpleApplicationEventMulticaster eventMulticaster = <span class="keyword">new</span> SimpleApplicationEventMulticaster();</span><br><span class="line">        eventMulticaster.setTaskExecutor(<span class="keyword">new</span> SimpleAsyncTaskExecutor());</span><br><span class="line">        <span class="keyword">return</span> eventMulticaster;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨é…ç½®ç±»ä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œäº†ä¸€ä¸ªåç§°ä¸ºAbstractApplicationContext.APPLICATION_EVENT_MULTICASTER_BEAN_NAMEï¼ˆå³applicationEventMulticasterï¼‰çš„Beanï¼Œç”¨äºè¦†ç›–é»˜è®¤çš„äº‹ä»¶å¤šæ’­å™¨ï¼Œç„¶åæŒ‡å®šäº†TaskExecutorï¼ŒSimpleAsyncTaskExecutorä¸ºSpringæä¾›çš„å¼‚æ­¥ä»»åŠ¡executorã€‚</p><p>åœ¨å¯åŠ¨é¡¹ç›®å‰ï¼Œå…ˆæŠŠä¹‹å‰åœ¨springbootå…¥å£ç±»æ·»åŠ çš„<code>@EnableAsync</code>æ³¨è§£å»æ‰ï¼Œç„¶åå¯åŠ¨é¡¹ç›®ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="img/QQ20201223-135759@2x.png" alt="QQ20201223-135759@2x"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç›‘å¬å™¨äº‹ä»¶éƒ½å¼‚æ­¥åŒ–äº†ã€‚</p><h3 id="å¤šäº‹ä»¶ç›‘å¬å™¨"><a href="#å¤šäº‹ä»¶ç›‘å¬å™¨" class="headerlink" title="å¤šäº‹ä»¶ç›‘å¬å™¨"></a>å¤šäº‹ä»¶ç›‘å¬å™¨</h3><p>äº‹ä»¶ç›‘å¬å™¨é™¤äº†å¯ä»¥ç›‘å¬å•ä¸ªäº‹ä»¶å¤–ï¼Œä¹Ÿå¯ä»¥ç›‘å¬å¤šä¸ªäº‹ä»¶ï¼ˆä»…@EventListeneræ”¯æŒï¼‰ï¼Œä¿®æ”¹MyAnnotationEventListenerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotationEventListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span>(classes = &#123;MyEvent.class, ContextRefreshedEvent.class, ContextClosedEvent.class&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMyEventPublished</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> MyEvent) &#123;</span><br><span class="line">            logger.info(<span class="string">"ç›‘å¬åˆ°MyEventäº‹ä»¶"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ContextRefreshedEvent) &#123;</span><br><span class="line">            logger.info(<span class="string">"ç›‘å¬åˆ°ContextRefreshedEventäº‹ä»¶"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ContextClosedEvent) &#123;</span><br><span class="line">            logger.info(<span class="string">"ç›‘å¬åˆ°ContextClosedEventäº‹ä»¶"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¯¥ç›‘å¬å™¨å°†åŒæ—¶ç›‘å¬MyEventã€ContextRefreshedEventå’ŒContextClosedEventä¸‰ç§ç±»å‹äº‹ä»¶ï¼š</p><p><img src="img/QQ20201223-140231@2x.png" alt="QQ20201223-140231@2x"></p><h3 id="ç›‘å¬å™¨æ’åº"><a href="#ç›‘å¬å™¨æ’åº" class="headerlink" title="ç›‘å¬å™¨æ’åº"></a>ç›‘å¬å™¨æ’åº</h3><p>å•ä¸ªç±»å‹äº‹ä»¶ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªç›‘å¬å™¨åŒæ—¶ç›‘å¬ï¼Œè¿™æ—¶å€™å¯ä»¥é€šè¿‡å®ç°Orderedæ¥å£å®ç°æ’åºï¼ˆæˆ–è€…@Orderæ³¨è§£æ ‡æ³¨ï¼‰ã€‚</p><p>ä¿®æ”¹MyEventListenerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEventListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">MyEvent</span>&gt;, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(MyEvent event)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶MyEventï¼Œæˆ‘çš„ä¼˜å…ˆçº§è¾ƒé«˜"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¿®æ”¹MyAnnotationEventListenerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotationEventListener</span> <span class="keyword">implements</span> <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span>(classes = &#123;MyEvent.class&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMyEventPublished</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> MyEvent) &#123;</span><br><span class="line">            logger.info(<span class="string">"ç›‘å¬åˆ°MyEventäº‹ä»¶ï¼Œæˆ‘çš„ä¼˜å…ˆçº§è¾ƒä½"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯åŠ¨ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="img/QQ20201223-140600@2x.png" alt="QQ20201223-140600@2x"></p><h3 id="é…åˆSpELè¡¨è¾¾å¼"><a href="#é…åˆSpELè¡¨è¾¾å¼" class="headerlink" title="é…åˆSpELè¡¨è¾¾å¼"></a>é…åˆSpELè¡¨è¾¾å¼</h3><p>@EventListeneræ³¨è§£è¿˜åŒ…å«ä¸€ä¸ªconditionå±æ€§ï¼Œå¯ä»¥é…åˆSpELè¡¨è¾¾å¼æ¥æ¡ä»¶åŒ–è§¦å‘ç›‘å¬æ–¹æ³•ã€‚ä¿®æ”¹MyEventï¼Œæ·»åŠ ä¸€ä¸ªbooleanç±»å‹å±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flag;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFlag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">(<span class="keyword">boolean</span> flag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.flag = flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyEvent</span><span class="params">(Object source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨å‘å¸ƒäº‹ä»¶çš„æ—¶å€™ï¼Œå°†è¯¥å±æ€§è®¾ç½®ä¸ºfalseï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEventPublisher</span> <span class="keyword">implements</span> <span class="title">ApplicationEventPublisherAware</span>, <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher applicationEventPublisher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationEventPublisher = applicationEventPublisher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishEvent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"å¼€å§‹å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶MyEvent"</span>);</span><br><span class="line">        MyEvent myEvent = <span class="keyword">new</span> MyEvent(applicationContext);</span><br><span class="line">        myEvent.setFlag(<span class="keyword">false</span>); <span class="comment">// è®¾ç½®ä¸ºfalse</span></span><br><span class="line">        applicationEventPublisher.publishEvent(myEvent);</span><br><span class="line">        logger.info(<span class="string">"å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶MyEventç»“æŸ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨MyAnnotationEventListenerçš„@EventListeneræ³¨è§£ä¸Šæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨SpELï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotationEventListener</span> <span class="keyword">implements</span> <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span>(classes = &#123;MyEvent.class&#125;, condition = <span class="string">"#event.flag"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMyEventPublished</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> MyEvent) &#123;</span><br><span class="line">            logger.info(<span class="string">"ç›‘å¬åˆ°MyEventäº‹ä»¶ï¼Œæˆ‘çš„ä¼˜å…ˆçº§è¾ƒä½"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>condition = &quot;#event.flag&quot;</code>çš„å«ä¹‰ä¸ºï¼Œå½“å‰eventäº‹ä»¶ï¼ˆè¿™é‡Œä¸ºMyEventï¼‰çš„flagå±æ€§ä¸ºtrueçš„æ—¶å€™æ‰§è¡Œã€‚</p><p>å¯åŠ¨ç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="img/QQ20201223-141248@2x.png" alt="QQ20201223-141248@2x"></p><p>å› ä¸ºæˆ‘ä»¬å‘å¸ƒçš„MyEventçš„flagå±æ€§å€¼ä¸ºfalseï¼Œæ‰€ä»¥ä¸Šé¢è¿™ä¸ªç›‘å¬å™¨æ²¡æœ‰è¢«è§¦å‘ã€‚</p><h3 id="äº‹åŠ¡äº‹ä»¶ç›‘å¬å™¨"><a href="#äº‹åŠ¡äº‹ä»¶ç›‘å¬å™¨" class="headerlink" title="äº‹åŠ¡äº‹ä»¶ç›‘å¬å™¨"></a>äº‹åŠ¡äº‹ä»¶ç›‘å¬å™¨</h3><p>Spring 4.2å¼€å§‹æä¾›äº†ä¸€ä¸ª@TransactionalEventListeneræ³¨è§£ç”¨äºç›‘å¬æ•°æ®åº“äº‹åŠ¡çš„å„ä¸ªé˜¶æ®µï¼š</p><ol><li>AFTER_COMMIT - äº‹åŠ¡æˆåŠŸæäº¤ï¼›</li><li>AFTER_ROLLBACK â€“ äº‹åŠ¡å›æ»šåï¼›</li><li>AFTER_COMPLETION â€“ äº‹åŠ¡å®Œæˆåï¼ˆæ— è®ºæ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼‰ï¼›</li><li>BEFORE_COMMIT - äº‹åŠ¡æäº¤å‰ï¼›</li></ol><p>ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TransactionalEventListener</span>(phase = TransactionPhase.AFTER_COMMIT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTransactionChange</span><span class="params">(ApplicationEvent event)</span></span>&#123;</span><br><span class="line">    logger.info(<span class="string">"ç›‘å¬åˆ°äº‹åŠ¡æäº¤äº‹ä»¶"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;åœ¨ä½¿ç”¨Springæ„å»ºçš„åº”ç”¨ç¨‹åºä¸­ï¼Œé€‚å½“ä½¿ç”¨äº‹ä»¶å‘å¸ƒä¸ç›‘å¬çš„æœºåˆ¶å¯ä»¥ä½¿æˆ‘ä»¬çš„ä»£ç çµæ´»åº¦æ›´é«˜ï¼Œé™ä½è€¦åˆåº¦ã€‚Springæä¾›äº†å®Œæ•´çš„äº‹ä»¶å‘å¸ƒä¸ç›‘å¬æ¨¡å‹ï¼Œåœ¨è¯¥æ¨¡å‹ä¸­ï¼Œäº‹ä»¶å‘å¸ƒæ–¹åªéœ€å°†äº‹ä»¶å‘å¸ƒå‡ºå»ï¼Œæ— éœ€å…³å¿ƒæœ‰å¤šå°‘ä¸ªå¯¹åº”çš„äº‹ä»¶ç›‘å¬å™¨ï¼›ç›‘å¬å™¨æ— éœ€å…³å¿ƒæ˜¯è°å‘å¸ƒäº†äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶ç›‘å¬æ¥è‡ªå¤šä¸ªäº‹ä»¶å‘å¸ƒæ–¹å‘å¸ƒçš„äº‹ä»¶ï¼Œé€šè¿‡è¿™ç§æœºåˆ¶ï¼Œäº‹ä»¶å‘å¸ƒä¸ç›‘å¬æ˜¯è§£è€¦çš„ã€‚&lt;/p&gt;&lt;p&gt;æœ¬èŠ‚å°†ä¸¾ä¾‹äº‹ä»¶å‘å¸ƒä¸ç›‘å¬çš„ä½¿ç”¨ï¼Œå¹¶ä»‹ç»å†…éƒ¨å®ç°åŸç†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spring" scheme="http://mrbird.cc/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Springå£°æ˜å¼äº‹åŠ¡åŸç†</title>
    <link href="http://mrbird.cc/Spring%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86.html"/>
    <id>http://mrbird.cc/Springå£°æ˜å¼äº‹åŠ¡åŸç†.html</id>
    <published>2020-06-14T01:27:34.000Z</published>
    <updated>2020-12-22T01:34:53.139Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --><p>åœ¨<a href="/Spring-äº‹åŠ¡ç®¡ç†.html">Spring-äº‹åŠ¡ç®¡ç†</a>ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†åœ¨Springä¸­å¦‚ä½•æ–¹ä¾¿çš„ç®¡ç†æ•°æ®åº“äº‹åŠ¡ï¼Œå¹¶äº†è§£äº†ä¸€äº›å’Œäº‹åŠ¡ç›¸å…³çš„ä¸“ä¸šæœ¯è¯­ã€‚æœ¬èŠ‚å°†é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­å›é¡¾Springå£°æ˜å¼äº‹åŠ¡çš„ä½¿ç”¨ï¼Œå¹¶é€šè¿‡æºç è§£è¯»å†…éƒ¨å®ç°åŸç†ï¼Œæœ€åé€šè¿‡åˆ—ä¸¾ä¸€äº›å¸¸è§äº‹åŠ¡ä¸ç”Ÿæ•ˆçš„åœºæ™¯æ¥åŠ æ·±å¯¹Springäº‹åŠ¡åŸç†çš„ç†è§£ã€‚</p><a id="more"></a><h2 id="äº‹åŠ¡ä¾‹å­å›é¡¾"><a href="#äº‹åŠ¡ä¾‹å­å›é¡¾" class="headerlink" title="äº‹åŠ¡ä¾‹å­å›é¡¾"></a>äº‹åŠ¡ä¾‹å­å›é¡¾</h2><p>æ–°å»ºSpringBooté¡¹ç›®ï¼ŒBootç‰ˆæœ¬2.4.0ï¼Œç„¶åå¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>å¼•å…¥äº†JDBCã€MySQLé©±åŠ¨å’Œmybatisç­‰ä¾èµ–ã€‚</p><p>ç„¶ååœ¨Springå…¥å£ç±»ä¸ŠåŠ ä¸Š<code>@EnableTransactionManagement</code>æ³¨è§£ï¼Œä»¥å¼€å¯äº‹åŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SpringApplication.run(TransactionApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ¥ç€æ–°å»ºåç§°ä¸ºtestçš„MySQLæ•°æ®åº“ï¼Œå¹¶åˆ›å»ºUSERè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`USER`</span> (</span><br><span class="line">  <span class="string">`USER_ID`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·ID'</span>,</span><br><span class="line">  <span class="string">`USERNAME`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·å'</span>,</span><br><span class="line">  <span class="string">`AGE`</span> <span class="built_in">varchar</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·å¹´é¾„'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`USER_ID`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure><p></p><p>å…¶ä¸­USER_IDå­—æ®µéç©ºã€‚</p><p>åœ¨application.propertiesé…ç½®ä¸­æ·»åŠ æ•°æ®åº“ç›¸å…³é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br><span class="line">spring.datasource.url=jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&amp;characterEncoding=UTF-8&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=GMT%2b8</span><br></pre></td></tr></table></figure><p></p><p>åˆ›å»ºUSERè¡¨å¯¹åº”å®ä½“ç±»Userï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String userId, String username, String age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(String age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åˆ›å»ºUserMapperï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into user(user_id,username,age) values(#&#123;userId&#125;,#&#123;username&#125;,#&#123;age&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åŒ…å«ä¸€ä¸ªæ–°å¢ç”¨æˆ·çš„æ–¹æ³•saveã€‚</p><p>åˆ›å»ºServiceæ¥å£UserServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å…¶å®ç°ç±»UserServiceImplï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserMapper userMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.save(user);</span><br><span class="line">        <span class="comment">// æµ‹è¯•äº‹åŠ¡å›æ»š</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(user.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"usernameä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨SpringBootçš„å…¥å£ç±»ä¸­æµ‹è¯•ä¸€æ³¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(TransactionApplication.class, args);</span><br><span class="line">        UserService userService = context.getBean(UserService.class);</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">"1"</span>, <span class="keyword">null</span>, <span class="string">"18"</span>);</span><br><span class="line">        userService.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœäº‹åŠ¡ç”Ÿæ•ˆçš„è¯ï¼Œè¿™æ¡æ•°æ®å°†ä¸ä¼šè¢«æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œè¿è¡Œç¨‹åºåï¼ŒæŸ¥çœ‹åº“è¡¨ï¼š</p><p><img src="img/QQ20201221-154216@2x.png" alt="QQ20201221-154216@2x"></p><p>å¯ä»¥çœ‹åˆ°æ•°æ®å¹¶æ²¡æœ‰è¢«æ’å…¥ï¼Œè¯´æ˜äº‹åŠ¡æ§åˆ¶æˆåŠŸã€‚</p><p>æˆ‘ä»¬æ³¨é‡Šæ‰UserServiceImplçš„saveUseræ–¹æ³•ä¸Šçš„<code>@Transactional</code>æ³¨è§£ï¼Œé‡æ–°è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹åº“è¡¨ï¼š</p><p><img src="img/QQ20201221-154521@2x.png" alt="QQ20201221-154521@2x"></p><p>å¯ä»¥çœ‹åˆ°æ•°æ®è¢«æ’å…¥åˆ°æ•°æ®åº“ä¸­äº†ï¼Œäº‹åŠ¡æ§åˆ¶å¤±æ•ˆã€‚</p><h2 id="äº‹åŠ¡åŸç†"><a href="#äº‹åŠ¡åŸç†" class="headerlink" title="äº‹åŠ¡åŸç†"></a>äº‹åŠ¡åŸç†</h2><h3 id="EnableTransactionManagement"><a href="#EnableTransactionManagement" class="headerlink" title="@EnableTransactionManagement"></a>@EnableTransactionManagement</h3><p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ¨¡å—é©±åŠ¨æ³¨è§£<code>@EnableTransactionManagement</code>å¼€å¯äº†äº‹åŠ¡ç®¡ç†åŠŸèƒ½ï¼ŒæŸ¥çœ‹å…¶æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥15-53-04.png" alt="2020å¹´12æœˆ21æ—¥15-53-04"></p><p>æ¥ç€æŸ¥çœ‹TransactionManagementConfigurationSelectorçš„æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥15-57-32.png" alt="2020å¹´12æœˆ21æ—¥15-57-32"></p><div class="note info">å¯¹é€šè¿‡Selectorå¾€IOCå®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶ä¸ç†Ÿæ‚‰çš„è¯»è€…å¯ä»¥å‚è€ƒ<a href="/Spring-Bean-Regist.html">æ·±å…¥å­¦ä¹ Springç»„ä»¶æ³¨å†Œ</a>ã€‚</div><p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹å…³æ³¨AutoProxyRegistrarå’ŒProxyTransactionManagementConfigurationçš„é€»è¾‘å³å¯ã€‚</p><h3 id="AutoProxyRegistrar"><a href="#AutoProxyRegistrar" class="headerlink" title="AutoProxyRegistrar"></a>AutoProxyRegistrar</h3><p>æŸ¥çœ‹AutoProxyRegistrarçš„æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥16-11-23.png" alt="2020å¹´12æœˆ21æ—¥16-11-23"></p><p>æŸ¥çœ‹<code>AopConfigUtils.registerAutoProxyCreatorIfNecessary(registry)</code>æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥16-15-50.png" alt="2020å¹´12æœˆ21æ—¥16-15-50"></p><p>æŸ¥çœ‹<code>InfrastructureAdvisorAutoProxyCreator</code>çš„å±‚çº§å…³ç³»å›¾ï¼š</p><p><img src="img/QQ20201221-162016@2x.png" alt="QQ20201221-162016@2x"></p><p>è¿™å’Œ<a href="/æ·±å…¥ç†è§£Spring-AOPåŸç†.html">æ·±å…¥ç†è§£Spring-AOPåŸç†</a>ä¸€æ–‡ä¸­çš„AnnotationAwareAspectJAutoProxyCreatorçš„å±‚çº§å…³ç³»å›¾ä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºInfrastructureAdvisorAutoProxyCreatorçš„ä½œç”¨ä¸ºï¼šä¸ºç›®æ ‡Serviceåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¢å¼ºç›®æ ‡Serviceæ–¹æ³•ï¼Œç”¨äºäº‹åŠ¡æ§åˆ¶ã€‚</p><h3 id="ProxyTransactionManagementConfiguration"><a href="#ProxyTransactionManagementConfiguration" class="headerlink" title="ProxyTransactionManagementConfiguration"></a>ProxyTransactionManagementConfiguration</h3><p>æŸ¥çœ‹ProxyTransactionManagementConfigurationæºç ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥16-57-15.png" alt="2020å¹´12æœˆ21æ—¥16-57-15"></p><ol><li><p>æ³¨å†ŒBeanFactoryTransactionAttributeSourceAdvisorå¢å¼ºå™¨ï¼Œè¯¥å¢å¼ºå™¨éœ€è¦å¦‚ä¸‹ä¸¤ä¸ªBeanï¼š</p><ul><li>TransactionAttributeSource</li><li>TransactionInterceptor</li></ul></li><li><p>æ³¨å†ŒTransactionAttributeSourceï¼š</p><p><img src="img/QQ20201221-170327@2x.png" alt="QQ20201221-170327@2x"></p><p>æ–¹æ³•ä½“å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªç±»å‹ä¸ºAnnotationTransactionAttributeSourceçš„Beanï¼ŒæŸ¥çœ‹å…¶æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥17-02-22.png" alt="2020å¹´12æœˆ21æ—¥17-02-22"></p><p>æŸ¥çœ‹SpringTransactionAnnotationParseræºç ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥17-06-16.png" alt="2020å¹´12æœˆ21æ—¥17-06-16"></p></li><li><p>æ³¨å†ŒTransactionInterceptoräº‹åŠ¡æ‹¦æˆªå™¨ï¼š</p><p><img src="img/QQ20201221-170716@2x.png" alt="QQ20201221-170716@2x"></p><p>æŸ¥çœ‹TransactionInterceptoræºç ï¼Œå…¶å®ç°äº†MethodInterceptoræ–¹æ³•æ‹¦æˆªå™¨æ¥å£ï¼Œåœ¨<a href="/æ·±å…¥ç†è§£Spring-AOPåŸç†.html">æ·±å…¥ç†è§£Spring-AOPåŸç†</a>ä¸€æ–‡ä¸­æ›¾ä»‹ç»è¿‡ï¼ŒMethodBeforeAdviceInterceptorã€AspectJAfterAdviceã€AfterReturningAdviceInterceptorå’ŒAspectJAfterThrowingAdviceç­‰å¢å¼ºå™¨éƒ½æ˜¯MethodInterceptorçš„å®ç°ç±»ï¼Œç›®æ ‡æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œå¯¹åº”æ‹¦æˆªå™¨çš„invokeæ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥é‡ç‚¹å…³æ³¨TransactionInterceptorå®ç°çš„invokeæ–¹æ³•ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥17-14-11.png" alt="2020å¹´12æœˆ21æ—¥17-14-11"></p><p>æŸ¥çœ‹invokeWithinTransactionæ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥18-33-23.png" alt="2020å¹´12æœˆ21æ—¥18-33-23"></p></li></ol><p>completeTransactionAfterThrowingæºç å¦‚ä¸‹ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥18-41-49.png" alt="2020å¹´12æœˆ21æ—¥18-41-49"></p><p>è¿™é‡Œï¼Œå‡å¦‚æ²¡æœ‰åœ¨@Transactionalæ³¨è§£ä¸ŠæŒ‡å®šå›æ»šçš„å¼‚å¸¸ç±»å‹çš„è¯ï¼Œé»˜è®¤åªå¯¹RunTimeExcetionå’ŒErrorç±»å‹å¼‚å¸¸è¿›è¡Œå›æ»šï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥18-43-45.png" alt="2020å¹´12æœˆ21æ—¥18-43-45"></p><p>commitTransactionAfterReturningæºç å¦‚ä¸‹ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥18-45-46.png" alt="2020å¹´12æœˆ21æ—¥18-45-46"></p><h3 id="debugéªŒè¯"><a href="#debugéªŒè¯" class="headerlink" title="debugéªŒè¯"></a>debugéªŒè¯</h3><p>é‡æ–°æ‰“å¼€UserServiceImplçš„saveUseræ–¹æ³•ä¸Šçš„<code>@Transactional</code>æ³¨è§£ï¼Œç„¶ååœ¨å¦‚ä¸‹æ‰€ç¤ºä½ç½®æ‰“ä¸ªæ–­ç‚¹ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥18-50-14.png" alt="2020å¹´12æœˆ21æ—¥18-50-14"></p><p>ä»¥debugçš„æ–¹å¼å¯åŠ¨ç¨‹åºï¼š</p><p><img src="img/QQ20201221-185241@2x.png" alt="QQ20201221-185241@2x"></p><p>å¯ä»¥çœ‹åˆ°ç›®æ ‡å¯¹è±¡å·²ç»è¢«JDKä»£ç†ï¼ˆç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé»˜è®¤èµ°JDKåŠ¨æ€ä»£ç†ã€‚å¯ä»¥é€šè¿‡spring.aop.proxy-target-class=trueé…ç½®æ¥å¼ºåˆ¶ä½¿ç”¨cglibä»£ç†ï¼Œéœ€è¦é¢å¤–å¼•å…¥AOPè‡ªåŠ¨è£…é…ä¾èµ–ï¼‰ã€‚</p><p>åœ¨æ–­ç‚¹å¤„æ‰§è¡ŒStep Intoï¼Œç¨‹åºè·³è½¬åˆ°JdkDynamicAopProxyçš„invokeæ–¹æ³•ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥19-01-32.png" alt="2020å¹´12æœˆ21æ—¥19-01-32"></p><p><img src="img/2020å¹´12æœˆ21æ—¥19-05-09.png" alt="2020å¹´12æœˆ21æ—¥19-05-09"></p><p>ç¨‹åºè·³è½¬åˆ°TransactionInterceptorçš„invokeæ–¹æ³•ï¼š</p><p><img src="img/2020å¹´12æœˆ21æ—¥19-06-43.png" alt="2020å¹´12æœˆ21æ—¥19-06-43"></p><p><img src="img/2020å¹´12æœˆ21æ—¥19-09-45.png" alt="2020å¹´12æœˆ21æ—¥19-09-45"></p><p>å¯ä»¥çœ‹åˆ°æ•´ä¸ªè¿‡ç¨‹å’Œ<a href="/æ·±å…¥ç†è§£Spring-AOPåŸç†.html">æ·±å…¥ç†è§£Spring-AOPåŸç†</a>ä¸€æ–‡ä»‹ç»çš„ä¸€è‡´ã€‚</p><h2 id="äº‹åŠ¡ä¸ç”Ÿæ•ˆåœºæ™¯"><a href="#äº‹åŠ¡ä¸ç”Ÿæ•ˆåœºæ™¯" class="headerlink" title="äº‹åŠ¡ä¸ç”Ÿæ•ˆåœºæ™¯"></a>äº‹åŠ¡ä¸ç”Ÿæ•ˆåœºæ™¯</h2><p>å¯¹Springäº‹åŠ¡æœºåˆ¶ä¸ç†Ÿæ‚‰çš„coderç»å¸¸ä¼šé‡åˆ°äº‹åŠ¡ä¸ç”Ÿæ•ˆçš„åœºæ™¯ï¼Œè¿™é‡Œåˆ—ä¸¾ä¸¤ä¸ªæœ€ä¸ºå¸¸è§çš„åœºæ™¯ï¼Œå¹¶ç»™å‡ºå¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="åœºæ™¯ä¸€"><a href="#åœºæ™¯ä¸€" class="headerlink" title="åœºæ™¯ä¸€"></a>åœºæ™¯ä¸€</h3><p>Serviceæ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ä¸æ˜¯RuntimeExceptionæˆ–è€…Errorç±»å‹ï¼Œå¹¶ä¸”@Transactionalæ³¨è§£ä¸Šæ²¡æœ‰æŒ‡å®šå›æ»šå¼‚å¸¸ç±»å‹ã€‚</p><p>å¯¹åº”çš„ä»£ç ä¾‹å­ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserMapper userMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        userMapper.save(user);</span><br><span class="line">        <span class="comment">// æµ‹è¯•äº‹åŠ¡å›æ»š</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(user.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"usernameä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™å†²æƒ…å†µä¸‹ï¼ŒSpringå¹¶ä¸ä¼šè¿›è¡Œäº‹åŠ¡å›æ»šæ“ä½œã€‚</p><p>æ­£å¦‚@Transactionalæ³¨è§£æºç æ³¨é‡Šæ‰€è¿°çš„é‚£æ ·ï¼š</p><p><img src="img/QQ20201221-191914@2x.png" alt="QQ20201221-191914@2x"></p><p><strong>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringäº‹åŠ¡åªå¯¹RuntimeExceptionæˆ–è€…Errorç±»å‹å¼‚å¸¸ï¼ˆé”™è¯¯ï¼‰è¿›è¡Œå›æ»šï¼Œæ£€æŸ¥å¼‚å¸¸ï¼ˆé€šå¸¸ä¸ºä¸šåŠ¡ç±»å¼‚å¸¸ï¼‰ä¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šã€‚</strong>ã€‚</p><p>æ‰€ä»¥è¦è§£å†³ä¸Šé¢è¿™ä¸ªäº‹åŠ¡ä¸ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>æ‰‹åŠ¨åœ¨@Transactionalæ³¨è§£ä¸Šå£°æ˜å›æ»šçš„å¼‚å¸¸ç±»å‹ï¼ˆæ–¹æ³•æŠ›å‡ºè¯¥å¼‚å¸¸åŠå…¶æ‰€æœ‰å­ç±»å‹å¼‚å¸¸éƒ½èƒ½è§¦å‘äº‹åŠ¡å›æ»šï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserMapper userMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(rollbackFor = Exception.class)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        userMapper.save(user);</span><br><span class="line">        <span class="comment">// æµ‹è¯•äº‹åŠ¡å›æ»š</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(user.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"usernameä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•å†…æ‰‹åŠ¨æŠ›å‡ºçš„æ£€æŸ¥å¼‚å¸¸ç±»å‹æ”¹ä¸ºRuntimeExceptionå­ç±»å‹ï¼š</p><p>å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±»å‹ParamInvalidExceptionï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamInvalidException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ParamInvalidException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹UserServiceImplçš„saveUseræ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserMapper userMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.save(user);</span><br><span class="line">        <span class="comment">// æµ‹è¯•äº‹åŠ¡å›æ»š</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(user.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ParamInvalidException(<span class="string">"usernameä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>è¿™ä¸¤ç§æ–¹å¼éƒ½èƒ½è®©äº‹åŠ¡æŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸç”Ÿæ•ˆã€‚</p><h3 id="åœºæ™¯äºŒ"><a href="#åœºæ™¯äºŒ" class="headerlink" title="åœºæ™¯äºŒ"></a>åœºæ™¯äºŒ</h3><p>éäº‹åŠ¡æ–¹æ³•ç›´æ¥é€šè¿‡thisè°ƒç”¨æœ¬ç±»äº‹åŠ¡æ–¹æ³•ã€‚è¿™ç§æƒ…å†µä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä¿®æ”¹UserServiceImplï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserMapper userMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUserTest</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.save(user);</span><br><span class="line">        <span class="comment">// æµ‹è¯•äº‹åŠ¡å›æ»š</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(user.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ParamInvalidException(<span class="string">"usernameä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨UserServiceImplä¸­ï¼Œæˆ‘ä»¬æ–°å¢äº†saveUserTestæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ²¡æœ‰ä½¿ç”¨@Transactionalæ³¨è§£æ ‡æ³¨ï¼Œä¸ºéäº‹åŠ¡æ–¹æ³•ï¼Œå†…éƒ¨ç›´æ¥è°ƒç”¨äº†saveUseräº‹åŠ¡æ–¹æ³•ã€‚</p><p>åœ¨å…¥å£ç±»é‡Œæµ‹è¯•è¯¥æ–¹æ³•çš„è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(TransactionApplication.class, args);</span><br><span class="line">        UserService userService = context.getBean(UserService.class);</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">"2"</span>, <span class="keyword">null</span>, <span class="string">"28"</span>);</span><br><span class="line">        userService.saveUserTest(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç¨‹åºï¼Œè§‚å¯Ÿæ•°æ®åº“æ•°æ®ï¼š</p><p><img src="img/QQ20201222-091609@2x.png" alt="QQ20201222-091609@2x"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡å¹¶æ²¡æœ‰å›æ»šï¼Œæ•°æ®å·²ç»è¢«æ’å…¥åˆ°äº†æ•°æ®åº“ä¸­ã€‚</p><p><strong>è¿™ç§æƒ…å†µä¸‹äº‹åŠ¡å¤±æ•ˆçš„åŸå› ä¸ºï¼šSpringäº‹åŠ¡æ§åˆ¶ä½¿ç”¨AOPä»£ç†å®ç°ï¼Œé€šè¿‡å¯¹ç›®æ ‡å¯¹è±¡çš„ä»£ç†æ¥å¢å¼ºç›®æ ‡æ–¹æ³•ã€‚è€Œä¸Šé¢ä¾‹å­ç›´æ¥é€šè¿‡thisè°ƒç”¨æœ¬ç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œthisçš„æŒ‡å‘å¹¶éä»£ç†ç±»ï¼Œè€Œæ˜¯è¯¥ç±»æœ¬èº«ã€‚</strong></p><p>ä½¿ç”¨debugæ¥éªŒè¯thisæ˜¯å¦ä¸ºä»£ç†å¯¹è±¡ï¼š</p><p><img src="img/2020å¹´12æœˆ22æ—¥09-23-04.png" alt="2020å¹´12æœˆ22æ—¥09-23-04"></p><p>è¿™ç§æƒ…å†µä¸‹è¦è®©äº‹åŠ¡ç”Ÿæ•ˆä¸»è¦æœ‰å¦‚ä¸‹ä¸¤ç§è§£å†³æ–¹å¼ï¼ˆåŸç†éƒ½æ˜¯ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥æ›¿ä»£thisï¼‰ï¼š</p><ol><li>ä»IOCå®¹å™¨ä¸­è·å–UserService Beanï¼Œç„¶åè°ƒç”¨å®ƒçš„saveUseræ–¹æ³•ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span>, <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserMapper userMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUserTest</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        UserService userService = context.getBean(UserService.class);</span><br><span class="line">        userService.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.save(user);</span><br><span class="line">        <span class="comment">// æµ‹è¯•äº‹åŠ¡å›æ»š</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(user.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ParamInvalidException(<span class="string">"usernameä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æˆ‘ä»¬é€šè¿‡å®ç°ApplicationContextAwareæ¥å£æ³¨å…¥äº†åº”ç”¨ä¸Šä¸‹æ–‡ApplicationContextï¼Œç„¶åä»ä¸­å–å‡ºUserService Beanæ¥ä»£æ›¿thisã€‚</p><ol start="2"><li><p>ä»AOPä¸Šä¸‹æ–‡ä¸­å–å‡ºå½“å‰ä»£ç†å¯¹è±¡ï¼š</p><p>è¿™ç§æƒ…å†µé¦–å…ˆéœ€è¦å¼•å…¥AOP Starterï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨SpringBootå…¥å£ç±»ä¸­é€šè¿‡æ³¨è§£@EnableAspectJAutoProxy(exposeProxy = true)å°†å½“å‰ä»£ç†å¯¹è±¡æš´éœ²åˆ°AOPä¸Šä¸‹æ–‡ä¸­ï¼ˆé€šè¿‡AopContextçš„ThreadLocalå®ç°ï¼‰ã€‚</p><p>æœ€ååœ¨UserServcieImplçš„saveUserTestæ–¹æ³•ä¸­é€šè¿‡AopContextè·å–UserServceçš„ä»£ç†å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserMapper userMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUserTest</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        UserService userService = (UserService) AopContext.currentProxy();</span><br><span class="line">        userService.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.save(user);</span><br><span class="line">        <span class="comment">// æµ‹è¯•äº‹åŠ¡å›æ»š</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(user.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ParamInvalidException(<span class="string">"usernameä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;åœ¨&lt;a href=&quot;/Spring-äº‹åŠ¡ç®¡ç†.html&quot;&gt;Spring-äº‹åŠ¡ç®¡ç†&lt;/a&gt;ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†åœ¨Springä¸­å¦‚ä½•æ–¹ä¾¿çš„ç®¡ç†æ•°æ®åº“äº‹åŠ¡ï¼Œå¹¶äº†è§£äº†ä¸€äº›å’Œäº‹åŠ¡ç›¸å…³çš„ä¸“ä¸šæœ¯è¯­ã€‚æœ¬èŠ‚å°†é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­å›é¡¾Springå£°æ˜å¼äº‹åŠ¡çš„ä½¿ç”¨ï¼Œå¹¶é€šè¿‡æºç è§£è¯»å†…éƒ¨å®ç°åŸç†ï¼Œæœ€åé€šè¿‡åˆ—ä¸¾ä¸€äº›å¸¸è§äº‹åŠ¡ä¸ç”Ÿæ•ˆçš„åœºæ™¯æ¥åŠ æ·±å¯¹Springäº‹åŠ¡åŸç†çš„ç†è§£ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spring" scheme="http://mrbird.cc/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥ç†è§£Spring AOPåŸç†</title>
    <link href="http://mrbird.cc/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Spring-AOP%E5%8E%9F%E7%90%86.html"/>
    <id>http://mrbird.cc/æ·±å…¥ç†è§£Spring-AOPåŸç†.html</id>
    <published>2020-06-08T01:04:57.000Z</published>
    <updated>2020-12-11T01:52:25.342Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --><p>AOPåº•å±‚ä¸ºåŠ¨æ€ä»£ç†ï¼ŒAOPæŒ‡çš„æ˜¯ï¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€åœ°å°†æŸæ®µä»£ç åˆ‡å…¥åˆ°æŒ‡å®šæ–¹æ³•æŒ‡å®šä½ç½®è¿›è¡Œè¿è¡Œçš„ç¼–ç¨‹æ–¹å¼ï¼Œç›¸å…³è®¾è®¡æ¨¡å¼ä¸ºä»£ç†æ¨¡å¼ã€‚æœ¬èŠ‚å°†é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­å›é¡¾Spring AOPçš„ä½¿ç”¨ï¼Œå¹¶ä¸”é€šè¿‡debugæºç æ·±å…¥ç†è§£å†…éƒ¨åŸç†ã€‚hintsï¼šæœ¬èŠ‚å›¾ç‰‡è¾ƒå¤šï¼ŒåŠ è½½è¾ƒæ…¢ã€‚</p><a id="more"></a><h2 id="å›é¡¾Spring-AOPçš„ä½¿ç”¨"><a href="#å›é¡¾Spring-AOPçš„ä½¿ç”¨" class="headerlink" title="å›é¡¾Spring AOPçš„ä½¿ç”¨"></a>å›é¡¾Spring AOPçš„ä½¿ç”¨</h2><p>æ–°å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼ŒSpringBootç‰ˆæœ¬ä¸º2.4.0ï¼Œå¼•å…¥å¦‚ä¸‹ä¸¤ä¸ªä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>ç„¶ååˆ›å»ºä¸€ä¸ªç›®æ ‡ç±»TatgetClassï¼ŒåŒ…å«å¾…ä¼šéœ€è¦è¢«AOPä»£ç†å¢å¼ºçš„æ–¹æ³•testï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TargetClass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç›®æ ‡æ–¹æ³•testè¢«æ‰§è¡Œ"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasLength(value)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"valueä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¼–å†™åˆ‡é¢ç±»MyAspectï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(public * cc.mrbird..*.TargetClass.test(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointcut</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"pointcut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBefore</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onBeforeï¼š"</span> + joinPoint.getSignature().getName() + <span class="string">"æ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œå‚æ•°ï¼š"</span></span><br><span class="line">                + Arrays.asList(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"pointcut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAfter</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onAfterï¼š"</span> + joinPoint.getSignature().getName() + <span class="string">"æ–¹æ³•æ‰§è¡Œç»“æŸï¼Œå‚æ•°ï¼š"</span></span><br><span class="line">                + Arrays.asList(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(value = <span class="string">"pointcut()"</span>, returning = <span class="string">"result"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"afterReturningï¼š"</span> + joinPoint.getSignature().getName() + <span class="string">"æ–¹æ³•æ‰§è¡Œç»“æŸè¿”å›ï¼Œå‚æ•°ï¼š"</span></span><br><span class="line">                + Arrays.asList(joinPoint.getArgs()) + <span class="string">"ï¼Œè¿”å›å€¼ï¼š"</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(value = <span class="string">"pointcut()"</span>, throwing = <span class="string">"exception"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(JoinPoint joinPoint, Exception exception)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"afterThrowingï¼š"</span> + joinPoint.getSignature().getName() + <span class="string">"æ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼Œå‚æ•°ï¼š"</span></span><br><span class="line">                + Arrays.asList(joinPoint.getArgs()) + <span class="string">"ï¼Œå¼‚å¸¸ï¼š"</span> + exception);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¯¥åˆ‡é¢åŒ…å«äº†4ä¸ªé€šçŸ¥æ–¹æ³•ï¼š</p><ul><li>å‰ç½®é€šçŸ¥ï¼ˆ@Beforeï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰è°ƒç”¨é€šçŸ¥åŠŸèƒ½ï¼›</li><li>åç½®é€šçŸ¥ï¼ˆ@Afterï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•å®Œæˆä¹‹åè°ƒç”¨é€šçŸ¥ï¼Œæ­¤æ—¶ä¸ä¼šå…³å¿ƒæ–¹æ³•çš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼›</li><li>è¿”å›é€šçŸ¥ï¼ˆ@AfterReturningï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åè°ƒç”¨é€šçŸ¥ï¼›</li><li>å¼‚å¸¸é€šçŸ¥ï¼ˆ@AfterThrowingï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨é€šçŸ¥ã€‚</li></ul><p>è¿™å‡ ä¸ªé€šçŸ¥çš„é¡ºåºåœ¨ä¸åŒçš„Springç‰ˆæœ¬ä¸­æœ‰æ‰€ä¸åŒï¼š</p><ol><li><p>Spring4.x</p><ul><li>æ­£å¸¸æƒ…å†µï¼š@Before â€”-&gt; ç›®æ ‡æ–¹æ³• â€”-&gt; @After â€”-&gt; @AfterReturning</li><li>å¼‚å¸¸æƒ…å†µï¼š@Before â€”-&gt; ç›®æ ‡æ–¹æ³• â€”-&gt; @After â€”-&gt; @AfterThrowing</li></ul></li><li><p>Spring5.x</p><ul><li>æ­£å¸¸æƒ…å†µï¼š@Before â€”-&gt; ç›®æ ‡æ–¹æ³• â€”-&gt; @AfterReturning â€”-&gt; @After</li><li>å¼‚å¸¸æƒ…å†µï¼š@Before â€”-&gt; ç›®æ ‡æ–¹æ³• â€”-&gt; @AfterThrowing â€”-&gt; @After</li></ul></li></ol><p>å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ï¼š<a href="https://www.cnblogs.com/orzjiangxiaoyu/p/13869747.html" target="_blank" rel="noopener">https://www.cnblogs.com/orzjiangxiaoyu/p/13869747.html</a>ã€‚é€šçŸ¥é¡ºåºå¹¶ä¸å½±å“æœ¬æ–‡å¯¹SpringAOPæºç çš„ç†è§£ã€‚</p><p>åœ¨SpringBootå…¥å£ç±»æµ‹è¯•AOPç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(AopApplication.class, args);</span><br><span class="line">        TargetClass targetClass = context.getBean(TargetClass.class);</span><br><span class="line">        targetClass.test(<span class="string">"aop"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¸»è¦é€»è¾‘ä¸ºä»IOCå®¹å™¨ä¸­è·å–TargetClass Beanï¼Œç„¶åè°ƒç”¨å…¶testæ–¹æ³•ï¼Œç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onBeforeï¼štestæ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œå‚æ•°ï¼š[aop]</span><br><span class="line">ç›®æ ‡æ–¹æ³•testè¢«æ‰§è¡Œ</span><br><span class="line">afterReturningï¼štestæ–¹æ³•æ‰§è¡Œç»“æŸè¿”å›ï¼Œå‚æ•°ï¼š[aop]ï¼Œè¿”å›å€¼ï¼šaop</span><br><span class="line">onAfterï¼štestæ–¹æ³•æ‰§è¡Œç»“æŸï¼Œå‚æ•°ï¼š[aop]</span><br></pre></td></tr></table></figure><p></p><p><code>test</code>æ–¹æ³•å‚æ•°ä¸ºç©ºæ—¶ï¼Œç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onBeforeï¼štestæ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œå‚æ•°ï¼š[]</span><br><span class="line">ç›®æ ‡æ–¹æ³•testè¢«æ‰§è¡Œ</span><br><span class="line">afterThrowingï¼štestæ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼Œå‚æ•°ï¼š[]ï¼Œå¼‚å¸¸ï¼šjava.lang.RuntimeException: valueä¸èƒ½ä¸ºç©º</span><br><span class="line">onAfterï¼štestæ–¹æ³•æ‰§è¡Œç»“æŸï¼Œå‚æ•°ï¼š[]</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æˆåŠŸé€šè¿‡Spring AOPå°†å„ä¸ªé€šçŸ¥æ–¹æ³•ç»‡å…¥åˆ°äº†ç›®æ ‡æ–¹æ³•çš„å„ä¸ªæ‰§è¡Œé˜¶æ®µï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥æ·±å…¥æ¢ç©¶Spring AOPçš„å®ç°åŸç†ã€‚</p><h2 id="EnableAspectJAutoProxy"><a href="#EnableAspectJAutoProxy" class="headerlink" title="@EnableAspectJAutoProxy"></a>@EnableAspectJAutoProxy</h2><p>å‰é¢æˆ‘ä»¬å¼•å…¥äº†Spring AOPå¼€ç®±å³ç”¨çš„starter<code>spring-boot-starter-aop</code>ï¼Œ@Enableæ¨¡å—é©±åŠ¨æ³¨è§£<code>EnableAspectJAutoProxy</code>ç”¨äºå¼€å¯AspectJè‡ªåŠ¨ä»£ç†ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import</span>(&#123;AspectJAutoProxyRegistrar.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAspectJAutoProxy &#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">proxyTargetClass</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">exposeProxy</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¯¥æ³¨è§£ç±»ä¸Šé€šè¿‡@Importå¯¼å…¥äº†<code>AspectJAutoProxyRegistrar</code>AspectJè‡ªåŠ¨ä»£ç†æ³¨å†Œå™¨ï¼ˆå¯¹@Importä¸äº†è§£çš„è¯»è€…å¯ä»¥å‚è€ƒ<a href="/Spring-Bean-Regist.html">æ·±å…¥å­¦ä¹ Springç»„ä»¶æ³¨å†Œ</a>ï¼‰ï¼ŒæŸ¥çœ‹<code>AspectJAutoProxyRegistrar</code>çš„æºç ï¼š</p><p><img src="img/QQ20201208-141342@2x.png" alt="QQ20201208-141342@2x"></p><p>é€šè¿‡æ³¨é‡Šæˆ‘ä»¬å¤§ä½“å¯ä»¥çŸ¥é“ï¼Œè¯¥æ³¨å†Œå™¨çš„ä½œç”¨æ˜¯å¾€IOCå®¹å™¨é‡Œæ³¨å†Œäº†ä¸€ä¸ªç±»å‹ä¸º<code>AnnotationAwareAspectJAutoProxyCreator</code>ï¼ˆæ³¨è§£é©±åŠ¨çš„AspectJè‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨ï¼‰çš„Beanã€‚è¯¥ç±»çš„<code>registerBeanDefinitions</code>æ–¹æ³•ä¸»è¦å…³æ³¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(registry);</span><br></pre></td></tr></table></figure><p></p><p>æŸ¥çœ‹å…¶æºç ï¼š</p><p><img src="img/dddddddddddddddd.png" alt="dddddddddddddddd"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¸å¿ƒé€»è¾‘ä¸ºé€šè¿‡<code>RootBeanDefinition</code>å¾€IOCæ³¨å†Œäº†åç§°ä¸º<code>AUTO_PROXY_CREATOR_BEAN_NAME</code>ï¼ˆå¸¸é‡ï¼Œå€¼ä¸ºorg.springframework.aop.config.internalAutoProxyCreatorï¼‰ï¼Œç±»å‹ä¸ºAnnotationAwareAspectJAutoProxyCreatorçš„Beanï¼ˆå¯¹è¿™ç§é€šè¿‡ImportBeanDefinitionRegistrarå¾€IOCæ³¨å†ŒBeanæ–¹å¼ä¸äº†è§£çš„è¯»è€…å¯ä»¥å‚è€ƒ<a href="/Spring-Bean-Regist.html">æ·±å…¥å­¦ä¹ Springç»„ä»¶æ³¨å†Œ</a>ï¼‰ã€‚</p><div class="note info">æ€»ç»“ï¼š<code>@EnableAspectJAutoProxy</code>æ¨¡å—é©±åŠ¨æ³¨è§£å¾€IOCå®¹å™¨ä¸­æ³¨å†Œäº†ç±»å‹ä¸ºAnnotationAwareAspectJAutoProxyCreatorçš„Beanï¼ŒBeanåç§°ä¸ºorg.springframework.aop.config.internalAutoProxyCreatorã€‚</div><h2 id="AnnotationAwareAspectJAutoProxyCreator-class-hierarchy"><a href="#AnnotationAwareAspectJAutoProxyCreator-class-hierarchy" class="headerlink" title="AnnotationAwareAspectJAutoProxyCreator class hierarchy"></a>AnnotationAwareAspectJAutoProxyCreator class hierarchy</h2><p>é€šè¿‡å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬çš„ç›®å…‰èšç„¦åœ¨<code>AnnotationAwareAspectJAutoProxyCreator</code>ç±»ä¸Šï¼Œä¸ºäº†ææ¸…æ¥šè¿™ä¸ªç±»çš„ä½œç”¨ï¼Œæˆ‘ä»¬å…ˆæ‹æ¸…ç±»çš„å±‚çº§å…³ç³»ï¼š</p><p><img src="img/QQ20201208-143923@2x.png" alt="QQ20201208-143923@2x"></p><p>å¯ä»¥çœ‹åˆ°AnnotationAwareAspectJAutoProxyCreatorçš„çˆ¶ç±»AbstractAutoProxyCreatorå®ç°äº†SmartInstantiationAwareBeanPostProcessorå’ŒBeanFactoryAwareæ¥å£ã€‚å®ç°BeanFactoryAwareç”¨äºåœ¨Beanåˆå§‹åŒ–æ—¶æ³¨å…¥BeanFactoryï¼Œè€ŒSmartInstantiationAwareBeanPostProcessoræ¥å£çš„çˆ¶ç±»ä¸ºInstantiationAwareBeanPostProcessoræ¥å£ï¼Œè¯¥æ¥å£ç»§æ‰¿è‡ªBeanPostProcessoræ¥å£ã€‚</p><p>é€šè¿‡<a href="/æ·±å…¥ç†è§£Spring-BeanPostProcessor-InstantiationAwareBeanPostProcessor.html">æ·±å…¥ç†è§£Spring BeanPostProcessor &amp; InstantiationAwareBeanPostProcessor</a>ä¸€èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“BeanPostProcessoræ¥å£å’ŒInstantiationAwareBeanPostProcessoræ¥å£åŒ…å«ä¸€äº›ç”¨äºBeanå®ä¾‹åŒ–åˆå§‹åŒ–å‰åè¿›è¡Œè‡ªå®šä¹‰æ“ä½œçš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¤§ä½“å¯ä»¥çŒœæµ‹å‡ºç›®æ ‡Beançš„ä»£ç†æ˜¯åœ¨è¿™äº›æ¥å£æ–¹æ³•é‡Œå®ç°çš„ã€‚</p><p>é€šè¿‡æŸ¥çœ‹AnnotationAwareAspectJAutoProxyCreatoråŠå…¶å„ä¸ªå±‚çº§çˆ¶ç±»æºç å¯ä»¥å‘ç°ï¼ŒAbstractAutoProxyCreatorç±»å®ç°äº†InstantiationAwareBeanPostProcessoræ¥å£çš„postProcessBeforeInstantiationæ–¹æ³•ï¼ˆè‡ªå®šä¹‰Beanå®ä¾‹åŒ–å‰æ“ä½œé€»è¾‘ï¼‰ï¼Œå®ç°äº†BeanPostProcessorçš„postProcessAfterInitializationæ–¹æ³•ï¼ˆè‡ªå®šä¹‰Beanåˆå§‹åŒ–åæ“ä½œé€»è¾‘ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸Šæ‰“ä¸ªç«¯ç‚¹ï¼Œç”¨äºåç»­debugï¼š</p><p><img src="img/2020å¹´12æœˆ10æ—¥10-33-06.png" alt="2020å¹´12æœˆ10æ—¥10-33-06"></p><h2 id="AOPä»£ç†åˆ›å»ºè¿‡ç¨‹"><a href="#AOPä»£ç†åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="AOPä»£ç†åˆ›å»ºè¿‡ç¨‹"></a>AOPä»£ç†åˆ›å»ºè¿‡ç¨‹</h2><p>æˆ‘ä»¬ä»¥debugçš„æ–¹å¼å¯åŠ¨å‰é¢çš„AOPä¾‹å­ï¼Œå› ä¸ºåç½®å¤„ç†å™¨å¯¹æ‰€æœ‰Beanéƒ½ç”Ÿæ•ˆï¼Œæ‰€ä»¥æ¯ä¸ªBeanåˆ›å»ºæ—¶éƒ½ä¼šè¿›å…¥æˆ‘ä»¬åˆšåˆšæ‰“æ–­ç‚¹çš„é‚£ä¸¤ä¸ªæ–¹æ³•ä¸­ã€‚ä½†æˆ‘ä»¬åªå…³å¿ƒSpring AOPæ˜¯æ€æ ·å¢å¼ºæˆ‘ä»¬å®šä¹‰çš„ç›®æ ‡ç±»TargetClassçš„ï¼Œæ‰€ä»¥å¦‚æœBeanç±»å‹ä¸æ˜¯TargetClassï¼Œæˆ‘ä»¬éƒ½ç›´æ¥ç‚¹å‡»Resume ProgramæŒ‰é’®è·³è¿‡ï¼Œç›´åˆ°Beanç±»å‹æ˜¯TargetClassï¼š</p><p><img src="img/QQ20201210-104756@2x.png" alt="QQ20201210-104756@2x"></p><p>postProcessBeforeInstantiationæ–¹æ³•ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼š</p><p><img src="img/2020å¹´12æœˆ10æ—¥13-58-48.png" alt="2020å¹´12æœˆ10æ—¥13-58-48"></p><ol><li><p>é€šè¿‡Beanåç§°å’ŒBeanç±»å‹è·å–è¯¥Beançš„å”¯ä¸€ç¼“å­˜é”®åï¼ŒgetCacheKeyæ–¹æ³•æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/2020å¹´12æœˆ10æ—¥14-05-07.png" alt="2020å¹´12æœˆ10æ—¥14-05-07"></p><p>åœ¨è¿™é‡Œï¼ŒcacheKeyçš„å€¼ä¸ºtargetClassã€‚</p></li><li><p>åˆ¤æ–­å½“å‰Beanï¼ˆTargetClassï¼‰æ˜¯å¦åŒ…å«åœ¨advisedBeansé›†åˆä¸­ï¼ˆAbstractAutoProxyCreatorçš„æˆå‘˜å˜é‡<code>private final Map&lt;Object, Boolean&gt; advisedBeans = new ConcurrentHashMap&lt;&gt;(256)</code>ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰Beanæ˜¯å¦éœ€è¦å¢å¼ºæ ‡è¯†ï¼Œé”®ä¸ºæ¯ä¸ªBeançš„cacheKeyï¼Œå€¼ä¸ºå¸ƒå°”ç±»å‹ï¼Œtrueè¡¨ç¤ºéœ€è¦å¢å¼ºï¼Œfalseè¡¨ç¤ºä¸éœ€è¦å¢å¼ºï¼‰ï¼Œæ­¤æ—¶TargetClassè¿˜æœªå®ä¾‹åŒ–ï¼Œæ‰€ä»¥è‡ªç„¶ä¸åœ¨è¯¥é›†åˆä¸­ã€‚</p></li><li><p>åˆ¤æ–­å½“å‰Beanï¼ˆTargetClassï¼‰æ˜¯å¦æ˜¯åŸºç¡€ç±»ï¼ŒæŸ¥çœ‹isInfrastructureClassæ–¹æ³•æºç ï¼š</p><p><img src="img/349A29C0-307C-46C8-8FCC-821B3D46F0E4.png" alt="349A29C0-307C-46C8-8FCC-821B3D46F0E4"></p><p>æ–¹æ³•è°ƒç”¨äº†çˆ¶ç±»çš„isInfrastructureClassæ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-141913@2x.png" alt="QQ20201210-141913@2x"></p><p>this.aspectJAdvisorFactory.isAspectæ–¹æ³•æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20201210-142323@2x.png" alt="QQ20201210-142323@2x"></p><p>æ‰€ä»¥è¿™ä¸€æ­¥é€»è¾‘ä¸ºï¼šåˆ¤æ–­å½“å‰Beanï¼ˆTargetClassï¼‰æ˜¯å¦æ˜¯Adviceï¼ŒPointcutï¼ŒAdvisorï¼ŒAopInfrastructureBeançš„å­ç±»æˆ–è€…æ˜¯å¦ä¸ºåˆ‡é¢ç±»ï¼ˆ@Aspectæ³¨è§£æ ‡æ³¨ï¼‰ã€‚</p></li><li><p>åˆ¤æ–­æ˜¯å¦éœ€è¦è·³è¿‡ï¼š</p><p>shouldSkipæºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20201210-142604@2x.png" alt="QQ20201210-142604@2x"></p><p><img src="img/QQ20201210-142745@2x.png" alt="QQ20201210-142745@2x"></p><p>é€šè¿‡Beanåç§°åˆ¤æ–­æ˜¯å¦ä»¥AutowireCapableBeanFactory.ORIGINAL_INSTANCE_SUFFIXï¼ˆ.ORIGINALï¼‰ç»“å°¾ï¼Œæ˜¯çš„è¯è¿”å›trueè¡¨ç¤ºè·³è¿‡ä»£ç†ã€‚</p><p>å¾ˆæ˜æ˜¾æˆ‘ä»¬çš„TargetClassä¸ç¬¦åˆ3å’Œ4ï¼Œæ‰€ä»¥ç»§ç»­èµ°ç¬¬5æ­¥ã€‚</p></li><li><p>å¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰äº†TargetSourceï¼Œåˆ™åœ¨æ­¤å¤„åˆ›å»ºBeanä»£ç†ï¼Œä»¥å–ä»£ç›®æ ‡Beançš„åç»­é»˜è®¤å®ä¾‹åŒ–æ–¹å¼ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰è‡ªå®šä¹‰TargetSourceï¼Œæ‰€ä»¥ç›´æ¥è·³è¿‡ã€‚</p></li></ol><hr><p>ç»è¿‡ä»¥ä¸Šè¿™äº›æ­¥éª¤ï¼Œå°±TargetClassè¿™ä¸ªBeanè€Œè¨€ï¼ŒpostProcessBeforeInstantiationæ–¹æ³•æœ€ç»ˆè¿”å›nullã€‚Beanå®ä¾‹åŒ–å‰ç½®å¤„ç†åˆ°æ­¤å®Œæ¯•ï¼Œç‚¹å‡»Resume Programï¼Œç»§ç»­Beançš„åç»­ç”Ÿå‘½å‘¨æœŸå¤„ç†é€»è¾‘ï¼Œç¨‹åºè·³è½¬åˆ°Beanåˆå§‹åŒ–åç½®å¤„ç†æ–¹æ³•postProcessAfterInitializationï¼š</p><p><img src="img/QQ20201210-144041@2x.png" alt="QQ20201210-144041@2x"></p><p>è¯¥æ–¹æ³•é‡ç‚¹å…³æ³¨wrapIfNecessaryæ–¹æ³•ï¼ŒæŸ¥çœ‹wrapIfNecessaryæ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ10æ—¥14-49-28.png" alt="2020å¹´12æœˆ10æ—¥14-49-28"></p><ol><li><p>getAdvicesAndAdvisorsForBeanæ–¹æ³•å†…éƒ¨ä¸»è¦åŒ…å«ä»¥ä¸‹è¿™äº›é€»è¾‘ï¼ˆæœ‰å…´è¶£è‡ªå·±debugæŸ¥çœ‹å…·ä½“åˆ¤æ–­é€»è¾‘å®ç°ï¼Œè¿™é‡Œä¸å†è´´å›¾ï¼Œåªåšæ€»ç»“ï¼‰ï¼š</p><ul><li>è·å–æ‰€æœ‰çš„é€šçŸ¥æ–¹æ³•ï¼ˆåˆ‡é¢é‡Œå®šä¹‰çš„å„ä¸ªæ–¹æ³•ï¼‰ï¼›</li><li>é€šè¿‡åˆ‡ç‚¹è¡¨è¾¾å¼åˆ¤æ–­è¿™äº›é€šçŸ¥æ–¹æ³•æ˜¯å¦å¯ä¸ºå½“å‰Beanæ‰€ç”¨ï¼›</li><li>å¦‚æœæœ‰ç¬¦åˆçš„é€šçŸ¥æ–¹æ³•ï¼Œåˆ™å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼ˆæ’åºè§„åˆ™ä¸åŒç‰ˆæœ¬Springæœ‰æ‰€ä¸åŒï¼Œä¸Šé¢å·²ç»æåŠè¿‡ï¼‰ã€‚</li></ul><p>åœ¨å‰é¢çš„AOPä¾‹å­ä¸­ï¼Œåˆ‡é¢MyAspecté‡Œçš„é€šçŸ¥æ–¹æ³•å°±æ˜¯ä¸ºäº†å¢å¼ºTargetClassæ‰€è®¾çš„ï¼ˆæ ¹æ®åˆ‡ç‚¹è¡¨è¾¾å¼ï¼‰ï¼Œæ‰€ä»¥getAdvicesAndAdvisorsForBeanæ–¹æ³•è¿”å›å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20201210-145937@2x.png" alt="QQ20201210-145937@2x"></p><p>è¿™äº›é€šçŸ¥æ–¹æ³•å°±æ˜¯æˆ‘ä»¬åœ¨MyAspectåˆ‡é¢é‡Œå®šä¹‰çš„é€šçŸ¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-150430@2x.png" alt="QQ20201210-150430@2x"></p></li><li><p>å¦‚æœè¯¥Beançš„é€šçŸ¥æ–¹æ³•é›†åˆä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™åˆ›å»ºè¯¥Beançš„ä»£ç†å¯¹è±¡ï¼Œå…·ä½“æŸ¥çœ‹createProxyæ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ10æ—¥15-25-17.png" alt="2020å¹´12æœˆ10æ—¥15-25-17"></p><p>ç»§ç»­è·Ÿè¸ªproxyFactory.getProxy(getProxyClassLoader())æºç ï¼š</p><p><img src="img/QQ20201210-152727@2x.png" alt="QQ20201210-152727@2x"></p><p><img src="img/QQ20201210-152758@2x.png" alt="QQ20201210-152758@2x"></p><p><img src="img/QQ20201210-152921@2x.png" alt="QQ20201210-152921@2x"></p><p>Springä¼šåˆ¤æ–­å½“å‰ä½¿ç”¨å“ªç§ä»£ç†å¯¹è±¡ï¼ˆä¸€èˆ¬æ¥è¯´å½“Beanæœ‰å®ç°æ¥å£æ—¶ï¼Œä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼Œå½“Beanæ²¡æœ‰å®ç°æ¥å£æ—¶ï¼Œä½¿ç”¨cglibä»£ç†ï¼Œåœ¨Bootä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>spring.aop.proxy-target-class=true</code>é…ç½®æ¥å¼ºåˆ¶ä½¿ç”¨cglibä»£ç†ï¼‰ã€‚</p></li></ol><p>é€šè¿‡Beanåˆå§‹åŒ–åç½®ä»£ç†æ–¹æ³•postProcessBeforeInstantiationå¤„ç†åï¼ŒTargetClassè¢«åŒ…è£…ä¸ºäº†cglibä»£ç†çš„å¢å¼ºBeanï¼Œæ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ï¼š</p><p><img src="img/2020å¹´12æœˆ10æ—¥15-38-49.png" alt="2020å¹´12æœˆ10æ—¥15-38-49"></p><p>åç»­ä»IOCå®¹å™¨ä¸­è·å¾—çš„TargetClasså°±æ˜¯è¢«ä»£ç†åçš„å¯¹è±¡ï¼Œæ‰§è¡Œä»£ç†å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•çš„æ—¶å€™ï¼Œä»£ç†å¯¹è±¡ä¼šæ‰§è¡Œç›¸åº”çš„é€šçŸ¥æ–¹æ³•é“¾ï¼Œä¸‹é¢æ¥ç€åˆ†æã€‚</p><h2 id="ç”Ÿæˆæ‹¦æˆªå™¨é“¾MethodInterceptor"><a href="#ç”Ÿæˆæ‹¦æˆªå™¨é“¾MethodInterceptor" class="headerlink" title="ç”Ÿæˆæ‹¦æˆªå™¨é“¾MethodInterceptor"></a>ç”Ÿæˆæ‹¦æˆªå™¨é“¾MethodInterceptor</h2><p>AOPä»£ç†å¯¹è±¡ç”Ÿæˆåï¼Œæˆ‘ä»¬æ¥ç€å…³æ³¨ä»£ç†å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œé€šçŸ¥æ–¹æ³•æ˜¯æ€ä¹ˆè¢«æ‰§è¡Œçš„ã€‚</p><p>å…ˆå°†å‰é¢æ‰“çš„æ–­ç‚¹éƒ½å»æ‰ï¼Œç„¶ååœ¨SpringBootçš„å…¥å£ç±»AopApplicationçš„å¦‚ä¸‹ä½ç½®æ‰“ä¸ªæ–­ç‚¹ï¼š</p><p><img src="img/QQ20201210-154403@2x.png" alt="QQ20201210-154403@2x"></p><p>ä»¥debugæ–¹å¼å¯åŠ¨ç¨‹åºï¼š</p><p>å¯ä»¥çœ‹åˆ°è·å–åˆ°çš„TargetClass Beanå°±æ˜¯å‰é¢cglibä»£ç†åçš„Beanï¼ˆTargetClass$$EnhanceBySpringCGLIBï¼‰ï¼š</p><p><img src="img/QQ20201210-154800@2x.png" alt="QQ20201210-154800@2x"></p><p>ç‚¹å‡»Step Intoè¿›å…¥testæ–¹æ³•å†…éƒ¨è°ƒç”¨é€»è¾‘ï¼Œä¼šå‘ç°ç¨‹åºè·³è½¬åˆ°äº†CglibAopProxyçš„interceptæ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•è¢«CglibAopProxyçš„interceptæ–¹æ³•æ‹¦æˆªäº†ï¼Œè¯¥æ‹¦æˆªæ–¹æ³•ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š</p><p><img src="img/2020å¹´12æœˆ11æ—¥09-08-20.png" alt="2020å¹´12æœˆ10æ—¥16-29-04"></p><p>è¿™é‡Œå…ˆé‡ç‚¹å…³æ³¨ä¸‹getInterceptorsAndDynamicInterceptionAdviceæ–¹æ³•ï¼Œå…¶æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20201210-163728@2x.png" alt="QQ20201210-163728@2x"></p><blockquote><p>å›¾ä¸­é”™åˆ«å­—çº æ­£ï¼šæä¾›-&gt;æé«˜ï¼Œæ‡’å¾—å†æ¬¡æˆªå›¾æ³¨é‡Šäº†ğŸ˜¢</p></blockquote><div class="note info">æ‰€è°“çš„æ‹¦æˆªå™¨é“¾ï¼Œå°±æ˜¯åœ¨ä»£ç†å¯¹è±¡çš„æŸä¸ªæ–¹æ³•è¢«æ‰§è¡Œæ—¶ï¼Œä»é€šçŸ¥æ–¹æ³•é›†åˆï¼ˆåˆ›å»ºä»£ç†å¯¹è±¡çš„æ—¶å€™å°±å·²ç»å°†å¯ç”¨é€šçŸ¥é›†åˆä¿å­˜åœ¨ä»£ç†å¯¹è±¡ä¸­äº†ï¼‰ä¸­ç­›é€‰å‡ºé€‚ç”¨äºè¯¥æ–¹æ³•çš„é€šçŸ¥ï¼Œç„¶åå°è£…ä¸ºæ‹¦æˆªå™¨å¯¹è±¡é›†åˆï¼ˆç±»å‹ä¸ºMethodInteceptorï¼Œä¸‹é¢ä¼šä»‹ç»åˆ°ï¼‰ã€‚</div><p>ç»§ç»­æŸ¥çœ‹this.advisorChainFactory.getInterceptorsAndDynamicInterceptionAdviceæºç ï¼š</p><p><img src="img/2020å¹´12æœˆ10æ—¥16-55-58.png" alt="2020å¹´12æœˆ10æ—¥16-55-58.png"></p><p>é€šè¿‡debugæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰ä»£ç†å¯¹è±¡çš„testæ–¹æ³•çš„æ‹¦æˆªå™¨é“¾ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å…ƒç´ ä¸ªæ•°ä¸º5ï¼š</p><p><img src="img/QQ20201210-165919@2x.png" alt="QQ20201210-165919@2x"></p><p>æ‹¦æˆªå™¨é“¾ç¬¬ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸ºExposeInvocationInterceptorï¼Œæ˜¯é»˜è®¤çš„æ‹¦æˆªå™¨ï¼Œåé¢ä¼šä»‹ç»åˆ°å®ƒçš„ä½œç”¨ã€‚å‰©ä¸‹å››ä¸ªä¾æ¬¡ä¸ºï¼šMethodBeforeAdviceInterceptorã€AspectJAfterAdviceã€AfterReturningAdviceInterceptorå’ŒAspectJAfterThrowingAdviceï¼Œå®ƒä»¬éƒ½æ˜¯MethodInterceptorçš„å®ç°ç±»ï¼š</p><p><img src="img/QQ20201210-170632@2x.png" alt="QQ20201210-170632@2x"></p><h2 id="é“¾å¼è°ƒç”¨é€šçŸ¥æ–¹æ³•"><a href="#é“¾å¼è°ƒç”¨é€šçŸ¥æ–¹æ³•" class="headerlink" title="é“¾å¼è°ƒç”¨é€šçŸ¥æ–¹æ³•"></a>é“¾å¼è°ƒç”¨é€šçŸ¥æ–¹æ³•</h2><p>è·å–åˆ°äº†ä»£ç†å¯¹è±¡ç›®æ ‡æ–¹æ³•çš„æ‹¦æˆªå™¨é“¾åï¼Œæˆ‘ä»¬æœ€åæ¥å…³æ³¨è¿™äº›æ‹¦æˆªå™¨æ˜¯å¦‚ä½•é“¾å¼è°ƒç”¨é€šçŸ¥æ–¹æ³•çš„ã€‚è·å–æ‹¦æˆªå™¨é“¾å¹¶ä¸”æ‹¦æˆªå™¨é“¾ä¸ä¸ºç©ºæ—¶ï¼ŒCglibAopProxyçš„interceptæ–¹æ³•åˆ›å»ºCglibMethodInvocationå¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„proceedæ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-182903@2x.png" alt="QQ20201210-182903@2x"></p><p>æŸ¥çœ‹CglibMethodInvocationæºç ï¼š</p><p><img src="img/QQ20201210-183201@2x.png" alt="QQ20201210-183201@2x"></p><p>æŸ¥çœ‹CglibMethodInvocationçˆ¶ç±»ReflectiveMethodInvocation proceedæ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ10æ—¥18-38-50.png" alt="2020å¹´12æœˆ10æ—¥18-38-50.png"></p><p>æ¸…é™¤æ‰ä¹‹å‰æ‰“çš„æ–­ç‚¹ï¼Œåœ¨è¯¥æ–¹æ³•ä¸Šç¬¬ä¸€è¡Œæ‰“ä¸ªç«¯ç‚¹ï¼Œé‡æ–°ä»¥debugæ–¹å¼å¯åŠ¨Bootåº”ç”¨ï¼š</p><p><img src="img/QQ20201210-184836@2x.png" alt="QQ20201210-184836@2x"></p><p>ç¨‹åºç¬¬ä¸€æ¬¡è¿›è¯¥æ–¹æ³•æ—¶currentInterceptorIndexå€¼ä¸º-1ï¼Œthis.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex)å–å‡ºæ‹¦æˆªå™¨é“¾ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ExposeInvocationInterceptorï¼Œæ–¹æ³•æœ€åè°ƒç”¨è¯¥æ‹¦æˆªå™¨çš„invokeæ–¹æ³•ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-185149@2x.png" alt="QQ20201210-185149@2x"></p><p>miå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ReflectiveMethodInvocationå¯¹è±¡ï¼Œç¨‹åºæ‰§è¡Œåˆ°mi.proceedæ–¹æ³•æ—¶ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-185436@2x.png" alt="QQ20201210-185436@2x"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶ç¨‹åºç¬¬äºŒæ¬¡æ‰§è¡ŒReflectiveMethodInvocationçš„poceedæ–¹æ³•ï¼ŒcurrentInterceptorIndexå€¼ä¸º0ï¼Œthis.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex)å–å‡ºæ‹¦æˆªå™¨é“¾ç¬¬äºŒä¸ªæ‹¦æˆªå™¨MethodBeforeAdviceInterceptorï¼Œæ–¹æ³•æœ€åè°ƒç”¨è¯¥æ‹¦æˆªå™¨çš„invokeæ–¹æ³•ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-185704@2x.png" alt="QQ20201210-185704@2x"></p><p>å¯ä»¥çœ‹åˆ°MethodBeforeAdviceInterceptorçš„invokeæ–¹æ³•ç¬¬ä¸€è¡Œè°ƒç”¨äº†é€šçŸ¥æ–¹æ³•beforeï¼Œæ­¤æ—¶æ§åˆ¶å°æ‰“å°å†…å®¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onBeforeï¼štestæ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œå‚æ•°ï¼š[hello]</span><br></pre></td></tr></table></figure><p></p><p>æ¥ç€åˆé€šè¿‡mi.proceedå†æ¬¡è°ƒç”¨ReflectiveMethodInvocationçš„poceedæ–¹æ³•ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-190035@2x.png" alt="QQ20201210-190035@2x"></p><p>æ­¤æ—¶ç¨‹åºç¬¬ä¸‰æ¬¡æ‰§è¡ŒReflectiveMethodInvocationçš„poceedæ–¹æ³•ï¼ŒcurrentInterceptorIndexå€¼ä¸º1ï¼Œthis.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex)å–å‡ºæ‹¦æˆªå™¨é“¾ç¬¬ä¸‰ä¸ªæ‹¦æˆªå™¨AspectJAfterAdviceï¼Œæ–¹æ³•æœ€åè°ƒç”¨è¯¥æ‹¦æˆªå™¨çš„invokeæ–¹æ³•ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-190158@2x.png" alt="QQ20201210-190158@2x"></p><p>å¯ä»¥çœ‹åˆ°AspectJAfterAdviceçš„invokeæ–¹æ³•å†…é€šè¿‡mi.proceedå†æ¬¡è°ƒç”¨ReflectiveMethodInvocationçš„poceedæ–¹æ³•ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-190413@2x.png" alt="QQ20201210-190413@2x"></p><p>æ­¤æ—¶ç¨‹åºç¬¬å››æ¬¡æ‰§è¡ŒReflectiveMethodInvocationçš„poceedæ–¹æ³•ï¼ŒcurrentInterceptorIndexå€¼ä¸º2ï¼Œthis.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex)å–å‡ºæ‹¦æˆªå™¨é“¾ç¬¬å››ä¸ªæ‹¦æˆªå™¨AfterReturningAdviceInterceptorï¼Œæ–¹æ³•æœ€åè°ƒç”¨è¯¥æ‹¦æˆªå™¨çš„invokeæ–¹æ³•ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-190604@2x.png" alt="QQ20201210-190604@2x"></p><p>å¯ä»¥çœ‹åˆ°AfterReturningAdviceInterceptorçš„invokeæ–¹æ³•å†…é€šè¿‡mi.proceedå†æ¬¡è°ƒç”¨ReflectiveMethodInvocationçš„poceedæ–¹æ³•ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-190706@2x.png" alt="QQ20201210-190706@2x"></p><p>æ­¤æ—¶ç¨‹åºç¬¬äº”æ¬¡æ‰§è¡ŒReflectiveMethodInvocationçš„poceedæ–¹æ³•ï¼ŒcurrentInterceptorIndexå€¼ä¸º3ï¼Œthis.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex)å–å‡ºæ‹¦æˆªå™¨é“¾ç¬¬äº”ä¸ªæ‹¦æˆªå™¨AspectJAfterThrowingAdviceï¼Œæ–¹æ³•æœ€åè°ƒç”¨è¯¥æ‹¦æˆªå™¨çš„invokeæ–¹æ³•ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-190828@2x.png" alt="QQ20201210-190828@2x"></p><p>å¯ä»¥çœ‹åˆ°AspectJAfterThrowingAdviceçš„invokeæ–¹æ³•å†…é€šè¿‡mi.proceedå†æ¬¡è°ƒç”¨ReflectiveMethodInvocationçš„poceedæ–¹æ³•ï¼ŒStep Intoè¿›å…¥è¯¥æ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-191109@2x.png" alt="QQ20201210-191109@2x"></p><p>æ­¤æ—¶ç¨‹åºç¬¬å…­æ¬¡æ‰§è¡ŒReflectiveMethodInvocationçš„poceedæ–¹æ³•ï¼ŒcurrentInterceptorIndexå€¼ä¸º4ï¼Œè€Œæ‹¦æˆªå™¨é“¾çš„é•¿åº¦ä¸º5ï¼Œ4==5-1æˆç«‹ï¼Œæ‰€ä»¥æ‰§è¡ŒinvokeJoinpoint()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å†…éƒ¨é€šè¿‡åå°„è°ƒç”¨äº†ç›®æ ‡æ–¹æ³•ï¼ˆè¿™é‡Œä¸ºTargetClassçš„testæ–¹æ³•ï¼‰ï¼Œæ‰§è¡Œåï¼Œæ§åˆ¶å°æ‰“å°å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">onBeforeï¼štestæ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œå‚æ•°ï¼š[hello]</span><br><span class="line">ç›®æ ‡æ–¹æ³•testè¢«æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p></p><p>éšç€invokeJoinpoint()æ–¹æ³•æ‰§è¡Œç»“æŸè¿”å›å‡ºæ ˆï¼Œç¨‹åºå›åˆ°AspectJAfterThrowingAdviceçš„invokeæ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-191519@2x.png" alt="QQ20201210-191519@2x"></p><p>å°±è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œç›®æ ‡æ–¹æ³•testå¹¶æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥AspectJAfterThrowingAdviceçš„invokeæ–¹æ³•æ‰§è¡Œç»“æŸå‡ºæ ˆï¼Œç¨‹åºå›åˆ°AfterReturningAdviceInteceptorçš„invokeæ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-191650@2x.png" alt="QQ20201210-191650@2x"></p><p>this.advice.afterReturningæ‰§è¡ŒafterReturningé€šçŸ¥æ–¹æ³•ï¼Œæ§åˆ¶å°æ‰“å°å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onBeforeï¼štestæ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œå‚æ•°ï¼š[hello]</span><br><span class="line">ç›®æ ‡æ–¹æ³•testè¢«æ‰§è¡Œ</span><br><span class="line">afterReturningï¼štestæ–¹æ³•æ‰§è¡Œç»“æŸè¿”å›ï¼Œå‚æ•°ï¼š[hello]ï¼Œè¿”å›å€¼ï¼šhello</span><br></pre></td></tr></table></figure><p></p><p>AfterReturningAdviceInteceptorçš„invokeæ–¹æ³•æ‰§è¡Œç»“æŸå‡ºæ ˆï¼Œç¨‹åºå›åˆ°AspectJAfterAdviceçš„invokeæ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-192054@2x.png" alt="QQ20201210-192054@2x"></p><p>AspectJAfterAdviceçš„invokeæ–¹æ³•æœ€ç»ˆæ‰§è¡Œfinally afteré€»è¾‘ï¼Œæ§åˆ¶å°æ‰“å°å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onBeforeï¼štestæ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œå‚æ•°ï¼š[hello]</span><br><span class="line">ç›®æ ‡æ–¹æ³•testè¢«æ‰§è¡Œ</span><br><span class="line">afterReturningï¼štestæ–¹æ³•æ‰§è¡Œç»“æŸè¿”å›ï¼Œå‚æ•°ï¼š[hello]ï¼Œè¿”å›å€¼ï¼šhello</span><br><span class="line">onAfterï¼štestæ–¹æ³•æ‰§è¡Œç»“æŸï¼Œå‚æ•°ï¼š[hello]</span><br></pre></td></tr></table></figure><p>AspectJAfterAdviceçš„invokeæ–¹æ³•æ‰§è¡Œç»“æŸå‡ºæ ˆï¼Œç¨‹åºå›åˆ°MethodBeforeAdviceInterceptorçš„invokeæ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-192249@2x.png" alt="QQ20201210-192249@2x"></p><p>MethodBeforeAdviceInterceptorçš„invokeæ–¹æ³•æ­£å¸¸æ‰§è¡Œç»“æŸï¼Œå‡ºæ ˆï¼Œç¨‹åºå›åˆ°ExposeInvocationInterceptorçš„invokeæ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-192435@2x.png" alt="QQ20201210-192435@2x"></p><p>ExposeInvocationInterceptorçš„invokeæ–¹æ³•æ‰§è¡Œç»“æŸå‡ºæ ˆï¼Œç¨‹åºå›åˆ°CglibAopProxyçš„interceptæ–¹æ³•ï¼š</p><p><img src="img/QQ20201210-192556@2x.png" alt="QQ20201210-192556@2x"></p><p>CglibAopProxyçš„interceptæ–¹æ³•æ‰§è¡Œç»“æŸå‡ºæ ˆåï¼Œæ•´ä¸ªAOPçš„æ‹¦æˆªå™¨é“¾è°ƒç”¨ä¹Ÿéšä¹‹ç»“æŸäº†ï¼š</p><p><img src="img/QQ20201210-192827@2x.png" alt="QQ20201210-192827@2x"></p><p>æˆ‘ä»¬å·²ç»æˆåŠŸåœ¨ç›®æ ‡æ–¹æ³•çš„å„ä¸ªæ‰§è¡Œæ—¶æœŸç»‡å…¥äº†é€šçŸ¥æ–¹æ³•ã€‚ä¸Šè¿°è¿‡ç¨‹ä¼´éšç€ä¸æ–­çš„å…¥æ ˆå‡ºæ ˆæ“ä½œï¼Œä¸æ‡‚æ‚¨çœ‹æ‡‚æ²¡ğŸ¤¨ã€‚</p><p>ä¸‹é¢ç”¨ä¸€å¼ å›¾æ€»ç»“æ‹¦æˆªå™¨é“¾è°ƒç”¨è¿‡ç¨‹ï¼š</p><p><img src="img/QQ20201211-094704@2x.png" alt="QQ20201211-094704@2x"></p><blockquote><p>å°šç¡…è°·AOPæºç è§£æå­¦ä¹ ç¬”è®°</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;AOPåº•å±‚ä¸ºåŠ¨æ€ä»£ç†ï¼ŒAOPæŒ‡çš„æ˜¯ï¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€åœ°å°†æŸæ®µä»£ç åˆ‡å…¥åˆ°æŒ‡å®šæ–¹æ³•æŒ‡å®šä½ç½®è¿›è¡Œè¿è¡Œçš„ç¼–ç¨‹æ–¹å¼ï¼Œç›¸å…³è®¾è®¡æ¨¡å¼ä¸ºä»£ç†æ¨¡å¼ã€‚æœ¬èŠ‚å°†é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­å›é¡¾Spring AOPçš„ä½¿ç”¨ï¼Œå¹¶ä¸”é€šè¿‡debugæºç æ·±å…¥ç†è§£å†…éƒ¨åŸç†ã€‚hintsï¼šæœ¬èŠ‚å›¾ç‰‡è¾ƒå¤šï¼ŒåŠ è½½è¾ƒæ…¢ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spring" scheme="http://mrbird.cc/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥ç†è§£Spring BeanPostProcessor &amp; InstantiationAwareBeanPostProcessor</title>
    <link href="http://mrbird.cc/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Spring-BeanPostProcessor-InstantiationAwareBeanPostProcessor.html"/>
    <id>http://mrbird.cc/æ·±å…¥ç†è§£Spring-BeanPostProcessor-InstantiationAwareBeanPostProcessor.html</id>
    <published>2020-06-02T07:59:35.000Z</published>
    <updated>2020-12-24T02:37:14.900Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --><p>åœ¨<a href="/Spring-Bean-Lifecycle.html">æ·±å…¥å­¦ä¹ Spring Beanç”Ÿå‘½å‘¨æœŸ</a>ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Beanåç½®å¤„ç†å™¨BeanPostProcessorï¼Œç”¨äºåœ¨Beanåˆå§‹åŒ–å‰åæ’å…¥æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘ï¼ˆBeanå¢å¼ºï¼ŒBeanä»£ç†ç­‰ï¼‰ã€‚ä»Šå¤©å¶ç„¶æ¥è§¦åˆ°BeanPostProcessorçš„å­ç±»InstantiationAwareBeanPostProcessorï¼Œç”¨äºBeanå®ä¾‹åŒ–å‰åå¤„ç†ã€‚æœ¬èŠ‚è®°å½•ä¸¤è€…çš„åŒºåˆ«ä»¥åŠç®€å•åŸç†åˆ†æã€‚</p><a id="more"></a><h2 id="ä¸¤è€…æ¯”è¾ƒ"><a href="#ä¸¤è€…æ¯”è¾ƒ" class="headerlink" title="ä¸¤è€…æ¯”è¾ƒ"></a>ä¸¤è€…æ¯”è¾ƒ</h2><p>Initializationä¸ºåˆå§‹åŒ–çš„æ„æ€ï¼ŒInstantiationä¸ºå®ä¾‹åŒ–çš„æ„æ€ã€‚åœ¨Spring Beanç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ä¾‹åŒ–æŒ‡çš„æ˜¯åˆ›å»ºBeançš„è¿‡ç¨‹ï¼Œåˆå§‹åŒ–æŒ‡çš„æ˜¯Beanåˆ›å»ºåï¼Œå¯¹å…¶å±æ€§è¿›è¡Œèµ‹å€¼ï¼ˆpopulate beanï¼‰ã€åç½®å¤„ç†ç­‰æ“ä½œçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥Instantiationæ‰§è¡Œæ—¶æœºå…ˆäºInitializationã€‚</p><h3 id="ç±»å…³ç³»"><a href="#ç±»å…³ç³»" class="headerlink" title="ç±»å…³ç³»"></a>ç±»å…³ç³»</h3><p>å…ˆæ¥çœ‹çœ‹BeanPostProcessorçš„ç±»ç»“æ„ï¼š</p><p><img src="img/QQ20201208-190911@2x.png" alt="QQ20201208-190911@2x"></p><p>InstantiationAwareBeanPostProcessorä¸ºBeanPostProcessorçš„å­ç±»ï¼Œæ–°å¢äº†ä¸‰ä¸ªé¢å¤–çš„æ–¹æ³•ï¼š</p><p><img src="img/QQ20201208-191154@2x.png" alt="QQ20201208-191154@2x"></p><p><img src="img/QQ20201209-090854@2x.png" alt="QQ20201209-090854@2x"></p><h3 id="æ–¹æ³•è§£æ"><a href="#æ–¹æ³•è§£æ" class="headerlink" title="æ–¹æ³•è§£æ"></a>æ–¹æ³•è§£æ</h3><ol><li><p>BeanPostProcessor</p><ul><li><code>postProcessBeforeInitialization(Object bean, String beanName)</code>ï¼šbeanï¼šBeanå®ä¾‹ï¼›beanNameï¼šBeanåç§°ã€‚æ–¹æ³•å°†åœ¨Beanå®ä¾‹çš„afterPropertiesSetæ–¹æ³•æˆ–è€…è‡ªå®šä¹‰çš„initæ–¹æ³•è¢«è°ƒç”¨å‰è°ƒç”¨ï¼Œæ­¤æ—¶Beanå±æ€§å·²ç»è¢«èµ‹å€¼ã€‚æ–¹æ³•è¿”å›åŸå§‹Beanå®ä¾‹æˆ–è€…åŒ…è£…åçš„Beanå®ä¾‹ï¼Œå¦‚æœè¿”å›nullï¼Œåˆ™åç»­çš„åç½®å¤„ç†æ–¹æ³•ä¸å†è¢«è°ƒç”¨ã€‚</li><li><code>postProcessAfterInitialization(Object bean, String beanName)</code>ï¼šbeanï¼šBeanå®ä¾‹ï¼›beanNameï¼šBeanåç§°ã€‚æ–¹æ³•å°†åœ¨Beanå®ä¾‹çš„afterPropertiesSetæ–¹æ³•æˆ–è€…è‡ªå®šä¹‰çš„initæ–¹æ³•è¢«è°ƒç”¨åè°ƒç”¨ï¼Œæ­¤æ—¶Beanå±æ€§å·²ç»è¢«èµ‹å€¼ã€‚æ–¹æ³•è¿”å›åŸå§‹Beanå®ä¾‹æˆ–è€…åŒ…è£…åçš„Beanå®ä¾‹ï¼Œå¦‚æœè¿”å›nullï¼Œåˆ™åç»­çš„åç½®å¤„ç†æ–¹æ³•ä¸å†è¢«è°ƒç”¨ã€‚</li></ul></li><li><p>InstantiationAwareBeanPostProcessor</p><ul><li><code>postProcessBeforeInstantiation(Class&lt;?&gt; beanClass, String beanName)</code>ï¼šbeanClassï¼šå¾…å®ä¾‹åŒ–çš„Beanç±»å‹ï¼›beanNameï¼šå¾…å®ä¾‹åŒ–çš„Beanåç§°ã€‚æ–¹æ³•ä½œç”¨ä¸ºï¼šåœ¨Beanå®ä¾‹åŒ–å‰è°ƒç”¨è¯¥æ–¹æ³•ï¼Œè¿”å›å€¼å¯ä»¥ä¸ºä»£ç†åçš„Beanï¼Œä»¥æ­¤ä»£æ›¿Beané»˜è®¤çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€‚è¿”å›å€¼ä¸ä¸ºnullæ—¶ï¼Œåç»­åªä¼šè°ƒç”¨BeanPostProcessorçš„ postProcessAfterInitializationæ–¹æ³•ï¼Œè€Œä¸ä¼šè°ƒç”¨åˆ«çš„åç»­åç½®å¤„ç†æ–¹æ³•ï¼ˆå¦‚postProcessAfterInitializationã€postProcessBeforeInstantiationç­‰æ–¹æ³•ï¼‰ï¼›è¿”å›å€¼ä¹Ÿå¯ä»¥ä¸ºnullï¼Œè¿™æ—¶å€™Beanå°†æŒ‰é»˜è®¤æ–¹å¼åˆå§‹åŒ–ã€‚</li><li><code>postProcessAfterInstantiation(Object bean, String beanName)</code>ï¼šbeanï¼šå®ä¾‹åŒ–åçš„Beanï¼Œæ­¤æ—¶å±æ€§è¿˜æ²¡æœ‰è¢«èµ‹å€¼ï¼›beanNameï¼šBeanåç§°ã€‚æ–¹æ³•ä½œç”¨ä¸ºï¼šå½“Beané€šè¿‡æ„é€ å™¨æˆ–è€…å·¥å‚æ–¹æ³•è¢«å®ä¾‹åŒ–åï¼Œå½“å±æ€§è¿˜æœªè¢«èµ‹å€¼å‰ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œä¸€èˆ¬ç”¨äºè‡ªå®šä¹‰å±æ€§èµ‹å€¼ã€‚æ–¹æ³•è¿”å›å€¼ä¸ºå¸ƒå°”ç±»å‹ï¼Œè¿”å›trueæ—¶ï¼Œè¡¨ç¤ºBeanå±æ€§éœ€è¦è¢«èµ‹å€¼ï¼›è¿”å›falseè¡¨ç¤ºè·³è¿‡Beanå±æ€§èµ‹å€¼ï¼Œå¹¶ä¸”InstantiationAwareBeanPostProcessorçš„postProcessPropertiesæ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ã€‚</li></ul></li></ol><h3 id="æ‰§è¡Œæ—¶æœºå¯¹æ¯”"><a href="#æ‰§è¡Œæ—¶æœºå¯¹æ¯”" class="headerlink" title="æ‰§è¡Œæ—¶æœºå¯¹æ¯”"></a>æ‰§è¡Œæ—¶æœºå¯¹æ¯”</h3><p>ä¸ºäº†éªŒè¯å®ä¾‹åŒ–å’Œåˆå§‹åŒ–çš„å…ˆåé¡ºåºï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œç‰ˆæœ¬2.4.0ï¼Œä¾èµ–å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>Springå…¥å£ç±»åç§°ä¸º<code>DemoApplication</code>ã€‚æ–°å»º<code>MyBeanPostProcessor</code>å®ç°BeanPostProcessoræ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"demoApplication"</span>.equals(beanName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">"post processor before "</span> + beanName + <span class="string">" initialization"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"demoApplication"</span>.equals(beanName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">"post processor after "</span> + beanName + <span class="string">" initialization"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å› ä¸ºå¯¹æ‰€æœ‰çš„Beanç”Ÿæ•ˆï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿè¾“å‡ºï¼Œè¿™é‡Œä»…å½“Beanåç§°ä¸º<code>demoApplication</code>æ—¶æ‰æ‰“å°è¾“å‡ºã€‚</p><p>æ¥ç€æ–°å»º<code>MyBeanInstantiationPostProcessor</code>å®ç°InstantiationAwareBeanPostProcessoræ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanInstantiationPostProcessor</span> <span class="keyword">implements</span> <span class="title">InstantiationAwareBeanPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInstantiation</span><span class="params">(Class&lt;?&gt; beanClass, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"demoApplication"</span>.equals(beanName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">"post process before "</span> + beanName + <span class="string">" instantiation"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">postProcessAfterInstantiation</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"demoApplication"</span>.equals(beanName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">"post process after "</span> + beanName + <span class="string">" instantiation"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PropertyValues <span class="title">postProcessProperties</span><span class="params">(PropertyValues pvs, Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"demoApplication"</span>.equals(beanName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">"post process "</span> + beanName + <span class="string">" properties"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pvs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯åŠ¨ç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post process before demoApplication instantiation</span><br><span class="line">post process after demoApplication instantiation</span><br><span class="line">post process demoApplication properties</span><br><span class="line">post processor before demoApplication initialization</span><br><span class="line">post processor after demoApplication initialization</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœå°†MyBeanInstantiationPostProcessorçš„postProcessAfterInstantiationæ–¹æ³•è¿”å›å€¼æ”¹ä¸ºfalseï¼Œç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post process before demoApplication instantiation</span><br><span class="line">post process after demoApplication instantiation</span><br><span class="line">post processor before demoApplication initialization</span><br><span class="line">post processor after demoApplication initialization</span><br></pre></td></tr></table></figure><p></p><h2 id="åŸç†è§£æ"><a href="#åŸç†è§£æ" class="headerlink" title="åŸç†è§£æ"></a>åŸç†è§£æ</h2><p>postProcessAfterInitializationå’ŒInstantiationAwareBeanPostProcessorçš„æ–¹æ³•éƒ½å’ŒBeanç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œè¦åˆ†æå®ƒä»¬çš„å®ç°åŸç†è‡ªç„¶è¦ä»Beançš„åˆ›å»ºè¿‡ç¨‹å…¥æ‰‹ã€‚Beanåˆ›å»ºçš„å…¥å£ä¸º<code>AbstractAutowireCapableBeanFactory</code>çš„createBeanæ–¹æ³•ï¼ŒæŸ¥çœ‹å…¶æºç ï¼š</p><p><img src="img/2020-12-09 10-32-44.png" alt="2020-12-09 10-32-44"></p><p>resolveBeforeInstantiationæ–¹æ³•æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/2020å¹´12æœˆ09æ—¥10-57-07.png" alt="2020å¹´12æœˆ09æ—¥10-57-07"></p><p>ä¸Šé¢æ–¹æ³•è¿”å›çš„beanå¦‚æœä¸ºç©ºçš„è¯ï¼Œ<code>AbstractAutowireCapableBeanFactory</code>çš„createBeanæ–¹æ³•å°†ç»§ç»­å¾€ä¸‹æ‰§è¡ŒdoCreateBeanæ–¹æ³•ï¼š</p><p><img src="img/2020å¹´12æœˆ09æ—¥11-04-18.png" alt="2020å¹´12æœˆ09æ—¥11-04-18"></p><p>æŸ¥çœ‹doCreateBeanæ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ09æ—¥14-11-50.png" alt="2020å¹´12æœˆ09æ—¥14-11-50"></p><p>å…¶ä»–éƒ¨åˆ†å’Œæœ¬èŠ‚è®¨è®ºå†…å®¹å…³ç³»ä¸å¤§ï¼ˆBeanç”Ÿå‘½å‘¨æœŸå…¶ä»–éƒ¨åˆ†ï¼‰ï¼Œé‡ç‚¹å…³æ³¨populateBeanå’ŒinitializeBeanæ–¹æ³•ã€‚æŸ¥çœ‹populateBeanæ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ09æ—¥14-30-56.png" alt="2020å¹´12æœˆ09æ—¥14-30-56"></p><p>æ¥ç€æŸ¥çœ‹initializeBeanæ–¹æ³•æºç ï¼š</p><p><img src="img/2020å¹´12æœˆ09æ—¥14-36-48.png" alt="2020å¹´12æœˆ09æ—¥14-36-48"></p><p>è‡³æ­¤æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹Beanç”Ÿå‘½å‘¨æœŸç›¸å…³æºç å¼„æ¸…æ¥šäº†BeanPostProcessorå’ŒInstantiationAwareBeanPostProcessorç›¸å…³æ–¹æ³•çš„æ‰§è¡Œæ—¶æœºä»¥åŠåŸç†ã€‚</p><p>ä¸Šé¢æºç çš„è¿½è¸ªå…¶å®ä¸ä»…æ¶‰åŠåˆ°äº†BeanPostProcessorå’ŒInstantiationAwareBeanPostProcessorç›¸å…³æ–¹æ³•çš„æ‰§è¡Œæ—¶æœºä»¥åŠåŸç†ï¼Œæ›´æ˜¯æ•´ä¸ªBeanç”Ÿå‘½å‘¨æœŸåˆ›å»ºè¿‡ç¨‹ï¼Œç»“åˆ<a href="/Spring-Beanç”Ÿå‘½å‘¨æœŸ.html">Spring-Beanç”Ÿå‘½å‘¨æœŸ</a>è¿™ç¯‡æ–‡ç« çš„æµç¨‹å†èµ°ä¸€éæºç ï¼Œä½ ä¼šå¯¹Beançš„ç”Ÿå‘½å‘¨æœŸæœ‰æ›´æ·±çš„ç†è§£ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸‹é¢é€šè¿‡ä¸€å¼ æµç¨‹å›¾æ€»ç»“æœ¬æ–‡ï¼š</p><p><img src="img/QQ20201209-151738@2x.png" alt="QQ20201209-151738@2x"></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;åœ¨&lt;a href=&quot;/Spring-Bean-Lifecycle.html&quot;&gt;æ·±å…¥å­¦ä¹ Spring Beanç”Ÿå‘½å‘¨æœŸ&lt;/a&gt;ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Beanåç½®å¤„ç†å™¨BeanPostProcessorï¼Œç”¨äºåœ¨Beanåˆå§‹åŒ–å‰åæ’å…¥æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘ï¼ˆBeanå¢å¼ºï¼ŒBeanä»£ç†ç­‰ï¼‰ã€‚ä»Šå¤©å¶ç„¶æ¥è§¦åˆ°BeanPostProcessorçš„å­ç±»InstantiationAwareBeanPostProcessorï¼Œç”¨äºBeanå®ä¾‹åŒ–å‰åå¤„ç†ã€‚æœ¬èŠ‚è®°å½•ä¸¤è€…çš„åŒºåˆ«ä»¥åŠç®€å•åŸç†åˆ†æã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spring" scheme="http://mrbird.cc/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Springè‡ªå¸¦å·¥å…·ç±»ä½¿ç”¨å­¦ä¹ </title>
    <link href="http://mrbird.cc/Spring%E8%87%AA%E5%B8%A6%E5%B7%A5%E5%85%B7%E7%B1%BB%E4%BD%BF%E7%94%A8%E5%AD%A6%E4%B9%A0.html"/>
    <id>http://mrbird.cc/Springè‡ªå¸¦å·¥å…·ç±»ä½¿ç”¨å­¦ä¹ .html</id>
    <published>2020-05-28T08:42:25.000Z</published>
    <updated>2020-12-24T01:31:01.922Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --><p>æˆ‘ä»¬é¡¹ç›®å¤§å¤šæ•°éƒ½æ˜¯åŸºäºSpringæ¶æ„ï¼ŒSpringè‡ªèº«åŒ…å«äº†è®¸å¤šå®ç”¨çš„å·¥å…·ç±»ï¼Œå­¦ä¹ è¿™äº›å·¥å…·ç±»çš„ä½¿ç”¨ä¸ä»…èƒ½è®©æˆ‘ä»¬è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœï¼Œè€Œä¸”è¿˜èƒ½å‡å°‘ä¸å¿…è¦çš„é¢å¤–çš„å·¥å…·ç±»çš„å¼•å…¥ã€‚æŸ¥çœ‹è¿™äº›å·¥å…·ç±»çš„æºç æ—¶å‘ç°å®ƒä»¬éƒ½æ˜¯abstractç±»å‹çš„ï¼Œè¿™æ˜¯å› ä¸ºå·¥å…·ç±»çš„æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯staticé™æ€æ–¹æ³•ï¼Œé™æ€æ–¹æ³•å’Œç±»ç»‘å®šï¼Œç±»åŠ è½½åå°±èƒ½ä½¿ç”¨äº†ï¼Œæ— éœ€å®ä¾‹åŒ–ï¼ˆåˆšå¥½abstractç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œå¹¶ä¸”å¯ä»¥å®šä¹‰éæŠ½è±¡æ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥å·¥å…·ç±»å®šä¹‰ä¸ºabstractç±»å‹å†åˆé€‚ä¸è¿‡ã€‚</p><a id="more"></a><div class="note info">æœ¬æ–‡printæ–¹æ³•ä¸ºSystem.out.printlnçš„å°è£…ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(Object value)</span> </span>&#123;</span><br><span class="line">    System.out.println(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="ClassUtils"><a href="#ClassUtils" class="headerlink" title="ClassUtils"></a>ClassUtils</h2><p>org.springframework.util.classUtilsåŒ…å«ä¸€äº›å’Œjava.lang.Classç›¸å…³çš„å®ç”¨æ–¹æ³•ã€‚</p><h3 id="getDefaultClassLoader"><a href="#getDefaultClassLoader" class="headerlink" title="getDefaultClassLoader"></a>getDefaultClassLoader</h3><p><code>ClassLoader getDefaultClassLoader()</code>è·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ç±»åŠ è½½å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getDefaultClassLoader());</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br></pre></td></tr></table></figure><h3 id="overrideThreadContextClassLoader"><a href="#overrideThreadContextClassLoader" class="headerlink" title="overrideThreadContextClassLoader"></a>overrideThreadContextClassLoader</h3><p><code>ClassLoader overrideThreadContextClassLoader(@Nullable ClassLoader classLoaderToUse)</code>ç”¨ç‰¹å®šçš„ç±»åŠ è½½å™¨è¦†ç›–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ç±»åŠ è½½å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getDefaultClassLoader());</span><br><span class="line">ClassUtils.overrideThreadContextClassLoader(ClassLoader.getSystemClassLoader().getParent());</span><br><span class="line">print(ClassUtils.getDefaultClassLoader());</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line">sun.misc.Launcher$ExtClassLoader@3feba861</span><br></pre></td></tr></table></figure><h3 id="forName"><a href="#forName" class="headerlink" title="forName"></a>forName</h3><p><code>forName(String name, @Nullable ClassLoader classLoader)</code>é€šè¿‡ç±»åè¿”å›ç±»å®ä¾‹ï¼Œç±»ä¼¼äºClass.forName()ï¼Œä½†åŠŸèƒ½æ›´å¼ºï¼Œå¯ä»¥ç”¨äºåŸå§‹ç±»å‹ï¼Œå†…éƒ¨ç±»ç­‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader classLoader = ClassUtils.getDefaultClassLoader();</span><br><span class="line">print(ClassUtils.forName(<span class="string">"int"</span>, classLoader));</span><br><span class="line">print(ClassUtils.forName(<span class="string">"java.lang.String[]"</span>, classLoader));</span><br><span class="line">print(ClassUtils.forName(<span class="string">"java.lang.Thread$State"</span>, classLoader));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int</span><br><span class="line">class [Ljava.lang.String;</span><br><span class="line">class java.lang.Thread$State</span><br></pre></td></tr></table></figure><h3 id="isPresent"><a href="#isPresent" class="headerlink" title="isPresent"></a>isPresent</h3><p><code>boolean isPresent(String className, @Nullable ClassLoader classLoader)</code>åˆ¤æ–­å½“å‰classLoaderæ˜¯å¦åŒ…å«ç›®æ ‡ç±»å‹ï¼ˆåŒ…æ‹¬å®ƒçš„æ‰€æœ‰çˆ¶ç±»å’Œæ¥å£ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader classLoader = ClassUtils.getDefaultClassLoader();</span><br><span class="line">print(ClassUtils.isPresent(<span class="string">"int"</span>, classLoader));</span><br><span class="line">print(ClassUtils.isPresent(<span class="string">"intt"</span>, classLoader));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">true</span><br><span class="line">false</span><br></pre></td></tr></table></figure><h3 id="resolvePrimitiveClassName"><a href="#resolvePrimitiveClassName" class="headerlink" title="resolvePrimitiveClassName"></a>resolvePrimitiveClassName</h3><p><code>Class&lt;?&gt; resolvePrimitiveClassName(@Nullable String name)</code>é€šè¿‡ç»™å®šç±»åè·å–åŸå§‹ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.resolvePrimitiveClassName(<span class="string">"int"</span>));</span><br><span class="line">print(ClassUtils.resolvePrimitiveClassName(<span class="string">"java.lang.Integer"</span>));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int</span><br><span class="line">null</span><br></pre></td></tr></table></figure><h3 id="isPrimitiveWrapper"><a href="#isPrimitiveWrapper" class="headerlink" title="isPrimitiveWrapper"></a>isPrimitiveWrapper</h3><p><code>boolean isPrimitiveWrapper(Class&lt;?&gt; clazz)</code>åˆ¤æ–­ç»™å®šç±»æ˜¯å¦ä¸ºåŒ…è£…ç±»ï¼Œå¦‚Boolean, Byte, Character, Short, Integer, Long, Float, Double æˆ–è€… Voidï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.isPrimitiveWrapper(Integer.class));</span><br><span class="line">print(ClassUtils.isPrimitiveWrapper(Character.class));</span><br><span class="line">print(ClassUtils.isPrimitiveWrapper(Void.class));</span><br><span class="line">print(ClassUtils.isPrimitiveWrapper(String.class));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">false</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰<code>isPrimitiveOrWrapper</code>åˆ¤æ–­æ˜¯å¦ä¸ºåŸå§‹ç±»æˆ–è€…åŒ…è£…ç±»ã€<code>isPrimitiveWrapperArray</code>åˆ¤æ–­æ˜¯å¦ä¸ºåŒ…è£…ç±»æ•°ç»„ã€<code>isPrimitiveArray</code>åˆ¤æ–­æ˜¯å¦ä¸ºåŸå§‹ç±»æ•°ç»„ã€‚</p><h3 id="resolvePrimitiveIfNecessary"><a href="#resolvePrimitiveIfNecessary" class="headerlink" title="resolvePrimitiveIfNecessary"></a>resolvePrimitiveIfNecessary</h3><p><code>Class&lt;?&gt; resolvePrimitiveIfNecessary(Class&lt;?&gt; clazz)</code>å¦‚æœç»™å®šç±»æ˜¯åŸå§‹ç±»ï¼Œåˆ™è¿”å›å¯¹åº”åŒ…è£…ç±»ï¼Œå¦åˆ™ç›´æ¥è¿”å›ç»™å®šç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.resolvePrimitiveIfNecessary(<span class="keyword">int</span>.class));</span><br><span class="line">print(ClassUtils.resolvePrimitiveIfNecessary(Object.class));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class java.lang.Integer</span><br><span class="line">class java.lang.Object</span><br></pre></td></tr></table></figure><h3 id="isAssignable"><a href="#isAssignable" class="headerlink" title="isAssignable"></a>isAssignable</h3><p><code>boolean isAssignable(Class&lt;?&gt; lhsType, Class&lt;?&gt; rhsType)</code>é€šè¿‡åå°„æ£€æŸ¥ï¼Œæ˜¯å¦å¯ä»¥å°†rhsTypeèµ‹å€¼ç»™lhsTypeï¼ˆæ³¨æ„ï¼ŒåŒ…è£…ç±»å‹å¯ä»¥èµ‹å€¼ç»™ç›¸åº”çš„åŸå§‹ç±»å‹ï¼Œè‡ªåŠ¨æ‹†è£…ç®±æœºåˆ¶ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.isAssignable(Integer.class, <span class="keyword">int</span>.class));</span><br><span class="line">print(ClassUtils.isAssignable(Object.class, String.class));</span><br><span class="line">print(ClassUtils.isAssignable(BeanPostProcessor.class, InstantiationAwareBeanPostProcessor.class));</span><br><span class="line">print(ClassUtils.isAssignable(<span class="keyword">double</span>.class, Double.class)); <span class="comment">// consider this</span></span><br><span class="line">print(ClassUtils.isAssignable(Integer.class, Long.class));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">false</span><br></pre></td></tr></table></figure><h3 id="isAssignableValue"><a href="#isAssignableValue" class="headerlink" title="isAssignableValue"></a>isAssignableValue</h3><p><code>boolean isAssignableValue(Class&lt;?&gt; type, @Nullable Object value)</code>åˆ¤æ–­ç»™å®šçš„å€¼æ˜¯å¦ç¬¦åˆç»™å®šçš„ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.isAssignableValue(Integer.class, <span class="number">1</span>));</span><br><span class="line">print(ClassUtils.isAssignableValue(Integer.class, <span class="number">1L</span>));</span><br><span class="line">print(ClassUtils.isAssignableValue(<span class="keyword">int</span>.class, Integer.valueOf(<span class="number">1</span>)));</span><br><span class="line">print(ClassUtils.isAssignableValue(Object.class,<span class="number">1</span>));</span><br><span class="line">print(ClassUtils.isAssignableValue(String.class,<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">true</span><br><span class="line">false</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">false</span><br></pre></td></tr></table></figure><h3 id="convertResourcePathToClassName"><a href="#convertResourcePathToClassName" class="headerlink" title="convertResourcePathToClassName"></a>convertResourcePathToClassName</h3><p><code>String convertResourcePathToClassName(String resourcePath)</code>å°†ç±»è·¯å¾„è½¬æ¢ä¸ºå…¨é™å®šç±»åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.convertResourcePathToClassName(<span class="string">"java/lang/String"</span>));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.String</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šå°±æ˜¯å°†<code>/</code>æ›¿æ¢ä¸º<code>.</code>ã€‚<code>convertClassNameToResourcePath</code>æ–¹æ³•åŠŸèƒ½ç›¸åã€‚</p><h3 id="classNamesToString"><a href="#classNamesToString" class="headerlink" title="classNamesToString"></a>classNamesToString</h3><p><code>String classNamesToString(Class&lt;?&gt;... classes)</code>ç›´æ¥çœ‹æ¼”ç¤ºä¸è§£é‡Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.classNamesToString(String.class, Integer.class, BeanPostProcessor.class));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[java.lang.String, java.lang.Integer, org.springframework.beans.factory.config.BeanPostProcessor]</span><br></pre></td></tr></table></figure><h3 id="getAllInterfaces"><a href="#getAllInterfaces" class="headerlink" title="getAllInterfaces"></a>getAllInterfaces</h3><p><code>Class&lt;?&gt;[] getAllInterfaces(Object instance)</code>è¿”å›ç»™å®šå®ä¾‹å¯¹è±¡æ‰€å®ç°æ¥å£ç±»å‹é›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AutowiredAnnotationBeanPostProcessor processor = <span class="keyword">new</span> AutowiredAnnotationBeanPostProcessor();</span><br><span class="line">Class&lt;?&gt;[] allInterfaces = ClassUtils.getAllInterfaces(processor);</span><br><span class="line">Arrays.stream(allInterfaces).forEach(System.out::println);</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor</span><br><span class="line">interface org.springframework.beans.factory.support.MergedBeanDefinitionPostProcessor</span><br><span class="line">interface org.springframework.core.PriorityOrdered</span><br><span class="line">interface org.springframework.beans.factory.BeanFactoryAware</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰<code>getAllInterfacesForClass</code>ã€<code>getAllInterfacesAsSet</code>ã€<code>getAllInterfacesForClassAsSet</code></p><h3 id="determineCommonAncestor"><a href="#determineCommonAncestor" class="headerlink" title="determineCommonAncestor"></a>determineCommonAncestor</h3><p><code>Class&lt;?&gt; determineCommonAncestor(@Nullable Class&lt;?&gt; clazz1, @Nullable Class&lt;?&gt; clazz2)</code>å¯»æ‰¾ç»™å®šç±»å‹çš„å…±åŒç¥–å…ˆï¼ˆæ‰€è°“å…±åŒç¥–å…ˆæŒ‡çš„æ˜¯ç»™å®šç±»å‹è°ƒç”¨<code>class.getSuperclass</code>è·å¾—çš„å…±åŒç±»å‹ï¼Œå¦‚æœç»™å®šç±»å‹æ˜¯Object.classï¼Œæ¥å£ï¼ŒåŸå§‹ç±»å‹æˆ–è€…Voidï¼Œç›´æ¥è¿”å›nullï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ƒä¸¤éƒ½æ˜¯æ¥å£</span></span><br><span class="line">print(ClassUtils.determineCommonAncestor(AutowireCapableBeanFactory.class, ListableBeanFactory.class));</span><br><span class="line">print(ClassUtils.determineCommonAncestor(Long.class, Integer.class));</span><br><span class="line">print(ClassUtils.determineCommonAncestor(String.class, Integer.class));</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">null</span><br><span class="line">class java.lang.Number</span><br><span class="line">null</span><br></pre></td></tr></table></figure><h3 id="isInnerClass"><a href="#isInnerClass" class="headerlink" title="isInnerClass"></a>isInnerClass</h3><p><code>boolean isInnerClass(Class&lt;?&gt; clazz)</code>åˆ¤æ–­ç»™å®šç±»å‹æ˜¯å¦ä¸ºå†…éƒ¨ç±»ï¼ˆéé™æ€ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">     <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print(ClassUtils.isInnerClass(A.B.class)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print(ClassUtils.isInnerClass(A.B.class)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print(ClassUtils.isInnerClass(A.B.class)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="isCglibProxy"><a href="#isCglibProxy" class="headerlink" title="isCglibProxy"></a>isCglibProxy</h3><p><code>boolean isCglibProxy(Object object)</code>æ˜¯å¦ä¸ºCglibä»£ç†å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfigure</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(AopApplication.class, args);</span><br><span class="line">        MyConfigure myConfigure = context.getBean(MyConfigure.class);</span><br><span class="line">        System.out.println(ClassUtils.isCglibProxy(myConfigure));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">true</span><br></pre></td></tr></table></figure><p>é…ç½®ç±»ä¸ç”±Cglibä»£ç†çš„è¯ï¼Œè¿”å›ä¸ºfalseï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>) <span class="comment">// æ³¨æ„è¿™é‡Œ</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfigure</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(AopApplication.class, args);</span><br><span class="line">        MyConfigure myConfigure = context.getBean(MyConfigure.class);</span><br><span class="line">        System.out.println(ClassUtils.isCglibProxy(myConfigure));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">false</span><br></pre></td></tr></table></figure><p>ä¸è¿‡è¿™ä¸ªæ–¹æ³•åºŸå¼ƒäº†ï¼Œå»ºè®®ä½¿ç”¨<code>org.springframework.aop.support.AopUtils.isCglibProxy(Object)</code>æ–¹æ³•ã€‚</p><h3 id="getUserClass"><a href="#getUserClass" class="headerlink" title="getUserClass"></a>getUserClass</h3><p><code>Class&lt;?&gt; getUserClass(Object instance)</code>è¿”å›ç»™å®šå®ä¾‹å¯¹åº”çš„ç±»å‹ï¼Œå¦‚æœå®ä¾‹æ˜¯Cglibä»£ç†åçš„å¯¹è±¡ï¼Œåˆ™è¿”å›ä»£ç†çš„ç›®æ ‡å¯¹è±¡ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getUserClass(<span class="string">"Hello"</span>)); <span class="comment">// class java.lang.String</span></span><br></pre></td></tr></table></figure><p></p><p>Cglibä»£ç†ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfigure</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(AopApplication.class, args);</span><br><span class="line">        MyConfigure myConfigure = context.getBean(MyConfigure.class);</span><br><span class="line">        <span class="comment">// æ³¨æ„å®ƒä»¬çš„åŒºåˆ«</span></span><br><span class="line">        System.out.println(myConfigure.getClass());</span><br><span class="line">        System.out.println(ClassUtils.getUserClass(myConfigure));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class cc.mrbird.aop.AopApplication$MyConfigure$$EnhancerBySpringCGLIB$$e51ce45</span><br><span class="line">class cc.mrbird.aop.AopApplication$MyConfigure</span><br></pre></td></tr></table></figure><h3 id="matchesTypeName"><a href="#matchesTypeName" class="headerlink" title="matchesTypeName"></a>matchesTypeName</h3><p><code>boolean matchesTypeName(Class&lt;?&gt; clazz, @Nullable String typeName)</code>åˆ¤æ–­ç»™å®šclasså’Œç±»å‹åç§°æ˜¯å¦åŒ¹é…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.matchesTypeName(String.class, <span class="string">"java.lang.String"</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p></p><h3 id="getShortName"><a href="#getShortName" class="headerlink" title="getShortName"></a>getShortName</h3><p><code>String getShortName(Class&lt;?&gt; clazz)</code>è¿”å›ç±»åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getShortName(String.class)); <span class="comment">// String</span></span><br></pre></td></tr></table></figure><p></p><h3 id="getShortNameAsProperty"><a href="#getShortNameAsProperty" class="headerlink" title="getShortNameAsProperty"></a>getShortNameAsProperty</h3><p><code>String getShortNameAsProperty(Class&lt;?&gt; clazz)</code>è¿”å›é¦–å­—æ¯å°å†™çš„ç±»åï¼Œå¦‚æœæ˜¯å†…éƒ¨ç±»çš„è¯ï¼Œåˆ™å»æ‰å¤–éƒ¨ç±»åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getShortNameAsProperty(String.class)); <span class="comment">// string</span></span><br></pre></td></tr></table></figure><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print(ClassUtils.getShortNameAsProperty(String.class)); <span class="comment">// b</span></span><br></pre></td></tr></table></figure><h3 id="getClassFileName"><a href="#getClassFileName" class="headerlink" title="getClassFileName"></a>getClassFileName</h3><p><code>String getClassFileName(Class&lt;?&gt; clazz)</code>è¿”å›ç±»å+.classï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getShortNameAsProperty(String.class)); <span class="comment">// String.class</span></span><br></pre></td></tr></table></figure><p></p><h3 id="getPackageName"><a href="#getPackageName" class="headerlink" title="getPackageName"></a>getPackageName</h3><p><code>String getPackageName(Class&lt;?&gt; clazz)</code>è¿”å›åŒ…åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getShortNameAsProperty(String.class)); <span class="comment">// java.lang</span></span><br></pre></td></tr></table></figure><p></p><h3 id="getQualifiedName"><a href="#getQualifiedName" class="headerlink" title="getQualifiedName"></a>getQualifiedName</h3><p><code>String getQualifiedName(Class&lt;?&gt; clazz)</code>è¿”å›å…¨é™å®šç±»åï¼Œå¦‚æœæ˜¯æ•°ç»„ç±»å‹åˆ™æœ«å°¾åŠ []ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getQualifiedName(String.class));</span><br><span class="line">print(ClassUtils.getQualifiedName(String[].class));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.String</span><br><span class="line">java.lang.String[]</span><br></pre></td></tr></table></figure><h3 id="getQualifiedMethodName"><a href="#getQualifiedMethodName" class="headerlink" title="getQualifiedMethodName"></a>getQualifiedMethodName</h3><p><code>String getQualifiedMethodName(Method method)</code>è·å–æ–¹æ³•çš„å…¨é™å®šåï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getQualifiedMethodName(</span><br><span class="line">        ClassUtils.class.getDeclaredMethod(<span class="string">"getQualifiedMethodName"</span>, Method.class</span><br><span class="line">        )));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.util.ClassUtils.getQualifiedMethodName</span><br></pre></td></tr></table></figure><h3 id="hasConstructor"><a href="#hasConstructor" class="headerlink" title="hasConstructor"></a>hasConstructor</h3><p><code>boolean hasConstructor(Class&lt;?&gt; clazz, Class&lt;?&gt;... paramTypes)</code>åˆ¤æ–­ç»™å®šç±»å‹æ˜¯å¦æœ‰ç»™å®šç±»å‹å‚æ•°æ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.hasConstructor(String.class, String.class));</span><br><span class="line">print(ClassUtils.hasConstructor(String.class, Object.class));</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">true</span><br><span class="line">false</span><br></pre></td></tr></table></figure><h3 id="getConstructorIfAvailable"><a href="#getConstructorIfAvailable" class="headerlink" title="getConstructorIfAvailable"></a>getConstructorIfAvailable</h3><p><code>&lt;T&gt; Constructor&lt;T&gt; getConstructorIfAvailable(Class&lt;T&gt; clazz, Class&lt;?&gt;... paramTypes)</code>è¿”å›ç»™å®šç±»å‹çš„ç»™å®šå‚æ•°ç±»å‹æ„é€ å™¨ï¼Œæ²¡æœ‰çš„è¯è¿”å›nullï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Constructor&lt;String&gt; constructorIfAvailable = ClassUtils.getConstructorIfAvailable(String.class, String.class);</span><br><span class="line">print(constructorIfAvailable != <span class="keyword">null</span>);</span><br><span class="line">print(constructorIfAvailable.toString());</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">true</span><br><span class="line">public java.lang.String(java.lang.String)</span><br></pre></td></tr></table></figure><h3 id="hasMethod"><a href="#hasMethod" class="headerlink" title="hasMethod"></a>hasMethod</h3><p><code>boolean hasMethod(Class&lt;?&gt; clazz, Method method)</code>åˆ¤æ–­ç»™å®šç±»å‹æ˜¯å¦æœ‰æŒ‡å®šçš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Method hasMethod = ClassUtils.class.getDeclaredMethod(<span class="string">"hasMethod"</span>, Class.class, Method.class);</span><br><span class="line">print(ClassUtils.hasMethod(ClassUtils.class, hasMethod)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p></p><p>é‡è½½æ–¹æ³•<code>boolean hasMethod(Class&lt;?&gt; clazz, String methodName, Class&lt;?&gt;... paramTypes)</code>ã€‚</p><h3 id="getMethod"><a href="#getMethod" class="headerlink" title="getMethod"></a>getMethod</h3><p><code>Method getMethod(Class&lt;?&gt; clazz, String methodName, @Nullable Class&lt;?&gt;... paramTypes)</code>ä»æŒ‡å®šç±»å‹ä¸­æ‰¾æŒ‡å®šæ–¹æ³•ï¼Œæ²¡æ‰¾åˆ°æŠ›IllegalStateExceptionå¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClassUtils.getMethod(ClassUtils.class,<span class="string">"hello"</span>, String.class);</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: Expected method not found: java.lang.NoSuchMethodException: org.springframework.util.ClassUtils.hello(java.lang.String)</span><br></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›æ²¡æ‰¾åˆ°è¿”å›nullï¼Œè€ŒéæŠ›å¼‚å¸¸ï¼Œå¯ä»¥ç”¨<code>getMethodIfAvailable</code>æ–¹æ³•ã€‚</p><h3 id="getMethodCountForName"><a href="#getMethodCountForName" class="headerlink" title="getMethodCountForName"></a>getMethodCountForName</h3><p><code>int getMethodCountForName(Class&lt;?&gt; clazz, String methodName)</code>ä»æŒ‡å®šç±»å‹ä¸­é€šè¿‡æ–¹æ³•åç§°æŸ¥æ‰¾è¯¥æ–¹æ³•ä¸ªæ•°ï¼ˆé‡å†™ã€é‡è½½ã€épublicçš„éƒ½ç®—ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ClassUtils.getMethodCountForName(ClassUtils.class,<span class="string">"hasMethod"</span>)); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p></p><p>ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰<code>hasAtLeastOneMethodWithName</code>ï¼Œè‡³å°‘å¾—æœ‰ä¸€ä¸ªã€‚</p><h3 id="getStaticMethod"><a href="#getStaticMethod" class="headerlink" title="getStaticMethod"></a>getStaticMethod</h3><p><code>Method getStaticMethod(Class&lt;?&gt; clazz, String methodName, Class&lt;?&gt;... args)</code>è·å–ç»™å®šç±»å‹çš„é™æ€æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•ä¸æ˜¯é™æ€çš„æˆ–è€…æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œåˆ™è¿”å›nullï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Method method = ClassUtils.getStaticMethod(ClassUtils.class, <span class="string">"getDefaultClassLoader"</span>);</span><br><span class="line">print(method != <span class="keyword">null</span>);</span><br><span class="line">print(method.getReturnType());</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">true</span><br><span class="line">class java.lang.ClassLoader</span><br></pre></td></tr></table></figure><h2 id="FileSystemUtils"><a href="#FileSystemUtils" class="headerlink" title="FileSystemUtils"></a>FileSystemUtils</h2><p>æ–‡ä»¶ç³»ç»Ÿå®ç”¨å·¥å…·ç±»</p><h3 id="deleteRecursively"><a href="#deleteRecursively" class="headerlink" title="deleteRecursively"></a>deleteRecursively</h3><p><code>boolean deleteRecursively(@Nullable File root)</code>é€’å½’åˆ é™¤æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•ï¼Œåˆ é™¤æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›falseï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>æ–°å»ºä¸€ä¸ªå¤šå±‚çº§ç›®å½•ï¼š</p><p><img src="img/QQ20201223-160010@2x.png" alt="QQ20201223-160010@2x"></p><p>å®ç”¨Fileçš„deleteç›®å½•å°è¯•åˆ é™¤aç›®å½•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">"a"</span>);</span><br><span class="line">print(file.delete()); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p></p><p>å› ä¸ºaç›®å½•åŒ…å«å­ç›®å½•ï¼ˆæ–‡ä»¶ï¼‰ï¼Œæ‰€ä»¥åº”è¯¥ä½¿ç”¨é€’å½’åˆ é™¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">"a"</span>);</span><br><span class="line">print(FileSystemUtils.deleteRecursively(file)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>é‡è½½æ–¹æ³•<code>boolean deleteRecursively(@Nullable Path root)</code>å’Œè¯¥æ–¹æ³•åŠŸèƒ½ç›¸ä¼¼ï¼Œä½†è¯¥æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºIOå¼‚å¸¸ã€‚</p><h3 id="copyRecursively"><a href="#copyRecursively" class="headerlink" title="copyRecursively"></a>copyRecursively</h3><p><code>void copyRecursively(File src, File dest)</code>é€’å½’å¤åˆ¶srcæ–‡ä»¶åˆ°destï¼ˆç›®æ ‡è·¯å¾„ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼‰ï¼š</p><p>æ–°å»ºä¸€ä¸ªå¤šå±‚çº§ç›®å½•ï¼š</p><p><img src="img/QQ20201223-160010@2x.png" alt="QQ20201223-160010@2x"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">File src = <span class="keyword">new</span> File(<span class="string">"a"</span>);</span><br><span class="line">File dest = <span class="keyword">new</span> File(<span class="string">"aa"</span>);</span><br><span class="line">FileSystemUtils.copyRecursively(src, dest);</span><br></pre></td></tr></table></figure><p><img src="img/QQ20201223-161119@2x.png" alt="QQ20201223-161119@2x"></p><p>é‡è½½æ–¹æ³•<code>void copyRecursively(Path src, Path dest)</code>ã€‚</p><h2 id="StreamUtils"><a href="#StreamUtils" class="headerlink" title="StreamUtils"></a>StreamUtils</h2><p>åŒ…å«ä¸€äº›æ–‡ä»¶æµçš„å®ç”¨æ–¹æ³•é»˜è®¤çš„ç¼“å†²åŒºå¤§å°ä¸º4096bytesã€‚</p><div class="note danger">æ³¨æ„ï¼šè¯¥å·¥å…·ç±»çš„æ‰€æœ‰æ–¹æ³•éƒ½ä¸ä¼šå¯¹æµè¿›è¡Œå…³é—­å¤„ç†ï¼</div><blockquote><p>æœªå®Œå¾…ç»­ï¼Œæ…¢æ…¢è®°å½•ğŸ˜´</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;æˆ‘ä»¬é¡¹ç›®å¤§å¤šæ•°éƒ½æ˜¯åŸºäºSpringæ¶æ„ï¼ŒSpringè‡ªèº«åŒ…å«äº†è®¸å¤šå®ç”¨çš„å·¥å…·ç±»ï¼Œå­¦ä¹ è¿™äº›å·¥å…·ç±»çš„ä½¿ç”¨ä¸ä»…èƒ½è®©æˆ‘ä»¬è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœï¼Œè€Œä¸”è¿˜èƒ½å‡å°‘ä¸å¿…è¦çš„é¢å¤–çš„å·¥å…·ç±»çš„å¼•å…¥ã€‚æŸ¥çœ‹è¿™äº›å·¥å…·ç±»çš„æºç æ—¶å‘ç°å®ƒä»¬éƒ½æ˜¯abstractç±»å‹çš„ï¼Œè¿™æ˜¯å› ä¸ºå·¥å…·ç±»çš„æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯staticé™æ€æ–¹æ³•ï¼Œé™æ€æ–¹æ³•å’Œç±»ç»‘å®šï¼Œç±»åŠ è½½åå°±èƒ½ä½¿ç”¨äº†ï¼Œæ— éœ€å®ä¾‹åŒ–ï¼ˆåˆšå¥½abstractç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œå¹¶ä¸”å¯ä»¥å®šä¹‰éæŠ½è±¡æ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥å·¥å…·ç±»å®šä¹‰ä¸ºabstractç±»å‹å†åˆé€‚ä¸è¿‡ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spring" scheme="http://mrbird.cc/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Java æ•°å­—ç­¾åç®—æ³•</title>
    <link href="http://mrbird.cc/Java-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95.html"/>
    <id>http://mrbird.cc/Java-æ•°å­—ç­¾åç®—æ³•.html</id>
    <published>2020-05-17T06:25:21.000Z</published>
    <updated>2020-08-27T09:01:20.873Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p>æ•°å­—ç­¾åç®—æ³•å¯ä»¥çœ‹æˆæ˜¯å¸¦ç§˜é’¥çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼Œç”¨äºéªŒè¯æ•°æ®å®Œæ•´æ€§ã€è®¤è¯æ•°æ®æ¥æºï¼Œå¹¶èµ·åˆ°æŠ—å¦è®¤çš„ä½œç”¨ã€‚éµå¾ªç§é’¥åŠ ç­¾ï¼Œå…¬é’¥éªŒç­¾çš„è§„åˆ™ï¼Œæ•°å­—ç­¾åç®—æ³•æ˜¯éå¯¹ç§°åŠ å¯†ç®—æ³•å’Œæ¶ˆæ¯æ‘˜è¦ç®—æ³•çš„ç»“åˆä½“ã€‚æ•°å­—ç­¾åç®—æ³•ä¸»è¦åŒ…æ‹¬RSAå’ŒDSAã€‚è¿™èŠ‚è®°å½•ä¸‹è¿™ä¸¤ç§ç®—æ³•åœ¨JDK8ä¸‹çš„å®ç°ã€‚<a id="more"></a></p><p>æ•°å­—ç­¾ååŠ ç­¾éªŒç­¾æµç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li>Aåœ¨æœ¬åœ°æ„å»ºç§˜é’¥å¯¹ï¼Œå¹¶å°†å…¬é’¥å‘å¸ƒç»™Bï¼›</li><li>Aä½¿ç”¨ç§é’¥å¯¹æ•°æ®è¿›è¡Œç­¾åï¼›</li><li>Aå‘é€ç­¾åå’Œæ•°æ®ç»™Bï¼›</li><li>Bä½¿ç”¨å…¬é’¥å¯¹ç­¾åå’Œæ•°æ®è¿›è¡ŒéªŒç­¾ã€‚</li></ol><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>RSAæ•°å­—ç­¾åç®—æ³•ä¸»è¦åˆ†ä¸ºMDç³»åˆ—å’ŒSHAç³»åˆ—ä¸¤å¤§ç±»ã€‚MDç³»åˆ—ä¸»è¦åŒ…æ‹¬MD2withRSAå’ŒMD5withRSAå…±2ç§æ•°å­—ç­¾åç®—æ³•ï¼›SHAç³»åˆ—ä¸»è¦åŒ…æ‹¬SHA1withRSAã€SHA224withRSAã€SHA256withRSAã€SHA384withRSAå’ŒSHA512withRSAå…±5ç§æ•°å­—ç­¾åç®—æ³•ã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RsaSignatureDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        <span class="comment">// éå¯¹ç§°åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"RSA"</span>;</span><br><span class="line">        <span class="comment">// ç­¾åç®—æ³•ï¼ŒRSA+SHA</span></span><br><span class="line">        String signAlgorithm = <span class="string">"SHA256withRSA"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ----- å…¬ç§é’¥ç”Ÿæˆ --------</span></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥å¯¹ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ï¼Œç§˜é’¥é•¿åº¦512~16384ä½ï¼Œ64å€æ•°</span></span><br><span class="line">        keyPairGenerator.initialize(<span class="number">512</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥å¯¹</span></span><br><span class="line">        KeyPair keyPair = keyPairGenerator.generateKeyPair();</span><br><span class="line">        <span class="comment">// å…¬é’¥</span></span><br><span class="line">        PublicKey publicKey = keyPair.getPublic();</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥: "</span> + Base64.getEncoder().encodeToString(publicKey.getEncoded()));</span><br><span class="line">        <span class="comment">// ç§é’¥</span></span><br><span class="line">        PrivateKey privateKey = keyPair.getPrivate();</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥: "</span> + Base64.getEncoder().encodeToString(privateKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ----- ç§é’¥åŠ ç­¾ ---------</span></span><br><span class="line">        <span class="comment">// è·å–ç­¾åå¯¹è±¡</span></span><br><span class="line">        Signature signature = Signature.getInstance(signAlgorithm);</span><br><span class="line">        signature.initSign(privateKey);</span><br><span class="line">        signature.update(value.getBytes());</span><br><span class="line">        <span class="keyword">byte</span>[] sign = signature.sign();</span><br><span class="line">        System.out.println(<span class="string">"ç­¾åå€¼: "</span> + Base64.getEncoder().encodeToString(sign));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ----- å…¬é’¥éªŒç­¾ ---------</span></span><br><span class="line">        signature.initVerify(publicKey);</span><br><span class="line">        signature.update(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"éªŒç­¾ç»“æœ: "</span> + signature.verify(sign));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç§˜é’¥å¯¹ç”Ÿæˆè¿‡ç¨‹å’Œä¸Šç¯‡RSAä»‹ç»çš„æ— å¼‚ï¼Œä¸»è¦å…³æ³¨åŠ ç­¾å’ŒéªŒç­¾æ“ä½œå³å¯ï¼Œç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RSAå…¬é’¥: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKTTlw+zyhGzmTmhT5w9vEP1ejOcVfM2rHbz8jUae7InAh42R9ZaYUk1c3q0uqmTv8xKOnszU/vrdV52zoFM+OMCAwEAAQ==</span><br><span class="line">RSAç§é’¥: MIIBUwIBADANBgkqhkiG9w0BAQEFAASCAT0wggE5AgEAAkEApNOXD7PKEbOZOaFPnD28Q/V6M5xV8zasdvPyNRp7sicCHjZH1lphSTVzerS6qZO/zEo6ezNT++t1XnbOgUz44wIDAQABAkBsZQXz+p2J1J2Qq8fqDSNxYc8Sf956SttSgw0m5Rqxxiw10cgHt67uocu3qK6UeMuJuaOiN3YT48kvFp6Joc75AiEA4L7R1zDWcOdWf2BE/k3yxJ4Uv0vbIZ9vWLuJGBR3xK0CIQC7v5f2fcedBWbJ/kR7CvbFE91ivM55dvWZMe/JrjXVzwIgFUn+FqRJq+g+CVLVNkGr/XP8AyLsXwL7SSx6kA1gSwECIHysAn4VEftr/dC+Pr0yD6HYyhbp53XzD6214lQbkfYzAiB1b2wNi0Y3N+D/OIrGUHlwgA0vkX82NP3V8qMDmRbCTQ==</span><br><span class="line">ç­¾åå€¼: HVN5WkhND0hy/xY43h8r3+AVt6oxMSv1Ug/Y+bv1tGxw4ePQtIgzFwK0lQQbhIlwts2d2STwQBews4dXCfEMmA==</span><br><span class="line">éªŒç­¾ç»“æœ: true</span><br></pre></td></tr></table></figure><p></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸åŒç­¾åç®—æ³•éœ€è¦çš„ç§˜é’¥é•¿åº¦æœ€å°å€¼ä¸åŒï¼Œå¤§ä¼™å¯ä»¥è‡ªå·±è¯•è¯•ã€‚</p><h2 id="DSA"><a href="#DSA" class="headerlink" title="DSA"></a>DSA</h2><p>DSAç®—æ³•ä¸RSAç®—æ³•éƒ½æ˜¯æ•°å­—è¯ä¹¦ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸¤ç§ç®—æ³•ã€‚ä¸¤è€…ä¸åŒçš„æ˜¯ï¼ŒDSAç®—æ³•ä»…åŒ…å«æ•°å­—ç­¾åç®—æ³•ï¼Œä½¿ç”¨DSAç®—æ³•çš„æ•°å­—è¯ä¹¦æ— æ³•è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼Œè€ŒRSAç®—æ³•æ—¢åŒ…å«åŠ å¯†/è§£å¯†ç®—æ³•ï¼ŒåŒæ—¶å…¼æœ‰æ•°å­—ç­¾åç®—æ³•ã€‚</p><p>JDK8æ”¯æŒSHA1withDSAã€SHA224withDSAã€SHA256withDSAã€SHA384withDSAå’ŒSHA512withDSAè¿™äº”ç§DSAæ•°å­—ç­¾åç®—æ³•ã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼ˆåªéœ€å°†ä¸Šé¢çš„ä¾‹å­ç®—æ³•æ›¿æ¢ä¸‹å°±å¥½ï¼Œå¹¶ä¸”æ³¨æ„ç§˜é’¥çš„é•¿åº¦èŒƒå›´ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RsaSignatureDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        <span class="comment">// éå¯¹ç§°åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"DSA"</span>;</span><br><span class="line">        <span class="comment">// ç­¾åç®—æ³•ï¼ŒDSA+SHA</span></span><br><span class="line">        String signAlgorithm = <span class="string">"SHA224withDSA"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ----- å…¬ç§é’¥ç”Ÿæˆ --------</span></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥å¯¹ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ï¼Œç§˜é’¥é•¿åº¦512~1024ä½ï¼Œ64å€æ•°</span></span><br><span class="line">        keyPairGenerator.initialize(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥å¯¹</span></span><br><span class="line">        KeyPair keyPair = keyPairGenerator.generateKeyPair();</span><br><span class="line">        <span class="comment">// å…¬é’¥</span></span><br><span class="line">        PublicKey publicKey = keyPair.getPublic();</span><br><span class="line">        System.out.println(<span class="string">"DSAå…¬é’¥: "</span> + Base64.getEncoder().encodeToString(publicKey.getEncoded()));</span><br><span class="line">        <span class="comment">// ç§é’¥</span></span><br><span class="line">        PrivateKey privateKey = keyPair.getPrivate();</span><br><span class="line">        System.out.println(<span class="string">"DSAç§é’¥: "</span> + Base64.getEncoder().encodeToString(privateKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ----- ç§é’¥åŠ ç­¾ ---------</span></span><br><span class="line">        <span class="comment">// è·å–ç­¾åå¯¹è±¡</span></span><br><span class="line">        Signature signature = Signature.getInstance(signAlgorithm);</span><br><span class="line">        signature.initSign(privateKey);</span><br><span class="line">        signature.update(value.getBytes());</span><br><span class="line">        <span class="keyword">byte</span>[] sign = signature.sign();</span><br><span class="line">        System.out.println(<span class="string">"ç­¾åå€¼: "</span> + Base64.getEncoder().encodeToString(sign));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ----- å…¬é’¥éªŒç­¾ ---------</span></span><br><span class="line">        signature.initVerify(publicKey);</span><br><span class="line">        signature.update(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"éªŒç­¾ç»“æœ: "</span> + signature.verify(sign));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DSAå…¬é’¥: MIIBtzCCASwGByqGSM44BAEwggEfAoGBAP1/U4EddRIpUt9KnC7s5Of2EbdSPO9EAMMeP4C2USZpRV1AIlH7WT2NWPq/xfW6MPbLm1Vs14E7gB00b/JmYLdrmVClpJ+f6AR7ECLCT7up1/63xhv4O1fnxqimFQ8E+4P208UewwI1VBNaFpEy9nXzrith1yrv8iIDGZ3RSAHHAhUAl2BQjxUjC8yykrmCouuEC/BYHPUCgYEA9+GghdabPd7LvKtcNrhXuXmUr7v6OuqC+VdMCz0HgmdRWVeOutRZT+ZxBxCBgLRJFnEj6EwoFhO3zwkyjMim4TwWeotUfI0o4KOuHiuzpnWRbqN/C/ohNWLx+2J6ASQ7zKTxvqhRkImog9/hWuWfBpKLZl6Ae1UlZAFMO/7PSSoDgYQAAoGAcW0aiebAWi5M18Lu6QS/1OoHbtw2I7kyivwExbNAZpWR9I9sNIwE1T0a491t1oqRV1cdBHyd9jiJqFwfLG6k5QidasXTgGYSsSZqFBebP5nrF5q3RtkosoHeHVKDnShQf5b36NK53CpCRfLayk2e5inu7CCCo+a58piAMiF3c+k=</span><br><span class="line">DSAç§é’¥: MIIBTAIBADCCASwGByqGSM44BAEwggEfAoGBAP1/U4EddRIpUt9KnC7s5Of2EbdSPO9EAMMeP4C2USZpRV1AIlH7WT2NWPq/xfW6MPbLm1Vs14E7gB00b/JmYLdrmVClpJ+f6AR7ECLCT7up1/63xhv4O1fnxqimFQ8E+4P208UewwI1VBNaFpEy9nXzrith1yrv8iIDGZ3RSAHHAhUAl2BQjxUjC8yykrmCouuEC/BYHPUCgYEA9+GghdabPd7LvKtcNrhXuXmUr7v6OuqC+VdMCz0HgmdRWVeOutRZT+ZxBxCBgLRJFnEj6EwoFhO3zwkyjMim4TwWeotUfI0o4KOuHiuzpnWRbqN/C/ohNWLx+2J6ASQ7zKTxvqhRkImog9/hWuWfBpKLZl6Ae1UlZAFMO/7PSSoEFwIVAIv03r5wR+DolDC5bGFOqQ2vuHlo</span><br><span class="line">ç­¾åå€¼: MCwCFBRba/HI5/tLt+exzpgvLoq5mAwaAhQvaVv4dbGFNtMpcI4ZeqjgAGeGyg==</span><br><span class="line">éªŒç­¾ç»“æœ: true</span><br></pre></td></tr></table></figure><p></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;æ•°å­—ç­¾åç®—æ³•å¯ä»¥çœ‹æˆæ˜¯å¸¦ç§˜é’¥çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼Œç”¨äºéªŒè¯æ•°æ®å®Œæ•´æ€§ã€è®¤è¯æ•°æ®æ¥æºï¼Œå¹¶èµ·åˆ°æŠ—å¦è®¤çš„ä½œç”¨ã€‚éµå¾ªç§é’¥åŠ ç­¾ï¼Œå…¬é’¥éªŒç­¾çš„è§„åˆ™ï¼Œæ•°å­—ç­¾åç®—æ³•æ˜¯éå¯¹ç§°åŠ å¯†ç®—æ³•å’Œæ¶ˆæ¯æ‘˜è¦ç®—æ³•çš„ç»“åˆä½“ã€‚æ•°å­—ç­¾åç®—æ³•ä¸»è¦åŒ…æ‹¬RSAå’ŒDSAã€‚è¿™èŠ‚è®°å½•ä¸‹è¿™ä¸¤ç§ç®—æ³•åœ¨JDK8ä¸‹çš„å®ç°ã€‚
    
    </summary>
    
    
      <category term="Security" scheme="http://mrbird.cc/tags/Security/"/>
    
      <category term="Java" scheme="http://mrbird.cc/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Java éå¯¹ç§°åŠ å¯†ç®—æ³•RSA</title>
    <link href="http://mrbird.cc/Java-%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95.html"/>
    <id>http://mrbird.cc/Java-éå¯¹ç§°åŠ å¯†ç®—æ³•.html</id>
    <published>2020-05-15T03:22:36.000Z</published>
    <updated>2020-08-27T06:26:00.006Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p>éå¯¹ç§°åŠ å¯†å’Œå¯¹ç§°åŠ å¯†ç®—æ³•ç›¸æ¯”ï¼Œå¤šäº†ä¸€æŠŠç§˜é’¥ï¼Œä¸ºåŒç§˜é’¥æ¨¡å¼ï¼Œä¸€ä¸ªå…¬å¼€ç§°ä¸ºå…¬é’¥ï¼Œä¸€ä¸ªä¿å¯†ç§°ä¸ºç§é’¥ã€‚éµå¾ªå…¬é’¥åŠ å¯†ç§é’¥è§£å¯†ï¼Œæˆ–è€…ç§é’¥åŠ å¯†å…¬é’¥è§£å¯†ã€‚éå¯¹ç§°åŠ å¯†ç®—æ³•æºäºDHç®—æ³•ï¼Œååˆæœ‰åŸºäºæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•çš„å¯†é’¥äº¤æ¢ç®—æ³•ECDHï¼Œä¸è¿‡ç›®å‰æœ€ä¸ºæµè¡Œçš„éå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯RSAï¼Œæœ¬æ–‡ç®€å•è®°å½•ä¸‹RSAçš„ä½¿ç”¨ã€‚<a id="more"></a></p><h2 id="RSAç®—æ³•"><a href="#RSAç®—æ³•" class="headerlink" title="RSAç®—æ³•"></a>RSAç®—æ³•</h2><p>RSAç®—æ³•æ˜¯æœ€ä¸ºå…¸å‹çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œè¯¥ç®—æ³•ç”±ç¾å›½éº»çœç†å·¥å­¦é™¢ï¼ˆMITï¼‰çš„Ron Rivestã€Adi Shamirå’ŒLeonard Adlemanä¸‰ä½å­¦è€…æå‡ºï¼Œå¹¶ä»¥è¿™ä¸‰ä½å­¦è€…çš„å§“æ°å¼€å¤´å­—æ¯å‘½åï¼Œç§°ä¸ºRSAç®—æ³•ã€‚</p><p>RSAç®—æ³•çš„æ•°æ®äº¤æ¢è¿‡ç¨‹åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š</p><ol><li>Aæ„å»ºRSAç§˜é’¥å¯¹ï¼›</li><li>Aå‘Bå‘å¸ƒå…¬é’¥ï¼›</li><li>Aç”¨ç§é’¥åŠ å¯†æ•°æ®å‘ç»™Bï¼›</li><li>Bç”¨å…¬é’¥è§£å¯†æ•°æ®ï¼›</li><li>Bç”¨å…¬é’¥åŠ å¯†æ•°æ®å‘ç»™Aï¼›</li><li>Aç”¨ç§é’¥è§£å¯†æ•°æ®ã€‚</li></ol><p>JDK8æ”¯æŒRSAç®—æ³•ï¼š</p><table><tr><th>ç®—æ³•</th><th>ç§˜é’¥é•¿åº¦</th><th>åŠ å¯†æ¨¡å¼</th><th>å¡«å……æ¨¡å¼</th></tr><tr><td>RSA</td><td>512~16384ä½ï¼Œ64å€æ•°</td><td>ECB</td><td>NoPadding<br>PKCS1Padding<br>OAEPWithMD5AndMGF1Padding<br>OAEPWithSHA1AndMGF1Padding<br>OAEPWithSHA-1AndMGF1Padding<br>OAEPWithSHA-224AndMGF1Padding<br>OAEPWithSHA-256AndMGF1Padding<br>OAEPWithSHA-384AndMGF1Padding<br>OAEPWithSHA-512AndMGF1Padding OAEPWithSHA-512/224AndMGF1Padding<br>OAEPWithSHA-512/2256ndMGF1Padding</td></tr></table><p>ä»£ç ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPairGenerator;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"RSA"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transform = <span class="string">"RSA/ECB/PKCS1Padding"</span>;</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥å¯¹ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ï¼Œç§˜é’¥é•¿åº¦512~16384ä½ï¼Œ64å€æ•°</span></span><br><span class="line">        keyPairGenerator.initialize(<span class="number">512</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥å¯¹</span></span><br><span class="line">        KeyPair keyPair = keyPairGenerator.generateKeyPair();</span><br><span class="line">        <span class="comment">// å…¬é’¥</span></span><br><span class="line">        PublicKey publicKey = keyPair.getPublic();</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥: "</span> + Base64.getEncoder().encodeToString(publicKey.getEncoded()));</span><br><span class="line">        <span class="comment">// ç§é’¥</span></span><br><span class="line">        PrivateKey privateKey = keyPair.getPrivate();</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥: "</span> + Base64.getEncoder().encodeToString(privateKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ------ æµ‹è¯•å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯† ------</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transform);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, publicKey);</span><br><span class="line">        <span class="keyword">byte</span>[] pubEncryptBytes = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥åŠ å¯†åæ•°æ®: "</span> + Base64.getEncoder().encodeToString(pubEncryptBytes));</span><br><span class="line"></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">        <span class="keyword">byte</span>[] priDecryptBytes = cipher.doFinal(pubEncryptBytes);</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥è§£å¯†åæ•°æ®: "</span> + <span class="keyword">new</span> String(priDecryptBytes));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ------ æµ‹è¯•ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯† ------</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, privateKey);</span><br><span class="line">        <span class="keyword">byte</span>[] priEncryptBytes = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥åŠ å¯†åæ•°æ®: "</span> + Base64.getEncoder().encodeToString(priEncryptBytes));</span><br><span class="line"></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, publicKey);</span><br><span class="line">        <span class="keyword">byte</span>[] pubDecryptBytes = cipher.doFinal(priEncryptBytes);</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥è§£å¯†åæ•°æ®: "</span> + <span class="keyword">new</span> String(pubDecryptBytes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RSAå…¬é’¥: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKBvz9cma+hXNiv2yXg6e1PyZhHVZm3bJXDvTJP2LyXo4vs9grH36Q9kNgr6quHtuU6fEoUxUu2zbEB8dkEWB9UCAwEAAQ==</span><br><span class="line">RSAç§é’¥: MIIBVAIBADANBgkqhkiG9w0BAQEFAASCAT4wggE6AgEAAkEAoG/P1yZr6Fc2K/bJeDp7U/JmEdVmbdslcO9Mk/YvJeji+z2CsffpD2Q2Cvqq4e25Tp8ShTFS7bNsQHx2QRYH1QIDAQABAkEAjemZXORdesz52/WVzEVepai6ZHfw/Kdl/PmPMSoIFmz7mk55rprl2Akn2V0odSiHSnMWvDmOUIAvHaHF4Re4wQIhAN5GxVeF7ndyoWasxqIOVb6baNkUrapBM0nacPS4WA8JAiEAuMcvNM2Z1rW74JagoGlSIfRkNUqa+3LTCN/fK7VR2W0CICs/+gYduVjkpSMlW0ENKQH9m1kh/Oiz5xbnujLj676BAiBVGif7wdXgtcLaJYXFW7ygNtcQVFQdCz13EOTQVKpl4QIgY2YyH3vUYI2J68qCGtYjj5iNHUEwwze+Za1R7y0V43k=</span><br><span class="line">RSAå…¬é’¥åŠ å¯†åæ•°æ®: O55w+9ve4QPcNDXNXF3W6O3J9UHxGBWlOM8W5RkKIslMR5xoUkBqIufWO2mz5MWezfxHB9yH1mPQgrv3H1hMKQ==</span><br><span class="line">RSAç§é’¥è§£å¯†åæ•°æ®: mrbird&apos;s blog</span><br><span class="line">RSAç§é’¥åŠ å¯†åæ•°æ®: UtwtFxWstrg+fQV6WSw8PYY1YP5K9bjYH7uY20SQIJ5iWQ9FEERi8+ttk2MougQro66aiJRpdCeSpIVi09J+Ew==</span><br><span class="line">RSAå…¬é’¥è§£å¯†åæ•°æ®: mrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¬é’¥åŠ å¯†ç§é’¥è§£å¯†å’Œç§é’¥åŠ å¯†å…¬é’¥è§£å¯†çš„æ¨¡å¼éƒ½å¯è¡Œã€‚</p><h2 id="å…¬ç§é’¥è·å–"><a href="#å…¬ç§é’¥è·å–" class="headerlink" title="å…¬ç§é’¥è·å–"></a>å…¬ç§é’¥è·å–</h2><p>å‡å¦‚ç°åœ¨æœ‰RSAå…¬é’¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKBvz9cma+hXNiv2yXg6e1PyZhHVZm3bJXDvTJP2LyXo4vs9grH36Q9kNgr6quHtuU6fEoUxUu2zbEB8dkEWB9UCAwEAAQ==</span><br></pre></td></tr></table></figure><p></p><p>RSAç§é’¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MIIBVAIBADANBgkqhkiG9w0BAQEFAASCAT4wggE6AgEAAkEAoG/P1yZr6Fc2K/bJeDp7U/JmEdVmbdslcO9Mk/YvJeji+z2CsffpD2Q2Cvqq4e25Tp8ShTFS7bNsQHx2QRYH1QIDAQABAkEAjemZXORdesz52/WVzEVepai6ZHfw/Kdl/PmPMSoIFmz7mk55rprl2Akn2V0odSiHSnMWvDmOUIAvHaHF4Re4wQIhAN5GxVeF7ndyoWasxqIOVb6baNkUrapBM0nacPS4WA8JAiEAuMcvNM2Z1rW74JagoGlSIfRkNUqa+3LTCN/fK7VR2W0CICs/+gYduVjkpSMlW0ENKQH9m1kh/Oiz5xbnujLj676BAiBVGif7wdXgtcLaJYXFW7ygNtcQVFQdCz13EOTQVKpl4QIgY2YyH3vUYI2J68qCGtYjj5iNHUEwwze+Za1R7y0V43k=</span><br></pre></td></tr></table></figure><p></p><p>éœ€è¦å°†å®ƒä»¬è¿˜åŸä¸ºPublicKeyå’ŒPrivateKeyå¯¹è±¡ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyFactory;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.PKCS8EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.X509EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"RSA"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transform = <span class="string">"RSA/ECB/PKCS1Padding"</span>;</span><br><span class="line">        <span class="comment">// RSAå…¬é’¥BASE64å­—ç¬¦ä¸²</span></span><br><span class="line">        String rsaPublicKey = <span class="string">"MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKBvz9cma+hXNiv2yXg6e1PyZhHVZm3bJXDvTJP2LyXo4vs9grH36Q9kNgr6quHtuU6fEoUxUu2zbEB8dkEWB9UCAwEAAQ=="</span>;</span><br><span class="line">        <span class="comment">// RSAç§é’¥BASE64å­—ç¬¦ä¸²</span></span><br><span class="line">        String rsaPrivateKey = <span class="string">"MIIBVAIBADANBgkqhkiG9w0BAQEFAASCAT4wggE6AgEAAkEAoG/P1yZr6Fc2K/bJeDp7U/JmEdVmbdslcO9Mk/YvJeji+z2CsffpD2Q2Cvqq4e25Tp8ShTFS7bNsQHx2QRYH1QIDAQABAkEAjemZXORdesz52/WVzEVepai6ZHfw/Kdl/PmPMSoIFmz7mk55rprl2Akn2V0odSiHSnMWvDmOUIAvHaHF4Re4wQIhAN5GxVeF7ndyoWasxqIOVb6baNkUrapBM0nacPS4WA8JAiEAuMcvNM2Z1rW74JagoGlSIfRkNUqa+3LTCN/fK7VR2W0CICs/+gYduVjkpSMlW0ENKQH9m1kh/Oiz5xbnujLj676BAiBVGif7wdXgtcLaJYXFW7ygNtcQVFQdCz13EOTQVKpl4QIgY2YyH3vUYI2J68qCGtYjj5iNHUEwwze+Za1R7y0V43k="</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ------- è¿˜åŸå…¬é’¥ --------</span></span><br><span class="line">        <span class="keyword">byte</span>[] publicKeyBytes = Base64.getDecoder().decode(rsaPublicKey);</span><br><span class="line">        X509EncodedKeySpec x509EncodedKeySpec = <span class="keyword">new</span> X509EncodedKeySpec(publicKeyBytes);</span><br><span class="line">        KeyFactory keyFactory = KeyFactory.getInstance(algorithm);</span><br><span class="line">        PublicKey publicKey = keyFactory.generatePublic(x509EncodedKeySpec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ------- è¿˜åŸç§é’¥ --------</span></span><br><span class="line">        <span class="keyword">byte</span>[] privateKeyBytes = Base64.getDecoder().decode(rsaPrivateKey);</span><br><span class="line">        PKCS8EncodedKeySpec pkcs8EncodedKeySpec = <span class="keyword">new</span> PKCS8EncodedKeySpec(privateKeyBytes);</span><br><span class="line">        PrivateKey privateKey = keyFactory.generatePrivate(pkcs8EncodedKeySpec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ------- æµ‹è¯•åŠ è§£å¯† --------</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transform);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, publicKey);</span><br><span class="line">        <span class="keyword">byte</span>[] pubEncryptBytes = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥åŠ å¯†æ•°æ®: "</span> + Base64.getEncoder().encodeToString(pubEncryptBytes));</span><br><span class="line"></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">        <span class="keyword">byte</span>[] priDecryptBytes = cipher.doFinal(pubEncryptBytes);</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥è§£å¯†æ•°æ®: "</span> + <span class="keyword">new</span> String(priDecryptBytes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RSAå…¬é’¥åŠ å¯†æ•°æ®: PdSr+WRUWIxbA7stmZ03GCwDBnE3CyFL43bTskJmBilY+9lL63Jt0KxN0S2A4ombxvngbiB8PVZiqj1oSkgWpA==</span><br><span class="line">RSAç§é’¥è§£å¯†æ•°æ®: mrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><h2 id="åˆ†æ®µåŠ è§£å¯†"><a href="#åˆ†æ®µåŠ è§£å¯†" class="headerlink" title="åˆ†æ®µåŠ è§£å¯†"></a>åˆ†æ®µåŠ è§£å¯†</h2><p>RSAåŠ è§£å¯†ä¸­å¿…é¡»è€ƒè™‘åˆ°çš„å¯†é’¥é•¿åº¦ã€æ˜æ–‡é•¿åº¦å’Œå¯†æ–‡é•¿åº¦é—®é¢˜ã€‚æ˜æ–‡é•¿åº¦éœ€è¦å°äºå¯†é’¥é•¿åº¦ï¼Œè€Œå¯†æ–‡é•¿åº¦åˆ™ç­‰äºå¯†é’¥é•¿åº¦ã€‚å› æ­¤å½“åŠ å¯†å†…å®¹é•¿åº¦å¤§äºå¯†é’¥é•¿åº¦æ—¶ï¼Œæœ‰æ•ˆçš„RSAåŠ è§£å¯†å°±éœ€è¦å¯¹å†…å®¹è¿›è¡Œåˆ†æ®µã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼ŒRSAç®—æ³•æœ¬èº«è¦æ±‚åŠ å¯†å†…å®¹ä¹Ÿå°±æ˜¯æ˜æ–‡é•¿åº¦må¿…é¡»æ»¡è¶³<code>0&lt;m&lt;å¯†é’¥é•¿åº¦n</code>ã€‚å¦‚æœå°äºè¿™ä¸ªé•¿åº¦å°±éœ€è¦è¿›è¡Œpaddingï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰paddingï¼Œå°±æ— æ³•ç¡®å®šè§£å¯†åå†…å®¹çš„çœŸå®é•¿åº¦ï¼Œå­—ç¬¦ä¸²ä¹‹ç±»çš„å†…å®¹é—®é¢˜è¿˜ä¸å¤§ï¼Œä»¥0ä½œä¸ºç»“æŸç¬¦ï¼Œä½†å¯¹äºŒè¿›åˆ¶æ•°æ®å°±å¾ˆéš¾ï¼Œå› ä¸ºä¸ç¡®å®šåé¢çš„0æ˜¯å†…å®¹è¿˜æ˜¯å†…å®¹ç»“æŸç¬¦ã€‚è€Œåªè¦ç”¨åˆ°paddingï¼Œé‚£ä¹ˆå°±è¦å ç”¨å®é™…çš„æ˜æ–‡é•¿åº¦ï¼Œäºæ˜¯å®é™…æ˜æ–‡é•¿åº¦éœ€è¦å‡å»paddingå­—èŠ‚é•¿åº¦ã€‚æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„paddingæ ‡å‡†æœ‰NoPPaddingã€OAEPPaddingã€PKCS1Paddingç­‰ï¼Œå…¶ä¸­PKCS#1å»ºè®®çš„paddingå°±å ç”¨äº†11ä¸ªå­—èŠ‚ã€‚</p><p>ä»¥ç§˜é’¥é•¿åº¦ä¸º1024bitsä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPairGenerator;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StringBuilder value = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">29</span>; i++) &#123;</span><br><span class="line">            value.append(<span class="string">"18cm"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å†…å®¹é•¿åº¦: "</span> + value.toString().length());</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"RSA"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transform = <span class="string">"RSA/ECB/PKCS1Padding"</span>;</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥å¯¹ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ï¼Œç§˜é’¥é•¿åº¦512~16384ä½ï¼Œ64å€æ•°</span></span><br><span class="line">        keyPairGenerator.initialize(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥å¯¹</span></span><br><span class="line">        KeyPair keyPair = keyPairGenerator.generateKeyPair();</span><br><span class="line">        <span class="comment">// å…¬é’¥</span></span><br><span class="line">        PublicKey publicKey = keyPair.getPublic();</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥: "</span> + Base64.getEncoder().encodeToString(publicKey.getEncoded()));</span><br><span class="line">        <span class="comment">// ç§é’¥</span></span><br><span class="line">        PrivateKey privateKey = keyPair.getPrivate();</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥: "</span> + Base64.getEncoder().encodeToString(privateKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ------ æµ‹è¯•å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯† ------</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transform);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, publicKey);</span><br><span class="line">        <span class="keyword">byte</span>[] pubEncryptBytes = cipher.doFinal(value.toString().getBytes());</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥åŠ å¯†åæ•°æ®: "</span> + Base64.getEncoder().encodeToString(pubEncryptBytes));</span><br><span class="line"></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">        <span class="keyword">byte</span>[] priDecryptBytes = cipher.doFinal(pubEncryptBytes);</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥è§£å¯†åæ•°æ®: "</span> + <span class="keyword">new</span> String(priDecryptBytes));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ------ æµ‹è¯•ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯† ------</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, privateKey);</span><br><span class="line">        <span class="keyword">byte</span>[] priEncryptBytes = cipher.doFinal(value.toString().getBytes());</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥åŠ å¯†åæ•°æ®: "</span> + Base64.getEncoder().encodeToString(priEncryptBytes));</span><br><span class="line"></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, publicKey);</span><br><span class="line">        <span class="keyword">byte</span>[] pubDecryptBytes = cipher.doFinal(priEncryptBytes);</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥è§£å¯†åæ•°æ®: "</span> + <span class="keyword">new</span> String(pubDecryptBytes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºä¼šæŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å†…å®¹é•¿åº¦: 120</span><br><span class="line">RSAå…¬é’¥: MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC79DkQcppMMl11r21OMYcTlLWMJP9ZZw9BdszZPu+D1kHijbETrae84AwOrNPqrl8/vpPh2q9BLkrkfQuvSLQHk6tuefVEyWRnnnEwYJzIbjuQPhEwKU7khqjhNXdoW/27AN7kyQwFFnbLHfkc/lh6V6N6S2g5J2NmQL4hfqVgGwIDAQAB</span><br><span class="line">RSAç§é’¥: MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALv0ORBymkwyXXWvbU4xhxOUtYwk/1lnD0F2zNk+74PWQeKNsROtp7zgDA6s0+quXz++k+Har0EuSuR9C69ItAeTq2559UTJZGeecTBgnMhuO5A+ETApTuSGqOE1d2hb/bsA3uTJDAUWdssd+Rz+WHpXo3pLaDknY2ZAviF+pWAbAgMBAAECgYA2ksoC6ZO9rh4O7rnpK15SJCq2n4N5HQCD/I+sQKbg+9QziPqygQikQdWeaTY6/Rhw9NARkyKx5VQfleNPqOeEj1KwNK8pctD7nkb/PL/LZofH1uk1J0sgaSPpox2LUrIabWFs/dztbHpR/aiaQLbLfrdOgkGoQWM3FB8hMEsbSQJBAPhD/US0C6VQuMqLytuOsB7imqNttD8F6gGQAXAGz2YcgDHSHdayzhT1q12J0nrzfJGfZLZpc+4t9szS9Oh3VvcCQQDBzznlqTbaq7KaxAacdo6BRQszVMuy9kJXupINUUyw+wEaCiz4sxCJsa8ASfJBnxRGFEPyi9Hea6ijOwckDYL9AkEAkAPYqn8K9mYCHDTFg2GdVv06mS0tTxXeLfPccaDxtJk54Cyz9HSayVvNgaBOgdY2376nzI0VnAf7z8tcGHIJ9wJAcPwb5pU1U1mRL8RjjkdXYGkd1Hj0n4oMtxQfHQBuUyahR8ry2LGbTIp3WRXC0xqoOQqLahS07pOYpkA9M3llCQJBAN4oaSLXsSpZtnwekocGapsBaY62Kn9QIZGaGHJkmAwXBXEdXZfr/16BhUd4JSlfGgL3CvdP57OaWjl0CPZ0wxs=</span><br><span class="line"></span><br><span class="line">javax.crypto.IllegalBlockSizeException: Data must not be longer than 117 bytes</span><br><span class="line"></span><br><span class="line">	at com.sun.crypto.provider.RSACipher.doFinal(RSACipher.java:344)</span><br><span class="line">	at com.sun.crypto.provider.RSACipher.engineDoFinal(RSACipher.java:389)</span><br><span class="line">	at javax.crypto.Cipher.doFinal(Cipher.java:2164)</span><br><span class="line">	at cc.mrbird.security.temp.rsa.Demo.test(Demo.java:42)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)</span><br><span class="line">	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)</span><br><span class="line">	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)</span><br><span class="line">	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)</span><br><span class="line">	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)</span><br><span class="line">	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)</span><br><span class="line">	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)</span><br><span class="line">	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)</span><br><span class="line">	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)</span><br><span class="line">	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)</span><br><span class="line">	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)</span><br><span class="line">	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)</span><br><span class="line">	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)</span><br><span class="line">	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)</span><br><span class="line">	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)</span><br><span class="line">	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)</span><br><span class="line">	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230)</span><br><span class="line">	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)</span><br></pre></td></tr></table></figure><p></p><p>å¯¹äº1024é•¿åº¦çš„å¯†é’¥ã€‚128å­—èŠ‚ï¼ˆ1024bits/8ï¼‰å‡å»PKCS#1å»ºè®®çš„paddingå°±å ç”¨äº†11ä¸ªå­—èŠ‚æ­£å¥½æ˜¯117å­—èŠ‚ã€‚æ‰€ä»¥åŠ å¯†çš„æ˜æ–‡é•¿åº¦120å­—èŠ‚å¤§äº117å­—èŠ‚ï¼Œç¨‹åºæŠ›å‡ºäº†å¼‚å¸¸ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨åˆ†æ®µåŠ å¯†çš„æ‰‹æ®µã€‚ç¼–å†™ä¸€ä¸ªåˆ†æ®µåŠ è§£å¯†çš„å·¥å…·ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RSAåˆ†æ®µåŠ è§£å¯†</span></span><br><span class="line"><span class="comment"> * é’ˆå¯¹ç§˜é’¥é•¿åº¦ä¸º1024bits</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RsaUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€å¤§åŠ å¯†å—é•¿åº¦ 1024/8 - 11</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ENCRYPT_BLOCK = <span class="number">117</span>;</span><br><span class="line">    <span class="comment">// æœ€å¤§è§£å¯†å—é•¿åº¦ 1024/8</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_DECRYPT_BLOCK = <span class="number">128</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TRANSFORM = <span class="string">"RSA/ECB/PKCS1Padding"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¬é’¥åŠ å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey å…¬é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value     å¾…åŠ å¯†å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åŠ å¯†å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(PublicKey publicKey, String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (ByteArrayOutputStream out = <span class="keyword">new</span> ByteArrayOutputStream()) &#123;</span><br><span class="line">            Cipher cipher = Cipher.getInstance(TRANSFORM);</span><br><span class="line">            cipher.init(Cipher.ENCRYPT_MODE, publicKey);</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = value.getBytes();</span><br><span class="line">            <span class="keyword">int</span> length = bytes.length;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> offSet = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] cache;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// å¯¹æ•°æ®åˆ†æ®µåŠ å¯†</span></span><br><span class="line">            <span class="keyword">while</span> (length - offSet &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (length - offSet &gt; MAX_ENCRYPT_BLOCK) &#123;</span><br><span class="line">                    cache = cipher.doFinal(bytes, offSet, MAX_ENCRYPT_BLOCK);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    cache = cipher.doFinal(bytes, offSet, length - offSet);</span><br><span class="line">                &#125;</span><br><span class="line">                out.write(cache, <span class="number">0</span>, cache.length);</span><br><span class="line">                i++;</span><br><span class="line">                offSet = i * MAX_ENCRYPT_BLOCK;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">byte</span>[] encryptedData = out.toByteArray();</span><br><span class="line">            <span class="keyword">return</span> Base64.getEncoder().encodeToString(encryptedData);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§é’¥è§£å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey ç§é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encrypt    å¸¦è§£å¯†å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è§£å¯†å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decrypt</span><span class="params">(PrivateKey privateKey, String encrypt)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (ByteArrayOutputStream out = <span class="keyword">new</span> ByteArrayOutputStream()) &#123;</span><br><span class="line">            Cipher cipher = Cipher.getInstance(TRANSFORM);</span><br><span class="line">            cipher.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = Base64.getDecoder().decode(encrypt);</span><br><span class="line">            <span class="keyword">int</span> length = bytes.length;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> offSet = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] cache;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// å¯¹æ•°æ®åˆ†æ®µè§£å¯†</span></span><br><span class="line">            <span class="keyword">while</span> (length - offSet &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (length - offSet &gt; MAX_DECRYPT_BLOCK) &#123;</span><br><span class="line">                    cache = cipher.doFinal(bytes, offSet, MAX_DECRYPT_BLOCK);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    cache = cipher.doFinal(bytes, offSet, length - offSet);</span><br><span class="line">                &#125;</span><br><span class="line">                out.write(cache, <span class="number">0</span>, cache.length);</span><br><span class="line">                i++;</span><br><span class="line">                offSet = i * MAX_DECRYPT_BLOCK;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">byte</span>[] decryptedData = out.toByteArray();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(decryptedData);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPairGenerator;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StringBuilder value = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">29</span>; i++) &#123;</span><br><span class="line">            value.append(<span class="string">"18cm"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å†…å®¹é•¿åº¦: "</span> + value.toString().length());</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"RSA"</span>;</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥å¯¹ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ï¼Œç§˜é’¥é•¿åº¦512~16384ä½ï¼Œ64å€æ•°</span></span><br><span class="line">        keyPairGenerator.initialize(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥å¯¹</span></span><br><span class="line">        KeyPair keyPair = keyPairGenerator.generateKeyPair();</span><br><span class="line">        <span class="comment">// å…¬é’¥</span></span><br><span class="line">        PublicKey publicKey = keyPair.getPublic();</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥: "</span> + Base64.getEncoder().encodeToString(publicKey.getEncoded()));</span><br><span class="line">        <span class="comment">// ç§é’¥</span></span><br><span class="line">        PrivateKey privateKey = keyPair.getPrivate();</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥: "</span> + Base64.getEncoder().encodeToString(privateKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ------ æµ‹è¯•å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯† ------</span></span><br><span class="line">        String pubEncrypt= RsaUtil.encrypt(publicKey, value.toString());</span><br><span class="line">        System.out.println(<span class="string">"RSAå…¬é’¥åŠ å¯†åæ•°æ®: "</span> + pubEncrypt);</span><br><span class="line"></span><br><span class="line">        String priDecrypt = RsaUtil.decrypt(privateKey, pubEncrypt);</span><br><span class="line">        System.out.println(<span class="string">"RSAç§é’¥è§£å¯†åæ•°æ®: "</span> + priDecrypt);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å†…å®¹é•¿åº¦: 120</span><br><span class="line">RSAå…¬é’¥: MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCJcyiFAbUHBYXe5BTY/TF5Bn4/fW4L0dK2eaDSPJr4uqTFxIj+sRDqRq71yZw3KJk0qxmmGbtMRQGuR+GVAyJ/0E2R3q2RM+aWCZmkzyDnq6xHIvV0d3mU3N8EDtPS6iO+ANOEPNKfdzr+BJN8NKnpXC2ii7phvMk/QlYqjVAbIwIDAQAB</span><br><span class="line">RSAç§é’¥: MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBAIlzKIUBtQcFhd7kFNj9MXkGfj99bgvR0rZ5oNI8mvi6pMXEiP6xEOpGrvXJnDcomTSrGaYZu0xFAa5H4ZUDIn/QTZHerZEz5pYJmaTPIOerrEci9XR3eZTc3wQO09LqI74A04Q80p93Ov4Ek3w0qelcLaKLumG8yT9CViqNUBsjAgMBAAECgYEAhaU2UdVuGoyxNR9acf4GW6IHoV4pYU68bnbm+2S4Xn7EdhN6DQNH6jOeLRjCTxOnnAF95/Z/GlLCpp335nbs1B1wlb6MP5l3keO2KhYuvPhnZdPInNV0aKWzOoX7gcmy12g5IAQgoYoc/IohPIpMmkgrbuGQGk2+jxnGPETgNdECQQDhDyP3VIH5AucbHHeL6fSU9kswO1eejLzRmvlKIwk15wE1xteFvIqpLOLlR8wJm+Eb5uB0HEr4X7rlWDQLq/OZAkEAnFilYybZfp4rRctsnYjFZf0QGUCCBV9hFa7xoGztV2rAkLLmsnayXzSJpOYYAOI7ekrqfLL3xALQKn8DZtr6GwJAecd9iKl7oshFUVA4B8dShwA2cyTJJou06B5ZYhpPM5GKABVWLZF13lDhfXs6FsD4L+bf8TQWBQuXz93IW8BxkQJAZqfR2BuPHRMPiKE77Of77K5PnrT7ajmpDkqy/knnQMmoLJo63Z0QG3Dsm6g0xIfG09JSypPcGQhb1DtXaXaIVwJAVVSPa1caRWLKYlEKAi1gBbrC5Zt7aTQ/ska2E3ksAhaVhScPBOEIoQf9EdbGajmpuueWeH9IlVrqQv0vFNY4gA==</span><br><span class="line">RSAå…¬é’¥åŠ å¯†åæ•°æ®: cy7Var2L72bgne9F8iGro+SCQxs2ejIMPwQDJ5hQFTLvyqtT4ZJYM5i2ClgOD9viAP2Tp/X5cCX0+K1xz88hf5w/xNPWonzdaJNa2J5gQv7KGxNe/pW4mtpf878u4sIvO9sT8AktWtJC3jFtvxL9u9vJdzWl99RSRf/3sNqWj3gLRM/YpCcGM0HPuDsyUdOA4q+Tn+d2nOf36XrBtjIl2QyOTwnMoMCbC9Hlt6jN8fMsSFW8oiFNqV/+HPlhs5ZtFixhUE6SryketJfzXGmUSXH5cM/+11pB2bBxrCvtqRUE5/MZKjL2kKmrZan3kDHi4aiwLSDdpYdZn0urrJObAA==</span><br><span class="line">RSAç§é’¥è§£å¯†åæ•°æ®: 18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm18cm</span><br></pre></td></tr></table></figure><p></p><h2 id="å»ºè®®"><a href="#å»ºè®®" class="headerlink" title="å»ºè®®"></a>å»ºè®®</h2><ol><li><p>å…¬é’¥æ˜¯é€šè¿‡Aå‘é€ç»™Bçš„ï¼Œå…¶åœ¨ä¼ é€’è¿‡ç¨‹ä¸­å¾ˆæœ‰å¯èƒ½è¢«æˆªè·ï¼Œä¹Ÿå°±æ˜¯è¯´çªƒå¬è€…å¾ˆæœ‰å¯èƒ½è·å¾—å…¬é’¥ã€‚å¦‚æœçªƒå¬è€…è·å¾—äº†å…¬é’¥ï¼Œå‘Aå‘é€æ•°æ®ï¼ŒAæ˜¯æ— æ³•è¾¨åˆ«æ¶ˆæ¯çš„çœŸä¼ªçš„ã€‚å› æ­¤ï¼Œè™½ç„¶å¯ä»¥ä½¿ç”¨å…¬é’¥å¯¹æ•°æ®åŠ å¯†ï¼Œä½†è¿™ç§æ–¹å¼è¿˜æ˜¯ä¼šæœ‰å­˜åœ¨ä¸€å®šçš„å®‰å…¨éšæ‚£ã€‚å¦‚æœè¦å»ºç«‹æ›´å®‰å…¨çš„åŠ å¯†æ¶ˆæ¯ä¼ é€’æ¨¡å‹ï¼Œå°±éœ€è¦ABåŒæ–¹æ„å»ºä¸¤å¥—éå¯¹ç§°åŠ å¯†ç®—æ³•å¯†é’¥ï¼Œä»…éµå¾ªâ€œç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†â€çš„æ–¹å¼è¿›è¡ŒåŠ å¯†æ¶ˆæ¯ä¼ é€’ï¼›</p></li><li><p>RSAä¸é€‚åˆåŠ å¯†è¿‡é•¿çš„æ•°æ®ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡åˆ†æ®µåŠ å¯†æ‰‹æ®µè§£å†³ï¼Œä½†è¿‡é•¿çš„æ•°æ®åŠ è§£å¯†è€—æ—¶è¾ƒé•¿ï¼Œåœ¨å“åº”é€Ÿåº¦è¦æ±‚è¾ƒé«˜çš„æƒ…å†µä¸‹æ…ç”¨ã€‚ä¸€èˆ¬æ¨èä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¼ è¾“å¯¹ç§°åŠ å¯†ç§˜é’¥ï¼ŒåŒæ–¹æ•°æ®åŠ å¯†ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•åŠ è§£å¯†ã€‚</p></li></ol><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;éå¯¹ç§°åŠ å¯†å’Œå¯¹ç§°åŠ å¯†ç®—æ³•ç›¸æ¯”ï¼Œå¤šäº†ä¸€æŠŠç§˜é’¥ï¼Œä¸ºåŒç§˜é’¥æ¨¡å¼ï¼Œä¸€ä¸ªå…¬å¼€ç§°ä¸ºå…¬é’¥ï¼Œä¸€ä¸ªä¿å¯†ç§°ä¸ºç§é’¥ã€‚éµå¾ªå…¬é’¥åŠ å¯†ç§é’¥è§£å¯†ï¼Œæˆ–è€…ç§é’¥åŠ å¯†å…¬é’¥è§£å¯†ã€‚éå¯¹ç§°åŠ å¯†ç®—æ³•æºäºDHç®—æ³•ï¼Œååˆæœ‰åŸºäºæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•çš„å¯†é’¥äº¤æ¢ç®—æ³•ECDHï¼Œä¸è¿‡ç›®å‰æœ€ä¸ºæµè¡Œçš„éå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯RSAï¼Œæœ¬æ–‡ç®€å•è®°å½•ä¸‹RSAçš„ä½¿ç”¨ã€‚
    
    </summary>
    
    
      <category term="Security" scheme="http://mrbird.cc/tags/Security/"/>
    
      <category term="Java" scheme="http://mrbird.cc/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Java å¯¹ç§°åŠ å¯†ç®—æ³•</title>
    <link href="http://mrbird.cc/Java-%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95.html"/>
    <id>http://mrbird.cc/Java-å¯¹ç§°åŠ å¯†ç®—æ³•.html</id>
    <published>2020-05-06T06:18:02.000Z</published>
    <updated>2020-08-21T07:49:23.903Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p>å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ç§˜é’¥ï¼Œè§£å¯†æ˜¯åŠ å¯†çš„é€†è¿ç®—ã€‚å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†é€Ÿåº¦å¿«ï¼Œå¯†æ–‡å¯é€†ï¼Œä¸€æ—¦ç§˜é’¥æ–‡ä»¶æ³„éœ²ï¼Œå°±ä¼šå¯¼è‡´åŸå§‹æ•°æ®æš´éœ²ã€‚å¯¹ç§°åŠ å¯†çš„ç»“æœä¸€èˆ¬ä½¿ç”¨Base64ç®—æ³•ç¼–ç ï¼Œä¾¿äºé˜…è¯»å’Œä¼ è¾“ã€‚JDK8æ”¯æŒçš„å¯¹ç§°åŠ å¯†ç®—æ³•ä¸»è¦æœ‰DESã€DESedeã€AESã€Blowfishï¼Œä»¥åŠRC2å’ŒRC4ç­‰ã€‚ä¸åŒçš„ç®—æ³•ç§˜é’¥é•¿åº¦ä¸åŒï¼Œç§˜é’¥é•¿åº¦è¶Šé•¿ï¼ŒåŠ å¯†å®‰å…¨æ€§è¶Šé«˜ã€‚<a id="more"></a></p><h2 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h2><p>DESï¼ˆData Encryption Standardï¼Œæ•°æ®åŠ å¯†æ ‡å‡†ï¼‰ç®—æ³•æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•é¢†åŸŸä¸­çš„å…¸å‹ç®—æ³•ï¼ŒDESç®—æ³•ç§˜é’¥è¾ƒçŸ­ï¼Œä»¥ç°åœ¨è®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›ï¼ŒDESç®—æ³•åŠ å¯†çš„æ•°æ®åœ¨24å°æ—¶å†…å¯èƒ½è¢«ç ´è§£ã€‚æ‰€ä»¥DESç®—æ³•å·²ç»è¢«æ·˜æ±°ï¼Œå»ºè®®ä½¿ç”¨AESç®—æ³•ï¼Œä¸è¿‡è¿™é‡Œè¿˜æ˜¯ç®€å•äº†è§£ä¸‹ã€‚</p><p>JDK8ä»…æ”¯æŒ56ä½é•¿åº¦çš„DESç§˜é’¥ï¼Œä¸‹é¢ä¸¾ä¸ªJDK8å®ç°DESåŠ å¯†çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DESKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å€¼ï¼š"</span> + value);</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"DES"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transformation = <span class="string">"DES"</span>;</span><br><span class="line">        <span class="comment">// --- ç”Ÿæˆç§˜é’¥ ---</span></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyGenerator keyGenerator = KeyGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç§˜é’¥é•¿åº¦</span></span><br><span class="line">        keyGenerator.init(<span class="number">56</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–DESç§˜é’¥ææ–™</span></span><br><span class="line">        DESKeySpec desKeySpec = <span class="keyword">new</span> DESKeySpec(secretKey.getEncoded());</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥å·¥å‚</span></span><br><span class="line">        SecretKeyFactory secretKeyFactory = SecretKeyFactory.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// ç”ŸæˆDESç§˜é’¥</span></span><br><span class="line">        SecretKey desSecretKey = secretKeyFactory.generateSecret(desKeySpec);</span><br><span class="line">        System.out.println(<span class="string">"DESç§˜é’¥ï¼š"</span> + Base64.getEncoder().encodeToString(desSecretKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å¯†ç å¯¹è±¡</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¨¡å¼ï¼ˆENCRYPT_MODEï¼šåŠ å¯†æ¨¡å¼ï¼›DECRYPT_MODEï¼šè§£å¯†æ¨¡å¼ï¼‰å’ŒæŒ‡å®šç§˜é’¥</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, desSecretKey);</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypt = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"DESåŠ å¯†ç»“æœï¼š"</span> + Base64.getEncoder().encodeToString(encrypt));</span><br><span class="line">        <span class="comment">// è§£å¯†</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºè§£å¯†æ¨¡å¼</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, desSecretKey);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(encrypt);</span><br><span class="line">        System.out.println(<span class="string">"DESè§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><div class="note danger">è½¬æ¢æ¨¡å¼transformationè¿™é‡Œå…ˆè®¾ç½®ä¸ºå’ŒåŠ å¯†ç®—æ³•ä¸€æ ·ï¼Œä¸‹é¢ä»‹ç»äº†åŠ å¯†æ¨¡å¼å’Œå¡«å……æ¨¡å¼åå†ä½œè¯´æ˜ã€‚</div><p>ä¸Šé¢æ­¥éª¤çœ‹ç€æŒºå¤šï¼Œå…¶å®å¯ä»¥æ€»ç»“ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š</p><ol><li><p>ç”ŸæˆåŠ å¯†ç§˜é’¥ï¼›</p><p>1.1. é€šè¿‡KeyGeneratorç”Ÿæˆä¸€ä¸ªæŒ‡å®šä½æ•°çš„ç§˜é’¥ï¼›</p><p>1.2. é€šè¿‡ä¸Šé¢ç”Ÿæˆçš„ç§˜é’¥å®ä¾‹åŒ–ç®—æ³•å¯¹åº”çš„ç§˜é’¥ææ–™KeySpecï¼›</p><p>1.3. ä½¿ç”¨ç§˜é’¥ææ–™é€šè¿‡ç§˜é’¥å·¥å‚SecretKeyFactoryç”Ÿæˆç®—æ³•ç§˜é’¥SecretKeyã€‚</p></li><li><p>é€šè¿‡è½¬æ¢æ¨¡å¼å®ä¾‹åŒ–Cipherï¼›</p></li><li><p>æŒ‡å®šCipheræ¨¡å¼å’Œç§˜é’¥ï¼Œè¿›è¡ŒåŠ è§£å¯†æ“ä½œã€‚</p></li></ol><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å€¼ï¼šmrbird&apos;s blog</span><br><span class="line">DESç§˜é’¥ï¼šLO/CCEC8y8E=</span><br><span class="line">DESåŠ å¯†ç»“æœï¼šhRZdN6f+6yj/lhPWUPsayA==</span><br><span class="line">DESè§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœåœ¨ç”Ÿæˆç§˜é’¥çš„æ—¶å€™ï¼Œä¸æŒ‡å®šä¸º56ä½ï¼Œåˆ™ä¼šæŠ›å‡º<span style="color:red">java.security.InvalidParameterException: Wrong keysize: must be equal to 56</span>å¼‚å¸¸ã€‚</p><h2 id="DESede"><a href="#DESede" class="headerlink" title="DESede"></a>DESede</h2><p>ä½œä¸ºDESç®—æ³•çš„ä¸€ç§æ”¹è‰¯ï¼ŒDESedeç®—æ³•ï¼ˆä¹Ÿæˆä¸º3DESï¼Œä¸‰é‡DESï¼‰é’ˆå¯¹å…¶ç§˜é’¥é•¿åº¦åçŸ­å’Œè¿­ä»£æ¬¡æ•°åå°‘ç­‰é—®é¢˜åšäº†ç›¸åº”æ”¹è¿›ï¼Œæé«˜äº†å®‰å…¨å¼ºåº¦ï¼Œä½†åŒæ—¶ä¹Ÿé€ æˆå¤„ç†é€Ÿåº¦è¾ƒæ…¢ã€ç§˜é’¥è®¡ç®—æ—¶é—´åŠ é•¿ã€åŠ å¯†æ•ˆç‡ä¸é«˜çš„é—®é¢˜ã€‚æ‰€ä»¥è¿™é‡Œè¿˜æ˜¯ç®€å•äº†è§£ä¸‹ï¼Œå®é™…è¿˜æ˜¯æ¨èç”¨AESã€‚</p><p>JDK8æ”¯æŒ112ä½æˆ–168ä½é•¿åº¦çš„DESedeç§˜é’¥ï¼Œä¸‹é¢ä¸¾ä¸ªJDK8å®ç°DESedeåŠ å¯†çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DESedeKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å€¼ï¼š"</span> + value);</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"DESede"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transformation = <span class="string">"DESede"</span>;</span><br><span class="line">        <span class="comment">// --- ç”Ÿæˆç§˜é’¥ ---</span></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyGenerator keyGenerator = KeyGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç§˜é’¥é•¿åº¦</span></span><br><span class="line">        keyGenerator.init(<span class="number">112</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–DESedeç§˜é’¥ææ–™</span></span><br><span class="line">        DESedeKeySpec desKeySpec = <span class="keyword">new</span> DESedeKeySpec(secretKey.getEncoded());</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥å·¥å‚</span></span><br><span class="line">        SecretKeyFactory secretKeyFactory = SecretKeyFactory.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// ç”ŸæˆDESç§˜é’¥</span></span><br><span class="line">        SecretKey desSecretKey = secretKeyFactory.generateSecret(desKeySpec);</span><br><span class="line">        System.out.println(<span class="string">"DESedeç§˜é’¥ï¼š"</span> + Base64.getEncoder().encodeToString(desSecretKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å¯†ç å¯¹è±¡</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¨¡å¼ï¼ˆENCRYPT_MODEï¼šåŠ å¯†æ¨¡å¼ï¼›DECRYPT_MODEï¼šè§£å¯†æ¨¡å¼ï¼‰å’ŒæŒ‡å®šç§˜é’¥</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, desSecretKey);</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypt = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"DESedeåŠ å¯†ç»“æœï¼š"</span> + Base64.getEncoder().encodeToString(encrypt));</span><br><span class="line">        <span class="comment">// è§£å¯†</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºè§£å¯†æ¨¡å¼</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, desSecretKey);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(encrypt);</span><br><span class="line">        System.out.println(<span class="string">"DESedeè§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿‡ç¨‹å’ŒDESä¸€è‡´ï¼ŒåŒºåˆ«ä»…åœ¨äºä½¿ç”¨çš„åŠ å¯†ç®—æ³•ä¸ºDESedeï¼Œç§˜é’¥é•¿åº¦æŒ‡å®šä¸º112ï¼Œç§˜é’¥ææ–™å¯¹è±¡ä¸ºDESedeKeySpecç±»ã€‚</p><p>ä¸Šé¢ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å€¼ï¼šmrbird&apos;s blog</span><br><span class="line">DESedeç§˜é’¥ï¼š1fFb+F1wboVGGTSPNIBJ+9XxW/hdcG6F</span><br><span class="line">DESedeåŠ å¯†ç»“æœï¼šWVg9w6exyRREqY1vNyRI+Q==</span><br><span class="line">DESedeè§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœæŒ‡å®šä¸åˆæ³•çš„ç§˜é’¥é•¿åº¦ï¼Œç¨‹åºå°†æŠ›å‡º<span style="color:red">java.security.InvalidParameterException: Wrong keysize: must be equal to 112 or 168</span>å¼‚å¸¸ã€‚</p><h2 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h2><p>AESï¼ˆAdvancedEncryption Standardï¼Œé«˜çº§æ•°æ®åŠ å¯†æ ‡å‡†ï¼‰ç®—æ³•æ”¯æŒ128ä½ã€192ä½å’Œ256ä½çš„ç§˜é’¥é•¿åº¦ï¼ŒåŠ å¯†é€Ÿåº¦æ¯”DESå’ŒDESedeéƒ½å¿«ï¼Œè‡³ä»Šè¿˜æ²¡æœ‰è¢«ç ´è§£çš„æŠ¥é“ã€‚ç»è¿‡éªŒè¯ï¼Œç›®å‰é‡‡ç”¨çš„AESç®—æ³•èƒ½å¤Ÿæœ‰æ•ˆæŠµå¾¡å·²çŸ¥çš„é’ˆå¯¹DESç®—æ³•çš„æ‰€æœ‰æ”»å‡»æ–¹æ³•ï¼Œå¦‚éƒ¨åˆ†å·®åˆ†æ”»å‡»ã€ç›¸å…³ç§˜é’¥æ”»å‡»ç­‰ã€‚AESç®—æ³•å› ç§˜é’¥å»ºç«‹æ—¶é—´çŸ­ã€çµæ•æ€§å¥½ã€å†…å­˜éœ€æ±‚ä½ç­‰ä¼˜ç‚¹ï¼Œåœ¨å„ä¸ªé¢†åŸŸå¾—åˆ°å¹¿æ³›çš„ç ”ç©¶ä¸åº”ç”¨ã€‚</p><p>JDK8æ”¯æŒ128ä½ã€192ä½å’Œ256ä½é•¿åº¦çš„AESç§˜é’¥ï¼Œä¸‹é¢ä¸¾ä¸ªJDK8å®ç°AESåŠ å¯†çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å€¼ï¼š"</span> + value);</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"AES"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transformation = <span class="string">"AES"</span>;</span><br><span class="line">        <span class="comment">// --- ç”Ÿæˆç§˜é’¥ ---</span></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyGenerator keyGenerator = KeyGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç§˜é’¥é•¿åº¦</span></span><br><span class="line">        keyGenerator.init(<span class="number">256</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥ææ–™</span></span><br><span class="line">        SecretKeySpec secretKeySpec = <span class="keyword">new</span> SecretKeySpec(secretKey.getEncoded(), algorithm);</span><br><span class="line">        System.out.println(<span class="string">"AESç§˜é’¥ï¼š"</span> + Base64.getEncoder().encodeToString(secretKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å¯†ç å¯¹è±¡</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¨¡å¼ï¼ˆENCRYPT_MODEï¼šåŠ å¯†æ¨¡å¼ï¼›DECRYPT_MODEï¼šè§£å¯†æ¨¡å¼ï¼‰å’ŒæŒ‡å®šç§˜é’¥</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, secretKeySpec);</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypt = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"AESåŠ å¯†ç»“æœï¼š"</span> + Base64.getEncoder().encodeToString(encrypt));</span><br><span class="line">        <span class="comment">// è§£å¯†</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºè§£å¯†æ¨¡å¼</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, secretKeySpec);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(encrypt);</span><br><span class="line">        System.out.println(<span class="string">"AESè§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿‡ç¨‹å’Œä¸Šé¢ä¾‹å­å¤§ä½“ä¸€è‡´ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯ä½¿ç”¨AESç®—æ³•æ— éœ€æŒ‡å®šç‰¹å®šç±»å‹çš„ç§˜é’¥ææ–™ï¼Œç›´æ¥ç”¨SecretKeySpecå¯¹è±¡å³å¯ã€‚</p><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å€¼ï¼šmrbird&apos;s blog</span><br><span class="line">AESç§˜é’¥ï¼švMj1fnhYdIGpTfxpEeKaynG879ARZ5r2AcfBpf+yoRs=</span><br><span class="line">AESåŠ å¯†ç»“æœï¼šGCmIlqEJIBlBRw/474OanQ==</span><br><span class="line">AESè§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœæŒ‡å®šä¸åˆæ³•çš„ç§˜é’¥é•¿åº¦ï¼Œç¨‹åºå°†æŠ›å‡º<span style="color:red">java.security.InvalidParameterException: Wrong keysize: must be equal to 128, 192 or 256</span>å¼‚å¸¸ã€‚</p><h2 id="RC2ã€RC4"><a href="#RC2ã€RC4" class="headerlink" title="RC2ã€RC4"></a>RC2ã€RC4</h2><p>RC2å’ŒRC4ç®—æ³•ä¹Ÿå¯ä»¥ç”¨äºæ›¿æ¢DESç®—æ³•ï¼Œç‰¹ç‚¹æ˜¯ç§˜é’¥é•¿åº¦è¾ƒä¸ºçµæ´»ï¼ŒRC2å’ŒRC4çš„ç§˜é’¥é•¿åº¦èŒƒå›´ä¸º40åˆ°1024ä½ã€‚</p><p>JDK8æ”¯æŒRC2å’ŒRC4ç®—æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å€¼ï¼š"</span> + value);</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"RC2"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transformation = <span class="string">"RC2"</span>;</span><br><span class="line">        <span class="comment">// --- ç”Ÿæˆç§˜é’¥ ---</span></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyGenerator keyGenerator = KeyGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç§˜é’¥é•¿åº¦</span></span><br><span class="line">        keyGenerator.init(<span class="number">666</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥ææ–™</span></span><br><span class="line">        SecretKeySpec secretKeySpec = <span class="keyword">new</span> SecretKeySpec(secretKey.getEncoded(), algorithm);</span><br><span class="line">        System.out.println(<span class="string">"RC2ç§˜é’¥ï¼š"</span> + Base64.getEncoder().encodeToString(secretKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å¯†ç å¯¹è±¡</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¨¡å¼ï¼ˆENCRYPT_MODEï¼šåŠ å¯†æ¨¡å¼ï¼›DECRYPT_MODEï¼šè§£å¯†æ¨¡å¼ï¼‰å’ŒæŒ‡å®šç§˜é’¥</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, secretKeySpec);</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypt = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"RC2åŠ å¯†ç»“æœï¼š"</span> + Base64.getEncoder().encodeToString(encrypt));</span><br><span class="line">        <span class="comment">// è§£å¯†</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºè§£å¯†æ¨¡å¼</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, secretKeySpec);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(encrypt);</span><br><span class="line">        System.out.println(<span class="string">"RC2è§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å€¼ï¼šmrbird&apos;s blog</span><br><span class="line">RC2ç§˜é’¥ï¼š//wHmkfa/TpQqeard5RD8h6Gdd1YJQZbFT4pUsssRfitpz1YkhJfCN/J/hjR0Q1HmVReJaSPCNDqP+GUBlvnWi7zsoKW35O6R5W/R0Bgnjh/qVsu</span><br><span class="line">RC2åŠ å¯†ç»“æœï¼š+XL70sqXz/myi1JRiLVbCw==</span><br><span class="line">RC2è§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœæŒ‡å®šä¸åˆæ³•çš„ç§˜é’¥é•¿åº¦ï¼Œç¨‹åºå°†æŠ›å‡º<span style="color:red">java.security.InvalidParameterException: Key length for RC2 must be between 40 and 1024 bits</span>å¼‚å¸¸ã€‚</p><p>RC4è¯»è€…å¯ä»¥è‡ªå·±ç©ä¸€ç©ã€‚</p><h2 id="Blowfish"><a href="#Blowfish" class="headerlink" title="Blowfish"></a>Blowfish</h2><p>Blowfishç®—æ³•ä¹Ÿå¯ä»¥ç”¨äºæ›¿æ¢DESï¼ŒBlowfishç®—æ³•çš„ç§˜é’¥é•¿åº¦èŒƒå›´ä¸º32åˆ°448ä½ï¼Œå¹¶ä¸”å¿…é¡»ä¸º8çš„å€æ•°ã€‚</p><p>JDK8æ”¯æŒBlowfishç®—æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å€¼ï¼š"</span> + value);</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"Blowfish"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transformation = <span class="string">"Blowfish"</span>;</span><br><span class="line">        <span class="comment">// --- ç”Ÿæˆç§˜é’¥ ---</span></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyGenerator keyGenerator = KeyGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç§˜é’¥é•¿åº¦</span></span><br><span class="line">        keyGenerator.init(<span class="number">128</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥ææ–™</span></span><br><span class="line">        SecretKeySpec secretKeySpec = <span class="keyword">new</span> SecretKeySpec(secretKey.getEncoded(), algorithm);</span><br><span class="line">        System.out.println(<span class="string">"Blowfishç§˜é’¥ï¼š"</span> + Base64.getEncoder().encodeToString(secretKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å¯†ç å¯¹è±¡</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¨¡å¼ï¼ˆENCRYPT_MODEï¼šåŠ å¯†æ¨¡å¼ï¼›DECRYPT_MODEï¼šè§£å¯†æ¨¡å¼ï¼‰å’ŒæŒ‡å®šç§˜é’¥</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, secretKeySpec);</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypt = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"BlowfishåŠ å¯†ç»“æœï¼š"</span> + Base64.getEncoder().encodeToString(encrypt));</span><br><span class="line">        <span class="comment">// è§£å¯†</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºè§£å¯†æ¨¡å¼</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, secretKeySpec);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(encrypt);</span><br><span class="line">        System.out.println(<span class="string">"Blowfishè§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å€¼ï¼šmrbird&apos;s blog</span><br><span class="line">Blowfishç§˜é’¥ï¼šd3ReFylxI2OI7n3qgPFViQ==</span><br><span class="line">BlowfishåŠ å¯†ç»“æœï¼šnnH2mqVZhhhegBwAuqecLw==</span><br><span class="line">Blowfishè§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœæŒ‡å®šä¸åˆæ³•çš„ç§˜é’¥é•¿åº¦ï¼Œç¨‹åºå°†æŠ›å‡º<span style="color:red">java.security.InvalidParameterException: Keysize must be multiple of 8, and can only range from 32 to 448 (inclusive)</span>å¼‚å¸¸ã€‚</p><h2 id="PBE"><a href="#PBE" class="headerlink" title="PBE"></a>PBE</h2><p>PBEï¼ˆPassword Based Encryptionï¼ŒåŸºäºå£ä»¤åŠ å¯†ï¼‰ç®—æ³•æ˜¯ä¸€ç§åŸºäºå£ä»¤çš„åŠ å¯†ç®—æ³•ï¼Œç‰¹ç‚¹æ˜¯æ²¡æœ‰ç§˜é’¥çš„æ¦‚å¿µï¼Œä¿¡æ¯äº¤äº’åŒæ–¹äº‹å…ˆæ‹Ÿå®šå¥½å£ä»¤å³å¯ã€‚å•çº¯çš„å£ä»¤å¾ˆå®¹æ˜“é€šè¿‡ç©·ä¸¾æ”»å‡»æ–¹å¼ç ´è¯‘ï¼Œæ‰€ä»¥PBEä¹ŸåŠ å…¥äº†â€œç›â€çš„æ¦‚å¿µã€‚</p><p>PBEç®—æ³•æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•çš„ç»¼åˆæ€§ç®—æ³•ï¼Œå¸¸è§ç®—æ³•å¦‚PBEWithMD5AndDESï¼Œè¯¥ç®—æ³•ä½¿ç”¨äº†MD5å’ŒDESç®—æ³•æ„å»ºPBEç®—æ³•ã€‚JDK8æ”¯æŒPBEWithMD5AndDESã€PBEWithMD5AndTripleDESã€PBEWithSHA1AndDESedeã€PBEWithSHA1AndRC2_40ã€PBEWithSHA1AndRC2_128ã€PBEWithSHA1AndRC4_40ã€PBEWithSHA1AndRC4_128ã€PBEWithHmacSHA1AndAES_128ã€PBEWithHmacSHA224AndAES_128ã€PBEWithHmacSHA256AndAES_128ã€PBEWithHmacSHA384AndAES_128ã€PBEWithHmacSHA512AndAES_128ã€PBEWithHmacSHA1AndAES_256ã€PBEWithHmacSHA224AndAES_256ã€PBEWithHmacSHA256AndAES_256ã€PBEWithHmacSHA384AndAES_256å’ŒPBEWithHmacSHA512AndAES_256ï¼Œå…¶ä¸­ç®—æ³•åç§°ä¸­åŒ…å«Hmacçš„éœ€è¦é…å’Œåˆå§‹åŒ–å‘é‡ä½¿ç”¨ã€‚</p><p>ä¸éœ€è¦æŒ‡å®šåˆå§‹åŒ–å‘é‡çš„PBEç®—æ³•æ—ï¼ˆPBEWithMD5AndDESã€PBEWithMD5AndTripleDESã€PBEWithSHA1AndDESedeã€PBEWithSHA1AndRC2_40ã€PBEWithSHA1AndRC2_128ã€PBEWithSHA1AndRC4_40ã€PBEWithSHA1AndRC4_128ï¼‰ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEParameterSpec;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å€¼ï¼š"</span> + value);</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"PBEWithSHA1AndDESede"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transformation = <span class="string">"PBEWithSHA1AndDESede"</span>;</span><br><span class="line">        <span class="comment">// å¯†ç ï¼ˆå£ä»¤ï¼‰</span></span><br><span class="line">        String password = <span class="string">"mrbird@qq.com"</span>;</span><br><span class="line">        System.out.println(<span class="string">"PBEå£ä»¤ï¼š"</span> + password);</span><br><span class="line">        <span class="comment">// è¿­ä»£æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å®‰å…¨éšæœºæ•°</span></span><br><span class="line">        SecureRandom secureRandom = <span class="keyword">new</span> SecureRandom();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç›</span></span><br><span class="line">        <span class="keyword">byte</span>[] salt = secureRandom.generateSeed(<span class="number">8</span>);</span><br><span class="line">        System.out.println(<span class="string">"ç›å€¼ï¼š"</span> + Base64.getEncoder().encodeToString(salt));</span><br><span class="line">        <span class="comment">// é€šè¿‡å¯†ç ç”Ÿæˆç§˜é’¥ææ–™</span></span><br><span class="line">        PBEKeySpec pbeKeySpec = <span class="keyword">new</span> PBEKeySpec(password.toCharArray());</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥å·¥å‚</span></span><br><span class="line">        SecretKeyFactory secretKeyFactory = SecretKeyFactory.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = secretKeyFactory.generateSecret(pbeKeySpec);</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–PBEå‚æ•°ææ–™</span></span><br><span class="line">        PBEParameterSpec pbeParameterSpec = <span class="keyword">new</span> PBEParameterSpec(salt, count);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å¯†ç å¯¹è±¡</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, secretKey, pbeParameterSpec);</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypt = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"PBEåŠ å¯†ç»“æœï¼š"</span> + Base64.getEncoder().encodeToString(encrypt));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£å¯†</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºè§£å¯†æ¨¡å¼</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, secretKey, pbeParameterSpec);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(encrypt);</span><br><span class="line">        System.out.println(<span class="string">"PBEè§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å€¼ï¼šmrbird&apos;s blog</span><br><span class="line">PBEå£ä»¤ï¼šmrbird@qq.com</span><br><span class="line">ç›å€¼ï¼še2vd/Or8i3U=</span><br><span class="line">PBEåŠ å¯†ç»“æœï¼šTZx40AyeTP9PZyF6iP3C8A==</span><br><span class="line">PBEè§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><p>ç®—æ³•åç§°åŒ…å«Hmacçš„PBEç®—æ³•éœ€è¦æŒ‡å®šåˆå§‹åŒ–å‘é‡ï¼Œæ¯”å¦‚PBEWithHmacSHA1AndAES_128ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEParameterSpec;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å€¼ï¼š"</span> + value);</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"PBEWithHmacSHA1AndAES_128"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transformation = <span class="string">"PBEWithHmacSHA1AndAES_128"</span>;</span><br><span class="line">        <span class="comment">// å¯†ç ï¼ˆå£ä»¤ï¼‰</span></span><br><span class="line">        String password = <span class="string">"mrbird@qq.com"</span>;</span><br><span class="line">        System.out.println(<span class="string">"PBEå£ä»¤ï¼š"</span> + password);</span><br><span class="line">        <span class="comment">// è¿­ä»£æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å®‰å…¨éšæœºæ•°</span></span><br><span class="line">        SecureRandom secureRandom = <span class="keyword">new</span> SecureRandom();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç›</span></span><br><span class="line">        <span class="keyword">byte</span>[] salt = secureRandom.generateSeed(<span class="number">8</span>);</span><br><span class="line">        System.out.println(<span class="string">"ç›å€¼ï¼š"</span> + Base64.getEncoder().encodeToString(salt));</span><br><span class="line">        <span class="comment">// é€šè¿‡å¯†ç ç”Ÿæˆç§˜é’¥ææ–™</span></span><br><span class="line">        PBEKeySpec pbeKeySpec = <span class="keyword">new</span> PBEKeySpec(password.toCharArray());</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥å·¥å‚</span></span><br><span class="line">        SecretKeyFactory secretKeyFactory = SecretKeyFactory.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = secretKeyFactory.generateSecret(pbeKeySpec);</span><br><span class="line">        <span class="comment">// åˆ›å»ºåˆå§‹åŒ–å‘é‡</span></span><br><span class="line">        IvParameterSpec iv = <span class="keyword">new</span> IvParameterSpec(<span class="string">"123456789abcdefg"</span>.getBytes());</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–PBEå‚æ•°ææ–™</span></span><br><span class="line">        PBEParameterSpec pbeParameterSpec = <span class="keyword">new</span> PBEParameterSpec(salt, count, iv);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å¯†ç å¯¹è±¡</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, secretKey, pbeParameterSpec);</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypt = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"PBEåŠ å¯†ç»“æœï¼š"</span> + Base64.getEncoder().encodeToString(encrypt));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£å¯†</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºè§£å¯†æ¨¡å¼</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, secretKey, pbeParameterSpec);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(encrypt);</span><br><span class="line">        System.out.println(<span class="string">"PBEè§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é€šè¿‡IvParameterSpecç±»åˆ›å»ºåˆå§‹åŒ–å‘é‡ï¼Œåˆ›å»ºåˆå§‹åŒ–å‘é‡çš„ç§˜é’¥å¿…é¡»ä¸º16å­—èŠ‚ï¼Œè¿™é‡Œä¸º123456789abcdefgï¼Œå®ä¾‹åŒ–PBEå‚æ•°ææ–™çš„æ—¶å€™é€šè¿‡æ„é€ å‚æ•°ä¼ å…¥åˆå§‹åŒ–å‘é‡ã€‚</p><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å€¼ï¼šmrbird&apos;s blog</span><br><span class="line">PBEå£ä»¤ï¼šmrbird@qq.com</span><br><span class="line">ç›å€¼ï¼šUJwEggkfM88=</span><br><span class="line">PBEåŠ å¯†ç»“æœï¼šl+HGXLUHEQN+uKmNuIzqzA==</span><br><span class="line">PBEè§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><h2 id="åŠ å¯†æ¨¡å¼"><a href="#åŠ å¯†æ¨¡å¼" class="headerlink" title="åŠ å¯†æ¨¡å¼"></a>åŠ å¯†æ¨¡å¼</h2><p>å¯¹ç§°åŠ å¯†ç®—æ³•åˆ†ä¸ºï¼šåºåˆ—å¯†ç (æµå¯†ç )åŠ å¯†ï¼Œåˆ†ç»„å¯†ç (å—å¯†ç )åŠ å¯†ä¸¤ç§ã€‚æµå¯†ç æ˜¯å¯¹ä¿¡æ¯æµä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼ˆä¸€ä¸ªå­—æ¯æˆ–ä¸€ä¸ªæ¯”ç‰¹ï¼‰ä½œä¸ºåŸºæœ¬çš„å¤„ç†å•å…ƒè¿›è¡ŒåŠ å¯†ï¼Œå—å¯†ç æ˜¯å…ˆå¯¹ä¿¡æ¯æµåˆ†å—ï¼Œå†å¯¹æ¯ä¸€å—åˆ†åˆ«åŠ å¯†ã€‚</p><p>ä¸Šé¢ä»‹ç»çš„è¿™äº›éƒ½å±äºå—å¯†ç åŠ å¯†ã€‚ä¸åŒçš„ç®—æ³•ä¾§é‡ç‚¹ä¸åŒï¼Œæœ‰çš„å¼ºè°ƒæ•ˆç‡ï¼Œæœ‰çš„å¼ºè°ƒå®‰å…¨ï¼Œæœ‰çš„å¼ºè°ƒå®¹é”™æ€§ã€‚æ ¹æ®æ•°æ®åŠ å¯†æ—¶æ¯ä¸ªåŠ å¯†åŒºå—é—´çš„å…³è”æ–¹å¼æ¥åŒºåˆ†ï¼Œå¯ä»¥åˆ†ä¸º4ç§åŠ å¯†æ¨¡å¼ï¼šç”µå­å¯†ç æœ¬æ¨¡å¼ï¼ˆElectronic Code Bookï¼ŒECBï¼‰ã€å¯†æ–‡é“¾æ¥æ¨¡å¼ï¼ˆCipher Book Chainingï¼ŒCBCï¼‰ã€å¯†æ–‡åé¦ˆæ¨¡å¼ï¼ˆCipher Feed Backï¼ŒCFBï¼‰ã€è¾“å‡ºåé¦ˆæ¨¡å¼ï¼ˆOutput Feed Backï¼ŒOFBï¼‰ã€‚AESæ ‡å‡†é™¤äº†æ¨èä¸Šè¿°4ç§å·¥ä½œæ¨¡å¼å¤–ï¼Œè¿˜æ¨èäº†ä¸€ç§æ–°çš„å·¥ä½œæ¨¡å¼â€”è®¡æ•°å™¨æ¨¡å¼ï¼ˆCounterï¼ŒCTRï¼‰ã€‚è¿™äº›å·¥ä½œæ¨¡å¼å¯é€‚ç”¨äºå„ç§åˆ†ç»„å¯†ç ç®—æ³•ã€‚</p><h3 id="ECB"><a href="#ECB" class="headerlink" title="ECB"></a>ECB</h3><p>ECBæ¨¡å¼åŠ è§£å¯†è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200821-090430@2x.png" alt="QQ20200821-090430@2x"></p><p>æ˜æ–‡åˆ†ä¸ºè‹¥å¹²å—ï¼Œæ¯æ¬¡åŠ å¯†å‡äº§ç”Ÿç‹¬ç«‹çš„å¯†æ–‡åˆ†ç»„ï¼Œæ¯ç»„çš„åŠ å¯†ç»“æœä¸ä¼šå¯¹å…¶ä»–åˆ†ç»„äº§ç”Ÿå½±å“ï¼Œç›¸åŒçš„æ˜æ–‡åŠ å¯†åå¯¹åº”äº§ç”Ÿç›¸åŒçš„å¯†æ–‡ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯å¹¶è¡Œæ“ä½œï¼Œæ²¡æœ‰è¯¯å·®ä¼ é€’ï¼ˆå› ä¸ºæ¯ä¸ªå¯†æ–‡éƒ½æ˜¯ç‹¬ç«‹åŠ å¯†æ¥çš„ï¼‰ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¦‚æœæ˜æ–‡é‡å¤ï¼Œåˆ™å¯¹åº”çš„å¯†æ–‡ä¹Ÿä¼šé‡å¤ï¼Œå¯¹æ˜æ–‡è¿›è¡Œä¸»åŠ¨æ”»å‡»çš„å¯èƒ½æ€§è¾ƒé«˜ï¼›</li><li><strong>ç”¨é€”</strong>ï¼šé€‚åˆåŠ å¯†ç§˜é’¥ã€éšæœºæ•°ç­‰çŸ­æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå®‰å…¨åœ°ä¼ é€’DESç§˜é’¥ï¼ŒECBæ˜¯æœ€åˆé€‚çš„æ¨¡å¼ã€‚</li></ul><h3 id="CBC"><a href="#CBC" class="headerlink" title="CBC"></a>CBC</h3><p>CBCæ¨¡å¼åŠ è§£å¯†è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200821-154612@2x.png" alt="QQ20200821-154612@2x.png"></p><p>æ˜æ–‡åˆ†ä¸ºè‹¥å¹²å—ï¼Œæ¯æ¬¡åŠ å¯†å‰ï¼Œæ˜æ–‡å—éƒ½å’Œå‰ä¸€ä¸ªæ˜æ–‡å—åŠ å¯†åçš„å†…å®¹è¿›è¡Œå¼‚æˆ–å¤„ç†ï¼Œç„¶åå†ç”¨ç§˜é’¥åŠ å¯†ã€‚å› ä¸ºç¬¬ä¸€ä¸ªæ˜æ–‡å—æ²¡æœ‰å¯ä»¥ç”¨æ¥å¼‚æˆ–å¤„ç†çš„å¯†æ–‡å—ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªåˆå§‹åŒ–å‘é‡æ¥æ›¿ä»£ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯†æ–‡é“¾æ¥æ¨¡å¼åŠ å¯†åçš„å¯†æ–‡ä¸Šä¸‹æ–‡å…³è”ï¼Œå¯¹æ˜æ–‡çš„ä¸»åŠ¨æ”»å‡»çš„å¯èƒ½æ€§è¾ƒä½ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼šä¸èƒ½å¹¶è¡ŒåŠ å¯†ï¼Œå¦‚æœåœ¨åŠ å¯†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œåˆ™é”™è¯¯å°†è¢«æ— é™æ”¾å¤§ï¼Œå¯¼è‡´åŠ å¯†å¤±è´¥ã€‚å¹¶ä¸”éœ€è¦æä¾›åˆå§‹åŒ–å‘é‡ï¼›</li><li><strong>ç”¨é€”</strong>ï¼šå¯åŠ å¯†ä»»æ„é•¿åº¦çš„æ•°æ®ï¼›é€‚ç”¨äºè®¡ç®—äº§ç”Ÿæ£€æµ‹æ•°æ®å®Œæ•´æ€§çš„æ¶ˆæ¯è®¤è¯ç Macã€‚</li></ul><h3 id="CFB"><a href="#CFB" class="headerlink" title="CFB"></a>CFB</h3><p>CFBæ¨¡å¼åŠ è§£å¯†è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200821-154853@2x.png" alt="QQ20200821-094022@2x"></p><p>æ˜æ–‡åˆ†ä¸ºè‹¥å¹²å—ï¼Œæ¯æ¬¡åŠ å¯†å‰ï¼Œå…ˆå°†å‰ä¸€ä¸ªå¯†æ–‡å—ä½¿ç”¨ç§˜é’¥åŠ å¯†ï¼ŒåŠ å¯†ç»“æœå’Œå½“å‰æ˜æ–‡å—å¼‚æˆ–å¤„ç†å¾—åˆ°å¯†æ–‡å—ã€‚åŒæ ·çš„ï¼Œéœ€è¦ä¸ºç¬¬ä¸€ä¸ªæ˜æ–‡å—åŠ å¯†æä¾›åˆå§‹åŒ–å‘é‡ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå’ŒCBCç±»ä¼¼ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼šå’ŒCBCç±»ä¼¼ï¼›</li><li><strong>ç”¨é€”</strong>ï¼šå› é”™è¯¯ä¼ æ’­æ— ç•Œï¼Œå¯ç”¨äºæ£€æŸ¥å‘ç°æ˜æ–‡å¯†æ–‡çš„ç¯¡æ”¹ã€‚</li></ul><h3 id="OFB"><a href="#OFB" class="headerlink" title="OFB"></a>OFB</h3><p>OFBæ¨¡å¼åŠ è§£å¯†è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200821-094947@2x.png" alt="QQ20200821-094947@2x"></p><p>è¿‡ç¨‹å’ŒCFBç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºOFBç¬¬ä¸€æ¬¡ä½¿ç”¨ç§˜é’¥å¯¹åˆå§‹åŒ–å‘é‡è¿›è¡ŒåŠ å¯†ï¼ˆç»“æœä¸ºAï¼‰ï¼ŒåŠ å¯†ç»“æœå’Œæ˜æ–‡å—å¼‚æˆ–å¤„ç†å¾—åˆ°å¯†æ–‡å—ï¼Œä¸‹ä¸€æ¬¡æ“ä½œæ—¶å€™ï¼Œä¸æ˜¯ä½¿ç”¨ç§˜é’¥åŠ å¯†å‰ä¸€ä¸ªå¯†æ–‡å—ï¼Œè€Œæ˜¯ä½¿ç”¨ç§˜é’¥åŠ å¯†Açš„ç»“æœå†å’Œæ˜æ–‡å—å¼‚æˆ–å¤„ç†ï¼Œå¾—åˆ°å½“å‰å¯†æ–‡å—ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå’ŒCFBç±»ä¼¼ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼šä¸åˆ©äºå¹¶è¡Œè®¡ç®—ï¼›å¯¹æ˜æ–‡çš„ä¸»åŠ¨æ”»å‡»æ˜¯å¯èƒ½çš„ï¼Œå®‰å…¨æ€§è¾ƒCFBå·®ï¼›</li><li><strong>ç”¨é€”</strong>ï¼šé€‚ç”¨äºåŠ å¯†å†—ä½™æ€§è¾ƒå¤§çš„æ•°æ®ï¼Œæ¯”å¦‚è¯­éŸ³å’Œå›¾åƒæ•°æ®ã€‚</li></ul><h3 id="CTR"><a href="#CTR" class="headerlink" title="CTR"></a>CTR</h3><p>CTRæ¨¡å¼åŠ è§£å¯†è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200821-100139@2x.png" alt="QQ20200821-100139@2x"></p><p>CTRå«ä¹‰æ˜¯è®¡æ•°å™¨æ¨¡å¼ï¼Œæ‰€ä»¥å®ƒç»´æŠ¤äº†ä¸€ä¸ªé€’å¢çš„è®¡æ•°å™¨ã€‚ç§˜é’¥åŠ å¯†è®¡æ•°å™¨ï¼Œç»“æœå’Œæ˜æ–‡å—å¼‚æˆ–å¾—åˆ°å¯†æ–‡å—ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä»¥å¹¶è¡Œæ“ä½œï¼Œå®‰å…¨æ€§å’ŒCBCä¸€æ ·å¥½ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ²¡æœ‰é”™è¯¯ä¼ æ’­ï¼Œå› æ­¤ä¸æ˜“ç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼›</li><li><strong>ç”¨é€”</strong>ï¼šé€‚ç”¨äºå„ç§åŠ å¯†åº”ç”¨ã€‚</li></ul><h2 id="å¡«å……æ¨¡å¼"><a href="#å¡«å……æ¨¡å¼" class="headerlink" title="å¡«å……æ¨¡å¼"></a>å¡«å……æ¨¡å¼</h2><p>å½“éœ€è¦æŒ‰å—å¤„ç†çš„æ•°æ®, æ•°æ®é•¿åº¦ä¸ç¬¦åˆå—å¤„ç†éœ€æ±‚æ—¶, æŒ‰ç…§ä¸€å®šçš„æ–¹æ³•å¡«å……æ»¡å—é•¿çš„è§„åˆ™ã€‚å¦‚æœä¸å¡«å……ï¼Œå¾…åŠ å¯†çš„æ•°æ®å—é•¿åº¦ä¸ç¬¦åˆè¦æ±‚æ—¶ç¨‹åºä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>JDK8ä¸­ä¸»è¦æ”¯æŒNoPaddingå’ŒPKCS5Paddingå¡«å……æ¨¡å¼ã€‚</p><ol><li>NoPaddingï¼šä¸å¡«å……ï¼›</li><li>PKCS5Paddingï¼šæ•°æ®å—çš„å¤§å°ä¸º8ä½, ä¸å¤Ÿå°±è¡¥è¶³ã€‚</li></ol><h2 id="åŠ å¯†ã€å¡«å……æ¨¡å¼å®æˆ˜"><a href="#åŠ å¯†ã€å¡«å……æ¨¡å¼å®æˆ˜" class="headerlink" title="åŠ å¯†ã€å¡«å……æ¨¡å¼å®æˆ˜"></a>åŠ å¯†ã€å¡«å……æ¨¡å¼å®æˆ˜</h2><p>åœ¨äº†è§£äº†åŠ å¯†æ¨¡å¼å’Œå¡«å……æ¨¡å¼åï¼Œæˆ‘ä»¬å›å¤´çœ‹å‰é¢ä»£ç ä¸­çš„transformationå‚æ•°ï¼Œå®ä¾‹åŒ–Cipherå¯¹è±¡çš„æ—¶å€™éœ€è¦æŒ‡å®štransformationè½¬æ¢æ¨¡å¼ï¼Œè½¬æ¢æ¨¡å¼ä¸»è¦æœ‰ä¸¤ç§æ ¼å¼ï¼š</p><ol><li>ç®—æ³•ï¼›</li><li>ç®—æ³•/åŠ å¯†æ¨¡å¼/å¡«å……æ¨¡å¼ã€‚</li></ol><p>ä¸‹é¢å°±AESç®—æ³•æ¥å®è·µä¸åŒçš„åŠ å¯†ã€å¡«å……æ¨¡å¼ã€‚</p><p>å½“è½¬æ¢æ¨¡å¼ä¸ºAES/ECB/PKCS5Paddingæ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å€¼ï¼š"</span> + value);</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"AES"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transformation = <span class="string">"AES/ECB/PKCS5Padding"</span>;</span><br><span class="line">        <span class="comment">// --- ç”Ÿæˆç§˜é’¥ ---</span></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyGenerator keyGenerator = KeyGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç§˜é’¥é•¿åº¦</span></span><br><span class="line">        keyGenerator.init(<span class="number">256</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥ææ–™</span></span><br><span class="line">        SecretKeySpec secretKeySpec = <span class="keyword">new</span> SecretKeySpec(secretKey.getEncoded(), algorithm);</span><br><span class="line">        System.out.println(<span class="string">"AESç§˜é’¥ï¼š"</span> + Base64.getEncoder().encodeToString(secretKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å¯†ç å¯¹è±¡</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¨¡å¼ï¼ˆENCRYPT_MODEï¼šåŠ å¯†æ¨¡å¼ï¼›DECRYPT_MODEï¼šè§£å¯†æ¨¡å¼ï¼‰å’ŒæŒ‡å®šç§˜é’¥</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, secretKeySpec);</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypt = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"AESåŠ å¯†ç»“æœï¼š"</span> + Base64.getEncoder().encodeToString(encrypt));</span><br><span class="line">        <span class="comment">// è§£å¯†</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºè§£å¯†æ¨¡å¼</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, secretKeySpec);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(encrypt);</span><br><span class="line">        System.out.println(<span class="string">"AESè§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¿è¡Œè§£æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å€¼ï¼šmrbird&apos;s blog</span><br><span class="line">AESç§˜é’¥ï¼šxCwGw2d/cflibDRY4oQtjNEgBN5tIrxOBtt/31jAeN8=</span><br><span class="line">AESåŠ å¯†ç»“æœï¼škjFz9IMO2HAOFgExXMsBjg==</span><br><span class="line">AESè§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><p>å°†è½¬æ¢æ¨¡å¼æ”¹ä¸ºAES/CBC/PKCS5Paddingæ—¶ï¼Œç¨‹åºè¾“å‡ºæŠ›å‡º<span style="color:red">java.security.InvalidKeyException: Parameters missing</span>å¼‚å¸¸ã€‚</p><p>å› ä¸ºè¯¥æ¨¡å¼éœ€è¦æŒ‡å®šåˆå§‹åŒ–å‘é‡ï¼Œå°†ä»£ç ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"mrbird's blog"</span>;</span><br><span class="line">        System.out.println(<span class="string">"å¾…åŠ å¯†å€¼ï¼š"</span> + value);</span><br><span class="line">        <span class="comment">// åŠ å¯†ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"AES"</span>;</span><br><span class="line">        <span class="comment">// è½¬æ¢æ¨¡å¼</span></span><br><span class="line">        String transformation = <span class="string">"AES/CBC/PKCS5Padding"</span>;</span><br><span class="line">        <span class="comment">// --- ç”Ÿæˆç§˜é’¥ ---</span></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ç§˜é’¥ç”Ÿæˆå™¨</span></span><br><span class="line">        KeyGenerator keyGenerator = KeyGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç§˜é’¥é•¿åº¦</span></span><br><span class="line">        keyGenerator.init(<span class="number">256</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç§˜é’¥ææ–™</span></span><br><span class="line">        SecretKeySpec secretKeySpec = <span class="keyword">new</span> SecretKeySpec(secretKey.getEncoded(), algorithm);</span><br><span class="line">        System.out.println(<span class="string">"AESç§˜é’¥ï¼š"</span> + Base64.getEncoder().encodeToString(secretKey.getEncoded()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å‘é‡ï¼Œ123456789abcdefgåˆå§‹åŒ–å‘é‡ç§˜é’¥ï¼Œ16å­—èŠ‚</span></span><br><span class="line">        IvParameterSpec iv = <span class="keyword">new</span> IvParameterSpec(<span class="string">"123456789abcdefg"</span>.getBytes());</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å¯†ç å¯¹è±¡</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¨¡å¼ï¼ˆENCRYPT_MODEï¼šåŠ å¯†æ¨¡å¼ï¼›DECRYPT_MODEï¼šè§£å¯†æ¨¡å¼ï¼‰å’ŒæŒ‡å®šç§˜é’¥</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, secretKeySpec, iv);</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypt = cipher.doFinal(value.getBytes());</span><br><span class="line">        System.out.println(<span class="string">"AESåŠ å¯†ç»“æœï¼š"</span> + Base64.getEncoder().encodeToString(encrypt));</span><br><span class="line">        <span class="comment">// è§£å¯†</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºè§£å¯†æ¨¡å¼</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, secretKeySpec, iv);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(encrypt);</span><br><span class="line">        System.out.println(<span class="string">"AESè§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¾…åŠ å¯†å€¼ï¼šmrbird&apos;s blog</span><br><span class="line">AESç§˜é’¥ï¼šxbqvwRKSrAtMsKOxzkbJqG0aMgMQwTC7TF5jkch1M5I=</span><br><span class="line">AESåŠ å¯†ç»“æœï¼šjksbHzoAA/K0sNVW1+RUOw==</span><br><span class="line">AESè§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><p>å°†è½¬æ¢æ¨¡å¼æ”¹ä¸ºAES/CBC/NoPaddingæ—¶ï¼Œç¨‹åºæŠ›å‡º<span style="color:red">javax.crypto.IllegalBlockSizeException: Input length not multiple of 16 bytes</span>å¼‚å¸¸ã€‚å› ä¸ºmrbirdâ€™s blogä¸æ˜¯16å­—èŠ‚çš„å€æ•°ã€‚</p><p>æ›´å¤šå¯¹ç§°åŠ å¯†ç®—æ³•å’ŒåŠ å¯†æ¨¡å¼å¡«å……æ¨¡å¼çš„ç»„åˆå¯ä»¥è‡ªå·±å°è¯•ä¸‹ï¼Œæˆ–è€…å‚è€ƒä¸‹é¢çš„ç®—æ³•æ€»ç»“ã€‚</p><h2 id="æ‰‹åŠ¨æŒ‡å®šç§˜é’¥"><a href="#æ‰‹åŠ¨æŒ‡å®šç§˜é’¥" class="headerlink" title="æ‰‹åŠ¨æŒ‡å®šç§˜é’¥"></a>æ‰‹åŠ¨æŒ‡å®šç§˜é’¥</h2><p>åœ¨ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•åŠ è§£å¯†çš„æ—¶å€™ï¼Œç§˜é’¥ä¸€èˆ¬æ˜¯åŒæ–¹äº‹å…ˆçº¦å®šå¥½çš„ï¼Œå‡å¦‚ç°åœ¨æœ‰AESç§˜é’¥/a3nqjFFtkWNmeX5HzmMtzCziOThbAnEHoiTA4JquAI=ï¼ŒAESå¯†æ–‡y9YMlnX7TE4qF0dDIQ==ï¼Œè½¬æ¢æ¨¡å¼ä¸ºAES/CTR/PKCS5Paddingï¼Œåˆå§‹åŒ–å‘é‡ç§˜é’¥ä¸º123456789abcdefgï¼Œå¦‚ä½•é€šè¿‡ç§˜é’¥å’Œå¯†æ–‡è¿›è¡Œè§£å¯†å‘¢ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ï¼ˆå³æ¼”ç¤ºå¦‚ä½•æ‰‹åŠ¨æŒ‡å®šç§˜é’¥å¹¶è§£å¯†ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String algorithm = <span class="string">"AES"</span>;</span><br><span class="line">        String transformation = <span class="string">"AES/CTR/PKCS5Padding"</span>;</span><br><span class="line">        String key = <span class="string">"/a3nqjFFtkWNmeX5HzmMtzCziOThbAnEHoiTA4JquAI="</span>;</span><br><span class="line">        String encrypt = <span class="string">"y9YMlnX7TE4qF0dDIQ=="</span>;</span><br><span class="line">        String ivKey = <span class="string">"123456789abcdefg"</span>;</span><br><span class="line"></span><br><span class="line">        Cipher cipher = Cipher.getInstance(transformation);</span><br><span class="line">        SecretKeySpec secretKeySpec = <span class="keyword">new</span> SecretKeySpec(Base64.getDecoder().decode(key), algorithm);</span><br><span class="line">        IvParameterSpec iv = <span class="keyword">new</span> IvParameterSpec(ivKey.getBytes());</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, secretKeySpec, iv);</span><br><span class="line">        <span class="keyword">byte</span>[] decrypt = cipher.doFinal(Base64.getDecoder().decode(encrypt));</span><br><span class="line">        System.out.println(<span class="string">"AESè§£å¯†ç»“æœï¼š"</span> + <span class="keyword">new</span> String(decrypt));</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AESè§£å¯†ç»“æœï¼šmrbird&apos;s blog</span><br></pre></td></tr></table></figure><p></p><h2 id="ç®—æ³•æ€»ç»“"><a href="#ç®—æ³•æ€»ç»“" class="headerlink" title="ç®—æ³•æ€»ç»“"></a>ç®—æ³•æ€»ç»“</h2><p>å¯¹ä¸Šé¢è¿™äº›ç®—æ³•è¿›è¡Œæ€»ç»“ï¼š</p><table><tr><th>ç®—æ³•</th><th>ç§˜é’¥é•¿åº¦ï¼ˆä½ï¼‰</th><th>å·¥ä½œæ¨¡å¼</th><th>å¡«å……æ¨¡å¼</th><th>åˆå§‹åŒ–å‘é‡ç§˜é’¥é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰</th></tr><tr><td>DES</td><td>56</td><td>ECBã€CBCã€CFBã€OFBã€CTRç­‰</td><td>NoPaddingã€<br>PKCS5Paddingã€<br>ISO10126Padding</td><td>8</td></tr><tr><td>DESede</td><td>112ã€168</td><td>ECBã€CBCã€CFBã€OFBã€CTRç­‰</td><td>NoPaddingã€<br>PKCS5Paddingã€<br>ISO10126Padding</td><td>8</td></tr><tr><td>AES</td><td>128ã€192ã€256</td><td>ECBã€CBCã€CFBã€OFBã€CTRç­‰</td><td>NoPaddingã€<br>PKCS5Paddingã€<br>ISO10126Padding</td><td>16</td></tr><tr><td>RC2</td><td>40~1024</td><td>ECBã€CBCã€CFBã€OFBã€CTRç­‰</td><td>NoPaddingã€<br>PKCS5Paddingã€<br>ISO10126Padding</td><td>8</td></tr><tr><td>RC4</td><td>40~1024</td><td>ECB</td><td>NoPadding</td><td>æ— </td></tr><tr><td>Blowfish</td><td>32~448ï¼Œ8çš„å€æ•°</td><td>ECBã€CBCã€CFBã€OFBã€CTRç­‰</td><td>NoPaddingã€<br>PKCS5Paddingã€<br>ISO10126Padding</td><td>8</td></tr><tr><td>PBE</td><td>æ— </td><td>CBC</td><td>PKCS5Padding</td><td>16ï¼ˆå¸¦Hmacï¼‰</td></tr></table><blockquote><p>ã€ŠJavaåŠ å¯†ä¸è§£å¯†çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ç§˜é’¥ï¼Œè§£å¯†æ˜¯åŠ å¯†çš„é€†è¿ç®—ã€‚å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†é€Ÿåº¦å¿«ï¼Œå¯†æ–‡å¯é€†ï¼Œä¸€æ—¦ç§˜é’¥æ–‡ä»¶æ³„éœ²ï¼Œå°±ä¼šå¯¼è‡´åŸå§‹æ•°æ®æš´éœ²ã€‚å¯¹ç§°åŠ å¯†çš„ç»“æœä¸€èˆ¬ä½¿ç”¨Base64ç®—æ³•ç¼–ç ï¼Œä¾¿äºé˜…è¯»å’Œä¼ è¾“ã€‚JDK8æ”¯æŒçš„å¯¹ç§°åŠ å¯†ç®—æ³•ä¸»è¦æœ‰DESã€DESedeã€AESã€Blowfishï¼Œä»¥åŠRC2å’ŒRC4ç­‰ã€‚ä¸åŒçš„ç®—æ³•ç§˜é’¥é•¿åº¦ä¸åŒï¼Œç§˜é’¥é•¿åº¦è¶Šé•¿ï¼ŒåŠ å¯†å®‰å…¨æ€§è¶Šé«˜ã€‚
    
    </summary>
    
    
      <category term="Security" scheme="http://mrbird.cc/tags/Security/"/>
    
      <category term="Java" scheme="http://mrbird.cc/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Java æ¶ˆæ¯æ‘˜è¦ç®—æ³•</title>
    <link href="http://mrbird.cc/Java-%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95.html"/>
    <id>http://mrbird.cc/Java-æ‘˜è¦ç®—æ³•.html</id>
    <published>2020-04-28T07:53:48.000Z</published>
    <updated>2020-08-24T02:59:47.742Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p>æ¶ˆæ¯æ‘˜è¦ç®—æ³•æ˜¯å•å‘ä¸å¯é€†çš„ï¼Œæ— æ³•é€šè¿‡åŠ å¯†åçš„æ•£åˆ—å€¼åæ¨åŸå§‹å€¼ï¼Œç›¸åŒçš„å†…å®¹ç”¨åŒæ ·çš„æ‘˜è¦ç®—æ³•è·å¾—çš„æ•£åˆ—å€¼æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¸¸ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><p>è¯¥ç®—æ³•ä¸»è¦åˆ†ä¸ºä¸‰å¤§ç±»ï¼šMDï¼ˆMessage Digestï¼Œæ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼‰ã€SHAï¼ˆSecure HashAlgorithmï¼Œå®‰å…¨æ•£åˆ—ç®—æ³•ï¼‰å’ŒMACï¼ˆMessage Authentication Codeï¼Œæ¶ˆæ¯è®¤è¯ç ç®—æ³•ï¼‰ã€‚MDç³»åˆ—ç®—æ³•åŒ…æ‹¬MD2ã€MD4å’ŒMD5å…±3ç§ç®—æ³•ï¼›SHAç®—æ³•ä¸»è¦åŒ…æ‹¬å…¶ä»£è¡¨ç®—æ³•SHA-1å’ŒSHA-1ç®—æ³•çš„å˜ç§SHA-2ç³»åˆ—ç®—æ³•ï¼ˆåŒ…å«SHA-224ã€SHA-256ã€SHA-384å’ŒSHA-512ï¼‰ï¼›MACç®—æ³•ç»¼åˆäº†ä¸Šè¿°ä¸¤ç§ç®—æ³•ï¼Œä¸»è¦åŒ…æ‹¬HmacMD5ã€HmacSHA1ã€HmacSHA256ã€HmacSHA384å’ŒHmacSHA512ç®—æ³•ã€‚è¿™èŠ‚ä¸»è¦è®°å½•ä¸‹JDK8å¯¹è¿™äº›ç®—æ³•çš„æ”¯æŒæƒ…å†µã€‚</p><a id="more"></a><p>æ¶ˆæ¯æ‘˜è¦ç®—æ³•çš„ç»“æœæˆ‘ä»¬ä¸€èˆ¬å°†å…¶è½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿é˜…è¯»ä¼ è¾“ã€‚</p><h2 id="MDç³»åˆ—ç®—æ³•"><a href="#MDç³»åˆ—ç®—æ³•" class="headerlink" title="MDç³»åˆ—ç®—æ³•"></a>MDç³»åˆ—ç®—æ³•</h2><p>MD5ç®—æ³•æ˜¯MDç³»åˆ—ç®—æ³•çš„ä»£è¡¨ï¼Œç”±MD2ã€MD4ç­‰ç®—æ³•æ¼”å˜è€Œæ¥ã€‚æ— è®ºé‡‡ç”¨å“ªç§MDç®—æ³•ï¼Œç»“æœéƒ½æ˜¯32å­—èŠ‚çš„16è¿›åˆ¶å­—ç¬¦ä¸²ã€‚JDK8åªæ”¯æŒMD2å’ŒMD5ä¸¤ç§MDç®—æ³•ã€‚</p><p>æ–°å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œå¼•å…¥common-codecä¾èµ–ï¼ˆåŒ…å«ä¸€äº›åŠ è§£å¯†å·¥å…·ç±»ï¼Œç”¨äºå¢å¼ºJDKæˆ–è€…ç®€åŒ–JDKç›¸å…³åŠ è§£å¯†APIï¼‰ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>JDK8ä¸­ï¼ŒMDç³»åˆ—ç®—æ³•çš„å®ç°æ˜¯é€šè¿‡MessageDigestç±»æ¥å®Œæˆçš„ï¼Œä¸‹é¢æ¼”ç¤ºä¸‹ä½¿ç”¨JDK8åŸç”ŸAPIå®ç°MD2å’ŒMD5åŠ å¯†ï¼ˆç®—æ³•åç§°ä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚</p><p>MD2ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"hello"</span>;</span><br><span class="line">        String algorithm = <span class="string">"md2"</span>;</span><br><span class="line">        <span class="comment">// è·å–MessageDigestå®ä¾‹</span></span><br><span class="line">        MessageDigest messageDigest = MessageDigest.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// è°ƒç”¨digestæ–¹æ³•ç”Ÿæˆæ•°å­—æ‘˜è¦</span></span><br><span class="line">        <span class="keyword">byte</span>[] digest = messageDigest.digest(value.getBytes());</span><br><span class="line">        <span class="comment">// ç»“æœè½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå€ŸåŠ©common-codec Hexç±»ï¼‰</span></span><br><span class="line">        String md2Hex = Hex.encodeHexString(digest);</span><br><span class="line">        System.out.println(md2Hex);</span><br><span class="line">        System.out.println(md2Hex.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a9046c73e00331af68917d3804f70655</span><br><span class="line">32</span><br></pre></td></tr></table></figure><p></p><p>MD5ï¼ˆåªéœ€è¦å°†ç®—æ³•æ”¹ä¸ºmd5å³å¯ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"hello"</span>;</span><br><span class="line">        String algorithm = <span class="string">"md5"</span>;</span><br><span class="line">        <span class="comment">// è·å–MessageDigestå®ä¾‹</span></span><br><span class="line">        MessageDigest messageDigest = MessageDigest.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// è°ƒç”¨digestæ–¹æ³•ç”Ÿæˆæ•°å­—æ‘˜è¦</span></span><br><span class="line">        <span class="keyword">byte</span>[] digest = messageDigest.digest(value.getBytes());</span><br><span class="line">        <span class="comment">// ç»“æœè½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå€ŸåŠ©common-codec Hexç±»ï¼‰</span></span><br><span class="line">        String md5Hex = Hex.encodeHexString(digest);</span><br><span class="line">        System.out.println(md5Hex);</span><br><span class="line">        System.out.println(md5Hex.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5d41402abc4b2a76b9719d911017c592</span><br><span class="line">32</span><br></pre></td></tr></table></figure><p></p><p>common-codecçš„DigestUtilsä¹Ÿæä¾›äº†MD2å’ŒMD5ç®—æ³•ç›¸å…³æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String value = <span class="string">"hello"</span>;</span><br><span class="line">        String md5Hex = DigestUtils.md5Hex(value.getBytes());</span><br><span class="line">        System.out.println(md5Hex);</span><br><span class="line"></span><br><span class="line">        String md2Hex = DigestUtils.md2Hex(value.getBytes());</span><br><span class="line">        System.out.println(md2Hex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>common-codecå¹¶æ²¡æœ‰è‡ªå·±å®ç°ç›¸å…³ç®—æ³•ï¼Œè€Œæ˜¯å¯¹JDKåŸç”ŸAPIè¿›è¡Œå°è£…ï¼Œä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚</p><h2 id="SHAç³»åˆ—ç®—æ³•"><a href="#SHAç³»åˆ—ç®—æ³•" class="headerlink" title="SHAç³»åˆ—ç®—æ³•"></a>SHAç³»åˆ—ç®—æ³•</h2><p>SHAç®—æ³•æ˜¯åŸºäºMD4ç®—æ³•å®ç°çš„ï¼Œä½œä¸ºMDç®—æ³•çš„ç»§ä»»è€…ï¼Œæˆä¸ºäº†æ–°ä¸€ä»£çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•çš„ä»£è¡¨ã€‚SHAä¸MDç®—æ³•ä¸åŒä¹‹å¤„ä¸»è¦åœ¨äºæ‘˜è¦é•¿åº¦ï¼ŒSHAç®—æ³•çš„æ‘˜è¦æ›´é•¿ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚</p><p>SHAç®—æ³•å®¶æ—ç›®å‰å…±æœ‰SHA-1ã€SHA-224ã€SHA-256ã€SHA-384å’ŒSHA-512äº”ç§ç®—æ³•ï¼Œé€šå¸¸å°†åå››ç§ç®—æ³•å¹¶ç§°ä¸ºSHA-2ç®—æ³•ã€‚</p><p>JDK8æ”¯æŒSHA-1ã€SHA-256ã€SHA-384ã€SHA-224å’ŒSHA-512äº”ç§ç®—æ³•ï¼Œå…¶ä¸­SHAçš„å†™æ³•ç­‰ä»·äºSHA-1ã€‚JDK8ä¸­ï¼ŒSHAç³»åˆ—ç®—æ³•çš„å®ç°ä¹Ÿæ˜¯é€šè¿‡MessageDigestç±»æ¥å®Œæˆçš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchAlgorithmException </span>&#123;</span><br><span class="line">        String value = <span class="string">"hello"</span>;</span><br><span class="line">        String algorithm = <span class="string">"SHA-1"</span>;</span><br><span class="line">        MessageDigest messageDigest = MessageDigest.getInstance(algorithm);</span><br><span class="line">        <span class="keyword">byte</span>[] digest = messageDigest.digest(value.getBytes());</span><br><span class="line">        System.out.println(Hex.encodeHexString(digest));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d</span><br></pre></td></tr></table></figure><p></p><p>å‰©ä¸‹çš„å‡ ç§ç®—æ³•å¯ä»¥è‡ªå·±å°è¯•ã€‚</p><p>common-codecåŒæ ·ä¹Ÿæä¾›äº†SHAç›¸å…³ç®—æ³•çš„APIï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String value = <span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line">        String sha1Hex = DigestUtils.sha1Hex(value);</span><br><span class="line">        System.out.println(sha1Hex);</span><br><span class="line"></span><br><span class="line">        String sha256Hex = DigestUtils.sha256Hex(value);</span><br><span class="line">        System.out.println(sha256Hex);</span><br><span class="line">        </span><br><span class="line">        String sha384Hex = DigestUtils.sha384Hex(value);</span><br><span class="line">        System.out.println(sha384Hex);</span><br><span class="line"></span><br><span class="line">        String sha512Hex = DigestUtils.sha512Hex(value);</span><br><span class="line">        System.out.println(sha512Hex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="MACç³»åˆ—ç®—æ³•"><a href="#MACç³»åˆ—ç®—æ³•" class="headerlink" title="MACç³»åˆ—ç®—æ³•"></a>MACç³»åˆ—ç®—æ³•</h2><p>MACç®—æ³•ç»“åˆäº†MDå’ŒSHAç®—æ³•çš„ä¼˜åŠ¿ï¼Œå¹¶åŠ å…¥ç§˜é’¥çš„æ”¯æŒï¼Œæ˜¯ä¸€ç§æ›´ä¸ºå®‰å…¨çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•ã€‚å› ä¸ºMACç®—æ³•èåˆäº†ç§˜é’¥æ•£åˆ—å‡½æ•°ï¼ˆkeyed-Hashï¼‰ï¼Œé€šå¸¸æˆ‘ä»¬ä¹ŸæŠŠMACç§°ä¸ºHMACï¼ˆkeyed-Hash Message Authentication Codeï¼‰ã€‚</p><p>MACç®—æ³•ä¸»è¦é›†åˆäº†MDå’ŒSHAä¸¤å¤§ç³»åˆ—æ¶ˆæ¯æ‘˜è¦ç®—æ³•ã€‚MDç³»åˆ—ç®—æ³•æœ‰HmacMD2ã€HmacMD4å’ŒHmacMD5ä¸‰ç§ç®—æ³•ï¼›SHAç³»åˆ—ç®—æ³•æœ‰HmacSHA1ã€HmacSHA224ã€HmacSHA256ã€HmacSHA384å’ŒHmacSHA512äº”ç§ç®—æ³•ã€‚</p><p>JDK8æ”¯æŒäº†HmacMD5ã€HmacSHA1ã€HmacSHA224ã€HmacSHA256ã€HmacSHA384å’ŒHmacSHA512è¿™å…­ç§MACç®—æ³•ï¼Œé€šè¿‡Macç±»å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Mac;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String value = <span class="string">"hello"</span>;</span><br><span class="line">        <span class="comment">// JDKæ”¯æŒ HmacMD5ã€HmacSHA1ã€HmacSHA224ã€HmacSHA256ã€HmacSHA384å’ŒHmacSHA512å…­ç§ç®—æ³•</span></span><br><span class="line">        String algorithm = <span class="string">"HmacMD5"</span>;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–KeyGenerator</span></span><br><span class="line">        KeyGenerator keyGenerator = KeyGenerator.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// æ„å»ºç§˜é’¥</span></span><br><span class="line">        SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">        <span class="comment">// è·å¾—ç§˜é’¥</span></span><br><span class="line">        <span class="keyword">byte</span>[] key = secretKey.getEncoded();</span><br><span class="line">        <span class="comment">// è¿˜åŸç§˜é’¥</span></span><br><span class="line">        SecretKeySpec secretKeySpec = <span class="keyword">new</span> SecretKeySpec(key, algorithm);</span><br><span class="line">        <span class="comment">// æ‰“å°ä¸‹ç§˜é’¥</span></span><br><span class="line">        System.out.println(Base64.encodeBase64String(secretKeySpec.getEncoded()));</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–Mac</span></span><br><span class="line">        Mac mac = Mac.getInstance(algorithm);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–Mac</span></span><br><span class="line">        mac.init(secretKeySpec);</span><br><span class="line">        <span class="comment">// è·å–æ¶ˆæ¯æ‘˜è¦</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = mac.doFinal(value.getBytes());</span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸º16è¿›åˆ¶</span></span><br><span class="line">        System.out.println(Hex.encodeHexString(bytes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PCg3+Q7i/C0ahZ74Vo3Nl/2wBvHnsdycoSmoAXzuxSwc5DVc1rWyHKHdt1XzlanT5GdJiKkcKhCwXGm7iN+udA==</span><br><span class="line">6c40b8d59b9d0f818e94b9028b789892</span><br></pre></td></tr></table></figure><p></p><h2 id="å®é™…åº”ç”¨"><a href="#å®é™…åº”ç”¨" class="headerlink" title="å®é™…åº”ç”¨"></a>å®é™…åº”ç”¨</h2><p>åœ¨Tomcatä¸‹è½½é¡µé¢ï¼š<a href="https://tomcat.apache.org/download-70.cgi" target="_blank" rel="noopener">https://tomcat.apache.org/download-70.cgi</a>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ç›¸å…³æ–‡ä»¶çš„æ‘˜è¦ï¼š</p><p><img src="img/QQ20200820-102253@2x.png" alt="QQ20200820-102253@2x"></p><p>æˆ‘ä»¬å°†32-bit Windows zipè¿™ä¸ªæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œè®¡ç®—å‡ºè¿™ä¸ªæ–‡ä»¶çš„sha512å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String algorithm = <span class="string">"SHA-512"</span>;</span><br><span class="line">        MessageDigest messageDigest = MessageDigest.getInstance(algorithm);</span><br><span class="line"></span><br><span class="line">        String filePath = <span class="string">"files/apache-tomcat-7.0.105-windows-x86.zip"</span>;</span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(filePath);</span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        ByteArrayOutputStream stream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        <span class="keyword">while</span> ((len = fis.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            stream.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] digest = messageDigest.digest(stream.toByteArray());</span><br><span class="line">        System.out.println(Hex.encodeHexString(digest));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b7a3b0629dad0d9684bc57a5d18251e38bafa172fcffeac06f7e3c40884f2afc099e7c0143a0471639887b8294c8135c35d1f1ac24f1637dee3c2b3a06aa3aa5</span><br></pre></td></tr></table></figure><p></p><p>è¿™å’Œé¡µé¢<a href="https://downloads.apache.org/tomcat/tomcat-7/v7.0.105/bin/apache-tomcat-7.0.105-windows-x86.zip.sha512" target="_blank" rel="noopener">https://downloads.apache.org/tomcat/tomcat-7/v7.0.105/bin/apache-tomcat-7.0.105-windows-x86.zip.sha512</a>ä¸Šæ˜¾ç¤ºçš„ä¸€è‡´ï¼Œè¯´æ˜æˆ‘ä»¬ä¸‹è½½çš„æ–‡ä»¶åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p><blockquote><p>ã€ŠJavaåŠ å¯†ä¸è§£å¯†çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;æ¶ˆæ¯æ‘˜è¦ç®—æ³•æ˜¯å•å‘ä¸å¯é€†çš„ï¼Œæ— æ³•é€šè¿‡åŠ å¯†åçš„æ•£åˆ—å€¼åæ¨åŸå§‹å€¼ï¼Œç›¸åŒçš„å†…å®¹ç”¨åŒæ ·çš„æ‘˜è¦ç®—æ³•è·å¾—çš„æ•£åˆ—å€¼æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¸¸ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§ã€‚&lt;/p&gt;&lt;p&gt;è¯¥ç®—æ³•ä¸»è¦åˆ†ä¸ºä¸‰å¤§ç±»ï¼šMDï¼ˆMessage Digestï¼Œæ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼‰ã€SHAï¼ˆSecure HashAlgorithmï¼Œå®‰å…¨æ•£åˆ—ç®—æ³•ï¼‰å’ŒMACï¼ˆMessage Authentication Codeï¼Œæ¶ˆæ¯è®¤è¯ç ç®—æ³•ï¼‰ã€‚MDç³»åˆ—ç®—æ³•åŒ…æ‹¬MD2ã€MD4å’ŒMD5å…±3ç§ç®—æ³•ï¼›SHAç®—æ³•ä¸»è¦åŒ…æ‹¬å…¶ä»£è¡¨ç®—æ³•SHA-1å’ŒSHA-1ç®—æ³•çš„å˜ç§SHA-2ç³»åˆ—ç®—æ³•ï¼ˆåŒ…å«SHA-224ã€SHA-256ã€SHA-384å’ŒSHA-512ï¼‰ï¼›MACç®—æ³•ç»¼åˆäº†ä¸Šè¿°ä¸¤ç§ç®—æ³•ï¼Œä¸»è¦åŒ…æ‹¬HmacMD5ã€HmacSHA1ã€HmacSHA256ã€HmacSHA384å’ŒHmacSHA512ç®—æ³•ã€‚è¿™èŠ‚ä¸»è¦è®°å½•ä¸‹JDK8å¯¹è¿™äº›ç®—æ³•çš„æ”¯æŒæƒ…å†µã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Security" scheme="http://mrbird.cc/tags/Security/"/>
    
      <category term="Java" scheme="http://mrbird.cc/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Java Base64ç®—æ³•</title>
    <link href="http://mrbird.cc/Java-Base64%E7%AE%97%E6%B3%95.html"/>
    <id>http://mrbird.cc/Java-Base64ç®—æ³•.html</id>
    <published>2020-04-21T06:24:20.000Z</published>
    <updated>2020-08-20T00:49:53.200Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p>Base64ç®—æ³•å¹¶ä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œå®ƒçš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ASCIIç åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°ä¹±ç çš„é—®é¢˜ã€‚Base64æ˜¯ç½‘ç»œä¸Šæœ€å¸¸è§çš„ç”¨äºä¼ è¾“8bitå­—èŠ‚ç çš„å¯è¯»æ€§ç¼–ç ç®—æ³•ä¹‹ä¸€ã€‚å¯è¯»æ€§ç¼–ç ç®—æ³•ä¸æ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ï¼Œè€Œæ˜¯ä¸ºäº†å¯è¯»æ€§ã€‚å¯è¯»æ€§ç¼–ç ä¸æ”¹å˜ä¿¡æ¯å†…å®¹ï¼Œåªæ”¹å˜ä¿¡æ¯å†…å®¹çš„è¡¨ç°å½¢å¼ã€‚Base64ä½¿ç”¨äº†64ç§å­—ç¬¦ï¼šå¤§å†™Aåˆ°Zã€å°å†™aåˆ°zã€æ•°å­—0åˆ°9ã€â€œ+â€å’Œâ€œ/â€ï¼Œæ•…å¾—æ­¤åã€‚</p><a id="more"></a><h2 id="å‚¨å¤‡çŸ¥è¯†Byteå’Œbit"><a href="#å‚¨å¤‡çŸ¥è¯†Byteå’Œbit" class="headerlink" title="å‚¨å¤‡çŸ¥è¯†Byteå’Œbit"></a>å‚¨å¤‡çŸ¥è¯†Byteå’Œbit</h2><p>Byteï¼šå­—èŠ‚ï¼Œæ•°æ®å­˜å‚¨çš„åŸºæœ¬å•ä½ï¼›</p><p>bitï¼šæ¯”ç‰¹ï¼Œä¹Ÿå«ä½ï¼Œä¸€ä¸ªä½åªèƒ½å­˜å‚¨0æˆ–è€…1ã€‚</p><p>å…³ç³»ï¼š1Byte = 8bitã€‚</p><p>ä¸€ä¸ªè‹±æ–‡å­—ç¬¦å 1ä¸ªå­—èŠ‚ï¼Œ8ä½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String a = <span class="string">"a"</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = a.getBytes();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">byte</span> b : bytes) &#123;</span><br><span class="line">        System.out.println(b);</span><br><span class="line">        System.out.println(Integer.toBinaryString(b));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">97</span><br><span class="line">1100001</span><br></pre></td></tr></table></figure><p></p><p>ä¸€ä¸ªä¸­æ–‡å­—ç¬¦åœ¨ä¸åŒç¼–ç ä¸‹æ‰€å çš„å­—èŠ‚æ•°ä¸åŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">    String a = <span class="string">"é¸Ÿ"</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] utf8Bytes = a.getBytes(<span class="string">"utf-8"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">byte</span> b : utf8Bytes) &#123;</span><br><span class="line">        System.out.print(b);</span><br><span class="line">        System.out.print(<span class="string">"    "</span>);</span><br><span class="line">        System.out.println(Integer.toBinaryString(b));</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println();</span><br><span class="line">    <span class="keyword">byte</span>[] gbkBytes = a.getBytes(<span class="string">"gbk"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">byte</span> b : gbkBytes) &#123;</span><br><span class="line">        System.out.print(b);</span><br><span class="line">        System.out.print(<span class="string">"    "</span>);</span><br><span class="line">        System.out.println(Integer.toBinaryString(b));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-23    11111111111111111111111111101001</span><br><span class="line">-72    11111111111111111111111110111000</span><br><span class="line">-97    11111111111111111111111110011111</span><br><span class="line"></span><br><span class="line">-60    11111111111111111111111111000100</span><br><span class="line">-15    11111111111111111111111111110001</span><br></pre></td></tr></table></figure><p></p><p>æ‰€ä»¥åœ¨UTF-8ç¼–ç ä¸‹ï¼Œä¸€ä¸ªä¸­æ–‡å 3ä¸ªå­—èŠ‚ï¼›åœ¨GBKç¼–ç ä¸‹ï¼Œä¸€ä¸ªä¸­æ–‡å 2ä¸ªå­—èŠ‚ã€‚</p><h2 id="Base64ç¼–ç åŸç†"><a href="#Base64ç¼–ç åŸç†" class="headerlink" title="Base64ç¼–ç åŸç†"></a>Base64ç¼–ç åŸç†</h2><p>Base64ç¼–ç è¡¨ï¼š</p><table><tbody><tr><td><div><b>ç´¢å¼•</b></div></td><td><div><b>å¯¹åº”å­—ç¬¦</b></div></td><td><div><b>ç´¢å¼•</b></div></td><td><div><b>å¯¹åº”å­—ç¬¦</b></div></td><td><div><b>ç´¢å¼•</b></div></td><td><div><b>å¯¹åº”å­—ç¬¦</b></div></td><td><div><b>ç´¢å¼•</b></div></td><td><div><b>å¯¹åº”å­—ç¬¦</b></div></td></tr><tr><td><div>0</div></td><td><div><b>A</b></div></td><td><div>17</div></td><td><div><b>R</b></div></td><td><div>34</div></td><td><div><b>i</b></div></td><td><div>51</div></td><td><div><b>z</b></div></td></tr><tr><td><div>1</div></td><td><div><b>B</b></div></td><td><div>18</div></td><td><div><b>S</b></div></td><td><div>35</div></td><td><div><b>j</b></div></td><td><div>52</div></td><td><div><b>0</b></div></td></tr><tr><td><div>2</div></td><td><div><b>C</b></div></td><td><div>19</div></td><td><div><b>T</b></div></td><td><div>36</div></td><td><div><b>k</b></div></td><td><div>53</div></td><td><div><b>1</b></div></td></tr><tr><td><div>3</div></td><td><div><b>D</b></div></td><td><div>20</div></td><td><div><b>U</b></div></td><td><div>37</div></td><td><div><b>l</b></div></td><td><div>54</div></td><td><div><b>2</b></div></td></tr><tr><td><div>4</div></td><td><div><b>E</b></div></td><td><div>21</div></td><td><div><b>V</b></div></td><td><div>38</div></td><td><div><b>m</b></div></td><td><div>55</div></td><td><div><b>3</b></div></td></tr><tr><td><div>5</div></td><td><div><b>F</b></div></td><td><div>22</div></td><td><div><b>W</b></div></td><td><div>39</div></td><td><div><b>n</b></div></td><td><div>56</div></td><td><div><b>4</b></div></td></tr><tr><td><div>6</div></td><td><div><b>G</b></div></td><td><div>23</div></td><td><div><b>X</b></div></td><td><div>40</div></td><td><div><b>o</b></div></td><td><div>57</div></td><td><div><b>5</b></div></td></tr><tr><td><div>7</div></td><td><div><b>H</b></div></td><td><div>24</div></td><td><div><b>Y</b></div></td><td><div>41</div></td><td><div><b>p</b></div></td><td><div>58</div></td><td><div><b>6</b></div></td></tr><tr><td><div>8</div></td><td><div><b>I</b></div></td><td><div>25</div></td><td><div><b>Z</b></div></td><td><div>42</div></td><td><div><b>q</b></div></td><td><div>59</div></td><td><div><b>7</b></div></td></tr><tr><td><div>9</div></td><td><div><b>J</b></div></td><td><div>26</div></td><td><div><b>a</b></div></td><td><div>43</div></td><td><div><b>r</b></div></td><td><div>60</div></td><td><div><b>8</b></div></td></tr><tr><td><div>10</div></td><td><div><b>K</b></div></td><td><div>27</div></td><td><div><b>b</b></div></td><td><div>44</div></td><td><div><b>s</b></div></td><td><div>61</div></td><td><div><b>9</b></div></td></tr><tr><td><div>11</div></td><td><div><b>L</b></div></td><td><div>28</div></td><td><div><b>c</b></div></td><td><div>45</div></td><td><div><b>t</b></div></td><td><div>62</div></td><td><div><b>+</b></div></td></tr><tr><td><div>12</div></td><td><div><b>M</b></div></td><td><div>29</div></td><td><div><b>d</b></div></td><td><div>46</div></td><td><div><b>u</b></div></td><td><div>63</div></td><td><div><b>/</b></div></td></tr><tr><td><div>13</div></td><td><div><b>N</b></div></td><td><div>30</div></td><td><div><b>e</b></div></td><td><div>47</div></td><td><div><b>v</b></div></td><td></td><td></td></tr><tr><td><div>14</div></td><td><div><b>O</b></div></td><td><div>31</div></td><td><div><b>f</b></div></td><td><div>48</div></td><td><div><b>w</b></div></td><td></td><td></td></tr><tr><td><div>15</div></td><td><div><b>P</b></div></td><td><div>32</div></td><td><div><b>g</b></div></td><td><div>49</div></td><td><div><b>x</b></div></td><td></td><td></td></tr><tr><td><div>16</div></td><td><div><b>Q</b></div></td><td><div>33</div></td><td><div><b>h</b></div></td><td><div>50</div></td><td><div><b>y</b></div></td><td></td><td></td></tr></tbody></table><p>Base64ç¼–ç çš„è¿‡ç¨‹ï¼š</p><ol><li>å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„ï¼›</li><li>å°†æ¯ä¸ªå­—ç¬¦è½¬æ¢ä¸ºASCIIç ï¼›</li><li>å°†ASCIIç è½¬æ¢ä¸º8bitäºŒè¿›åˆ¶ç ï¼›</li><li>ç„¶åæ¯3ä¸ªå­—èŠ‚ä¸ºä¸€ç»„ï¼ˆä¸€ä¸ªå­—èŠ‚ä¸º8ä¸ªbitï¼Œæ‰€ä»¥æ¯ç»„24ä¸ªbitï¼‰ï¼›</li><li>å°†æ¯ç»„çš„24ä¸ªbitåˆ†ä¸º4ä»½ï¼Œæ¯ä»½6ä¸ªbitï¼›</li><li>åœ¨æ¯6ä¸ªbitå‰è¡¥0ï¼Œè¡¥é½8bitï¼ˆå‰é¢è¡¥0ä¸å½±å“æ•°å€¼å¤§å°ï¼‰ï¼›</li><li>ç„¶åå°†æ¯8bitè½¬æ¢ä¸º10è¿›åˆ¶æ•°ï¼Œæ ¹æ®ä¸Šé¢çš„Base64ç¼–ç è¡¨è¿›è¡Œè½¬æ¢ã€‚</li></ol><div class="note info">ä¸Šé¢æ­¥éª¤ä¸­ï¼Œä¸ºä»€ä¹ˆè¦å°†æ¯ç»„24ä¸ªbitåˆ†ä¸º4ä»½ï¼Œæ¯ä»½6ä¸ªbitå‘¢ï¼Ÿå› ä¸º6bitçš„æœ€å¤§å€¼ä¸º111111ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶ä¸º63ï¼Œæ‰€ä»¥6bitçš„å–å€¼èŒƒå›´ä¸º0~63ï¼Œè¿™å’Œbase64ç¼–ç è¡¨é•¿åº¦ä¸€è‡´ã€‚</div><p>æ ¹æ®ä¸Šé¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼šç°è¦å¯¹helloè¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡ŒBase64ç¼–ç ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>helloè½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„ï¼šh e l l oï¼›</li><li>å¯¹åº”çš„ASCIIç ä¸ºï¼š104 101 108 108 111ï¼›</li><li>è½¬æ¢ä¸º8bitäºŒè¿›åˆ¶æ•°ï¼š01101000 01100101 01101100 01101100 01101111</li><li>åˆ†ç»„ï¼Œæ¯ç»„24ä¸ªbitï¼ˆä¸è¶³24ä¸ªbitçš„ç”¨00000000è¡¥é½ï¼‰ï¼š 011010000110010101101100 011011000110111100000000ï¼›</li><li>æ¯ç»„24bitåˆ†ä¸º4ä»½ï¼Œæ¯ä»½6bitï¼š011010 000110 010101 101100 011011 000110 111100 000000ï¼›</li><li>åœ¨æ¯6ä¸ªbitå‰è¡¥0ï¼Œè¡¥é½8bitï¼š00011010 00000110 00010101 00101100 00011011 00000110 00111100 00000000ï¼›</li><li>å°†æ¯8bitè½¬æ¢ä¸º10è¿›åˆ¶æ•°ï¼š26 6 21 44 27 6 60 0</li><li>ä»ä¸Šé¢Base64ç¼–ç è¡¨ä¸­æ‰¾åˆ°åè¿›åˆ¶æ•°å¯¹åº”çš„å­—ç¬¦ï¼ˆæœ«å°¾çš„0å¹¶ä¸æ˜¯Aï¼Œè€Œæ˜¯ç”¨=ç­‰å·è¡¥ä½ï¼‰ï¼ša G V s b G 8 =</li></ol><p>æ‰€ä»¥helloç»è¿‡Base64ç¼–ç çš„ç»“æœä¸ºaGVsbG8=</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä»£ç éªŒè¯ä¸‹ï¼ˆJDK8å¼€å§‹å·²ç»æä¾›äº†Base64çš„å®ç°ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Base64Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(Base64.getEncoder().encodeToString(<span class="string">"hello"</span>.getBytes()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¾“å‡ºä¹Ÿæ˜¯aGVsbG8=</p><h2 id="URL-Base64ç®—æ³•"><a href="#URL-Base64ç®—æ³•" class="headerlink" title="URL Base64ç®—æ³•"></a>URL Base64ç®—æ³•</h2><p>Base64ç¼–ç å€¼é€šè¿‡URLä¼ è¾“ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸ºBase64ç¼–ç ä¸­çš„â€œ+â€å’Œâ€œ/â€ç¬¦å·æ˜¯ä¸å…è®¸å‡ºç°åœ¨URLä¸­çš„ã€‚åŒæ ·ï¼Œç¬¦å·â€œ=â€ç”¨åšå‚æ•°åˆ†éš”ç¬¦ï¼Œä¹Ÿä¸å…è®¸å‡ºç°åœ¨URLä¸­ï¼Œæ ¹æ®RFC 4648ä¸­çš„å»ºè®®ï¼Œâ€œ~â€å’Œâ€œ.â€ç¬¦éƒ½æœ‰å¯èƒ½æ›¿ä»£â€œ=â€ç¬¦å·ã€‚ä½†â€œ~â€ç¬¦å·ä¸æ–‡ä»¶ç³»ç»Ÿç›¸å†²çªï¼Œä¸èƒ½ä½¿ç”¨ï¼›å¦‚æœä½¿ç”¨â€œ.â€ç¬¦å·ï¼ŒæŸäº›æ–‡ä»¶ç³»ç»Ÿè®¤ä¸ºè¯¥ç¬¦å·è¿ç»­å‡ºç°ä¸¤æ¬¡åˆ™ä¸ºé”™è¯¯ã€‚</p><p>æ‰€ä»¥common codecåŒ…ä¸‹çš„URL Base64ç®—æ³•èˆå¼ƒäº†å¡«å……ç¬¦ï¼Œä½¿ç”¨äº†ä¸å®šé•¿URL Base64ç¼–ç ã€‚</p><p>å¼•å…¥common codecä¾èµ–åŒ…ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Base64Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String value = <span class="string">"hello"</span>;</span><br><span class="line">        System.out.println(Base64.encodeBase64String(value.getBytes()));</span><br><span class="line">        System.out.println(Base64.encodeBase64URLSafeString(value.getBytes()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aGVsbG8=</span><br><span class="line">aGVsbG8</span><br></pre></td></tr></table></figure><p></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;Base64ç®—æ³•å¹¶ä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œå®ƒçš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ASCIIç åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°ä¹±ç çš„é—®é¢˜ã€‚Base64æ˜¯ç½‘ç»œä¸Šæœ€å¸¸è§çš„ç”¨äºä¼ è¾“8bitå­—èŠ‚ç çš„å¯è¯»æ€§ç¼–ç ç®—æ³•ä¹‹ä¸€ã€‚å¯è¯»æ€§ç¼–ç ç®—æ³•ä¸æ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ï¼Œè€Œæ˜¯ä¸ºäº†å¯è¯»æ€§ã€‚å¯è¯»æ€§ç¼–ç ä¸æ”¹å˜ä¿¡æ¯å†…å®¹ï¼Œåªæ”¹å˜ä¿¡æ¯å†…å®¹çš„è¡¨ç°å½¢å¼ã€‚Base64ä½¿ç”¨äº†64ç§å­—ç¬¦ï¼šå¤§å†™Aåˆ°Zã€å°å†™aåˆ°zã€æ•°å­—0åˆ°9ã€â€œ+â€å’Œâ€œ/â€ï¼Œæ•…å¾—æ­¤åã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Security" scheme="http://mrbird.cc/tags/Security/"/>
    
      <category term="Java" scheme="http://mrbird.cc/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Javaè®¾è®¡æ¨¡å¼å­¦ä¹ </title>
    <link href="http://mrbird.cc/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html"/>
    <id>http://mrbird.cc/Javaè®¾è®¡æ¨¡å¼.html</id>
    <published>2020-04-01T02:07:45.000Z</published>
    <updated>2020-08-03T00:55:25.747Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --><p>ç®€å•è®°å½•Javaä¸­23ç§è®¾è®¡æ¨¡å¼çš„åº”ç”¨ï¼Œæ–¹ä¾¿åæœŸæŸ¥çœ‹ã€‚<a id="more"></a></p><h2 id="åˆ›å»ºå‹æ¨¡å¼"><a href="#åˆ›å»ºå‹æ¨¡å¼" class="headerlink" title="åˆ›å»ºå‹æ¨¡å¼"></a>åˆ›å»ºå‹æ¨¡å¼</h2><h3 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h3><p>ç®€å•å·¥å‚æ¨¡å¼ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå¹¶ä¸å±äºè®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼Œä¸è¿‡è¿™é‡Œè¿˜æ˜¯ç®€å•è®°å½•ä¸‹ã€‚</p><p><strong>å®šä¹‰</strong>ï¼šç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§ç±»å‹å®ä¾‹ã€‚å®¢æˆ·ç«¯åªéœ€ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œæ— å¿ƒå…³å¿ƒåˆ›å»ºè¿‡ç¨‹ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼šå…·ä½“äº§å“ä»å®¢æˆ·ç«¯ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œè§£è€¦ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šå·¥å‚ç±»èŒè´£è¿‡é‡ï¼Œå¢åŠ æ–°çš„ç±»å‹æ—¶ï¼Œå¾—ä¿®æ”¹å·¥ç¨‹ç±»å¾—ä»£ç ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ã€‚</p><p>ä¸¾ä¾‹ï¼šæ–°å»ºFruitæ°´æœæŠ½è±¡ç±»ï¼ŒåŒ…å«eatæŠ½è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å…¶å®ç°ç±»Appleï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">extends</span> <span class="title">Fruit</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åƒğŸ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºåˆ›å»ºFruitçš„å·¥å‚ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Fruit <span class="title">produce</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"apple"</span>.equals(name)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Apple();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºä¸ªå®¢æˆ·ç«¯æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        FruitFactory factory = <span class="keyword">new</span> FruitFactory();</span><br><span class="line">        Fruit fruit = factory.produce(<span class="string">"apple"</span>);</span><br><span class="line">        fruit.eat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿è¡Œmainæ–¹æ³•ï¼Œè¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åƒğŸ</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯Applicationå¹¶æœªä¾èµ–å…·ä½“çš„æ°´æœç±»å‹ï¼Œåªå…³å¿ƒFruitFactoryçš„å…¥å‚ï¼Œè¿™å°±æ˜¯å®¢æˆ·ç«¯å’Œå…·ä½“äº§å“è§£è€¦çš„ä½“ç°ï¼ŒUMLå›¾å¦‚ä¸‹ï¼š</p><p><img src="img/QQæˆªå›¾20191216103019.png" alt="QQæˆªå›¾20191216103019.png"></p><h3 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>ä¸ºäº†è§£å†³ç®€å•å·¥å‚æ¨¡å¼çš„ç¼ºç‚¹ï¼Œè¯ç”Ÿäº†å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory method patternï¼‰ã€‚</p><p><strong>å®šä¹‰</strong>ï¼šå®šä¹‰åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å®ç°è¿™ä¸ªæ¥å£çš„ç±»æ¥å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ï¼Œå·¥å‚æ–¹æ³•è®©ç±»çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°äº†å­ç±»è¿›è¡Œã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ol><li><p>å…·ä½“äº§å“ä»å®¢æˆ·ç«¯ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œè§£è€¦ã€‚</p></li><li><p>åŠ å…¥æ–°çš„ç±»å‹æ—¶ï¼Œåªéœ€æ·»åŠ æ–°çš„å·¥å‚æ–¹æ³•ï¼ˆæ— éœ€ä¿®æ”¹æ—§çš„å·¥å‚æ–¹æ³•ä»£ç ï¼‰ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</p></li></ol><p><strong>ç¼ºç‚¹</strong>ï¼šç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ã€‚</p><p>ä¸¾ä¾‹ï¼šæ–°å»ºFruitæŠ½è±¡ç±»ï¼ŒåŒ…å«eatæŠ½è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºFruitFactoryæŠ½è±¡å·¥å‚ï¼Œå®šä¹‰produceFruitæŠ½è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Fruit <span class="title">produceFruit</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºFruitçš„å®ç°ç±»ï¼ŒAppleï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åƒğŸ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºFruitFactoryçš„å®ç°ç±»AppleFruitFactoryï¼Œç”¨äºç”Ÿäº§å…·ä½“ç±»å‹çš„æ°´æœ â€”â€” è‹¹æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleFruitFactory</span> <span class="keyword">extends</span> <span class="title">FruitFactory</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Fruit <span class="title">produceFruit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Apple();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºå®¢æˆ·ç«¯Applicationæµ‹è¯•ä¸€æ³¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        FruitFactory factory = <span class="keyword">new</span> AppleFruitFactory();</span><br><span class="line">        Fruit fruit = factory.produceFruit();</span><br><span class="line">        fruit.eat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿è¡Œmainæ–¹æ³•ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åƒğŸ</span><br></pre></td></tr></table></figure><p></p><p>ç°åœ¨è¦æ–°å¢Bananaç±»å‹çš„æ°´æœï¼Œåªéœ€è¦æ–°å¢Bananaç±»å‹çš„å·¥å‚ç±»å³å¯ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰çš„AppleFruitFactoryä»£ç ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚ä½†æ˜¯è¿™ç§æ¨¡å¼çš„ç¼ºç‚¹ä¹Ÿæ˜¾è€Œæ˜“è§ï¼Œå°±æ˜¯ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ã€‚</p><p>ä¸Šé¢ä¾‹å­UMLå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQæˆªå›¾20191216105317.png" alt="QQæˆªå›¾20191216105317.png"></p><h3 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h3><p>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract factory patternï¼‰æä¾›äº†<strong>ä¸€ç³»åˆ—</strong>ç›¸å…³æˆ–è€…ç›¸äº’ä¾èµ–çš„å¯¹è±¡çš„æ¥å£ï¼Œå…³é”®å­—æ˜¯â€œä¸€ç³»åˆ—â€ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ol><li><p>å…·ä½“äº§å“ä»å®¢æˆ·ç«¯ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œè§£è€¦ã€‚</p></li><li><p>å°†ä¸€ä¸ªç³»åˆ—çš„äº§å“æ—ç»Ÿä¸€åˆ°ä¸€èµ·åˆ›å»ºã€‚</p></li></ol><p><strong>ç¼ºç‚¹</strong>ï¼šæ‹“å±•æ–°çš„åŠŸèƒ½å›°éš¾ï¼Œéœ€è¦ä¿®æ”¹æŠ½è±¡å·¥å‚çš„æ¥å£ï¼›</p><p>ç»¼ä¸Šæ‰€è¿°ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼é€‚åˆé‚£äº›åŠŸèƒ½ç›¸å¯¹å›ºå®šçš„äº§å“æ—çš„åˆ›å»ºã€‚</p><p>ä¸¾ä¾‹ï¼šæ–°å»ºæ°´æœæŠ½è±¡ç±»Fruitï¼ŒåŒ…å«buyæŠ½è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºä»·æ ¼æŠ½è±¡ç±»Priceï¼ŒåŒ…å«payæŠ½è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Price</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºæ°´æœåˆ›å»ºå·¥å‚æ¥å£FruitFactoryï¼ŒåŒ…å«è·å–æ°´æœå’Œä»·æ ¼æŠ½è±¡æ–¹æ³•ï¼ˆäº§å“æ—çš„ä½“ç°æ˜¯ï¼Œä¸€ç»„äº§å“åŒ…å«æ°´æœå’Œå¯¹åº”çš„ä»·æ ¼ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FruitFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Fruit <span class="title">getFruit</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Price <span class="title">getPrice</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ¥ä¸‹æ¥å¼€å§‹åˆ›å»ºğŸè¿™ä¸ªâ€œäº§å“æ—â€ã€‚æ–°å»ºFruitå®ç°ç±»AppleFruitï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleFruit</span> <span class="keyword">extends</span> <span class="title">Fruit</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"è´­ä¹°ğŸ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºå¯¹åº”çš„è‹¹æœä»·æ ¼å®ç°ApplePriceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplePrice</span> <span class="keyword">extends</span> <span class="title">Price</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ğŸå•ä»·2å…ƒ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åˆ›å»ºå®¢æˆ·ç«¯Applicationï¼Œæµ‹è¯•ä¸€æ³¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        FruitFactory factory = <span class="keyword">new</span> AppleFruitFactory();</span><br><span class="line">        factory.getFruit().buy();</span><br><span class="line">        factory.getPrice().pay();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è´­ä¹°ğŸ</span><br><span class="line">ğŸå•ä»·2å…ƒ</span><br></pre></td></tr></table></figure><p></p><p>å®¢æˆ·ç«¯åªéœ€è¦é€šè¿‡åˆ›å»ºAppleFruitFactoryå°±å¯ä»¥è·å¾—è‹¹æœè¿™ä¸ªäº§å“æ—çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬è‹¹æœå¯¹è±¡ï¼Œè‹¹æœä»·æ ¼ã€‚è¦æ–°å»ºğŸŒçš„äº§å“æ—ï¼Œåªéœ€è¦å®ç°FruitFactoryã€Priceå’ŒFruitæ¥å£å³å¯ã€‚è¿™ç§æ¨¡å¼çš„ç¼ºç‚¹å’Œå·¥å‚æ–¹æ³•å·®ä¸å¤šï¼Œå°±æ˜¯ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ã€‚</p><p>ä¸Šé¢ä¾‹å­UMLå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQæˆªå›¾20191216112922.png" alt="QQæˆªå›¾20191216112922.png"></p><h3 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h3><p>å»ºé€ è€…æ¨¡å¼ä¹Ÿç§°ä¸ºç”Ÿæˆå™¨æ¨¡å¼ï¼ˆBuilder Patternï¼‰ï¼Œå°†å¤æ‚å¯¹è±¡çš„å»ºé€ è¿‡ç¨‹æŠ½è±¡å‡ºæ¥ï¼ˆæŠ½è±¡ç±»åˆ«ï¼‰ï¼Œä½¿è¿™ä¸ªæŠ½è±¡è¿‡ç¨‹çš„ä¸åŒå®ç°æ–¹æ³•å¯ä»¥æ„é€ å‡ºä¸åŒè¡¨ç°ï¼ˆå±æ€§ï¼‰çš„å¯¹è±¡ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œç›¸åŒçš„è¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“ã€‚</p><p>å°†å¤æ‚å¯¹è±¡çš„å»ºé€ è¿‡ç¨‹æŠ½è±¡å‡ºæ¥ï¼ˆæŠ½è±¡ç±»åˆ«ï¼‰ï¼Œä½¿è¿™ä¸ªæŠ½è±¡è¿‡ç¨‹çš„ä¸åŒå®ç°æ–¹æ³•å¯ä»¥æ„é€ å‡ºä¸åŒè¡¨ç°ï¼ˆå±æ€§ï¼‰çš„å¯¹è±¡ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œç›¸åŒçš„è¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“ã€‚</p><p>é€‚ç”¨äºï¼š</p><ol><li>ä¸€ä¸ªå¯¹è±¡æœ‰éå¸¸å¤æ‚çš„å†…éƒ¨ç»“æ„ï¼ˆå¾ˆå¤šå±æ€§ï¼‰</li><li>æƒ³å°†å¤æ‚å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»ã€‚</li></ol><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ol><li>å°è£…æ€§å¥½ï¼Œåˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»</li><li>æ‹“å±•æ€§å¥½ï¼Œå»ºé€ ç±»ä¹‹é—´ç‹¬ç«‹ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£è€¦ã€‚</li></ol><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ol><li>äº§ç”Ÿå¤šä½™çš„Builderå¯¹è±¡ï¼›</li><li>äº§å“å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œå»ºé€ è€…éœ€è¦æ›´æ”¹ï¼Œæˆæœ¬è¾ƒå¤§ã€‚</li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>æ–°å¢å•†é“ºç±»Shopï¼ŒåŒ…å«åç§°ï¼Œåœ°ç‚¹å’Œç±»å‹å±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shop</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Shop&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", location='"</span> + location + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", type='"</span> + type + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocation</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.location = location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ¥ç€åˆ›å»ºShopæŠ½è±¡ç”Ÿæˆå™¨ShopBuilderï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">name</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">location</span><span class="params">(String location)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">type</span><span class="params">(String type)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Shop <span class="title">build</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åŒ…å«å’ŒShopç›¸åŒçš„å±æ€§åŠå¯¹åº”çš„æŠ½è±¡æ„å»ºæ–¹æ³•ã€‚</p><p>ç»§ç»­åˆ›å»ºShopBuilderçš„å®ç°ï¼Œæ°´æœåº—æ„é€ å™¨FruitShopBuilderï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitShopBuilder</span> <span class="keyword">extends</span> <span class="title">ShopBuilder</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Shop shop = <span class="keyword">new</span> Shop();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">name</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shop.setName(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">location</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shop.setLocation(location);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">type</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shop.setType(type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shop <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åˆ›å»ºä¸ªç»é”€å•†ç±»Dealerï¼Œç”¨äºé€šè¿‡ShopBuilderæ„å»ºå…·ä½“çš„å•†åº—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dealer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ShopBuilder builder;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBuilder</span><span class="params">(ShopBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.builder = builder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shop <span class="title">build</span><span class="params">(String name, String location, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.builder.name(name);</span><br><span class="line">        <span class="keyword">this</span>.builder.location(location);</span><br><span class="line">        <span class="keyword">this</span>.builder.type(type);</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åˆ›å»ºä¸ªå®¢æˆ·ç«¯Applicationæµ‹è¯•ä¸€æ³¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShopBuilder builder = <span class="keyword">new</span> FruitShopBuilder();</span><br><span class="line">        Dealer dealer = <span class="keyword">new</span> Dealer();</span><br><span class="line">        dealer.setBuilder(builder);</span><br><span class="line"></span><br><span class="line">        Shop shop = dealer.build(<span class="string">"XXæ°´æœåº—"</span>, <span class="string">"ç¦å·å¸‚XXåŒºXXè¡—XXå·"</span>, <span class="string">"æ°´æœç»è¥"</span>);</span><br><span class="line">        System.out.println(shop);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Shop&#123;name=&apos;XXæ°´æœåº—&apos;, location=&apos;ç¦å·å¸‚XXåŒºXXè¡—XXå·&apos;, type=&apos;æ°´æœç»è¥&apos;&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™ä¸ªä¾‹å­æ˜¯å…¸å‹çš„å»ºé€ è€…æ¨¡å¼ï¼ŒUMLå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQæˆªå›¾20191216162813.png" alt="QQæˆªå›¾20191216162813.png"></p><p>å…¶å®å»ºé€ è€…æ¨¡å¼æ›´ä¸ºå¸¸ç”¨çš„ä¾‹å­æ˜¯ä¸‹é¢è¿™ä¸ªï¼š</p><p>åˆ›å»ºä¸€ä¸ªåº—é“ºç±»Shopï¼ŒShopé‡ŒåŒ…å«æ„é€ è¯¥Shopçš„å†…éƒ¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shop</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Shop</span><span class="params">(ShopBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = builder.name;</span><br><span class="line">        <span class="keyword">this</span>.location = builder.location;</span><br><span class="line">        <span class="keyword">this</span>.type = builder.type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Shop&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", location='"</span> + location + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", type='"</span> + type + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopBuilder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> String location;</span><br><span class="line">        <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ShopBuilder <span class="title">name</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ShopBuilder <span class="title">location</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.location = location;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ShopBuilder <span class="title">type</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.type = type;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Shop <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Shop(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨å®¢æˆ·ç«¯æ„å»ºShopåªéœ€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Shop shop = <span class="keyword">new</span> Shop.ShopBuilder()</span><br><span class="line">                .name(<span class="string">"XXæ°´æœåº—"</span>)</span><br><span class="line">                .location(<span class="string">"ç¦å·å¸‚XXåŒºXXè¡—XXå·"</span>)</span><br><span class="line">                .type(<span class="string">"æ°´æœç»è¥"</span>)</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(shop);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™ç§ç”¨æ³•å’ŒLombokçš„@Builderæ³¨è§£æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p><p>è¿™ä¸ªä¾‹å­çš„UMLå›¾ï¼š</p><p><img src="img/QQæˆªå›¾20191216163308.png" alt="QQæˆªå›¾20191216163308.png"></p><h3 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h3><p>å•ä¾‹æ¨¡å¼ç›®çš„æ˜¯ä¸ºäº†ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ol><li>å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜å¼€é”€ï¼›</li><li>å¯ä»¥é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼›</li><li>è®¾ç½®å…¨å±€è®¿é—®ç‚¹ï¼Œä¸¥æ ¼æ§åˆ¶è®¿é—®ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>æ²¡æœ‰æ¥å£ï¼Œæ‹“å±•å›°éš¾ã€‚</li></ol><h4 id="æ‡’æ±‰æ¨¡å¼"><a href="#æ‡’æ±‰æ¨¡å¼" class="headerlink" title="æ‡’æ±‰æ¨¡å¼"></a>æ‡’æ±‰æ¨¡å¼</h4><p>æ‡’æ±‰æ¨¡å¼ä¸‹çš„å•ä¾‹å†™æ³•æ˜¯æœ€ç®€å•çš„ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingleton lazySingleton = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazySingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (lazySingleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">            lazySingleton = <span class="keyword">new</span> LazySingleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lazySingleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯åŠ åŒæ­¥é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingleton lazySingleton = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazySingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (LazySingleton.class) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lazySingleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">                lazySingleton = <span class="keyword">new</span> LazySingleton();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lazySingleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä½†æ˜¯åŒæ­¥é”é”çš„æ˜¯æ•´ä¸ªç±»ï¼Œæ¯”è¾ƒæ¶ˆè€—èµ„æºï¼Œå¹¶ä¸”å³ä½¿è¿è¡Œå†…å­˜ä¸­å·²ç»å­˜åœ¨LazySingletonï¼Œè°ƒç”¨å…¶getInstanceè¿˜æ˜¯ä¼šä¸Šé”ï¼Œæ‰€ä»¥è¿™ç§å†™æ³•ä¹Ÿä¸æ˜¯å¾ˆå¥½ã€‚</p><h4 id="åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼"><a href="#åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼" class="headerlink" title="åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼"></a>åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyDoubleCheckSingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazyDoubleCheckSingleton instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazyDoubleCheckSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazyDoubleCheckSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazyDoubleCheckSingleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> LazyDoubleCheckSingleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­è™½ç„¶åŠ äº†åŒæ­¥é”ï¼Œä½†å®ƒè¿˜æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚è™½ç„¶ä¸Šé¢çš„ä¾‹å­ä¸ä¼šå‡ºç°å¤šæ¬¡åˆå§‹åŒ–LazyDoubleCheckSingletonå®ä¾‹çš„æƒ…å†µï¼Œä½†æ˜¯ç”±äºæŒ‡ä»¤é‡æ’çš„åŸå› ï¼ŒæŸäº›çº¿ç¨‹å¯èƒ½ä¼šè·å–åˆ°ç©ºå¯¹è±¡ï¼Œåç»­å¯¹è¯¥å¯¹è±¡çš„æ“ä½œå°†è§¦å‘ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><p>è¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€è¦é˜»æ­¢æŒ‡ä»¤é‡æ’å³å¯ï¼Œæ‰€ä»¥å¯ä»¥ç»™instanceå±æ€§åŠ ä¸Švolatileå…³é”®å­—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyDoubleCheckSingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> LazyDoubleCheckSingleton instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazyDoubleCheckSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazyDoubleCheckSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazyDoubleCheckSingleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> LazyDoubleCheckSingleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç›¸å…³åšæ–‡ï¼š<a href="/volatile.html">æ·±å…¥ç†è§£volatileå…³é”®å­—</a>ã€‚</p><p>ä¸Šé¢è¿™ç§å†™æ³•æ˜¯ä¸ä½†ç¡®ä¿äº†çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”å½“LazyDoubleCheckSingletonå®ä¾‹åˆ›å»ºå¥½åï¼Œåç»­å†è°ƒç”¨å…¶getInstanceæ–¹æ³•ä¸ä¼šä¸Šé”ã€‚</p><h4 id="é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼"><a href="#é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼" class="headerlink" title="é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼"></a>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼</h4><p>çœ‹ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticInnerClassSingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">StaticInnerClassSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> StaticInnerClassSingleton instance = <span class="keyword">new</span> StaticInnerClassSingleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StaticInnerClassSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> InnerClass.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¸ºä»€ä¹ˆè¿™ä¸ªä¾‹å­æ˜¯å¯è¡Œçš„å‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ol><li>JVMåœ¨ç±»çš„åˆå§‹åŒ–é˜¶æ®µä¼šåŠ Classå¯¹è±¡åˆå§‹åŒ–åŒæ­¥é”ï¼ŒåŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹è¯¥ç±»çš„åˆå§‹åŒ–æ“ä½œï¼›</li><li>é™æ€å†…éƒ¨ç±»InnerClassçš„é™æ€æˆå‘˜å˜é‡instanceåœ¨æ–¹æ³•åŒºä¸­åªä¼šæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</li></ol><p>åœ¨Javaè§„èŒƒä¸­ï¼Œå½“ä»¥ä¸‹è¿™äº›æƒ…å†µé¦–æ¬¡å‘ç”Ÿæ—¶ï¼ŒAç±»å°†ä¼šç«‹åˆ»è¢«åˆå§‹åŒ–ï¼š</p><ol><li>Aç±»å‹å®ä¾‹è¢«åˆ›å»ºï¼›</li><li>Aç±»ä¸­å£°æ˜çš„é™æ€æ–¹æ³•è¢«è°ƒç”¨ï¼›</li><li>Aç±»ä¸­çš„é™æ€æˆå‘˜å˜é‡è¢«èµ‹å€¼ï¼›</li><li>Aç±»ä¸­çš„é™æ€æˆå‘˜è¢«ä½¿ç”¨ï¼ˆéå¸¸é‡ï¼‰ï¼›</li></ol><h4 id="é¥¿æ±‰å•ä¾‹æ¨¡å¼"><a href="#é¥¿æ±‰å•ä¾‹æ¨¡å¼" class="headerlink" title="é¥¿æ±‰å•ä¾‹æ¨¡å¼"></a>é¥¿æ±‰å•ä¾‹æ¨¡å¼</h4><p>â€œé¥¿æ±‰â€æ„æŒ‡åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åˆå§‹åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungrySingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> HungrySingleton instance = <span class="keyword">new</span> HungrySingleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungrySingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™ç§æ¨¡å¼åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å®Œæˆäº†åˆå§‹åŒ–ï¼Œæ‰€ä»¥å¹¶ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ï¼›ä½†ç”±äºä¸æ˜¯æ‡’åŠ è½½ï¼Œé¥¿æ±‰æ¨¡å¼ä¸ç®¡éœ€ä¸éœ€è¦ç”¨åˆ°å®ä¾‹éƒ½è¦å»åˆ›å»ºå®ä¾‹ï¼Œå¦‚æœåˆ›å»ºäº†ä¸ä½¿ç”¨ï¼Œåˆ™ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚</p><h4 id="åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼"><a href="#åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼" class="headerlink" title="åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼"></a>åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼</h4><p>å‰é¢çš„å•ä¾‹ä¾‹å­åœ¨å®ç°åºåˆ—åŒ–æ¥å£åéƒ½èƒ½è¢«åºåˆ—åŒ–çš„æ–¹å¼ç ´åï¼Œæ¯”å¦‚HungrySingletonï¼Œè®©å…¶å®ç°åºåˆ—åŒ–æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungrySingleton</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">8073288969651806838L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> HungrySingleton instance = <span class="keyword">new</span> HungrySingleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungrySingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç„¶ååˆ›å»ºApplicationæµ‹è¯•ä¸€ä¸‹å¦‚ä½•ç ´åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">// æ¼”ç¤ºåºåˆ—åŒ–ç ´åå•ä¾‹</span></span><br><span class="line">        HungrySingleton instance = HungrySingleton.getInstance();</span><br><span class="line">        ObjectOutputStream outputStream = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"file"</span>));</span><br><span class="line">        outputStream.writeObject(instance);</span><br><span class="line"></span><br><span class="line">        ObjectInputStream inputStream = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"file"</span>));</span><br><span class="line">        HungrySingleton newInstance = (HungrySingleton) inputStream.readObject();</span><br><span class="line"></span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(newInstance);</span><br><span class="line">        System.out.println(instance == newInstance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cc.mrbird.design.pattern.creational.singleton.HungrySingleton@7f31245a</span><br><span class="line">cc.mrbird.design.pattern.creational.singleton.HungrySingleton@6d03e736</span><br><span class="line">false</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æ˜¯å•ä¾‹æ¨¡å¼ï¼Œä½†å´æˆåŠŸåˆ›å»ºå‡ºäº†ä¸¤ä¸ªä¸ä¸€æ ·çš„å®ä¾‹ï¼Œå•ä¾‹é­åˆ°äº†ç ´åã€‚</p><p>è¦è®©ååºåˆ—åŒ–åçš„å¯¹è±¡å’Œåºåˆ—åŒ–å‰çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„è¯ï¼Œå¯ä»¥åœ¨HungrySingletoné‡ŒåŠ ä¸ŠreadResolveæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungrySingleton</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">8073288969651806838L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> HungrySingleton instance = <span class="keyword">new</span> HungrySingleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungrySingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ–°å¢</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å†æ¬¡è¿è¡ŒApplicationçš„mainæ–¹æ³•åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cc.mrbird.design.pattern.creational.singleton.HungrySingleton@7f31245a</span><br><span class="line">cc.mrbird.design.pattern.creational.singleton.HungrySingleton@7f31245a</span><br><span class="line">true</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ–¹å¼æœ€ç»ˆååºåˆ—åŒ–å‡ºæ¥çš„å¯¹è±¡å’Œåºåˆ—åŒ–å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ä½†è¿™ç§æ–¹å¼ååºåˆ—åŒ–è¿‡ç¨‹å†…éƒ¨è¿˜æ˜¯ä¼šé‡æ–°åˆ›å»ºHungrySingletonå®ä¾‹ï¼Œåªä¸è¿‡å› ä¸ºHungrySingletonç±»å®šä¹‰äº†readResolveæ–¹æ³•ï¼ˆæ–¹æ³•å†…éƒ¨è¿”å›instanceå¼•ç”¨ï¼‰ï¼Œååºåˆ—åŒ–è¿‡ç¨‹ä¼šåˆ¤æ–­ç›®æ ‡ç±»æ˜¯å¦å®šä¹‰äº†readResolveè¯¥æ–¹æ³•ï¼Œæ˜¯çš„è¯åˆ™é€šè¿‡åå°„è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><h4 id="åå°„ç ´åå•ä¾‹æ¨¡å¼"><a href="#åå°„ç ´åå•ä¾‹æ¨¡å¼" class="headerlink" title="åå°„ç ´åå•ä¾‹æ¨¡å¼"></a>åå°„ç ´åå•ä¾‹æ¨¡å¼</h4><p>é™¤äº†åºåˆ—åŒ–èƒ½ç ´åå•ä¾‹å¤–ï¼Œåå°„ä¹Ÿå¯ä»¥ï¼Œä¸¾ä¸ªåå°„ç ´åHungrySingletonçš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HungrySingleton instance = HungrySingleton.getInstance();</span><br><span class="line">        <span class="comment">// åå°„åˆ›å»ºå®ä¾‹</span></span><br><span class="line">        Class&lt;HungrySingleton&gt; c = HungrySingleton.class;</span><br><span class="line">        <span class="comment">// è·å–æ„é€ å™¨</span></span><br><span class="line">        Constructor&lt;HungrySingleton&gt; constructor = c.getDeclaredConstructor();</span><br><span class="line">        <span class="comment">// æ‰“å¼€æ„é€ å™¨æƒé™</span></span><br><span class="line">        constructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        HungrySingleton newInstance = constructor.newInstance();</span><br><span class="line"></span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(newInstance);</span><br><span class="line">        System.out.println(instance == newInstance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cc.mrbird.design.pattern.creational.singleton.HungrySingleton@1b6d3586</span><br><span class="line">cc.mrbird.design.pattern.creational.singleton.HungrySingleton@4554617c</span><br><span class="line">false</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é€šè¿‡åå°„ç ´åäº†ç§æœ‰æ„é€ å™¨æƒé™ï¼ŒæˆåŠŸåˆ›å»ºäº†æ–°çš„å®ä¾‹ã€‚</p><p>å¯¹äºè¿™ç§æƒ…å†µï¼Œé¥¿æ±‰æ¨¡å¼ä¸‹çš„ä¾‹å­å¯ä»¥åœ¨æ„é€ å™¨ä¸­æ·»åŠ åˆ¤æ–­é€»è¾‘æ¥é˜²å¾¡ï¼ˆæ‡’æ±‰æ¨¡å¼çš„å°±æ²¡æœ‰åŠæ³•äº†ï¼‰ï¼Œæ¯”å¦‚ä¿®æ”¹HungrySingletonçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungrySingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> HungrySingleton instance = <span class="keyword">new</span> HungrySingleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungrySingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"forbidden"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å†æ¬¡è¿è¡ŒApplicationçš„mainæ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.reflect.InvocationTargetException</span><br><span class="line">    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">    at java.lang.reflect.Constructor.newInstance(Constructor.java:423)</span><br><span class="line">    at cc.mrbird.design.pattern.creational.singleton.Application.main(Application.java:33)</span><br><span class="line">Caused by: java.lang.RuntimeException: forbidden</span><br><span class="line">    at cc.mrbird.design.pattern.creational.singleton.HungrySingleton.&lt;init&gt;(HungrySingleton.java:16)</span><br><span class="line">    ... 5 more</span><br></pre></td></tr></table></figure><p></p><h4 id="æšä¸¾å•ä¾‹æ¨¡å¼"><a href="#æšä¸¾å•ä¾‹æ¨¡å¼" class="headerlink" title="æšä¸¾å•ä¾‹æ¨¡å¼"></a>æšä¸¾å•ä¾‹æ¨¡å¼</h4><p>æšä¸¾å•ä¾‹æ¨¡å¼æ˜¯æ¨èçš„å•ä¾‹æ¨¡å¼ï¼Œå®ƒä¸ä»…å¯ä»¥é˜²å¾¡åºåˆ—åŒ–æ”»å‡»ï¼Œä¹Ÿå¯ä»¥é˜²å¾¡åå°„æ”»å‡»ã€‚ä¸¾ä¸ªæšä¸¾å•ä¾‹æ¨¡å¼çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> EnumSingleton &#123;</span><br><span class="line"></span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EnumSingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>éªŒè¯ä¸‹æ˜¯å¦æ˜¯å•ä¾‹çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        EnumSingleton instance = EnumSingleton.getInstance();</span><br><span class="line">        instance.setData(<span class="keyword">new</span> Object());</span><br><span class="line">        EnumSingleton newInstance = EnumSingleton.getInstance();</span><br><span class="line"></span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(newInstance);</span><br><span class="line">        System.out.println(instance.getData());</span><br><span class="line">        System.out.println(newInstance.getData());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTANCE</span><br><span class="line">INSTANCE</span><br><span class="line">java.lang.Object@1b6d3586</span><br><span class="line">java.lang.Object@1b6d3586</span><br></pre></td></tr></table></figure><p></p><p>æµ‹è¯•ä¸‹åºåˆ—åŒ–æ”»å‡»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        EnumSingleton instance = EnumSingleton.getInstance();</span><br><span class="line">        instance.setData(<span class="keyword">new</span> Object());</span><br><span class="line">        ObjectOutputStream outputStream = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"file"</span>));</span><br><span class="line">        outputStream.writeObject(instance);</span><br><span class="line">       </span><br><span class="line">        ObjectInputStream inputStream = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"file"</span>));</span><br><span class="line">        EnumSingleton newInstance = (EnumSingleton) inputStream.readObject();</span><br><span class="line"></span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(newInstance);</span><br><span class="line">        System.out.println(instance == newInstance);</span><br><span class="line"></span><br><span class="line">        System.out.println(instance.getData());</span><br><span class="line">        System.out.println(newInstance.getData());</span><br><span class="line">        System.out.println(instance.getData() == newInstance.getData());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSTANCE</span><br><span class="line">INSTANCE</span><br><span class="line">true</span><br><span class="line">java.lang.Object@568db2f2</span><br><span class="line">java.lang.Object@568db2f2</span><br><span class="line">true</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–åçš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªã€‚</p><p>åŸç†ï¼šè·Ÿè¸ªObjectInputStream#readObjectæºç ï¼Œå…¶ä¸­å½“åç¼–è¯‘å¯¹è±¡ä¸ºæšä¸¾ç±»å‹æ—¶ï¼Œå°†è°ƒç”¨readEnumæ–¹æ³•ï¼š</p><p><img src="img/QQæˆªå›¾20191217155448.png" alt="QQæˆªå›¾20191217155448.png"></p><p>nameä¸ºæšä¸¾ç±»é‡Œçš„æšä¸¾å¸¸é‡ï¼Œå¯¹äºçº¿ç¨‹æ¥è¯´å®ƒæ˜¯å”¯ä¸€çš„ï¼Œå­˜åœ¨æ–¹æ³•åŒºï¼Œæ‰€ä»¥é€šè¿‡<code>Enum.valueOf((Class)cl, name)</code>æ–¹æ³•å¾—åˆ°çš„æšä¸¾å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªã€‚</p><p>å†æµ‹è¯•ä¸€ä¸‹åå°„æ”»å‡»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        EnumSingleton instance = EnumSingleton.getInstance();</span><br><span class="line"></span><br><span class="line">        Class&lt;EnumSingleton&gt; c = EnumSingleton.class;</span><br><span class="line">        <span class="comment">// æšä¸¾ç±»åªåŒ…å«ä¸€ä¸ª(String,int)ç±»å‹æ„é€ å™¨</span></span><br><span class="line">        Constructor&lt;EnumSingleton&gt; constructor = c.getDeclaredConstructor(String.class, <span class="keyword">int</span>.class);</span><br><span class="line">        constructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        EnumSingleton newInstance = constructor.newInstance(<span class="string">"hello"</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(instance == newInstance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿è¡Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Cannot reflectively create enum objects</span><br><span class="line">    at java.lang.reflect.Constructor.newInstance(Constructor.java:417)</span><br><span class="line">    at cc.mrbird.design.pattern.creational.singleton.Application.main(Application.java:71)</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°æŠ›å¼‚å¸¸äº†ï¼ŒæŸ¥çœ‹Constructorç±»çš„417è¡Œä»£ç å¯ä»¥å‘ç°åŸå› ï¼š <img src="img/QQæˆªå›¾20191217160647.png" alt="QQæˆªå›¾20191217160647.png"></p><p>Javaç¦æ­¢é€šè¿‡åå°„åˆ›å»ºæšä¸¾å¯¹è±¡ã€‚</p><p>æ­£æ˜¯å› ä¸ºæšä¸¾ç±»å‹æ‹¥æœ‰è¿™äº›å¤©ç„¶çš„ä¼˜åŠ¿ï¼Œæ‰€ä»¥ç”¨å®ƒåˆ›å»ºå•ä¾‹æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œè¿™ä¹Ÿæ˜¯Effective Javaæ¨èçš„æ–¹å¼ã€‚</p><h3 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h3><p>åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œé€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p><p>é€‚ç”¨äºï¼š</p><ol><li>ç±»åˆå§‹åŒ–æ¶ˆè€—è¾ƒå¤šèµ„æºï¼›</li><li>å¾ªç¯ä½“ä¸­ç”Ÿäº§å¤§é‡å¯¹è±¡çš„æ—¶å€™ã€‚</li></ol><p>ä¼˜ç‚¹ï¼š</p><ol><li>åŸå‹æ¨¡å¼æ€§èƒ½æ¯”ç›´æ¥newä¸€ä¸ªå¯¹è±¡æ€§èƒ½å¥½ï¼›</li><li>ç®€åŒ–åˆ›å»ºå¯¹è±¡è¿‡ç¨‹ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å¯¹è±¡å¿…é¡»é‡å†™Objectå…‹éš†æ–¹æ³•ï¼›</li><li>å¤æ‚å¯¹è±¡çš„å…‹éš†æ–¹æ³•å†™èµ·æ¥è¾ƒéº»çƒ¦ï¼ˆæ·±å…‹éš†ã€æµ…å…‹éš†ï¼‰</li></ol><p>ä¸¾ä¾‹ï¼šæ–°å»ºä¸€ä¸ªå­¦ç”Ÿç±»Studentï¼Œå®ç°å…‹éš†æ¥å£ï¼Œå¹¶é‡å†™Objectçš„å…‹éš†æ–¹æ³•ï¼ˆå› ä¸ºéƒ½æ˜¯ç®€å•å±æ€§ï¼Œæ‰€ä»¥æµ…å…‹éš†å³å¯ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Student&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨Applicationä¸­æµ‹è¯•ä¸€æ³¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        ArrayList&lt;Student&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            Student s = (Student) student.clone();</span><br><span class="line">            s.setName(<span class="string">"å­¦ç”Ÿ"</span> + i);</span><br><span class="line">            s.setAge(<span class="number">20</span> + i);</span><br><span class="line">            list.add(s);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Student&#123;name=<span class="string">'å­¦ç”Ÿ0'</span>, age=<span class="number">20</span>&#125;, Student&#123;name=<span class="string">'å­¦ç”Ÿ1'</span>, age=<span class="number">21</span>&#125;, Student&#123;name=<span class="string">'å­¦ç”Ÿ2'</span>, age=<span class="number">22</span>&#125;]</span><br></pre></td></tr></table></figure><p></p><p>è¿™ç§æ–¹å¼ä¼šæ¯”ç›´æ¥åœ¨å¾ªç¯ä¸­åˆ›å»ºStudentæ€§èƒ½å¥½ã€‚</p><p>å½“å¯¹è±¡åŒ…å«å¼•ç”¨ç±»å‹å±æ€§æ—¶ï¼Œéœ€è¦ä½¿ç”¨æ·±å…‹éš†ï¼Œæ¯”å¦‚StudentåŒ…å«Dateå±æ€§æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Student&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", birthday="</span> + birthday +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        Student student = (Student) <span class="keyword">super</span>.clone();</span><br><span class="line">        <span class="comment">// å¼•ç”¨ç±»å‹æ·±å…‹éš†</span></span><br><span class="line">        Date birthday = (Date) student.getBirthday().clone();</span><br><span class="line">        student.setBirthday(birthday);</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå…‹éš†ä¼šç ´åå®ç°äº†Cloneableæ¥å£çš„å•ä¾‹å¯¹è±¡ã€‚</p><h2 id="ç»“æ„å‹æ¨¡å¼"><a href="#ç»“æ„å‹æ¨¡å¼" class="headerlink" title="ç»“æ„å‹æ¨¡å¼"></a>ç»“æ„å‹æ¨¡å¼</h2><h3 id="å¤–è§‚æ¨¡å¼"><a href="#å¤–è§‚æ¨¡å¼" class="headerlink" title="å¤–è§‚æ¨¡å¼"></a>å¤–è§‚æ¨¡å¼</h3><p>å¤–è§‚æ¨¡å¼åˆå«é—¨é¢æ¨¡å¼ï¼Œæä¾›äº†ç»Ÿä¸€å¾—æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ã€‚</p><p>é€‚ç”¨äºï¼š</p><ol><li>å­ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œå¢åŠ å¤–è§‚æ¨¡å¼æä¾›ç®€å•æ¥å£è°ƒç”¨ï¼›</li><li>æ„å»ºå¤šå±‚ç³»ç»Ÿç»“æ„ï¼Œåˆ©ç”¨å¤–è§‚å¯¹è±¡ä½œä¸ºæ¯å±‚çš„å…¥å£ï¼Œç®€åŒ–å±‚é—´è°ƒç”¨ã€‚</li></ol><p>ä¼˜ç‚¹ï¼š</p><ol><li>ç®€åŒ–äº†è°ƒç”¨è¿‡ç¨‹ï¼Œæ— éœ€äº†è§£æ·±å…¥å­ç³»ç»Ÿï¼›</li><li>å‡ä½è€¦åˆåº¦ï¼›</li><li>æ›´å¥½çš„å±‚æ¬¡åˆ’åˆ†ï¼›</li><li>ç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å¢åŠ å­ç³»ç»Ÿï¼Œæ‹“å±•å­ç³»ç»Ÿè¡Œä¸ºå®¹æ˜“å¼•å…¥é£é™©ï¼›</li><li>ä¸ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li></ol><p>ä¸¾ä¸ªè®¢å¤–å–çš„ä¾‹å­ã€‚</p><p>åˆ›å»ºä¸€ä¸ªå¤–å–å®ä½“ç±»Takeawayï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Takeaway</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è®¢å¤–å–è¿‡ç¨‹ä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šä¸‹å•ã€æ”¯ä»˜å’Œé…é€ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªServiceå¯¹åº”è¿™ä¸‰ä¸ªè¿‡ç¨‹ã€‚æ–°å»ºä¸‹å•æœåŠ¡OrderServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">placeAnOrder</span><span class="params">(Takeaway takeaway)</span> </span>&#123;</span><br><span class="line">        System.out.println(takeaway.getName() + <span class="string">"ä¸‹å•æˆåŠŸ"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºæ”¯ä»˜æœåŠ¡PayServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">pay</span><span class="params">(Takeaway takeaway)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å•†å“"</span> + takeaway.getName() + <span class="string">"æ”¯ä»˜æˆåŠŸ"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºé…é€æœåŠ¡DeliveryServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeliveryService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delivery</span><span class="params">(Takeaway takeaway)</span> </span>&#123;</span><br><span class="line">        System.out.println(takeaway.getName() + <span class="string">"å·²ç”±éª‘æ‰‹XXæ¥å•ï¼Œè®¢å•æ´¾é€ä¸­"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åŸºäºå¤–è§‚æ¨¡å¼æ³•åˆ™ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªServiceæ¥èšåˆè¿™ä¸‰ä¸ªæœåŠ¡ï¼Œå®¢æˆ·ç«¯åªéœ€è¦å’Œè¿™ä¸ªServiceäº¤äº’å³å¯ã€‚æ–°å»ºå¤–å–æœåŠ¡TakeawayServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TakeawayService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService = <span class="keyword">new</span> OrderService();</span><br><span class="line">    <span class="keyword">private</span> PayService payService = <span class="keyword">new</span> PayService();</span><br><span class="line">    <span class="keyword">private</span> DeliveryService deliveryService = <span class="keyword">new</span> DeliveryService();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeOrder</span><span class="params">(Takeaway takeaway)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (orderService.placeAnOrder(takeaway)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (payService.pay(takeaway)) &#123;</span><br><span class="line">                deliveryService.delivery(takeaway);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºä¸ªå®¢æˆ·ç«¯æµ‹è¯•ä¸€æ³¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Takeaway takeaway = <span class="keyword">new</span> Takeaway();</span><br><span class="line">        takeaway.setName(<span class="string">"æ³¡æ¤’ğŸ¸"</span>);</span><br><span class="line"></span><br><span class="line">        TakeawayService takeawayService = <span class="keyword">new</span> TakeawayService();</span><br><span class="line">        takeawayService.takeOrder(takeaway);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯åªéœ€è¦è°ƒç”¨TakeawayServiceå³å¯ï¼Œæ— éœ€å…³ç³»å†…éƒ¨å…·ä½“ç»å†äº†å¤šå°‘ä¸ªæ­¥éª¤ï¼Œè¿è¡Œmainæ–¹æ³•è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ³¡æ¤’ğŸ¸ä¸‹å•æˆåŠŸ</span><br><span class="line">å•†å“æ³¡æ¤’ğŸ¸æ”¯ä»˜æˆåŠŸ</span><br><span class="line">æ³¡æ¤’ğŸ¸å·²ç”±éª‘æ‰‹XXæ¥å•ï¼Œè®¢å•æ´¾é€ä¸­</span><br></pre></td></tr></table></figure><p></p><p>è¯¥ä¾‹å­çš„UMLå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQæˆªå›¾20191218151629.png" alt="QQæˆªå›¾20191218151629.png"></p><h3 id="è£…é¥°è€…æ¨¡å¼"><a href="#è£…é¥°è€…æ¨¡å¼" class="headerlink" title="è£…é¥°è€…æ¨¡å¼"></a>è£…é¥°è€…æ¨¡å¼</h3><p>åœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¹‹ä¸Šï¼Œå°†åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œæä¾›äº†æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>é€‚ç”¨äºï¼š</p><ol><li>æ‹“å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ï¼›</li><li>åŠ¨æ€ç»™å¯¹è±¡æ·»åŠ åŠŸèƒ½ï¼Œå¹¶ä¸”åŠ¨æ€æ’¤é”€ã€‚</li></ol><p>ä¼˜ç‚¹ï¼š</p><ol><li>ç»§æ‰¿çš„æœ‰åŠ›è¡¥å……ï¼Œä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹ç»™å¯¹è±¡æ‹“å±•åŠŸèƒ½ï¼›</li><li>é€šè¿‡ä½¿ç”¨ä¸åŒçš„è£…é¥°ç±»ã€ä¸åŒçš„ç»„åˆæ–¹å¼ï¼Œå®ç°ä¸åŒçš„æ•ˆæœã€‚</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å¢åŠ ç¨‹åºå¤æ‚æ€§ï¼›</li></ol><p>ä¸¾ä¸ªæ°´æœæ²™æ‹‰çš„ä¾‹å­ã€‚</p><p>æ¯”å¦‚åœ¨ç‚¹æ°´æœæ²™æ‹‰å¤–å–æ—¶ï¼Œå¯ä»¥å¾€æ°´æœæ²™æ‹‰é‡ŒåŠ å„ç§æ°´æœï¼Œä»·æ ¼ä¹Ÿä¼šç›¸åº”çš„è°ƒæ•´ï¼Œè¦è®©ç¨‹åºæ”¯æŒä¸åŒæ°´æœè‡ªç”±ç»„åˆï¼Œå¹¶è®¡ç®—ç›¸åº”çš„ä»·æ ¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è£…é¥°è€…æ¨¡å¼æ¥å®Œæˆã€‚</p><p>å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„æ°´æœæ²™æ‹‰ç±»AbstractFruitSaladï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractFruitSalad</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">remark</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">price</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åŒ…å«å¤‡æ³¨å’Œä»·æ ¼æŠ½è±¡æ–¹æ³•ã€‚</p><p>æ¥ç€åˆ›å»ºä¸€ä¸ªæŠ½è±¡çš„è£…é¥°å™¨AbstractDecoratorï¼ˆå…³é”®ç‚¹ï¼Œç»§æ‰¿æŠ½è±¡æ°´æœæ²™æ‹‰ç±»ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractDecorator</span> <span class="keyword">extends</span> <span class="title">AbstractFruitSalad</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AbstractFruitSalad fruitSalad;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AbstractDecorator</span><span class="params">(AbstractFruitSalad fruitSalad)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fruitSalad = fruitSalad;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">remark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fruitSalad.remark();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fruitSalad.price();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åˆ›å»ºå…·ä½“çš„æ°´æœæ²™æ‹‰ç±»FruitSaladï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitSalad</span> <span class="keyword">extends</span> <span class="title">AbstractFruitSalad</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">remark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æ°´æœğŸ¥—ï¼ˆæ ‡å‡†ï¼‰\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¯¥æ²™æ‹‰æ˜¯æ ‡å‡†çš„æ°´æœæ²™æ‹‰ï¼Œä»·æ ¼æ˜¯9å…ƒã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„æ°´æœæ²™æ‹‰è¿˜å…è®¸å®¢æˆ·æ·»åŠ çŒ•çŒ´æ¡ƒå’Œè¥¿ç“œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸¤ä¸ªæ–°çš„è£…é¥°å™¨ã€‚æ·»åŠ çŒ•çŒ´æ¡ƒè£…é¥°å™¨KiwiDecoratorï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KiwiDecorator</span> <span class="keyword">extends</span> <span class="title">AbstractDecorator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KiwiDecorator</span><span class="params">(AbstractFruitSalad fruitSalad)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(fruitSalad);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">remark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.remark() + <span class="string">"åŠ ä»½ğŸ¥åˆ‡\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.price() + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŠ ä¸€ä»½çŒ•çŒ´æ¡ƒéœ€è¦åœ¨åŸæœ‰åŸºç¡€ä¸ŠåŠ 2å…ƒã€‚</p><p>æ¥ç€ç»§ç»­åˆ›å»ºè¥¿ç“œè£…é¥°å™¨WaterMelonDecoratorï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaterMelonDecorator</span> <span class="keyword">extends</span> <span class="title">AbstractDecorator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WaterMelonDecorator</span><span class="params">(AbstractFruitSalad fruitSalad)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(fruitSalad);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">remark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.remark() + <span class="string">"åŠ ä»½ğŸ‰åˆ‡\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.price() + <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æœ€ååˆ›å»ºå®¢æˆ·ç«¯Applicationæµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç‚¹äº†ä»½æ°´æœæ²™æ‹‰ï¼Œå¹¶åŠ äº†ä¸¤ä»½ğŸ¥å’Œä¸€ä»½ğŸ‰ï¼Œçœ‹çœ‹æœ€ç»ˆä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ</span></span><br><span class="line">        AbstractFruitSalad fruitSalad = <span class="keyword">new</span> FruitSalad();</span><br><span class="line">        fruitSalad = <span class="keyword">new</span> KiwiDecorator(fruitSalad);</span><br><span class="line">        fruitSalad = <span class="keyword">new</span> KiwiDecorator(fruitSalad);</span><br><span class="line">        fruitSalad = <span class="keyword">new</span> WaterMelonDecorator(fruitSalad);</span><br><span class="line"></span><br><span class="line">        System.out.println(fruitSalad.remark() + <span class="string">"ä»·æ ¼æ˜¯ï¼š"</span> + fruitSalad.price());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¸Šé¢çš„å†™æ³•ä¹Ÿå¯ä»¥æ”¹ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç‚¹äº†ä»½æ°´æœæ²™æ‹‰ï¼Œå¹¶åŠ äº†ä¸¤ä»½ğŸ¥å’Œä¸€ä»½ğŸ‰ï¼Œçœ‹çœ‹æœ€ç»ˆä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ</span></span><br><span class="line">        AbstractFruitSalad fruitSalad = <span class="keyword">new</span> FruitSalad();</span><br><span class="line">        fruitSalad = <span class="keyword">new</span> WaterMelonDecorator(<span class="keyword">new</span> KiwiDecorator(<span class="keyword">new</span> KiwiDecorator(fruitSalad)));</span><br><span class="line"></span><br><span class="line">        System.out.println(fruitSalad.remark() + <span class="string">"ä»·æ ¼æ˜¯ï¼š"</span> + fruitSalad.price());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ°´æœğŸ¥—ï¼ˆæ ‡å‡†ï¼‰</span><br><span class="line">åŠ ä»½ğŸ¥åˆ‡</span><br><span class="line">åŠ ä»½ğŸ¥åˆ‡</span><br><span class="line">åŠ ä»½ğŸ‰åˆ‡</span><br><span class="line">ä»·æ ¼æ˜¯ï¼š16</span><br></pre></td></tr></table></figure><p></p><p>é€šè¿‡ä¸åŒçš„è£…é¥°å™¨è‡ªç”±ç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»çš„ç»„è£…å‡ºå„å¼å„æ ·çš„æ°´æœæ²™æ‹‰ï¼Œè¿™æ­£æ˜¯è£…é¥°è€…æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œä½†æ˜æ˜¾å¯ä»¥çœ‹å‡ºä»£ç å˜å¤æ‚äº†ã€‚</p><p>è¿™ä¸ªä¾‹å­çš„UMLå›¾å¦‚ä¸‹æ‰€ç¤º:</p><p><img src="img/QQæˆªå›¾20191218172739.png" alt="QQæˆªå›¾20191218172739.png"></p><h3 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h3><p>å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢ä¸ºæœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿åŸæœ¬ä¸å…¼å®¹çš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚</p><p>é€‚ç”¨äºï¼š</p><ol><li>å·²å­˜åœ¨çš„ç±»ï¼Œå®ƒçš„æ–¹æ³•å’Œéœ€æ±‚ä¸åŒ¹é…æ—¶ï¼ˆæ–¹æ³•ç»“æœç›¸åŒæˆ–è€…ç›¸ä¼¼ï¼‰</li></ol><p>ä¼˜ç‚¹:</p><ol><li>æé«˜ç±»çš„é€æ˜æ€§å’Œå¤ç”¨ï¼Œç°æœ‰çš„ç±»å¤ç”¨ä½†ä¸éœ€æ”¹å˜ï¼›</li><li>ç›®æ ‡ç±»å’Œé€‚é…å™¨ç±»è§£è€¦ï¼Œæé«˜ç¨‹åºæ‹“å±•æ€§ï¼›</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>é€‚é…å™¨ç¼–å†™è¿‡ç¨‹éœ€è¦å…¨é¢è€ƒè™‘ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ï¼›</li><li>é™ä½ä»£ç å¯è¯»æ€§ã€‚</li></ol><p>åˆ†ä¸ºï¼šç±»é€‚é…å™¨æ¨¡å¼å’Œå¯¹è±¡é€‚é…å™¨æ¨¡å¼ã€‚</p><p>å…ˆä¸¾ä¸ªç±»é€‚é…å™¨æ¨¡å¼çš„ä¾‹å­ï¼š</p><p>å‡å¦‚é¡¹ç›®é‡ŒåŸæœ‰ä¸€æ¡æ°´æœçš„äº§å“çº¿ï¼Œæ¯”å¦‚åŒ…å«ä¸€ä¸ªæ ‘è“ç±»Raspberryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Raspberry</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRaspberry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ·»åŠ ç‚¹æ ‘è“"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>éšç€é¡¹ç›®çš„æ‹“å±•ï¼Œç°åœ¨æ–°å¢äº†æ°´æœæ´¾äº§å“çº¿ï¼Œæ–°å»ºPieæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Pie</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">make</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¦å°†RaspberryåŠ å…¥åˆ°Pieäº§å“çº¿ï¼Œåˆä¸æƒ³ä¿®æ”¹Raspberryç±»çš„ä»£ç ï¼Œåˆ™å¯ä»¥åˆ›å»ºä¸€ä¸ªé€‚é…å™¨RaspberryPieAdaptorï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RaspberryPieAdaptor</span> <span class="keyword">extends</span> <span class="title">Raspberry</span> <span class="keyword">implements</span> <span class="title">Pie</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ¶ä½œä¸€ä¸ªæ´¾ğŸ¥§"</span>);</span><br><span class="line">        <span class="keyword">super</span>.addRaspberry();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é€‚é…å™¨ç»§æ‰¿è¢«é€‚é…çš„ç±»ï¼Œå®ç°æ–°çš„äº§å“çº¿æ¥å£ã€‚</p><p>åœ¨Applicationé‡Œæµ‹è¯•ä¸€æ³¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pie pie = <span class="keyword">new</span> RaspberryPieAdaptor();</span><br><span class="line">        pie.make();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åˆ¶ä½œä¸€ä¸ªæ´¾ğŸ¥§</span><br><span class="line">æ·»åŠ ç‚¹æ ‘è“</span><br></pre></td></tr></table></figure><p></p><p>æˆåŠŸé€šè¿‡é€‚é…å™¨åˆ¶é€ äº†æ ‘è“æ´¾ã€‚ç±»é€‚é…å™¨æ¨¡å¼çš„UMLå›¾å¾ˆç®€å•ï¼š</p><p><img src="img/QQæˆªå›¾20191219105058.png" alt="QQæˆªå›¾20191219105058.png"></p><p>å¯¹è±¡é€‚é…å™¨æ¨¡å¼åªéœ€è¦å°†RaspberryPieAdaptorä¿®æ”¹ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RaspberryPieAdaptor</span> <span class="keyword">implements</span> <span class="title">Pie</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Raspberry raspberry = <span class="keyword">new</span> Raspberry();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ¶ä½œä¸€ä¸ªæ´¾ğŸ¥§"</span>);</span><br><span class="line">        raspberry.addRaspberry();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™ç§æ¨¡å¼ä¸ç›´æ¥ç»§æ‰¿è¢«é€‚é…è€…ï¼Œè€Œæ˜¯åœ¨é€‚é…å™¨é‡Œåˆ›å»ºè¢«é€‚é…è€…ã€‚è¿™ç§æ¨¡å¼çš„UMLå›¾ï¼š</p><p><img src="img/QQæˆªå›¾20191219110730.png" alt="QQæˆªå›¾20191219110730.png"></p><h3 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h3><p>æä¾›äº†å‡å°‘å¯¹è±¡æ•°é‡ä»è€Œæ”¹å–„åº”ç”¨æ‰€éœ€çš„å¯¹è±¡ç»“æ„çš„æ–¹å¼ï¼Œè¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚</p><p>é€‚ç”¨äºï¼š</p><ol><li>åº•å±‚ç³»ç»Ÿå¼€å‘ï¼Œè§£å†³æ€§èƒ½é—®é¢˜ï¼›</li><li>ç³»ç»Ÿæ‹¥æœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œéœ€è¦ç¼“å†²æ± çš„åœºæ™¯ã€‚</li></ol><p>ä¼˜ç‚¹ï¼š</p><ol><li>å‡å°‘å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½å†…å­˜å ç”¨ï¼›</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å…³æ³¨å†…/å¤–éƒ¨çŠ¶æ€ï¼Œå…³æ³¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›</li><li>ç¨‹åºçš„é€»è¾‘å¤æ‚åŒ–ã€‚</li></ol><p>å†…éƒ¨çŠ¶æ€ï¼šç®€å•ç†è§£ä¸ºäº«å…ƒå¯¹è±¡çš„å±æ€§çŠ¶æ€ï¼Œä¸ä¼šå› ä¸ºå¤–éƒ¨çš„æ”¹å˜è€Œæ”¹å˜ï¼› å¤–éƒ¨çŠ¶æ€ï¼šç®€å•ç†è§£ä¸ºæ–¹æ³•å‚æ•°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ–°å»ºæ´¾ğŸ¥§æ¥å£Pieï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Pie</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">make</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å…¶å®ç°ç±»æ°´æœæ´¾FruitPieï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitPie</span> <span class="keyword">implements</span> <span class="title">Pie</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime productTime;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FruitPie</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductTime</span><span class="params">(LocalDateTime productTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productTime = productTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            System.out.println(name + <span class="string">"ç”Ÿäº§æ—¶é—´ï¼š"</span> + <span class="keyword">this</span>.productTime);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åŒ…å«åç§°å’Œç”Ÿäº§æ—¥æœŸå±æ€§ï¼Œå¹¶ä¸”æœ‰ä¸ªmakeæ–¹æ³•ã€‚</p><p>æ¥ç€åˆ›å»ºç”Ÿäº§FruitPieçš„å·¥å‚FruitPieFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitPieFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HashMap&lt;String, FruitPie&gt; PIE_HASH_MAP = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> FruitPie <span class="title">produce</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        FruitPie fruitPie = PIE_HASH_MAP.get(name);</span><br><span class="line">        <span class="keyword">if</span> (fruitPie == <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ²¡æœ‰"</span> + name + <span class="string">"åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ..."</span>);</span><br><span class="line">            fruitPie = <span class="keyword">new</span> FruitPie(name);</span><br><span class="line">            PIE_HASH_MAP.put(name, fruitPie);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fruitPie;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä»£ç å…³é”®æ˜¯é€šè¿‡HashMapå­˜å‚¨å¯¹è±¡ã€‚</p><p>ç¼–å†™ä¸ªæµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] PIE = &#123;<span class="string">"ğŸ‡æ´¾"</span>, <span class="string">"ğŸˆæ´¾"</span>, <span class="string">"ğŸ“æ´¾"</span>, <span class="string">"ğŸ’æ´¾"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IntStream.range(<span class="number">0</span>, <span class="number">10</span>).forEach((i) -&gt; &#123;</span><br><span class="line">            String name = PIE[(<span class="keyword">int</span>) (Math.random() * PIE.length)];</span><br><span class="line">            FruitPie fruitPie = FruitPieFactory.produce(name);</span><br><span class="line">            fruitPie.setProductTime(LocalDateTime.now());</span><br><span class="line">            fruitPie.make();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">æ²¡æœ‰ğŸ“æ´¾åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ...</span><br><span class="line">ğŸ“æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.397</span><br><span class="line">æ²¡æœ‰ğŸ‡æ´¾åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ...</span><br><span class="line">ğŸ‡æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.498</span><br><span class="line">ğŸ‡æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.599</span><br><span class="line">æ²¡æœ‰ğŸ’æ´¾åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ...</span><br><span class="line">ğŸ’æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.700</span><br><span class="line">ğŸ’æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.800</span><br><span class="line">ğŸ’æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.901</span><br><span class="line">æ²¡æœ‰ğŸˆæ´¾åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ...</span><br><span class="line">ğŸˆæ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:27.002</span><br><span class="line">ğŸ“æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:27.103</span><br><span class="line">ğŸ‡æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:27.203</span><br><span class="line">ğŸ‡æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:27.304</span><br></pre></td></tr></table></figure><p></p><p>ä»ç»“æœçœ‹ï¼Œåœ¨10æ¬¡å¾ªç¯ä¸­ï¼Œåªç”Ÿäº§äº†4ä¸ªå¯¹è±¡ï¼Œè¿™å¾ˆå¥½çš„æè¿°äº†ç³»ç»Ÿæœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œéœ€è¦ç¼“å†²æ± çš„åœºæ™¯ã€‚</p><p>JDKä¸­çš„å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œæ•°æ®åº“è¿æ¥æ± ç­‰éƒ½æ˜¯ç”¨çš„äº«å…ƒæ¨¡å¼ã€‚</p><h3 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h3><p>å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿å®¢æˆ·ç«¯å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ä¿æŒä¸€è‡´çš„æ–¹å¼å¤„ç†ã€‚</p><p>é€‚ç”¨äºï¼š</p><ol><li>å®¢æˆ·ç«¯å¯ä»¥å¿½ç•¥ç»„åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„å·®å¼‚ï¼›</li><li>å¤„ç†æ ‘å½¢ç»“æ„æ•°æ®ã€‚</li></ol><p>ä¼˜ç‚¹:</p><ol><li>å±‚æ¬¡æ¸…æ™°ï¼›</li><li>å®¢æˆ·ç«¯ä¸å¿…å…³ç³»å±‚æ¬¡å·®å¼‚ï¼Œæ–¹ä¾¿æ§åˆ¶ï¼›</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>æ ‘å½¢å¤„ç†è¾ƒä¸ºå¤æ‚ã€‚</li></ol><p>ä¸¾ä¸ªèœå•æŒ‰é’®ç»„æˆçš„æ ‘å½¢ä¾‹å­ã€‚</p><p>æ–°å»ºèœå•æŒ‰é’®çš„ç»„åˆæŠ½è±¡ç±»AbstractMenuButtonï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractMenuButton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(AbstractMenuButton abstractMenuButton)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"ä¸æ”¯æŒåˆ›å»ºæ“ä½œ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"ä¸æ”¯æŒåç§°è·å–"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"ä¸æ”¯æŒç±»å‹è·å–"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getIcon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"ä¸æ”¯æŒå›¾æ ‡"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"ä¸æ”¯æŒæ‰“å°æ“ä½œ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç»„åˆäº†èœå•æŒ‰é’®æ“ä½œçš„åŸºæœ¬æ–¹æ³•ã€‚</p><p>æ–°å¢æŒ‰é’®ç±»Buttonï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">AbstractMenuButton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Button</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æŒ‰é’®"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(getName() + <span class="string">"ã€"</span> + getType() + <span class="string">"ã€‘"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æŒ‰é’®æ‹¥æœ‰åç§°å±æ€§ï¼Œå¹¶ä¸”æ”¯æŒåç§°è·å–ï¼Œç±»å‹è·å–å’Œæ‰“å°æ–¹æ³•ï¼Œæ‰€ä»¥é‡å†™äº†è¿™ä¸‰ä¸ªçˆ¶ç±»æ–¹æ³•ã€‚</p><p>æ¥ç€æ–°å»ºèœå•ç±»Menuï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">extends</span> <span class="title">AbstractMenuButton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;AbstractMenuButton&gt; items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line">    <span class="keyword">private</span> Integer level;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Menu</span><span class="params">(String name, String icon, Integer level)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.icon = icon;</span><br><span class="line">        <span class="keyword">this</span>.level = level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(AbstractMenuButton abstractMenuButton)</span> </span>&#123;</span><br><span class="line">        items.add(abstractMenuButton);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"èœå•"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getIcon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.icon;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(getIcon() + getName() + <span class="string">"ã€"</span> + getType() + <span class="string">"ã€‘"</span>);</span><br><span class="line">        <span class="keyword">for</span> (AbstractMenuButton item : items) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.level != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.level; i++) &#123;</span><br><span class="line">                    System.out.print(<span class="string">"    "</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            item.print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>èœå•åŒ…å«åç§°ã€å›¾æ ‡å’Œå±‚çº§å±æ€§ï¼Œå¹¶ä¸”èœå•å¯ä»¥åŒ…å«ä¸‹çº§ï¼ˆæ¯”å¦‚ä¸‹çº§èœå•ï¼Œä¸‹çº§æŒ‰é’®ï¼‰ï¼Œæ‰€ä»¥å®ƒåŒ…å«ä¸€ä¸ªList<abstractmenubutton>ç±»å‹çš„å±æ€§itemsã€‚</abstractmenubutton></p><p>æ­¤å¤–ï¼Œèœå•åŒ…å«æ·»åŠ ä¸‹çº§ã€åç§°è·å–ã€ç±»å‹è·å–ã€å›¾æ ‡è·å–å’Œæ‰“å°æ–¹æ³•ã€‚</p><p>æ–°å»ºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæµ‹è¯•èœå•æŒ‰é’®çš„å±‚çº§ç»“æ„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Menu userMenu = <span class="keyword">new</span> Menu(<span class="string">"ç”¨æˆ·ç®¡ç†"</span>, <span class="string">"ğŸ§‘"</span>, <span class="number">2</span>);</span><br><span class="line">        Button createUser = <span class="keyword">new</span> Button(<span class="string">"æ–°å¢ç”¨æˆ·"</span>);</span><br><span class="line">        Button updateUser = <span class="keyword">new</span> Button(<span class="string">"ä¿®æ”¹ç”¨æˆ·"</span>);</span><br><span class="line">        Button deleteUser = <span class="keyword">new</span> Button(<span class="string">"åˆ é™¤ç”¨æˆ·"</span>);</span><br><span class="line">        userMenu.add(createUser);</span><br><span class="line">        userMenu.add(updateUser);</span><br><span class="line">        userMenu.add(deleteUser);</span><br><span class="line"></span><br><span class="line">        Menu logMenu = <span class="keyword">new</span> Menu(<span class="string">"æ“ä½œæ—¥å¿—"</span>, <span class="string">"ğŸ“ƒ"</span>, <span class="number">2</span>);</span><br><span class="line">        Button export = <span class="keyword">new</span> Button(<span class="string">"å¯¼å‡ºExcel"</span>);</span><br><span class="line">        logMenu.add(export);</span><br><span class="line"></span><br><span class="line">        Menu systemMenu = <span class="keyword">new</span> Menu(<span class="string">"ç³»ç»Ÿç®¡ç†"</span>, <span class="string">"ğŸ”¨"</span>, <span class="number">1</span>);</span><br><span class="line">        systemMenu.add(userMenu);</span><br><span class="line">        systemMenu.add(logMenu);</span><br><span class="line"></span><br><span class="line">        systemMenu.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ‰“å°è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ğŸ”¨ç³»ç»Ÿç®¡ç†ã€èœå•ã€‘</span><br><span class="line">    ğŸ§‘ç”¨æˆ·ç®¡ç†ã€èœå•ã€‘</span><br><span class="line">        æ–°å¢ç”¨æˆ·ã€æŒ‰é’®ã€‘</span><br><span class="line">        ä¿®æ”¹ç”¨æˆ·ã€æŒ‰é’®ã€‘</span><br><span class="line">        åˆ é™¤ç”¨æˆ·ã€æŒ‰é’®ã€‘</span><br><span class="line">    ğŸ“ƒæ“ä½œæ—¥å¿—ã€èœå•ã€‘</span><br><span class="line">        å¯¼å‡ºExcelã€æŒ‰é’®ã€‘</span><br></pre></td></tr></table></figure><p></p><p>UMLå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQæˆªå›¾20191219190427.png" alt="QQæˆªå›¾20191219190427.png"></p><h3 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h3><p>å°†æŠ½è±¡éƒ¨åˆ†å’Œå…·ä½“å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚é€šè¿‡ç»„åˆçš„æ–¹å¼å»ºç«‹ä¸¤ä¸ªç±»ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿ã€‚</p><p>é€‚ç”¨äºï¼š</p><ol><li>æŠ½è±¡å’Œå®ä½“å®ç°ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§ï¼›</li><li>ä¸€ä¸ªç±»å­˜åœ¨å¤šä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œå¹¶ä¸”éœ€è¦ç‹¬ç«‹æ‹“å±•ï¼›</li><li>ä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿ã€‚</li></ol><p>ä¼˜ç‚¹ï¼š</p><ol><li>åˆ†ç¦»æŠ½è±¡éƒ¨åˆ†å’Œå…·ä½“å®ç°éƒ¨åˆ†ï¼›</li><li>æé«˜äº†ç³»ç»Ÿå¯æ‹“å±•æ€§ï¼›</li><li>ç¬¦åˆå¼€é—­åŸåˆ™å’Œåˆæˆå¤ç”¨åŸåˆ™ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å¢åŠ äº†ç³»ç»Ÿçš„ç†è§£å’Œè®¾è®¡éš¾åº¦ï¼›</li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>ç°æœ‰æ´¾çš„æ¥å£ç±»Pieï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Pie</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Pie <span class="title">makePie</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getType</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åŒ…å«åˆ¶ä½œæ´¾å’Œè·å–æ´¾ç±»å‹æŠ½è±¡æ–¹æ³•ã€‚</p><p>æ¥ç€åˆ›å»ºä¸¤ä¸ªPieçš„å®ç°ç±»ï¼Œè‹¹æœæ´¾AppliePieï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplePie</span> <span class="keyword">implements</span> <span class="title">Pie</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pie <span class="title">makePie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ¶ä½œè‹¹æœæ´¾ğŸğŸ¥§"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApplePie();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ°´æœæ´¾"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>èƒ¡èåœæ´¾CarrotPieï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarrotPie</span> <span class="keyword">implements</span> <span class="title">Pie</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pie <span class="title">makePie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ¶ä½œèƒ¡èåœæ´¾ğŸ¥•ğŸ¥§"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CarrotPie();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"è”¬èœæ²™æ‹‰æ´¾"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ¥ç€åˆ›å»ºä¸€ä¸ªåº—é“ºæŠ½è±¡ç±»Storeï¼Œé€šè¿‡å±æ€§çš„æ–¹å¼å’ŒPieç›¸å…³è”ï¼Œç›®çš„æ˜¯å¯ä»¥åœ¨ä¸åŒçš„åº—é“ºå®ç°ç±»ä¸­çµæ´»åœ°åˆ¶ä½œå„ç§æ´¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Pie pie;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Store</span><span class="params">(Pie pie)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pie = pie;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> Pie <span class="title">makePie</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>Storeå­ç±»ä¹‹ä¸€ï¼Œå±±å§†å¤§å”çš„å°åº—SamStoreï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SamStore</span> <span class="keyword">extends</span> <span class="title">Store</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SamStore</span><span class="params">(Pie pie)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(pie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">Pie <span class="title">makePie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"å±±å§†å¤§å”çš„å°åº—ğŸ’’"</span>);</span><br><span class="line">        <span class="keyword">return</span> pie.makePie();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>Storeå­ç±»ä¹‹äºŒï¼Œæ°å…‹çš„å°åº—JackStoreï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JackStore</span> <span class="keyword">extends</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JackStore</span><span class="params">(Pie pie)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(pie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">Pie <span class="title">makePie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"æ°å…‹çš„å°åº—ğŸ’’"</span>);</span><br><span class="line">        <span class="keyword">return</span> pie.makePie();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å»ºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæµ‹è¯•Pieçš„å®ç°ç±»å’ŒStoreçš„ç»§æ‰¿ç±»ä¹‹é—´çš„è‡ªç”±ç»„åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Store samStore = <span class="keyword">new</span> SamStore(<span class="keyword">new</span> ApplePie());</span><br><span class="line">        Pie samStorePie = samStore.makePie();</span><br><span class="line">        samStorePie.getType();</span><br><span class="line"></span><br><span class="line">        Store jackStore = <span class="keyword">new</span> JackStore(<span class="keyword">new</span> CarrotPie());</span><br><span class="line">        Pie jackStorePie = jackStore.makePie();</span><br><span class="line">        jackStorePie.getType();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å±±å§†å¤§å”çš„å°åº—ğŸ’’åˆ¶ä½œè‹¹æœæ´¾ğŸğŸ¥§</span><br><span class="line">æ°´æœæ´¾</span><br><span class="line">æ°å…‹çš„å°åº—ğŸ’’åˆ¶ä½œèƒ¡èåœæ´¾ğŸ¥•ğŸ¥§</span><br><span class="line">è”¬èœæ²™æ‹‰æ´¾</span><br></pre></td></tr></table></figure><p></p><p>è¿™ä¸ªä¾‹å­å¾ˆå¥½åœ°ä½“ç°äº†æ¡¥æ¥æ¨¡å¼çš„ç‰¹ç‚¹ï¼ŒUMLå›¾å¦‚ä¸‹ï¼š</p><p><img src="img/QQæˆªå›¾20191220151943.png" alt="QQæˆªå›¾20191220151943.png"></p><h3 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h3><p>ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œä»£ç†å¯¹è±¡åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°äº†ä¸­ä»‹çš„ä½œç”¨ã€‚</p><p>é€‚ç”¨äºï¼š</p><ol><li>ä¿æŠ¤ç›®æ ‡å¯¹è±¡ï¼›</li><li>å¢å¼ºç›®æ ‡å¯¹è±¡ã€‚</li></ol><p>ä¼˜ç‚¹ï¼š</p><ol><li>å°†ä»£ç†å¯¹è±¡å’ŒçœŸå®è¢«è°ƒç”¨çš„ç›®æ ‡å¯¹è±¡åˆ†ç¦»ï¼›</li><li>é™ä½è€¦åˆï¼Œæ‹“å±•æ€§å¥½ï¼›</li><li>ä¿æŠ¤ç›®æ ‡å¯¹è±¡ï¼Œå¢å¼ºç›®æ ‡å¯¹è±¡ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>é€ æˆç±»çš„æ•°ç›®å¢åŠ ï¼Œå¢åŠ å¤æ‚åº¦ï¼›</li><li>å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡å¢åŠ ä»£ç†å¯¹è±¡ï¼Œä¼šé€ æˆå¤„ç†é€Ÿåº¦å˜æ…¢ã€‚</li></ol><h4 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h4><p>é€šè¿‡åœ¨ä»£ç ä¸­æ˜¾å¼åœ°å®šä¹‰äº†ä¸€ä¸ªä»£ç†ç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­é€šè¿‡åŒåçš„æ–¹æ³•å¯¹ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è¿›è¡ŒåŒ…è£…ï¼Œå®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ä»£ç†ç±»çš„æ–¹æ³•æ¥è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚</p><p>ä¸¾ä¸ªé™æ€ä»£ç†çš„ä¾‹å­ï¼š</p><p>æ–°å»ºä¸€ä¸ªæ´¾çš„åˆ¶ä½œæ¥å£PieServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PieServcie</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">makePie</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åˆ›å»ºå…¶å®ç°ç±»PieServiceImplï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PieServiceImpl</span> <span class="keyword">implements</span> <span class="title">PieServcie</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makePie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ¶ä½œğŸ¥—æ´¾"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¦å¯¹PieServiceImplçš„<code>makePie</code>æ–¹æ³•å¢å¼ºï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡PieServiceProxyï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PieServiceProxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PieServcie pieServcie;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makePie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        beforeMethod();</span><br><span class="line">        pieServcie = <span class="keyword">new</span> PieServiceImpl();</span><br><span class="line">        pieServcie.makePie();</span><br><span class="line">        afterMethod();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">beforeMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å‡†å¤‡ææ–™"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">afterMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ä¿é²œ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨PieServiceProxyä¸­æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå’ŒPieServcieä¸€è‡´çš„åŒåæ–¹æ³•<code>makePie</code>ï¼Œæ–¹æ³•å†…éƒ¨è°ƒç”¨äº†PieServiceImplçš„<code>makePie</code>æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•è°ƒç”¨å‰è°ƒç”¨äº†ä»£ç†ç±»çš„<code>beforeMethod</code>æ–¹æ³•ï¼Œæ–¹æ³•è°ƒç”¨åè°ƒç”¨äº†ä»£ç†ç±»çš„<code>afterMethod</code>æ–¹æ³•ã€‚</p><p>åˆ›å»ºå®¢æˆ·ç«¯Applicationï¼Œæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        PieServiceProxy proxy = <span class="keyword">new</span> PieServiceProxy();</span><br><span class="line">        proxy.makePie();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å‡†å¤‡ææ–™</span><br><span class="line">åˆ¶ä½œğŸ¥—æ´¾</span><br><span class="line">ä¿é²œ</span><br></pre></td></tr></table></figure><p></p><p>è¿™ä¸ªä¾‹å­çš„UMLå›¾å¦‚ä¸‹ï¼š</p><p><img src="img/QQ20200421-100633@2x.png" alt="QQ20200421-100633@2x"></p><h4 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h4><p>JDKçš„åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£ï¼Œé€šè¿‡æ¥å£çš„æ–¹æ³•ååœ¨åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¸­è°ƒç”¨ä¸šåŠ¡å®ç°ç±»çš„åŒåæ–¹æ³•ã€‚</p><p>é™æ€ä»£ç†çš„ç¼ºç‚¹å°±æ˜¯æ¯éœ€è¦ä»£ç†ä¸€ä¸ªç±»ï¼Œå°±éœ€è¦æ‰‹å†™å¯¹åº”çš„ä»£ç†ç±»ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨åŠ¨æ€ä»£ç†æ¥è§£å†³ã€‚ä¸¾ä¸ªåŠ¨æ€ä»£ç†çš„ä¾‹å­ï¼š</p><p>æ–°å»ºå†°æ·‡æ·‹åˆ¶ä½œæ¥å£IceCreamServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IceCreamService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">makeIceCream</span><span class="params">(String fruit)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å®ç°ç±»IceCreamServiceImplï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCreamServiceImpl</span> <span class="keyword">implements</span> <span class="title">IceCreamService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeIceCream</span><span class="params">(String fruit)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ¶ä½œ"</span> + fruit + <span class="string">"ğŸ¦"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç°åœ¨éœ€è¦å¯¹IceCreamServiceImplè¿›è¡Œä»£ç†å¢å¼ºï¼Œå¦‚æœä½¿ç”¨é™æ€ä»£ç†ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªIceCreamServiceImplProxyç±»ï¼Œä½¿ç”¨åŠ¨æ€ä»£ç†çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€ç”Ÿæˆå¯¹åº”çš„ä»£ç†ç±»ã€‚</p><p>åˆ›å»ºDynamicProxyï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»£ç†çš„ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DynamicProxy</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">proxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = object.getClass();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(clazz.getClassLoader(),</span><br><span class="line">                clazz.getInterfaces(), <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy  åŠ¨æ€ç”Ÿæˆçš„ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method ä»£ç†æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args   ä»£ç†æ–¹æ³•çš„æ–¹æ³•å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç»“æœ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åŠ¨æ€ä»£ç†ç±»é€šè¿‡å®ç°InvocationHandlerçš„<code>invoke</code>æ–¹æ³•å®ç°ï¼Œ<code>proxy</code>ç”¨äºç”Ÿæˆä»£ç†å¯¹è±¡ã€‚å‰©ä¸‹çš„æ­¥éª¤å’Œé™æ€ä»£ç†ç±»ä¼¼ï¼Œå®Œå–„DynamicProxyï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»£ç†çš„ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DynamicProxy</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">proxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = object.getClass();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(clazz.getClassLoader(),</span><br><span class="line">                clazz.getInterfaces(), <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy  åŠ¨æ€ç”Ÿæˆçš„ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method ä»£ç†æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args   ä»£ç†æ–¹æ³•çš„æ–¹æ³•å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç»“æœ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        beforeMethod(object);</span><br><span class="line">        <span class="comment">// åå°„æ‰§è¡Œä»£ç†å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•</span></span><br><span class="line">        Object result = method.invoke(object, args);</span><br><span class="line">        afterMethod(object);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">beforeMethod</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (object <span class="keyword">instanceof</span> PieServcie) &#123;</span><br><span class="line">            System.out.println(<span class="string">"å‡†å¤‡æ´¾çš„ææ–™"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (object <span class="keyword">instanceof</span> IceCreamService) &#123;</span><br><span class="line">            System.out.println(<span class="string">"å‡†å¤‡å†°æ·‡æ·‹ææ–™"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"æš‚ä¸æ”¯æŒä»£ç†"</span> + object.getClass() + <span class="string">"ç±»å‹"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">afterMethod</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (object <span class="keyword">instanceof</span> PieServcie) &#123;</span><br><span class="line">            System.out.println(<span class="string">"ä¿é²œæ´¾"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (object <span class="keyword">instanceof</span> IceCreamService) &#123;</span><br><span class="line">            System.out.println(<span class="string">"ä¿é²œå†°æ·‡æ·‹"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"æš‚ä¸æ”¯æŒä»£ç†"</span> + object.getClass() + <span class="string">"ç±»å‹"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®¢æˆ·ç«¯Applicationæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        PieServcie pieServiceDynamicProxy = (PieServcie) <span class="keyword">new</span> DynamicProxy(<span class="keyword">new</span> PieServiceImpl()).proxy();</span><br><span class="line">        pieServiceDynamicProxy.makePie();</span><br><span class="line">        System.out.println(<span class="string">"-----------------"</span>);</span><br><span class="line">        IceCreamService iceCreamServiceDynamicProxy = (IceCreamService) <span class="keyword">new</span> DynamicProxy(<span class="keyword">new</span> IceCreamServiceImpl()).proxy();</span><br><span class="line">        iceCreamServiceDynamicProxy.makeIceCream(<span class="string">"ğŸ“"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å‡†å¤‡æ´¾çš„ææ–™</span><br><span class="line">åˆ¶ä½œğŸ¥—æ´¾</span><br><span class="line">ä¿é²œæ´¾</span><br><span class="line">-----------------</span><br><span class="line">å‡†å¤‡å†°æ·‡æ·‹ææ–™</span><br><span class="line">åˆ¶ä½œğŸ“ğŸ¦</span><br><span class="line">ä¿é²œå†°æ·‡æ·‹</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†æˆ‘ä»¬å®ç°äº†ç›®æ ‡æ–¹æ³•å¢å¼ºï¼Œå¹¶ä¸”ä¸éœ€è¦æ‰‹å†™ç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚</p><h4 id="CGLibä»£ç†"><a href="#CGLibä»£ç†" class="headerlink" title="CGLibä»£ç†"></a>CGLibä»£ç†</h4><p>é€šè¿‡ç»§æ‰¿æ¥å®ç°ï¼Œç”Ÿæˆçš„ä»£ç†ç±»å°±æ˜¯ç›®æ ‡å¯¹è±¡ç±»çš„å­ç±»ï¼Œé€šè¿‡é‡å†™ä¸šåŠ¡æ–¹æ³•æ¥å®ç°ä»£ç†ã€‚</p><h4 id="Springå¯¹ä»£ç†æ¨¡å¼çš„æ‹“å±•"><a href="#Springå¯¹ä»£ç†æ¨¡å¼çš„æ‹“å±•" class="headerlink" title="Springå¯¹ä»£ç†æ¨¡å¼çš„æ‹“å±•"></a>Springå¯¹ä»£ç†æ¨¡å¼çš„æ‹“å±•</h4><ol><li>å½“Beanæœ‰å®ç°æ¥å£æ—¶ï¼Œä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼›</li><li>å½“Beanæ²¡æœ‰å®ç°æ¥å£æ—¶ï¼Œä½¿ç”¨CGLibä»£ç†ã€‚</li></ol><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®å¼ºåˆ¶ä½¿ç”¨CGLibä»£ç†ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  aop:</span></span><br><span class="line"><span class="attr">    proxy-target-class:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p></p><h2 id="è¡Œä¸ºå‹æ¨¡å¼"><a href="#è¡Œä¸ºå‹æ¨¡å¼" class="headerlink" title="è¡Œä¸ºå‹æ¨¡å¼"></a>è¡Œä¸ºå‹æ¨¡å¼</h2><h3 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªæµç¨‹çš„éª¨æ¶ï¼Œç”±å¤šä¸ªæ–¹æ³•ç»„æˆã€‚å¹¶å…è®¸å­ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤æä¾›å®ç°ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯å…¬å…±çš„ä¸å˜çš„éƒ¨åˆ†ç”±çˆ¶ç±»ç»Ÿä¸€å®ç°ï¼Œå˜åŒ–çš„éƒ¨åˆ†ç”±å­ç±»æ¥ä¸ªæ€§åŒ–å®ç°ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ol><li>æé«˜å¤ç”¨æ€§ï¼›</li><li>æé«˜æ‹“å±•æ€§ï¼›</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>ç±»çš„æ•°ç›®å¢åŠ ï¼›</li><li>å¢åŠ äº†ç³»ç»Ÿå®ç°çš„å¤æ‚åº¦ï¼›</li><li>çˆ¶ç±»æ·»åŠ æ–°çš„æŠ½è±¡æ–¹æ³•ï¼Œæ‰€æœ‰å­ç±»éƒ½è¦æ”¹ä¸€éã€‚</li></ol><p>ä¸¾ä¸ªæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ä¾‹å­ã€‚å®šä¹‰ä¸€ä¸ªå¤–å–çš„æ¥å£ï¼ŒåŒ…å«ä¸‹å•ã€åˆ¶ä½œå’Œæ‰“åŒ…é…é€ä¸‰ä¸ªæ­¥éª¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Takeaway</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">order</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ä¸‹å•"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">packageSend</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ‰“åŒ…æ´¾é€"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">needTableware</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">flow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.order();</span><br><span class="line">        <span class="keyword">this</span>.make();</span><br><span class="line">        <span class="keyword">if</span> (needTableware()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"èµ é€ä¸€æ¬¡æ€§é¤å…·"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.packageSend();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å…¶ä¸­ä¸‹å•å’Œæ‰“åŒ…é…é€è¡Œä¸ºæ˜¯å›ºå®šçš„ï¼Œä¸åŒçš„æ˜¯åˆ¶ä½œè¿‡ç¨‹ï¼Œæ‰€ä»¥<code>order</code>å’Œ<code>packageSend</code>æ–¹æ³•æä¾›äº†é»˜è®¤å®ç°ï¼Œå¹¶ä¸”ç”±finalä¿®é¥°ï¼Œå­ç±»ä¸å¯é‡å†™ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<code>needTableware</code>è¿™ä¸ªé’©å­æ–¹æ³•æ¥æ§åˆ¶æŸäº›å­ç±»çš„å®šåˆ¶åŒ–éœ€æ±‚ã€‚</p><p>æ–°å¢BarbecueTakeawayç»§æ‰¿Takeawayï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarbecueTakeaway</span> <span class="keyword">extends</span> <span class="title">Takeaway</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> needTableware;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BarbecueTakeaway</span><span class="params">(<span class="keyword">boolean</span> needTableware)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.needTableware = needTableware;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ¶ä½œçƒ¤è‚‰"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">needTableware</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.needTableware;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å¢FruitTakeawayç»§æ‰¿Takeawayï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitTakeaway</span> <span class="keyword">extends</span> <span class="title">Takeaway</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ°´æœé…è´§"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">needTableware</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ–°å¢ä¸ªå®¢æˆ·ç«¯Applicationæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Takeaway barbecue = <span class="keyword">new</span> BarbecueTakeaway(<span class="keyword">true</span>);</span><br><span class="line">        barbecue.flow();</span><br><span class="line"></span><br><span class="line">        FruitTakeaway fruit = <span class="keyword">new</span> FruitTakeaway();</span><br><span class="line">        fruit.flow();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹å•</span><br><span class="line">åˆ¶ä½œçƒ¤è‚‰</span><br><span class="line">èµ é€ä¸€æ¬¡æ€§é¤å…·</span><br><span class="line">æ‰“åŒ…æ´¾é€</span><br><span class="line">ä¸‹å•</span><br><span class="line">æ°´æœé…è´§</span><br><span class="line">æ‰“åŒ…æ´¾é€</span><br></pre></td></tr></table></figure><p>UMLï¼š</p><p><img src="img/QQ20200421-153516@2x.png" alt="QQ20200421-153516@2x"></p><h3 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h3><p>ignore</p><h3 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h3><p>ç­–ç•¥æ¨¡å¼å®šä¹‰äº†ç®—æ³•å®¶æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚æ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„ç”¨æˆ·ã€‚ç­–ç•¥æ¨¡å¼å¸¸ç”¨äºæ¶ˆé™¤å¤§é‡çš„if elseä»£ç ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼š</p><ol><li>ç³»ç»Ÿæœ‰å¾ˆå¤šç±»ï¼Œå®ƒä»¬çš„åŒºåˆ«ä»…ä»…åœ¨äºè¡Œä¸ºä¸åŒï¼›</li><li>ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ï¼›</li></ol><p>ä¸¾ä¸ªç­–ç•¥æ¨¡å¼çš„ä¾‹å­ï¼ˆä¿ƒé”€æ´»åŠ¨ï¼‰ï¼Œå®šä¹‰ä¸€ä¸ªä¿ƒé”€ç­–ç•¥æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PromotionStrategy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">promotion</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å®ç°ç±»ä¹‹ä¸€ï¼ˆç­–ç•¥ä¹‹ä¸€ï¼‰ï¼Œæ»¡å‡ä¿ƒé”€ç­–ç•¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FullReductionPromotionStrategy</span> <span class="keyword">implements</span> <span class="title">PromotionStrategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">promotion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ»¡1000ç«‹å‡1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å®ç°ç±»ä¹‹ä¸€ï¼ˆç­–ç•¥ä¹‹ä¸€ï¼‰ï¼Œæ‰“æŠ˜ä¿ƒé”€ç­–ç•¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DiscountPromotionStrategy</span> <span class="keyword">implements</span> <span class="title">PromotionStrategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">promotion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"9.9æŠ˜é’œæƒ "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå®¢æˆ·ç«¯ä¼ é€’çš„ä¿ƒé”€ç­–ç•¥key</span></span><br><span class="line">        String promotionKey = <span class="string">"fr"</span>;</span><br><span class="line">        PromotionStrategy strategy;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"fr"</span>.equals(promotionKey)) &#123;</span><br><span class="line">            strategy = <span class="keyword">new</span> FullReductionPromotionStrategy();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"ds"</span>.equals(promotionKey)) &#123;</span><br><span class="line">            strategy = <span class="keyword">new</span> DiscountPromotionStrategy();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"æš‚ä¸æ”¯æŒè¯¥ä¿ƒé”€æ´»åŠ¨"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        strategy.promotion();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ»¡1000ç«‹å‡1</span><br></pre></td></tr></table></figure><p></p><p>ç­–ç•¥æ¨¡å¼å¸¸ç»“åˆå·¥å‚æ¨¡å¼æ¥æ¶ˆé™¤å¤§é‡çš„if elseä»£ç ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªä¿ƒé”€ç­–ç•¥çš„åˆ›å»ºå·¥å‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PromotionStrategyFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, PromotionStrategy&gt; PROMOTION_STRATEGY_MAP = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> PromotionStrategy NON_PROMOTION = () -&gt; System.out.println(<span class="string">"æ— ä¿ƒé”€æ´»åŠ¨"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        PROMOTION_STRATEGY_MAP.put(PromotionKey.FR, <span class="keyword">new</span> FullReductionPromotionStrategy());</span><br><span class="line">        PROMOTION_STRATEGY_MAP.put(PromotionKey.DS, <span class="keyword">new</span> DiscountPromotionStrategy());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">PromotionStrategyFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PromotionStrategy <span class="title">getPromotionStrategy</span><span class="params">(String promotionKey)</span> </span>&#123;</span><br><span class="line">        PromotionStrategy strategy = PROMOTION_STRATEGY_MAP.get(promotionKey);</span><br><span class="line">        <span class="keyword">return</span> strategy == <span class="keyword">null</span> ? NON_PROMOTION : strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">interface</span> <span class="title">PromotionKey</span> </span>&#123;</span><br><span class="line">        String FR = <span class="string">"fr"</span>;</span><br><span class="line">        String DS = <span class="string">"ds"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡Mapæ¥è£…è½½ä¿ƒé”€ç­–ç•¥ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¯¹è±¡çš„é‡å¤åˆ›å»ºã€‚å¦‚æœä¸å¸Œæœ›åœ¨staticå—ä¸­ä¸€æ¬¡æ€§åˆå§‹åŒ–æ‰€æœ‰ä¿ƒé”€ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆäº«å…ƒæ¨¡å¼æ¥æ¨è¿Ÿå¯¹è±¡åˆ›å»ºè¿‡ç¨‹ã€‚</p><p>é€šè¿‡è¿™ä¸ªå·¥å‚æ–¹æ³•ï¼Œä¸Šé¢å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç®€å†™ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå®¢æˆ·ç«¯ä¼ é€’çš„ä¿ƒé”€ç­–ç•¥key</span></span><br><span class="line">        String promotionKey = <span class="string">"fr"</span>;</span><br><span class="line">        PromotionStrategy promotionStrategy = PromotionStrategyFactory.getPromotionStrategy(promotionKey);</span><br><span class="line">        promotionStrategy.promotion();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="è§£é‡Šå™¨æ¨¡å¼"><a href="#è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="è§£é‡Šå™¨æ¨¡å¼"></a>è§£é‡Šå™¨æ¨¡å¼</h3><p>ç”¨çš„è¾ƒå°‘ï¼Œæš‚ä¸è®°å½•ã€‚</p><h3 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h3><p>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…åŒæ—¶ç›‘å¬æŸä¸ªä¸»é¢˜å¯¹è±¡ï¼Œå½“ä¸»ä½“å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒçš„æ‰€æœ‰è§‚å¯Ÿè€…éƒ½ä¼šæ”¶åˆ°å“åº”çš„é€šçŸ¥ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ol><li>è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŠ½è±¡çš„è€¦åˆï¼›</li><li>è§‚å¯Ÿè€…æ¨¡å¼æ”¯æŒå¹¿æ’­é€šä¿¡ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>è§‚å¯Ÿè€…ä¹‹é—´æœ‰è¿‡å¤šçš„ç»†èŠ‚ä¾èµ–ï¼Œæé«˜æ—¶é—´æ¶ˆè€—åŠç¨‹åºå¤æ‚åº¦ï¼›</li><li>åº”é¿å…å¾ªç¯è°ƒç”¨ã€‚</li></ol><p>JDKå¯¹è§‚å¯Ÿè€…æ¨¡å¼æä¾›äº†æ”¯æŒã€‚ä¸‹é¢ä¸¾ä¸ªè§‚å¯Ÿè€…æ¨¡å¼çš„ä¾‹å­ã€‚</p><p>åˆ›å»ºä¸€ä¸ªåšå®¢ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»§æ‰¿ Observableç±»ï¼ŒBlogä¸ºè¢«è§‚å¯Ÿå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blog</span> <span class="keyword">extends</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Blog</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">comment</span><span class="params">(Comment comment)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(comment.getNickname() + <span class="string">"è¯„è®ºäº†&lt;"</span> + <span class="keyword">this</span>.title + <span class="string">"&gt; ï¼Œ"</span> +</span><br><span class="line">                <span class="string">"è¯„è®ºå†…å®¹ï¼š"</span> + comment.getValue());</span><br><span class="line">        <span class="comment">// è®¾ç½®æ ‡è¯†ä½ changed = trueï¼Œè¡¨ç¤ºè¢«è§‚å¯Ÿè€…å‘ç”Ÿäº†æ”¹å˜</span></span><br><span class="line">        setChanged();</span><br><span class="line">        <span class="comment">// é€šçŸ¥è§‚å¯Ÿè€…ï¼Œå¯ä»¥ç»™è§‚å¯Ÿè€…ä¼ é€’æ•°æ®</span></span><br><span class="line">        notifyObservers(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>Commentç±»ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Comment</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯„è®ºè€…æ˜µç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯„è®ºå†…å®¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Comment</span><span class="params">(String nickname, String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickname = nickname;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>Blogç±»æ˜¯è¢«è§‚å¯Ÿè€…å¯¹è±¡ï¼Œè¢«è§‚å¯Ÿè€…å¯¹è±¡éœ€è¦ç»§æ‰¿JDKçš„Observableç±»ï¼Œç»§æ‰¿åï¼Œè¢«è§‚å¯Ÿè€…å¯¹è±¡åŒ…å«å¦‚ä¸‹å±æ€§å’Œæ–¹æ³•ï¼š</p><p><img src="img/QQ20200511-093515@2x.png" alt="QQ20200511-093515@2x"></p><p>è¿™äº›æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨æ–¹æ³•ï¼ˆåŠ äº†synchronizedåŒæ­¥é”ï¼‰ã€‚</p><p>Blogçš„commentæ–¹æ³•ä¸­ï¼Œå½“åšå®¢æ”¶åˆ°è¯„è®ºæ—¶ï¼Œé¦–å…ˆè°ƒç”¨çˆ¶ç±»çš„setChanged()æ–¹æ³•ï¼Œè®¾ç½®æ ‡è¯†ä½ changed = trueï¼Œè¡¨ç¤ºè¢«è§‚å¯Ÿè€…å‘ç”Ÿäº†æ”¹å˜ï¼›ç„¶åè°ƒç”¨çˆ¶ç±»çš„notifyObservers(Object)æ–¹æ³•é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…ã€‚</p><p>è¢«è§‚å¯Ÿè€…å¯¹è±¡åˆ›å»ºå¥½åï¼Œæˆ‘ä»¬æ¥ç€åˆ›å»ºè§‚å¯Ÿè€…ã€‚æ–°å»ºä¸€ä¸ªAuthorç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Author</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Author</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§‚å¯Ÿè€…è¢«é€šçŸ¥åï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o   è¢«è§‚å¯Ÿè€…å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arg è¢«è§‚å¯Ÿè€…ä¼ é€’è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Observable o, Object arg)</span> </span>&#123;</span><br><span class="line">        Blog blog = (Blog) o;</span><br><span class="line">        Comment comment = (Comment) arg;</span><br><span class="line">        System.out.println(<span class="string">"ç³»ç»Ÿæ„ŸçŸ¥åˆ°"</span> + <span class="keyword">this</span>.name + <span class="string">"æ’°å†™çš„åšæ–‡&lt;"</span> +</span><br><span class="line">                blog.getTitle() + <span class="string">"&gt;æ”¶åˆ°äº†"</span> + comment.getNickname() +</span><br><span class="line">                <span class="string">"çš„è¯„è®ºï¼Œè¯„è®ºå†…å®¹ä¸ºï¼š"</span> + comment.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è§‚å¯Ÿè€…å¯¹è±¡éœ€è¦å®ç°JDKçš„Observerç±»ï¼Œé‡å†™updateæ–¹æ³•ã€‚å½“è¢«è§‚å¯Ÿè€…å¯¹è±¡è°ƒç”¨äº†notifyObserversæ–¹æ³•åï¼Œç›¸åº”çš„è§‚å¯Ÿè€…çš„updateæ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</p><p>æ–°å»ºä¸€ä¸ªå®¢æˆ·ç«¯æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Blog blog = <span class="keyword">new</span> Blog(<span class="string">"Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ"</span>);</span><br><span class="line">        Author author = <span class="keyword">new</span> Author(<span class="string">"MrBird"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ è§‚å¯Ÿè€…</span></span><br><span class="line">        blog.addObserver(author);</span><br><span class="line"></span><br><span class="line">        Comment comment = <span class="keyword">new</span> Comment(<span class="string">"Scott"</span>,</span><br><span class="line">                <span class="string">"æ„Ÿè°¢æ¥¼ä¸»çš„æ–‡ç« ï¼Œè®©æˆ‘åŠæ—¶æ”¾å¼ƒJavaï¼Œå›å®¶ç»§æ‰¿äº†åƒä¸‡å®¶äº§ã€‚"</span>);</span><br><span class="line">        blog.comment(comment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Scottè¯„è®ºäº†&lt;Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ&gt; ï¼Œè¯„è®ºå†…å®¹ï¼šæ„Ÿè°¢æ¥¼ä¸»çš„æ–‡ç« ï¼Œè®©æˆ‘åŠæ—¶æ”¾å¼ƒJavaï¼Œå›å®¶ç»§æ‰¿äº†åƒä¸‡å®¶äº§ã€‚</span><br><span class="line">ç³»ç»Ÿæ„ŸçŸ¥åˆ°MrBirdæ’°å†™çš„åšæ–‡&lt;Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ&gt;æ”¶åˆ°äº†Scottçš„è¯„è®ºï¼Œè¯„è®ºå†…å®¹ä¸ºï¼šæ„Ÿè°¢æ¥¼ä¸»çš„æ–‡ç« ï¼Œè®©æˆ‘åŠæ—¶æ”¾å¼ƒJavaï¼Œå›å®¶ç»§æ‰¿äº†åƒä¸‡å®¶äº§ã€‚</span><br></pre></td></tr></table></figure><p></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè§‚å¯Ÿè€…çš„updateæ–¹æ³•é‡Œçš„é€»è¾‘æœ€å¥½è¿›è¡Œå¼‚æ­¥åŒ–ï¼Œè¿™æ ·åœ¨å¹¶å‘ç¯å¢ƒä¸‹å¯ä»¥æå‡ç¨‹åºæ€§èƒ½ã€‚</p><h3 id="å¤‡å¿˜å½•æ¨¡å¼"><a href="#å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼"></a>å¤‡å¿˜å½•æ¨¡å¼</h3><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/jimoer/p/9537997.html" target="_blank" rel="noopener">https://www.cnblogs.com/jimoer/p/9537997.html</a>ã€‚</p><h3 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h3><p>æš‚ä¸è®°å½•ã€‚</p><h3 id="ä¸­ä»‹è€…æ¨¡å¼"><a href="#ä¸­ä»‹è€…æ¨¡å¼" class="headerlink" title="ä¸­ä»‹è€…æ¨¡å¼"></a>ä¸­ä»‹è€…æ¨¡å¼</h3><p>æš‚ä¸è®°å½•ã€‚</p><h3 id="èŒè´£é“¾æ¨¡å¼"><a href="#èŒè´£é“¾æ¨¡å¼" class="headerlink" title="èŒè´£é“¾æ¨¡å¼"></a>èŒè´£é“¾æ¨¡å¼</h3><p>èŒè´£é“¾æ¨¡å¼ä¸ºè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ¥æ”¶æ­¤æ¬¡è¯·æ±‚å¯¹è±¡çš„é“¾ã€‚</p><p>é€‚ç”¨äºï¼š</p><ul><li>ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†éœ€è¦å¤šä¸ªå¯¹è±¡å½“ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªåä½œå¤„ç†ï¼›</li></ul><p>ä¼˜ç‚¹ï¼š</p><ol><li>è¯·æ±‚çš„å‘é€è€…å’Œæ¥å—è€…ï¼ˆè¯·æ±‚çš„å¤„ç†ï¼‰è§£è€¦ï¼›</li><li>èŒè´£é“¾å¯ä»¥åŠ¨æ€çš„ç»„åˆã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>èŒè´£é“¾å¤ªé•¿æˆ–è€…å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œå½±å“æ€§èƒ½ï¼›</li><li>èŒè´£é“¾å¯èƒ½è¿‡å¤šã€‚</li></ol><p>ä¸¾ä¸ªå­—ç¬¦ä¸²æ ¡éªŒçš„ä¾‹å­ã€‚æ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ ¡éªŒæŠ½è±¡ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StringValidator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> StringValidator validator;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNextValidator</span><span class="params">(StringValidator validator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.validator = validator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(String value)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>StringValidatorç±»åŒ…å«äº†ä¸€ä¸ªè‡ªèº«ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œè¿™ä¹Ÿæ˜¯è¯¥æ¨¡å¼çš„è®¾è®¡æ ¸å¿ƒï¼Œä»¥æ­¤å½¢æˆé“¾æ¡ã€‚</p><p>åˆ›å»ºä¸€ä¸ªæ ¡éªŒå­—ç¬¦ä¸²é•¿åº¦çš„ç±»StringLengthValidatorï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringLengthValidator</span> <span class="keyword">extends</span> <span class="title">StringValidator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="keyword">null</span> &amp;&amp; value.length() != <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"å­—ç¬¦ä¸²é•¿åº¦åˆæ³•"</span>);</span><br><span class="line">            <span class="keyword">if</span> (validator != <span class="keyword">null</span>) &#123;</span><br><span class="line">                validator.check(value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"å­—ç¬¦ä¸²é•¿åº¦ä¸åˆæ³•"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¸Šé¢ä»£ç ä¸­ï¼Œåœ¨å­—ç¬¦ä¸²é•¿åº¦æ ¡éªŒåˆæ³•åï¼Œæˆ‘ä»¬åˆ¤æ–­çˆ¶ç±»çš„validatorå±æ€§æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™è°ƒç”¨å…¶checkæ–¹æ³•ç»§ç»­ä¸‹ä¸€æ­¥æ ¡éªŒã€‚</p><p>æ¥ç€å†æ–°å»ºä¸€ä¸ªæ ¡éªŒå­—ç¬¦ä¸²å†…å®¹çš„ç±»StringValueValidatorï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringValueValidator</span> <span class="keyword">extends</span> <span class="title">StringValidator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value.contains(<span class="string">"fuck"</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">"å­—ç¬¦ä¸²å€¼ä¸åˆæ³•"</span>);</span><br><span class="line">            <span class="keyword">if</span> (validator != <span class="keyword">null</span>) &#123;</span><br><span class="line">                validator.check(value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"å­—ç¬¦ä¸²å€¼åˆæ³•"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¥—è·¯å’ŒStringLengthValidatorä¸€æ ·ã€‚æ¥ç€åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ç±»ï¼Œæ¼”ç¤ºä¸‹å¦‚ä½•è®©æ ¡éªŒç±»å½¢æˆä¸€ä¸ªé“¾æ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringValidator lengthValidator = <span class="keyword">new</span> StringLengthValidator();</span><br><span class="line">        StringValidator valueValidator = <span class="keyword">new</span> StringValueValidator();</span><br><span class="line"></span><br><span class="line">        lengthValidator.setNextValidator(valueValidator);</span><br><span class="line">        lengthValidator.check(<span class="string">"hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¸Šé¢ä»£ç ä¸­ï¼Œé€šè¿‡StringValidatorçš„setNextValidatoræ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸‹ä¸€ä¸ªæ ¡éªŒç±»ï¼Œä»¥æ­¤å½¢æˆé“¾æ¡ï¼Œç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å­—ç¬¦ä¸²é•¿åº¦åˆæ³•</span><br><span class="line">å­—ç¬¦ä¸²å€¼åˆæ³•</span><br></pre></td></tr></table></figure><p></p><h3 id="è®¿é—®è€…æ¨¡å¼"><a href="#è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¿é—®è€…æ¨¡å¼"></a>è®¿é—®è€…æ¨¡å¼</h3><p>æš‚ä¸è®°å½•ğŸŒš</p><h3 id="çŠ¶æ€æ¨¡å¼"><a href="#çŠ¶æ€æ¨¡å¼" class="headerlink" title="çŠ¶æ€æ¨¡å¼"></a>çŠ¶æ€æ¨¡å¼</h3><p>æš‚ä¸è®°å½•ğŸŒš</p><blockquote><p>å‚è€ƒè¿æ¥ï¼š<a href="https://zh.wikipedia.org/wiki/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F_(%E8%AE%A1%E7%AE%97%E6%9C%BA)" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F_(%E8%AE%A1%E7%AE%97%E6%9C%BA)</a></p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;ç®€å•è®°å½•Javaä¸­23ç§è®¾è®¡æ¨¡å¼çš„åº”ç”¨ï¼Œæ–¹ä¾¿åæœŸæŸ¥çœ‹ã€‚
    
    </summary>
    
    
      <category term="Java" scheme="http://mrbird.cc/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Kafka APIä½¿ç”¨</title>
    <link href="http://mrbird.cc/Kafka-API%E4%BD%BF%E7%94%A8.html"/>
    <id>http://mrbird.cc/Kafka-APIä½¿ç”¨.html</id>
    <published>2020-03-29T14:08:32.000Z</published>
    <updated>2020-04-02T08:13:18.478Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p>æœ¬èŠ‚æ¼”ç¤ºå¦‚ä½•é€šè¿‡Javaä»£ç åˆ›å»ºKafkaç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œæ‹¦æˆªå™¨ï¼Œä¾èµ–ä½¿ç”¨<a href="https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients/2.4.1" target="_blank" rel="noopener">Kafka-clients</a>ã€‚å› ä¸ºæˆ‘å®‰è£…çš„Kafkaç‰ˆæœ¬ä¸º2.4.1ï¼Œæ‰€ä»¥ä¾èµ–çš„ç‰ˆæœ¬ä¹Ÿç”¨2.4.1ï¼Œé¿å…å…¼å®¹é—®é¢˜ã€‚æ–°å¢ä¸€ä¸ªmavené¡¹ç›®ï¼Œå¼•å…¥ï¼š</p><a id="more"></a><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç”Ÿäº§è€…API"><a href="#ç”Ÿäº§è€…API" class="headerlink" title="ç”Ÿäº§è€…API"></a>ç”Ÿäº§è€…API</h2><p>Kafka çš„ Producer å‘é€æ¶ˆæ¯é‡‡ç”¨çš„æ˜¯å¼‚æ­¥å‘é€çš„æ–¹å¼ã€‚åœ¨æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°äº†ä¸¤ä¸ªçº¿ç¨‹â€”â€”main çº¿ç¨‹å’Œ Sender çº¿ç¨‹ï¼Œä»¥åŠä¸€ä¸ªçº¿ç¨‹å…±äº«å˜é‡â€”â€”RecordAccumulatorã€‚main çº¿ç¨‹å°†æ¶ˆæ¯å‘é€ç»™ RecordAccumulatorï¼ŒSender çº¿ç¨‹ä¸æ–­ä» RecordAccumulator ä¸­æ‹‰å–æ¶ˆæ¯å‘é€åˆ° Kafka brokerã€‚</p><h3 id="ç®€å•å‘é€æ•°æ®"><a href="#ç®€å•å‘é€æ•°æ®" class="headerlink" title="ç®€å•å‘é€æ•°æ®"></a>ç®€å•å‘é€æ•°æ®</h3><p>åˆ›å»º<code>ProducerDemo</code>ç±»ï¼Œç¼–å†™ä¸€ä¸ªç®€å•çš„ç”Ÿäº§è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1. ç”Ÿäº§è€…é…ç½®</span></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="comment">// æŒ‡å®škafkaåœ°å€</span></span><br><span class="line">        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">"localhost:9092"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šackç­‰çº§</span></span><br><span class="line">        properties.put(ProducerConfig.ACKS_CONFIG, <span class="string">"all"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šé‡è¯•æ¬¡æ•°ï¼Œå³ç”Ÿäº§è€…å‘é€æ•°æ®åæ²¡æœ‰æ”¶åˆ°ackåº”ç­”æ—¶çš„é‡è¯•æ¬¡æ•°</span></span><br><span class="line">        properties.put(ProducerConfig.RETRIES_CONFIG, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ‰¹æ¬¡å¤§å° 16k = 16 * 1024</span></span><br><span class="line">        properties.put(ProducerConfig.BATCH_SIZE_CONFIG, <span class="number">16384</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line">        properties.put(ProducerConfig.LINGER_MS_CONFIG, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šRecordAccumulatorç¼“å†²åŒºå¤§å° 32m = 32 * 1024 * 1024</span></span><br><span class="line">        properties.put(ProducerConfig.BUFFER_MEMORY_CONFIG, <span class="number">33554432</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šk-våºåˆ—åŒ–è§„åˆ™</span></span><br><span class="line">        properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringSerializer"</span>);</span><br><span class="line">        properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringSerializer"</span>);</span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºç”Ÿäº§è€…</span></span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = <span class="keyword">new</span> KafkaProducer&lt;&gt;(properties);</span><br><span class="line">        <span class="comment">// 3. å‡†å¤‡æ•°æ®</span></span><br><span class="line">        ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(<span class="string">"test"</span>, <span class="string">"mesage"</span>);</span><br><span class="line">        <span class="comment">// 4. å‘é€æ•°æ®ï¼ˆä¸å¸¦å›è°ƒï¼‰</span></span><br><span class="line">        producer.send(record);</span><br><span class="line">        <span class="comment">// 5. å…³é—­è¿æ¥</span></span><br><span class="line">        producer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ— è®ºæ˜¯åˆ›å»ºç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…ï¼Œæˆ‘ä»¬éƒ½è¦æŒ‡å®šé…ç½®ã€‚ç”Ÿäº§è€…é…ç½®å¯ä»¥ä½¿ç”¨å¸¸é‡ç±»<code>ProducerConfig</code>æŒ‡å®šï¼Œé‡Œé¢åŒ…å«äº†ç”Ÿäº§è€…æ‰€æœ‰å¯ç”¨é…ç½®ï¼Œå¹¶ä¸”åŒ…å«å¯¹åº”çš„è§£é‡Šï¼š</p><p><img src="img/QQ20200402-103628@2x.png" alt="QQ20200402-103628@2x"></p><p>ä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªkvéƒ½æ˜¯Stringç±»å‹çš„ç”Ÿäº§è€…ã€‚é…ç½®äº†Kafkaçš„åœ°å€ï¼Œackç­‰çº§ä¸ºallï¼ˆåœ¨<a href="/Kafkaç”Ÿäº§è€….html">Kafkaç”Ÿäº§è€…</a>ä¸€èŠ‚ä¸­ä»‹ç»è¿‡äº†ï¼Œä¸èµ˜è¿°ï¼‰ï¼Œé‡è¯•æ¬¡æ•°ä¸º3ã€‚å¹¶ä¸”æŒ‡å®šäº†ç”Ÿäº§è€…å‘é€æ•°æ®çš„æ‰¹æ¬¡ä¸º16kï¼Œç­‰å¾…æ—¶é—´ä¸º1msã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¹ˆå‘é€çš„æ•°æ®é‡è¾¾åˆ°äº†16kï¼Œè¦ä¹ˆç­‰å¾…æ—¶é—´è¶…è¿‡äº†1msæ‰ä¼šçœŸæ­£åœ°æŠŠæ•°æ®å‘å¾€Kafkaã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šRecordAccumulatorç¼“å†²åŒºå¤§å°ï¼Œkvåºåˆ—åŒ–è§„åˆ™é‡‡ç”¨<code>StringSerializer</code>ã€‚</p><p>Kafkaæ¶ˆæ¯ä½¿ç”¨<code>KafkaProducer</code>å¯¹è±¡è¡¨ç¤ºï¼Œä»–æœ‰6ä¸ªé‡è½½æ„é€ å™¨ï¼Œè¿™åœ¨<a href="/Kafkaç”Ÿäº§è€….html">Kafkaç”Ÿäº§è€…</a>ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº†ä¸»é¢˜ä¸ºtestï¼Œæ¶ˆæ¯å†…å®¹ä¸ºmessageã€‚</p><p>è¿è¡Œè¿™æ®µä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¯åŠ¨zkå’Œkafkaï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å¯åŠ¨zk</span><br><span class="line">sh bin/zookeeper-server-start.sh config/zookeeper.properties</span><br><span class="line"># å¯åŠ¨kafka broker</span><br><span class="line">sh bin/kafka-server-start.sh config/server.properties</span><br><span class="line"># å¯åŠ¨kafkaæ¶ˆè´¹è€…</span><br><span class="line">sh bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test</span><br></pre></td></tr></table></figure><p></p><p>ç„¶åè¿è¡Œä¸Šé¢çš„ç¨‹åºï¼Œè§‚å¯Ÿæ¶ˆè´¹è€…è¾“å‡ºï¼š</p><p><img src="img/QQ20200402-110459@2x.png" alt="QQ20200402-110459@2x"></p><h3 id="å¸¦å›è°ƒå‡½æ•°"><a href="#å¸¦å›è°ƒå‡½æ•°" class="headerlink" title="å¸¦å›è°ƒå‡½æ•°"></a>å¸¦å›è°ƒå‡½æ•°</h3><p><code>KafkaProducer</code>çš„<code>send</code>æ–¹æ³•å¯ä»¥åˆ¶å®šå›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°ä¼šåœ¨ producer æ”¶åˆ° ack æ—¶è°ƒç”¨ï¼Œä¸ºå¼‚æ­¥è°ƒç”¨ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯RecordMetadata å’Œ Exceptionï¼Œå¦‚æœ Exception ä¸º nullï¼Œè¯´æ˜æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå¦‚æœException ä¸ä¸º nullï¼Œè¯´æ˜æ¶ˆæ¯å‘é€å¤±è´¥ã€‚</p><p>æ”¹é€ ä¸Šé¢çš„sendæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 3. å‡†å¤‡æ•°æ®</span></span><br><span class="line">ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(<span class="string">"test"</span>, <span class="string">"callback-test"</span>);</span><br><span class="line"><span class="comment">// 4. å‘é€æ•°æ®ï¼ˆå¸¦å›è°ƒï¼‰</span></span><br><span class="line">producer.send(record, (metadata, exception) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (exception == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å›è°ƒå‡½æ•°ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨ Producer æ”¶åˆ° ack æ—¶è°ƒç”¨ï¼Œä¸ºå¼‚æ­¥è°ƒç”¨</span></span><br><span class="line">        String result = String.format(<span class="string">"æ¶ˆæ¯å‘é€æˆåŠŸï¼Œä¸»é¢˜Topic: %s,åˆ†åŒºPartition: %s,åç§»é‡Offset: %s"</span>,</span><br><span class="line">                metadata.topic(), metadata.partition(), metadata.offset());</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆæ¯å‘é€å¤±è´¥"</span>);</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p></p><p>è¿è¡Œè¯¥æ–¹æ³•ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ¶ˆæ¯å‘é€æˆåŠŸï¼Œä¸»é¢˜Topic: test,åˆ†åŒºPartition: 0,åç§»é‡Offset: 4</span><br></pre></td></tr></table></figure><p></p><p>æ¶ˆè´¹è€…ï¼š</p><p><img src="img/QQ20200402-111752@2x.png" alt="QQ20200402-111752@2x"></p><h3 id="åŒæ­¥å‘é€"><a href="#åŒæ­¥å‘é€" class="headerlink" title="åŒæ­¥å‘é€"></a>åŒæ­¥å‘é€</h3><p>å¦‚å‰é¢æ‰€è¯´ï¼ŒKafka çš„ Producer å‘é€æ¶ˆæ¯é‡‡ç”¨çš„æ˜¯å¼‚æ­¥å‘é€çš„æ–¹å¼ï¼Œ<code>KafkaProducer</code>çš„<code>send</code>æ–¹æ³•è¿”å›<code>Future</code>å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è°ƒç”¨<code>Future</code>å¯¹è±¡çš„<code>get</code>æ–¹æ³•å®ç°åŒæ­¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. å‡†å¤‡æ•°æ®</span></span><br><span class="line">ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(<span class="string">"test"</span>, <span class="string">"test-sync"</span>);</span><br><span class="line"><span class="comment">// 4. å‘é€æ•°æ®ï¼ˆå¸¦å›è°ƒï¼‰</span></span><br><span class="line">Future&lt;RecordMetadata&gt; future = producer.send(record, (metadata, exception) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (exception == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å›è°ƒå‡½æ•°ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨ Producer æ”¶åˆ° ack æ—¶è°ƒç”¨ï¼Œä¸ºå¼‚æ­¥è°ƒç”¨</span></span><br><span class="line">        String result = String.format(<span class="string">"æ¶ˆæ¯å‘é€æˆåŠŸï¼Œä¸»é¢˜Topic: %s,åˆ†åŒºPartition: %s,åç§»é‡Offset: %s"</span>,</span><br><span class="line">                metadata.topic(), metadata.partition(), metadata.offset());</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆæ¯å‘é€å¤±è´¥"</span>);</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">future.get();</span><br></pre></td></tr></table></figure><p></p><h3 id="è‡ªå®šä¹‰åˆ†åŒºå™¨"><a href="#è‡ªå®šä¹‰åˆ†åŒºå™¨" class="headerlink" title="è‡ªå®šä¹‰åˆ†åŒºå™¨"></a>è‡ªå®šä¹‰åˆ†åŒºå™¨</h3><p>è‡ªå®šä¹‰åˆ†åŒºå™¨åªéœ€è¦è¦å®ç°<code>Partitioner</code>æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPartitioner</span> <span class="keyword">implements</span> <span class="title">Partitioner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(String topic, Object key, <span class="keyword">byte</span>[] keyBytes, Object value,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">byte</span>[] valueBytes, Cluster cluster)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(Map&lt;String, ?&gt; configs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>partition</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸»é¢˜topicï¼Œkeyå€¼ï¼Œåºåˆ—åŒ–åçš„keyå€¼ï¼Œvalueå€¼ï¼Œåºåˆ—åŒ–åçš„valueå€¼ï¼ŒKafkaé›†ç¾¤clusterä¿¡æ¯ï¼Œæ¥ä¸ªæ€§åŒ–åˆ†åŒºè§„åˆ™ã€‚</p><p>è¦ä½¿ç”¨è‡ªå®šä¹‰åˆ†åŒºå™¨ï¼Œå¯é€šè¿‡é…ç½®ç±»æŒ‡å®šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šè‡ªå®šä¹‰åˆ†åŒºå™¨</span></span><br><span class="line">properties.put(ProducerConfig.PARTITIONER_CLASS_CONFIG, MyPartitioner.class);</span><br></pre></td></tr></table></figure><p></p><h2 id="æ¶ˆè´¹è€…API"><a href="#æ¶ˆè´¹è€…API" class="headerlink" title="æ¶ˆè´¹è€…API"></a>æ¶ˆè´¹è€…API</h2><p>Consumer æ¶ˆè´¹æ•°æ®æ—¶çš„å¯é æ€§æ˜¯å¾ˆå®¹æ˜“ä¿è¯çš„ï¼Œå› ä¸ºæ•°æ®åœ¨ Kafka ä¸­æ˜¯æŒä¹…åŒ–çš„ï¼Œæ•…ä¸ç”¨æ‹…å¿ƒæ•°æ®ä¸¢å¤±é—®é¢˜ã€‚</p><p>ç”±äº consumer åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°æ–­ç”µå®•æœºç­‰æ•…éšœï¼Œconsumer æ¢å¤åï¼Œéœ€è¦ä»æ•…éšœå‰çš„ä½ç½®çš„ç»§ç»­æ¶ˆè´¹ï¼Œæ‰€ä»¥ consumer éœ€è¦å®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°äº†å“ªä¸ª offsetï¼Œä»¥ä¾¿æ•…éšœæ¢å¤åç»§ç»­æ¶ˆè´¹ã€‚æ‰€ä»¥ offset çš„ç»´æŠ¤æ˜¯ Consumer æ¶ˆè´¹æ•°æ®æ˜¯å¿…é¡»è€ƒè™‘çš„é—®é¢˜ã€‚</p><h3 id="è‡ªåŠ¨æäº¤offset"><a href="#è‡ªåŠ¨æäº¤offset" class="headerlink" title="è‡ªåŠ¨æäº¤offset"></a>è‡ªåŠ¨æäº¤offset</h3><p>åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè‡ªåŠ¨æäº¤offsetï¼Œæ¼”ç¤ºæ¶ˆæ¯æ¶ˆè´¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 1. æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">"localhost:9092"</span>);</span><br><span class="line">        <span class="comment">// è‡ªåŠ¨æäº¤offset</span></span><br><span class="line">        properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// æäº¤offsetçš„æ—¶é—´ï¼Œå•ä½msï¼Œå³1ç§’é’Ÿæäº¤ä¸€æ¬¡</span></span><br><span class="line">        properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, <span class="string">"1000"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šk-vååºåˆ—åŒ–è§„åˆ™</span></span><br><span class="line">        properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</span><br><span class="line">        properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">        properties.put(ConsumerConfig.GROUP_ID_CONFIG, <span class="string">"my-group"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºæ¶ˆè´¹è€…</span></span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(properties);</span><br><span class="line">        <span class="comment">// è®¢é˜…ä¸»é¢˜</span></span><br><span class="line">        consumer.subscribe(Collections.singletonList(<span class="string">"test"</span>));</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="comment">// æ‹‰å–æ•°æ®ï¼ŒæŒ‡å®šè½®è¯¢æ—¶é—´ä¸º1ç§’</span></span><br><span class="line">            ConsumerRecords&lt;String, String&gt; consumerRecords = consumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) &#123;</span><br><span class="line">                System.out.println(consumerRecord.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯åŠ¨æ¶ˆè´¹è€…ï¼Œç„¶åå†ä½¿ç”¨ç”Ÿäº§è€…å‘é€<code>mrbird</code>æ¶ˆæ¯åˆ°testä¸»é¢˜ï¼Œæ¶ˆè´¹è€…æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConsumerRecord(topic = test, partition = 0, leaderEpoch = 0, offset = 6, CreateTime = 1585811850841, serialized key size = -1, serialized value size = 6, headers = RecordHeaders(headers = [], isReadOnly = false), key = null, value = mrbird)</span><br></pre></td></tr></table></figure><p></p><h3 id="æ‰‹åŠ¨æäº¤offset"><a href="#æ‰‹åŠ¨æäº¤offset" class="headerlink" title="æ‰‹åŠ¨æäº¤offset"></a>æ‰‹åŠ¨æäº¤offset</h3><p>è™½ç„¶è‡ªåŠ¨æäº¤ offset ååˆ†ä¾¿åˆ©ï¼Œä½†ç”±äºå…¶æ˜¯åŸºäºæ—¶é—´æäº¤çš„ï¼Œå¼€å‘äººå‘˜éš¾ä»¥æŠŠæ¡ offset æäº¤çš„æ—¶æœºã€‚å› æ­¤ Kafka è¿˜æä¾›äº†æ‰‹åŠ¨æäº¤ offset çš„ APIã€‚</p><p>æ‰‹åŠ¨æäº¤ offset çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šåˆ†åˆ«æ˜¯ <strong>commitSync</strong>ï¼ˆåŒæ­¥æäº¤ï¼‰å’Œ <strong>commitAsync</strong>ï¼ˆå¼‚æ­¥æäº¤ï¼‰ã€‚ä¸¤è€…çš„ç›¸åŒç‚¹æ˜¯ï¼Œéƒ½ä¼šå°†æœ¬æ¬¡ poll çš„ä¸€æ‰¹æ•°æ®æœ€é«˜çš„åç§»é‡æäº¤ï¼›ä¸åŒç‚¹æ˜¯ï¼ŒcommitSync é˜»å¡å½“å‰çº¿ç¨‹ï¼Œä¸€ç›´åˆ°æäº¤æˆåŠŸï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å¤±è´¥é‡è¯•ï¼ˆç”±ä¸å¯æ§å› ç´ å¯¼è‡´ï¼Œä¹Ÿä¼šå‡ºç°æäº¤å¤±è´¥ï¼‰ï¼›è€Œ commitAsync åˆ™æ²¡æœ‰å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œæ•…æœ‰å¯èƒ½æäº¤å¤±è´¥ã€‚</p><p>ç”±äºåŒæ­¥æäº¤ offset æœ‰å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œæ•…æ›´åŠ å¯é ï¼Œä»¥ä¸‹ä¸ºåŒæ­¥æäº¤ offset çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 1. æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">"localhost:9092"</span>);</span><br><span class="line">        <span class="comment">// å…³é—­è‡ªåŠ¨æäº¤offset</span></span><br><span class="line">        properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šk-vååºåˆ—åŒ–è§„åˆ™</span></span><br><span class="line">        properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</span><br><span class="line">        properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">        properties.put(ConsumerConfig.GROUP_ID_CONFIG, <span class="string">"my-group"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºæ¶ˆè´¹è€…</span></span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(properties);</span><br><span class="line">        <span class="comment">// è®¢é˜…ä¸»é¢˜</span></span><br><span class="line">        consumer.subscribe(Collections.singletonList(<span class="string">"test"</span>));</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">// æ‹‰å–æ•°æ®ï¼ŒæŒ‡å®šè½®è¯¢æ—¶é—´ä¸º1ç§’</span></span><br><span class="line">            ConsumerRecords&lt;String, String&gt; consumerRecords = consumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) &#123;</span><br><span class="line">                System.out.println(consumerRecord.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åŒæ­¥æäº¤</span></span><br><span class="line">            consumer.commitSync();</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>commitSync()</code>ä¹Ÿå¯ä»¥æŒ‡å®šè¶…æ—¶æ—¶é—´ã€‚</p><p>è™½ç„¶åŒæ­¥æäº¤ offset æ›´å¯é ä¸€äº›ï¼Œä½†æ˜¯ç”±äºå…¶ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æäº¤æˆåŠŸã€‚å› æ­¤ååé‡ä¼šæ”¶åˆ°å¾ˆå¤§çš„å½±å“ã€‚æ›´å¤šçš„æƒ…å†µä¸‹ï¼Œä¼šé€‰ç”¨å¼‚æ­¥æäº¤ offset çš„æ–¹å¼ã€‚</p><p>ä»¥ä¸‹ä¸ºå¼‚æ­¥æäº¤ offset çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 1. æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">"localhost:9092"</span>);</span><br><span class="line">        <span class="comment">// å…³é—­è‡ªåŠ¨æäº¤offset</span></span><br><span class="line">        properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// æäº¤offsetçš„æ—¶é—´ï¼Œå•ä½msï¼Œå³1ç§’é’Ÿæäº¤ä¸€æ¬¡</span></span><br><span class="line">        properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, <span class="string">"1000"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šk-vååºåˆ—åŒ–è§„åˆ™</span></span><br><span class="line">        properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</span><br><span class="line">        properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">        properties.put(ConsumerConfig.GROUP_ID_CONFIG, <span class="string">"my-group"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºæ¶ˆè´¹è€…</span></span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(properties);</span><br><span class="line">        <span class="comment">// è®¢é˜…ä¸»é¢˜</span></span><br><span class="line">        consumer.subscribe(Collections.singletonList(<span class="string">"test"</span>));</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="comment">// æ‹‰å–æ•°æ®ï¼ŒæŒ‡å®šè½®è¯¢æ—¶é—´ä¸º1ç§’</span></span><br><span class="line">            ConsumerRecords&lt;String, String&gt; consumerRecords = consumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) &#123;</span><br><span class="line">                System.out.println(consumerRecord.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¼‚æ­¥æäº¤</span></span><br><span class="line">            consumer.commitAsync();</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>commitAsync()</code>å¯ä»¥æŒ‡å®šå›è°ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">consumer.commitAsync((offsets, exception) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (exception == <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">"æäº¤offset: "</span> + offsets + <span class="string">"æˆåŠŸ"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"æäº¤å¤±è´¥"</span>);</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><div class="note danger">æ— è®ºæ˜¯åŒæ­¥æäº¤è¿˜æ˜¯å¼‚æ­¥æäº¤ offsetï¼Œéƒ½æœ‰å¯èƒ½ä¼šé€ æˆæ•°æ®çš„æ¼æ¶ˆè´¹æˆ–è€…é‡å¤æ¶ˆè´¹ã€‚å…ˆæäº¤ offset åæ¶ˆè´¹ï¼Œæœ‰å¯èƒ½é€ æˆæ•°æ®çš„æ¼æ¶ˆè´¹ï¼›è€Œå…ˆæ¶ˆè´¹åæäº¤ offsetï¼Œæœ‰å¯èƒ½ä¼šé€ æˆæ•°æ®çš„é‡å¤æ¶ˆè´¹ã€‚</div><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><p>Producer æ‹¦æˆªå™¨(interceptor)æ˜¯åœ¨ Kafka 0.10 ç‰ˆæœ¬è¢«å¼•å…¥çš„ï¼Œinterceptor ä½¿å¾—ç”¨æˆ·åœ¨æ¶ˆæ¯å‘é€å‰ä»¥åŠ producer å›è°ƒé€»è¾‘å‰æœ‰æœºä¼šå¯¹æ¶ˆæ¯åšä¸€äº›å®šåˆ¶åŒ–éœ€æ±‚ï¼Œæ¯”å¦‚ä¿®æ”¹æ¶ˆæ¯ç­‰ã€‚åŒæ—¶ï¼Œproducer å…è®¸ç”¨æˆ·æŒ‡å®šå¤šä¸ª interceptoræŒ‰é¡ºåºå½¢æˆä¸€ä¸ªæ‹¦æˆªå™¨é“¾(interceptor chain)ã€‚Intercetpor çš„å®ç°æ¥å£æ˜¯ <code>org.apache.kafka.clients.producer.ProducerInterceptor</code>ï¼Œå…¶å®šä¹‰çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><p><img src="img/QQ20200402-154559@2x.png" alt="QQ20200402-154559@2x"></p><ul><li>configure(configs)ï¼šè·å–é…ç½®ä¿¡æ¯å’Œåˆå§‹åŒ–æ•°æ®æ—¶è°ƒç”¨ï¼›</li><li><p>onSend(ProducerRecord)ï¼šåœ¨æ¶ˆæ¯è¢«åºåˆ—åŒ–ä»¥åŠè®¡ç®—åˆ†åŒºå‰è°ƒç”¨è¯¥æ–¹æ³•ã€‚ç”¨æˆ·å¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­å¯¹æ¶ˆæ¯åšä»»ä½•æ“ä½œï¼Œä½†æœ€å¥½ä¸è¦ä¿®æ”¹æ¶ˆæ¯æ‰€å±çš„ topic å’Œåˆ†åŒºï¼Œå¦åˆ™ä¼šå½±å“ç›®æ ‡åˆ†åŒºçš„è®¡ç®—ï¼›</p></li><li><p>onAcknowledgement(RecordMetadata, Exception)ï¼šåœ¨è¿”å›ackæ—¶ï¼Œæˆ–è€…å‘é€å¤±è´¥æ—¶è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p></li><li>closeï¼šå…³é—­ interceptorï¼Œä¸»è¦ç”¨äºæ‰§è¡Œä¸€äº›èµ„æºæ¸…ç†å·¥ä½œã€‚</li></ul><p>ä¸‹é¢ä¸¾ä¸ªè‡ªå®šä¹‰æ‹¦æˆªå™¨çš„ä¾‹å­ï¼šå®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨é“¾ï¼ŒåŒ…å«ä¸¤ä¸ªæ‹¦æˆªå™¨<code>MessageFormatInterceptor</code>å’Œ<code>CountInterceptor</code>ï¼Œåˆ†åˆ«ç”¨äºæ¶ˆæ¯åŠ å·¥å’Œç»Ÿè®¡æ¶ˆæ¯å‘é€æˆåŠŸå’Œå¤±è´¥çš„ç¬”æ•°ã€‚</p><p>å®šä¹‰<code>MessageFormatInterceptor</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageFormatInterceptor</span> <span class="keyword">implements</span> <span class="title">ProducerInterceptor</span>&lt;<span class="title">String</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProducerRecord&lt;String, String&gt; <span class="title">onSend</span><span class="params">(ProducerRecord&lt;String, String&gt; record)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ProducerRecord&lt;&gt;(record.topic(), record.partition(), record.timestamp(), record.key(),</span><br><span class="line">                System.currentTimeMillis() + <span class="string">" - "</span> + record.value());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAcknowledgement</span><span class="params">(RecordMetadata metadata, Exception exception)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(Map&lt;String, ?&gt; configs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å®šä¹‰<code>CountInterceptor</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountInterceptor</span> <span class="keyword">implements</span> <span class="title">ProducerInterceptor</span>&lt;<span class="title">String</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> errorCounter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> successCounter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProducerRecord&lt;String, String&gt; <span class="title">onSend</span><span class="params">(ProducerRecord&lt;String, String&gt; record)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> record;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAcknowledgement</span><span class="params">(RecordMetadata metadata, Exception exception)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (exception == <span class="keyword">null</span>) &#123;</span><br><span class="line">            successCounter++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            errorCounter++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æˆåŠŸç¬”æ•°: "</span> + successCounter);</span><br><span class="line">        System.out.println(<span class="string">"å¤±è´¥ç¬”æ•°: "</span> + errorCounter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(Map&lt;String, ?&gt; configs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å…¶å®è¿™ä¸¤ä¸ªåŠŸèƒ½å®Œå…¨å¯ä»¥ç”±ä¸€ä¸ªè¿‡æ»¤å™¨æ¥å®Œæˆï¼Œè¿™é‡Œä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºè¿‡æ»¤å™¨é“¾ã€‚</p><p>åœ¨ç”Ÿäº§è€…é…ç½®ä¸­æŒ‡å®šè¿™ä¸ªè¿‡æ»¤å™¨é“¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. ç”Ÿäº§è€…é…ç½®</span></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="comment">// æŒ‡å®škafkaåœ°å€</span></span><br><span class="line">        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">"localhost:9092"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šackç­‰çº§</span></span><br><span class="line">        properties.put(ProducerConfig.ACKS_CONFIG, <span class="string">"all"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šé‡è¯•æ¬¡æ•°ï¼Œå³ç”Ÿäº§è€…å‘é€æ•°æ®åæ²¡æœ‰æ”¶åˆ°ackåº”ç­”æ—¶çš„é‡è¯•æ¬¡æ•°</span></span><br><span class="line">        properties.put(ProducerConfig.RETRIES_CONFIG, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ‰¹æ¬¡å¤§å° 16k = 16 * 1024</span></span><br><span class="line">        properties.put(ProducerConfig.BATCH_SIZE_CONFIG, <span class="number">16384</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line">        properties.put(ProducerConfig.LINGER_MS_CONFIG, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šRecordAccumulatorç¼“å†²åŒºå¤§å° 32m = 32 * 1024 * 1024</span></span><br><span class="line">        properties.put(ProducerConfig.BUFFER_MEMORY_CONFIG, <span class="number">33554432</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šk-våºåˆ—åŒ–è§„åˆ™</span></span><br><span class="line">        properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringSerializer"</span>);</span><br><span class="line">        properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, <span class="string">"org.apache.kafka.common.serialization.StringSerializer"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šè¿‡æ»¤å™¨é“¾</span></span><br><span class="line">        properties.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG, Arrays.asList(<span class="string">"cc.mrbird.kafka.MessageFormatInterceptor"</span>, <span class="string">"cc.mrbird.kafka.CountInterceptor"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºç”Ÿäº§è€…</span></span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = <span class="keyword">new</span> KafkaProducer&lt;&gt;(properties);</span><br><span class="line">        <span class="comment">// 3. å‡†å¤‡æ•°æ®</span></span><br><span class="line">        ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(<span class="string">"test"</span>, <span class="string">"kafka"</span>);</span><br><span class="line">        <span class="comment">// 4. å‘é€æ•°æ®</span></span><br><span class="line">        producer.send(record);</span><br><span class="line">        <span class="comment">// 5. å…³é—­è¿æ¥</span></span><br><span class="line">        producer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºï¼Œæ§åˆ¶å°è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æˆåŠŸç¬”æ•°: 1</span><br><span class="line">å¤±è´¥ç¬”æ•°: 0</span><br></pre></td></tr></table></figure><p></p><p>æ¶ˆè´¹è€…ï¼š</p><p><img src="img/QQ20200402-160619@2x.png" alt="QQ20200402-160619@2x"></p><blockquote><p>ã€Œå°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹ Kafkaã€ å­¦ä¹ ç¬”è®°</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;æœ¬èŠ‚æ¼”ç¤ºå¦‚ä½•é€šè¿‡Javaä»£ç åˆ›å»ºKafkaç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œæ‹¦æˆªå™¨ï¼Œä¾èµ–ä½¿ç”¨&lt;a href=&quot;https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients/2.4.1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Kafka-clients&lt;/a&gt;ã€‚å› ä¸ºæˆ‘å®‰è£…çš„Kafkaç‰ˆæœ¬ä¸º2.4.1ï¼Œæ‰€ä»¥ä¾èµ–çš„ç‰ˆæœ¬ä¹Ÿç”¨2.4.1ï¼Œé¿å…å…¼å®¹é—®é¢˜ã€‚æ–°å¢ä¸€ä¸ªmavené¡¹ç›®ï¼Œå¼•å…¥ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kafka" scheme="http://mrbird.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafkaæ¶ˆè´¹è€…</title>
    <link href="http://mrbird.cc/Kafka%E6%B6%88%E8%B4%B9%E8%80%85.html"/>
    <id>http://mrbird.cc/Kafkaæ¶ˆè´¹è€….html</id>
    <published>2020-03-28T14:07:33.000Z</published>
    <updated>2020-04-01T09:09:54.508Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p>Kafkaæ¶ˆè´¹è€…é‡‡ç”¨pullæ‹‰æ¨¡å¼ä»brokerä¸­æ¶ˆè´¹æ•°æ®ã€‚ä¸ä¹‹ç›¸å¯¹çš„pushï¼ˆæ¨ï¼‰æ¨¡å¼å¾ˆéš¾é€‚åº”æ¶ˆè´¹é€Ÿç‡ä¸åŒçš„æ¶ˆè´¹è€…ï¼Œå› ä¸ºæ¶ˆæ¯å‘é€é€Ÿç‡æ˜¯ç”± broker å†³å®šçš„ã€‚å®ƒçš„ç›®æ ‡æ˜¯å°½å¯èƒ½ä»¥æœ€å¿«é€Ÿåº¦ä¼ é€’æ¶ˆæ¯ï¼Œä½†æ˜¯è¿™æ ·å¾ˆå®¹æ˜“é€ æˆ consumer æ¥ä¸åŠå¤„ç†æ¶ˆæ¯ã€‚è€Œ pull æ¨¡å¼åˆ™å¯ä»¥æ ¹æ® consumer çš„æ¶ˆè´¹èƒ½åŠ›ä»¥é€‚å½“çš„é€Ÿç‡æ¶ˆè´¹æ¶ˆæ¯ã€‚pull æ¨¡å¼ä¸è¶³ä¹‹å¤„æ˜¯ï¼Œå¦‚æœ kafka æ²¡æœ‰æ•°æ®ï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¼šé™·å…¥å¾ªç¯ä¸­ï¼Œä¸€ç›´è¿”å›ç©ºæ•°æ®ã€‚é’ˆå¯¹è¿™ä¸€ç‚¹ï¼ŒKafka çš„æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ•°æ®æ—¶ä¼šä¼ å…¥ä¸€ä¸ªæ—¶é•¿å‚æ•° timeoutï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ•°æ®å¯ä¾›æ¶ˆè´¹ï¼Œconsumer ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ä¹‹åå†è¿”å›ï¼Œè¿™æ®µæ—¶é•¿å³ä¸º timeoutã€‚</p><a id="more"></a><h2 id="æ¶ˆè´¹è€…ç»„"><a href="#æ¶ˆè´¹è€…ç»„" class="headerlink" title="æ¶ˆè´¹è€…ç»„"></a>æ¶ˆè´¹è€…ç»„</h2><p>æ¶ˆè´¹è€…ç»„ï¼ˆconsumer groupï¼‰ä¸æ¶ˆè´¹è€…ä¹‹é—´å¯†åˆ‡ç›¸å…³ã€‚åœ¨Kafkaä¸­ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å…±åŒæ„æˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œè€Œä¸€ä¸ªæ¶ˆè´¹è€…åªèƒ½ä»å²äºä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œæ¶ˆè´¹è€…ç»„æœ€ä¸ºé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯å®ç°å¹¿æ’­ä¸å•æ’­çš„åŠŸèƒ½ã€‚ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥ç¡®ä¿å…¶æ‰€è®¢é˜…çš„Topicçš„æ¯ä¸ªåˆ†åŒºåªèƒ½è¢«ä»å±äºè¯¥æ¶ˆè´¹è€…ç»„ä¸­çš„å”¯ä¸€ä¸€ä¸ªæ¶ˆè´¹è€…æ‰€æ¶ˆè´¹ï¼›å¦‚æœä¸åŒçš„æ¶ˆè´¹è€…ç»„è®¢é˜…äº†åŒä¸€ä¸ªTopicï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆè´¹è€…ç»„ä¹‹é—´æ˜¯å½¼æ­¤ç‹¬ç«‹çš„ï¼Œä¸ä¼šå—åˆ°ç›¸äº’çš„å¹²æ‰°ã€‚</p><div class="note info">å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€æ¡æ¶ˆæ€å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…æ‰€æ¶ˆè´¹ï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™äº›æ¶ˆè´¹è€…æ”¾åˆ°ä¸åŒçš„æ¶ˆè´¹è€…ç»„ä¸­ï¼Œè¿™å®é™…ä¸Šå°±æ˜¯å¹¿æ’­çš„æ•ˆæœï¼›å¦‚æœå¸Œæœ›ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ‰€æ¶ˆè´¹ï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™äº›æ¶ˆè´¹è€…æ”¾åˆ°åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œè¿™å®é™…ä¸Šå°±æ˜¯å•æ’­çš„æ•ˆæœã€‚</div><h2 id="åˆ†åŒºåˆ†é…ç­–ç•¥"><a href="#åˆ†åŒºåˆ†é…ç­–ç•¥" class="headerlink" title="åˆ†åŒºåˆ†é…ç­–ç•¥"></a>åˆ†åŒºåˆ†é…ç­–ç•¥</h2><p>ä¸€ä¸ª consumer group ä¸­æœ‰å¤šä¸ª consumerï¼Œä¸€ä¸ª topic æœ‰å¤šä¸ª partitionï¼Œæ‰€ä»¥å¿…ç„¶ä¼šæ¶‰åŠåˆ° partition çš„åˆ†é…é—®é¢˜ï¼Œå³ç¡®å®šé‚£ä¸ª partition ç”±å“ªä¸ª consumer æ¥æ¶ˆè´¹ã€‚</p><p>Kafka æœ‰ä¸¤ç§åˆ†é…ç­–ç•¥ï¼Œä¸€æ˜¯ RoundRobinï¼Œä¸€æ˜¯ Rangeã€‚</p><h3 id="RoundRobin"><a href="#RoundRobin" class="headerlink" title="RoundRobin"></a>RoundRobin</h3><p>RoundRobinå³è½®è¯¢çš„æ„æ€ï¼Œæ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªä¸‰ä¸ªæ¶ˆè´¹è€…ConsumerAã€ConsumerBå’ŒConsumerCç»„æˆçš„æ¶ˆè´¹è€…ç»„ï¼ŒåŒæ—¶æ¶ˆè´¹TopicAä¸»é¢˜æ¶ˆæ¯ï¼ŒTopicAåˆ†ä¸º7ä¸ªåˆ†åŒºï¼Œå¦‚æœé‡‡ç”¨RoundRobinåˆ†é…ç­–ç•¥ï¼Œè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200401-145222@2x.png" alt="QQ20200401-145222@2x"></p><p>è¿™ç§è½®è¯¢çš„æ–¹å¼åº”è¯¥å¾ˆå¥½ç†è§£ã€‚ä½†å¦‚æœæ¶ˆè´¹è€…ç»„æ¶ˆè´¹å¤šä¸ªä¸»é¢˜çš„å¤šä¸ªåˆ†åŒºï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿæ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªä¸¤ä¸ªæ¶ˆè´¹è€…ConsumerAå’ŒConsumerBç»„æˆçš„æ¶ˆè´¹è€…ç»„ï¼ŒåŒæ—¶æ¶ˆè´¹TopicAå’ŒTopicBä¸»é¢˜æ¶ˆæ¯ï¼Œå¦‚æœé‡‡ç”¨RoundRobinåˆ†é…ç­–ç•¥ï¼Œè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200401-150317@2x.png" alt="QQ20200401-150317@2x"></p><blockquote><p>æ³¨ï¼šTAP0è¡¨ç¤ºTopicA Partition0åˆ†åŒºæ•°æ®ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></blockquote><p>è¿™ç§æƒ…å†µä¸‹ï¼Œé‡‡ç”¨RoundRobinç®—æ³•åˆ†é…ï¼Œå¤šä¸ªä¸»é¢˜ä¼šè¢«å½“åšä¸€ä¸ªæ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ•´ä½“åŒ…å«äº†å„è‡ªçš„Partitionï¼Œæ¯”å¦‚åœ¨<a href="https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients/2.4.1" target="_blank" rel="noopener">Kafka-clients</a>ä¾èµ–ä¸­ï¼Œä¸ä¹‹å¯¹åº”çš„å¯¹è±¡ä¸º<code>TopicPartition</code>ã€‚æ¥ç€å°†è¿™äº›<code>TopicPartition</code>æ ¹æ®å…¶å“ˆå¸Œå€¼è¿›è¡Œæ’åºï¼Œæ’åºåé‡‡ç”¨è½®è¯¢çš„æ–¹å¼åˆ†é…ç»™æ¶ˆè´¹è€…ã€‚</p><p>ä½†è¿™ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šå‡å¦‚ä¸Šå›¾ä¸­çš„æ¶ˆè´¹è€…ç»„ä¸­ï¼ŒConsumerAåªè®¢é˜…äº†TopicAä¸»é¢˜ï¼ŒConsumerBåªè®¢é˜…äº†TopicBä¸»é¢˜ï¼Œé‡‡ç”¨RoundRobinè½®è¯¢ç®—æ³•åï¼Œå¯èƒ½ä¼šå‡ºç°ConsumerAæ¶ˆè´¹äº†TopicBä¸»é¢˜åˆ†åŒºé‡Œçš„æ¶ˆæ¯ï¼ŒConsumerBæ¶ˆè´¹äº†TopicAä¸»é¢˜åˆ†åŒºé‡Œçš„æ¶ˆæ¯ã€‚</p><div class="note info">ç»¼ä¸Šæ‰€è¿°ï¼ŒRoundRobinç®—æ³•åªé€‚ç”¨äºæ¶ˆè´¹è€…ç»„ä¸­æ¶ˆè´¹è€…è®¢é˜…çš„ä¸»é¢˜ç›¸åŒçš„æƒ…å†µã€‚åŒæ—¶ä¼šå‘ç°ï¼Œé‡‡ç”¨RoundRobinç®—æ³•ï¼Œæ¶ˆè´¹è€…ç»„é‡Œçš„æ¶ˆè´¹è€…ä¹‹é—´æ¶ˆè´¹çš„æ¶ˆæ¯ä¸ªæ•°æœ€å¤šç›¸å·®1ä¸ªã€‚</div><h3 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h3><p>Kafkaé»˜è®¤é‡‡ç”¨Rangeåˆ†é…ç­–ç•¥ï¼ŒRangeé¡¾åæ€ä¹‰å°±æ˜¯æŒ‰èŒƒå›´åˆ’åˆ†çš„æ„æ€ã€‚</p><p>æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªä¸‰ä¸ªæ¶ˆè´¹è€…ConsumerAã€ConsumerBå’ŒConsumerCç»„æˆçš„æ¶ˆè´¹è€…ç»„ï¼ŒåŒæ—¶æ¶ˆè´¹TopicAä¸»é¢˜æ¶ˆæ¯ï¼ŒTopicAåˆ†ä¸º7ä¸ªåˆ†åŒºï¼Œå¦‚æœé‡‡ç”¨Rangeåˆ†é…ç­–ç•¥ï¼Œè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200401-152904@2x.png" alt="QQ20200401-152904@2x"></p><p>å‡å¦‚ç°åœ¨æœ‰ä¸€ä¸ªä¸¤ä¸ªæ¶ˆè´¹è€…ConsumerAå’ŒConsumerBç»„æˆçš„æ¶ˆè´¹è€…ç»„ï¼ŒåŒæ—¶æ¶ˆè´¹TopicAå’ŒTopicBä¸»é¢˜æ¶ˆæ¯ï¼Œå¦‚æœé‡‡ç”¨Rangeåˆ†é…ç­–ç•¥ï¼Œè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200401-153300@2x.png" alt="QQ20200401-153300@2x"></p><p>Rangeç®—æ³•å¹¶ä¸ä¼šæŠŠå¤šä¸ªä¸»é¢˜åˆ†åŒºå½“æˆä¸€ä¸ªæ•´ä½“ã€‚</p><div class="note info">ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºRangeç®—æ³•çš„ä¸€ä¸ªå¼Šç«¯ï¼šé‚£å°±æ˜¯åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…çš„æ¶ˆè´¹è€…æ¶ˆè´¹çš„æ¶ˆæ¯æ•°é‡ç›¸å·®å¯èƒ½è¾ƒå¤§ã€‚</div><h2 id="offsetç»´æŠ¤"><a href="#offsetç»´æŠ¤" class="headerlink" title="offsetç»´æŠ¤"></a>offsetç»´æŠ¤</h2><p>offsetç”±æ¶ˆæ¯çš„ä¸»é¢˜Topic+åˆ†åŒºPartitionå’Œæ¶ˆè´¹è€…ç»„åç§°å”¯ä¸€ç¡®å®šã€‚</p><p>ç”±äº consumer åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°æ–­ç”µå®•æœºç­‰æ•…éšœï¼Œconsumer æ¢å¤åï¼Œéœ€è¦ä»æ•… éšœå‰çš„ä½ç½®çš„ç»§ç»­æ¶ˆè´¹ï¼Œæ‰€ä»¥ consumer éœ€è¦å®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°äº†å“ªä¸ª offsetï¼Œä»¥ä¾¿æ•…éšœæ¢ å¤åç»§ç»­æ¶ˆè´¹ã€‚</p><p>Kafka 0.9 ç‰ˆæœ¬ä¹‹å‰ï¼Œconsumer é»˜è®¤å°† offset ä¿å­˜åœ¨ Zookeeper ä¸­ï¼Œä» 0.9 ç‰ˆæœ¬å¼€å§‹ï¼Œ consumer é»˜è®¤å°† offset ä¿å­˜åœ¨ Kafka ä¸€ä¸ªå†…ç½®çš„ topic ä¸­ï¼Œè¯¥ topic ä¸º__consumer_offsetsã€‚</p><blockquote><p>ã€Œå°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹ Kafkaã€ å­¦ä¹ ç¬”è®°</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;Kafkaæ¶ˆè´¹è€…é‡‡ç”¨pullæ‹‰æ¨¡å¼ä»brokerä¸­æ¶ˆè´¹æ•°æ®ã€‚ä¸ä¹‹ç›¸å¯¹çš„pushï¼ˆæ¨ï¼‰æ¨¡å¼å¾ˆéš¾é€‚åº”æ¶ˆè´¹é€Ÿç‡ä¸åŒçš„æ¶ˆè´¹è€…ï¼Œå› ä¸ºæ¶ˆæ¯å‘é€é€Ÿç‡æ˜¯ç”± broker å†³å®šçš„ã€‚å®ƒçš„ç›®æ ‡æ˜¯å°½å¯èƒ½ä»¥æœ€å¿«é€Ÿåº¦ä¼ é€’æ¶ˆæ¯ï¼Œä½†æ˜¯è¿™æ ·å¾ˆå®¹æ˜“é€ æˆ consumer æ¥ä¸åŠå¤„ç†æ¶ˆæ¯ã€‚è€Œ pull æ¨¡å¼åˆ™å¯ä»¥æ ¹æ® consumer çš„æ¶ˆè´¹èƒ½åŠ›ä»¥é€‚å½“çš„é€Ÿç‡æ¶ˆè´¹æ¶ˆæ¯ã€‚pull æ¨¡å¼ä¸è¶³ä¹‹å¤„æ˜¯ï¼Œå¦‚æœ kafka æ²¡æœ‰æ•°æ®ï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¼šé™·å…¥å¾ªç¯ä¸­ï¼Œä¸€ç›´è¿”å›ç©ºæ•°æ®ã€‚é’ˆå¯¹è¿™ä¸€ç‚¹ï¼ŒKafka çš„æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ•°æ®æ—¶ä¼šä¼ å…¥ä¸€ä¸ªæ—¶é•¿å‚æ•° timeoutï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ•°æ®å¯ä¾›æ¶ˆè´¹ï¼Œconsumer ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ä¹‹åå†è¿”å›ï¼Œè¿™æ®µæ—¶é•¿å³ä¸º timeoutã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kafka" scheme="http://mrbird.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafkaç”Ÿäº§è€…</title>
    <link href="http://mrbird.cc/Kafka%E7%94%9F%E4%BA%A7%E8%80%85.html"/>
    <id>http://mrbird.cc/Kafkaç”Ÿäº§è€….html</id>
    <published>2020-03-26T14:07:25.000Z</published>
    <updated>2020-04-01T11:40:08.244Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p>Kafkaç”Ÿäº§è€…ç”¨äºç”Ÿäº§æ¶ˆæ¯ã€‚é€šè¿‡å‰é¢çš„å†…å®¹æˆ‘ä»¬çŸ¥é“ï¼ŒKafkaçš„topicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œé‚£ä¹ˆç”Ÿäº§è€…å¦‚ä½•å°†è¿™äº›æ•°æ®å¯é åœ°å‘é€åˆ°è¿™äº›åˆ†åŒºï¼Ÿç”Ÿäº§è€…å‘é€æ•°æ®çš„ä¸åŒçš„åˆ†åŒºçš„ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿé’ˆå¯¹è¿™ä¸¤ä¸ªç–‘é—®ï¼Œè¿™èŠ‚ç®€å•è®°å½•ä¸‹ã€‚</p><a id="more"></a><h2 id="ä¸ºä½•è¦åˆ†åŒº"><a href="#ä¸ºä½•è¦åˆ†åŒº" class="headerlink" title="ä¸ºä½•è¦åˆ†åŒº"></a>ä¸ºä½•è¦åˆ†åŒº</h2><ol><li><p>æ–¹ä¾¿åœ¨é›†ç¾¤ä¸­æ‰©å±•ï¼Œæ¯ä¸ªåˆ†åŒºPartitionå¯ä»¥é€šè¿‡è°ƒæ•´ä»¥é€‚åº”å®ƒæ‰€åœ¨çš„æœºå™¨ï¼Œè€Œä¸€ä¸ª topicåˆå¯ä»¥æœ‰å¤šä¸ªPartitionç»„æˆï¼Œå› æ­¤æ•´ä¸ªé›†ç¾¤å°±å¯ä»¥é€‚åº”ä»»æ„å¤§å°çš„æ•°æ®äº†ï¼›</p></li><li><p>å¯ä»¥æé«˜å¹¶å‘ï¼Œå› ä¸ºKafkaå¯ä»¥ä»¥Partitionä¸ºå•ä½è¿›è¡Œè¯»å†™ã€‚</p></li></ol><h2 id="ç”Ÿäº§è€…å‘é€æ•°æ®åˆ°ä¸åŒåˆ†åŒºçš„ä¾æ®"><a href="#ç”Ÿäº§è€…å‘é€æ•°æ®åˆ°ä¸åŒåˆ†åŒºçš„ä¾æ®" class="headerlink" title="ç”Ÿäº§è€…å‘é€æ•°æ®åˆ°ä¸åŒåˆ†åŒºçš„ä¾æ®"></a>ç”Ÿäº§è€…å‘é€æ•°æ®åˆ°ä¸åŒåˆ†åŒºçš„ä¾æ®</h2><p>ä»¥<a href="https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients/2.4.1" target="_blank" rel="noopener">Kafka-clients</a>ä¾èµ–ä¸ºä¾‹ï¼Œç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯é€šè¿‡<code>ProducerRecord</code>å¯¹è±¡è¡¨ç¤ºï¼Œå…¶é‡è½½äº†6ä¸ªæ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ProducerRecord</span> <span class="params">(String topic, Integer partition, Long timestamp, K key, V value, Iterable&lt;Header&gt; headers)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ProducerRecord</span> <span class="params">(String topic, Integer partition, Long timestamp, K key, V value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ProducerRecord</span> <span class="params">(String topic, Integer partition, K key, V value, Iterable&lt;Header&gt; headers)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ProducerRecord</span> <span class="params">(String topic, Integer partition, K key, V value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ProducerRecord</span> <span class="params">(String topic, K key, V value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ProducerRecord</span> <span class="params">(String topic, V value)</span></span></span><br></pre></td></tr></table></figure><ol><li><p>æŒ‡æ˜ partition çš„æƒ…å†µä¸‹ï¼Œç›´æ¥å°†æŒ‡æ˜çš„å€¼ç›´æ¥ä½œä¸º partiton å€¼ï¼›</p></li><li><p>æ²¡æœ‰æŒ‡æ˜ partition å€¼ä½†æœ‰ key çš„æƒ…å†µä¸‹ï¼Œå°† key çš„ hash å€¼ä¸ topic çš„ partition æ•°è¿›è¡Œå–ä½™å¾—åˆ° partition å€¼ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¸Œæœ›æŸç»„æ¶ˆæ¯åœ¨Kafkaé›†ç¾¤å…¨å±€æœ‰åºï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šç›¸åŒçš„æ¶ˆæ¯keyæ¥å®ç°ï¼›</p></li><li><p>æ—¢æ²¡æœ‰ partition å€¼åˆæ²¡æœ‰ key å€¼çš„æƒ…å†µä¸‹ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶éšæœºç”Ÿæˆä¸€ä¸ªæ•´æ•°ï¼ˆå é¢æ¯æ¬¡è°ƒç”¨åœ¨è¿™ä¸ªæ•´æ•°ä¸Šè‡ªå¢ï¼‰ï¼Œå°†è¿™ä¸ªå€¼ä¸ topic å¯ç”¨çš„ partition æ€»æ•°å–ä½™å¾—åˆ° partition å€¼ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ round-robin ç®—æ³•ã€‚</p></li></ol><h2 id="æ•°æ®å¯é æ€§çš„ä¿è¯"><a href="#æ•°æ®å¯é æ€§çš„ä¿è¯" class="headerlink" title="æ•°æ®å¯é æ€§çš„ä¿è¯"></a>æ•°æ®å¯é æ€§çš„ä¿è¯</h2><p>æ•°æ®å¯é æ€§æŒ‡çš„æ˜¯ï¼š producer å‘é€çš„æ•°æ®ï¼Œèƒ½å¯é çš„å‘é€åˆ°æŒ‡å®šçš„ topicã€‚</p><h3 id="ack"><a href="#ack" class="headerlink" title="ack"></a>ack</h3><p>topic çš„æ¯ä¸ª partition æ”¶åˆ° producer å‘é€çš„æ•°æ®åï¼Œéƒ½éœ€è¦å‘ producer å‘é€ <strong><span style="color:red">ack</span></strong>ï¼ˆ<strong>acknowledgement</strong> ç¡®è®¤æ”¶åˆ°ï¼‰ï¼Œå¦‚æœ producer æ”¶åˆ° ackï¼Œå°±ä¼šè¿›è¡Œä¸‹ä¸€è½®çš„å‘é€ï¼Œå¦åˆ™é‡æ–°å‘é€æ•°æ®ã€‚</p><p>å‰¯æœ¬åŒæ­¥ç­–ç•¥ä¸»è¦æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p><table><tr><th>ç­–ç•¥</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr><tr><td>åŠæ•°ä»¥ä¸Šå®ŒæˆåŒæ­¥ï¼Œå°±å‘é€ ack</td><td>å»¶è¿Ÿä½</td><td>é€‰ä¸¾æ–°çš„ leader æ—¶ï¼Œå®¹å¿ n å°èŠ‚ç‚¹çš„æ•…éšœï¼Œéœ€è¦ 2n+1 ä¸ªå‰¯æœ¬</td></tr><tr><td>å…¨éƒ¨å®ŒæˆåŒæ­¥ï¼Œæ‰å‘é€ack</td><td>é€‰ä¸¾æ–°çš„ leader æ—¶ï¼Œå®¹å¿ n å°èŠ‚ç‚¹çš„æ•…éšœï¼Œéœ€è¦ n+1 ä¸ªå‰¯æœ¬</td><td>å»¶è¿Ÿé«˜</td></tr></table><p>Kafka é€‰æ‹©äº†ç¬¬äºŒç§æ–¹æ¡ˆï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ol><li>åŒæ ·ä¸ºäº†å®¹å¿ n å°èŠ‚ç‚¹çš„æ•…éšœï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆéœ€è¦ 2n+1 ä¸ªå‰¯æœ¬ï¼Œè€Œç¬¬äºŒç§æ–¹æ¡ˆåªéœ€è¦ n+1 ä¸ªå‰¯æœ¬ï¼Œè€Œ Kafka çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰å¤§é‡çš„æ•°æ®ï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆä¼šé€ æˆå¤§é‡æ•°æ®çš„å†—ä½™ã€‚</li><li>è™½ç„¶ç¬¬äºŒç§æ–¹æ¡ˆçš„ç½‘ç»œå»¶è¿Ÿä¼šæ¯”è¾ƒé«˜ï¼Œä½†ç½‘ç»œå»¶è¿Ÿå¯¹ Kafka çš„å½±å“è¾ƒå°ã€‚</li></ol><p>å¯¹äºæŸäº›ä¸å¤ªé‡è¦çš„æ•°æ®ï¼Œå¯¹æ•°æ®çš„å¯é æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œèƒ½å¤Ÿå®¹å¿æ•°æ®çš„å°‘é‡ä¸¢å¤±ï¼Œ æ‰€ä»¥æ²¡å¿…è¦ç­‰æ‰€æœ‰ follower å…¨éƒ¨æ¥æ”¶æˆåŠŸï¼Œäºæ˜¯ Kafka ä¸ºç”¨æˆ·æä¾›äº†ä¸‰ç§å¯é æ€§çº§åˆ«ï¼Œç”¨æˆ·æ ¹æ®å¯¹å¯é æ€§å’Œå»¶è¿Ÿçš„è¦æ±‚è¿›è¡Œæƒè¡¡ï¼Œ é€‰æ‹©ä»¥ä¸‹çš„acks å‚æ•°é…ç½®ï¼š</p><ul><li><p>0ï¼šproducer ä¸ç­‰å¾… broker çš„ ackï¼Œè¿™ä¸€æ“ä½œæä¾›äº†ä¸€ä¸ªæœ€ä½çš„å»¶è¿Ÿï¼Œbroker ä¸€æ¥æ”¶åˆ°è¿˜ æ²¡æœ‰å†™å…¥ç£ç›˜å°±å·²ç»è¿”å›ï¼Œå½“ broker æ•…éšœæ—¶æœ‰å¯èƒ½<span style="color:red">ä¸¢å¤±æ•°æ®</span>ï¼›</p></li><li><p>1ï¼šproducer ç­‰å¾… broker çš„ ackï¼Œpartition çš„ leader è½ç›˜æˆåŠŸåè¿”å› ackï¼Œå¦‚æœåœ¨ follower åŒæ­¥æˆåŠŸä¹‹å‰ leader æ•…éšœï¼Œé‚£ä¹ˆå°†ä¼š<span style="color:red">ä¸¢å¤±æ•°æ®</span>ï¼›</p></li><li><p>-1ï¼ˆallï¼‰ï¼šproducer ç­‰å¾… broker çš„ ackï¼Œpartition çš„ leader å’Œ follower å…¨éƒ¨è½ç›˜æˆåŠŸåæ‰ è¿”å› ackã€‚ä½†æ˜¯å¦‚æœåœ¨ follower åŒæ­¥å®Œæˆåï¼Œbroker å‘é€ ack ä¹‹å‰ï¼Œleader å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆä¼šé€ æˆ<span style="color:red">æ•°æ®é‡å¤</span>ã€‚</p></li></ul><h3 id="ISR"><a href="#ISR" class="headerlink" title="ISR"></a>ISR</h3><p>ç”±äºKafkaå‰¯æœ¬åŒæ­¥ç­–ç•¥é€‰æ‹©çš„æ˜¯è¡¨æ ¼ä¸­çš„ç¬¬äºŒç§ï¼Œå³ç­‰å¾…æ‰€æœ‰followerå‰¯æœ¬åŒæ­¥å®Œæˆï¼Œæ‰å‘é€ackï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥å¦‚ä¸‹é—®é¢˜ï¼Œè®¾æƒ³ä¸‹ï¼šleader æ”¶åˆ°æ•°æ®ï¼Œæ‰€æœ‰ follower éƒ½å¼€å§‹åŒæ­¥æ•°æ®ï¼Œ ä½†æœ‰ä¸€ä¸ª followerï¼Œå› ä¸ºæŸç§æ•…éšœï¼Œè¿Ÿè¿Ÿä¸èƒ½ä¸ leader è¿›è¡ŒåŒæ­¥ï¼Œé‚£ leader å°±è¦ä¸€ç›´ç­‰ä¸‹å»ï¼Œ ç›´åˆ°å®ƒå®ŒæˆåŒæ­¥ï¼Œæ‰èƒ½å‘é€ ackã€‚è¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p>Leader ç»´æŠ¤äº†ä¸€ä¸ªåŠ¨æ€çš„ <strong>in-sync replica set</strong> (<span style="color:red">ISR</span>)ï¼Œæ„ä¸ºå’Œ leader ä¿æŒåŒæ­¥çš„ follower é›† åˆã€‚å½“ ISR ä¸­çš„ follower å®Œæˆæ•°æ®çš„åŒæ­¥ä¹‹åï¼Œleader å°±ä¼šç»™ follower å‘é€ ackã€‚å¦‚æœ follower é•¿æ—¶é—´æœªå‘ leader åŒæ­¥æ•°æ® ï¼Œ åˆ™è¯¥ follower å°†è¢«è¸¢å‡ºISR ï¼Œ è¯¥æ—¶é—´é˜ˆå€¼ç”±<code>replica.lag.time.max.ms</code>å‚æ•°è®¾å®šã€‚Leader å‘ç”Ÿæ•…éšœä¹‹åï¼Œå°±ä¼šä» ISR ä¸­é€‰ä¸¾æ–°çš„ leaderã€‚</p><h3 id="æ•°æ®ä¸€è‡´æ€§é—®é¢˜"><a href="#æ•°æ®ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§é—®é¢˜"></a>æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h3><p>ç”±äºæˆ‘ä»¬å¹¶ä¸èƒ½ä¿è¯Kafkaé›†ç¾¤ä¸­æ¯æ—¶æ¯åˆ»followerçš„é•¿åº¦éƒ½å’Œleaderä¸€è‡´ï¼ˆå³æ•°æ®åŒæ­¥æ˜¯æœ‰æ—¶å»¶çš„ï¼‰ï¼Œé‚£ä¹ˆå½“leaderæŒ‚æ‰é€‰ä¸¾æŸä¸ªfollowerä¸ºæ–°çš„leaderçš„æ—¶å€™ï¼ˆåŸå…ˆæŒ‚æ‰çš„leaderæ¢å¤äº†æˆä¸ºäº†followerï¼‰ï¼Œå¯èƒ½ä¼šå‡ºç°leaderçš„æ•°æ®æ¯”followerè¿˜å°‘çš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ç§æ•°æ®é‡ä¸ä¸€è‡´å¸¦æ¥çš„æ··ä¹±æƒ…å†µï¼ŒKafkaæå‡ºäº†ä»¥ä¸‹æ¦‚å¿µï¼š</p><p><img src="img/QQ20200401-093957@2x.png" alt="QQ20200401-093957@2x"></p><ul><li>LEOï¼ˆLog End Offsetï¼‰ï¼šæŒ‡çš„æ˜¯æ¯ä¸ªå‰¯æœ¬æœ€åä¸€ä¸ªoffsetï¼›</li><li>HWï¼ˆHigh Watherï¼‰ï¼šæŒ‡çš„æ˜¯æ¶ˆè´¹è€…èƒ½è§åˆ°çš„æœ€å¤§çš„ offsetï¼ŒISR é˜Ÿåˆ—ä¸­æœ€å°çš„ LEOã€‚</li></ul><div class="note danger">æ¶ˆè´¹è€…å’Œleaderé€šä¿¡æ—¶ï¼Œåªèƒ½æ¶ˆè´¹HWä¹‹å‰çš„æ•°æ®ï¼ŒHWä¹‹åçš„æ•°æ®å¯¹æ¶ˆè´¹è€…ä¸å¯è§ã€‚</div><p>é’ˆå¯¹è¿™ä¸ªè§„åˆ™ï¼š</p><ul><li><p><strong>å½“followerå‘ç”Ÿæ•…éšœæ—¶</strong>ï¼šfollower å‘ç”Ÿæ•…éšœåä¼šè¢«ä¸´æ—¶è¸¢å‡º ISRï¼Œå¾…è¯¥ follower æ¢å¤åï¼Œfollower ä¼šè¯»å–æœ¬åœ°ç£ç›˜è®°å½•çš„ä¸Šæ¬¡çš„ HWï¼Œå¹¶å°† log æ–‡ä»¶é«˜äº HW çš„éƒ¨åˆ†æˆªå–æ‰ï¼Œä» HW å¼€å§‹å‘ leader è¿›è¡ŒåŒæ­¥ã€‚ç­‰è¯¥ follower çš„ LEO å¤§äºç­‰äºè¯¥ Partition çš„ HWï¼Œå³ follower è¿½ä¸Š leader ä¹‹åï¼Œå°±å¯ä»¥é‡æ–°åŠ å…¥ ISR äº†ã€‚</p></li><li><p><strong>å½“leaderå‘ç”Ÿæ•…éšœæ—¶</strong>ï¼šleader å‘ç”Ÿæ•…éšœä¹‹åï¼Œä¼šä» ISR ä¸­é€‰å‡ºä¸€ä¸ªæ–°çš„ leaderï¼Œä¹‹åï¼Œä¸ºä¿è¯å¤šä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå…¶ä½™çš„ follower ä¼šå…ˆå°†å„è‡ªçš„ log æ–‡ä»¶é«˜äº HW çš„éƒ¨åˆ†æˆªæ‰ï¼Œç„¶åä»æ–°çš„ leader åŒæ­¥æ•°æ®ã€‚</p></li></ul><div class="note danger">æ‰€ä»¥æ•°æ®ä¸€è‡´æ€§å¹¶ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±æˆ–è€…ä¸é‡å¤ï¼Œè¿™æ˜¯ç”±ackæ§åˆ¶çš„ã€‚HWè§„åˆ™åªèƒ½ä¿è¯å‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼</div><h3 id="Exactly-Once"><a href="#Exactly-Once" class="headerlink" title="Exactly Once"></a>Exactly Once</h3><p>å°†æœåŠ¡å™¨çš„ ACK çº§åˆ«è®¾ç½®ä¸º-1ï¼Œå¯ä»¥ä¿è¯ Producer åˆ° Server ä¹‹é—´ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œå³ <strong>At Least Once</strong> è¯­ä¹‰ã€‚ç›¸å¯¹çš„ï¼Œå°†æœåŠ¡å™¨ ACK çº§åˆ«è®¾ç½®ä¸º 0ï¼Œå¯ä»¥ä¿è¯ç”Ÿäº§è€…æ¯æ¡æ¶ˆæ¯åªä¼šè¢« å‘é€ä¸€æ¬¡ï¼Œå³ <strong>At Most Once</strong> è¯­ä¹‰ã€‚</p><p>At Least Once å¯ä»¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ•°æ®ä¸é‡å¤ï¼›ç›¸å¯¹çš„ï¼ŒAt Least Once å¯ä»¥ä¿è¯æ•°æ®ä¸é‡å¤ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€äº›éå¸¸é‡è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ äº¤æ˜“æ•°æ®ï¼Œä¸‹æ¸¸æ•°æ®æ¶ˆè´¹è€…è¦æ±‚æ•°æ®æ—¢ä¸é‡å¤ä¹Ÿä¸ä¸¢å¤±ï¼Œå³ <strong>Exactly Once</strong> è¯­ä¹‰ã€‚åœ¨ 0.11 ç‰ˆ æœ¬ä»¥å‰çš„ Kafkaï¼Œå¯¹æ­¤æ˜¯æ— èƒ½ä¸ºåŠ›çš„ï¼Œåªèƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œå†åœ¨ä¸‹æ¸¸æ¶ˆè´¹è€…å¯¹æ•°æ®åšå…¨å±€ å»é‡ã€‚å¯¹äºå¤šä¸ªä¸‹æ¸¸åº”ç”¨çš„æƒ…å†µï¼Œæ¯ä¸ªéƒ½éœ€è¦å•ç‹¬åšå…¨å±€å»é‡ï¼Œè¿™å°±å¯¹æ€§èƒ½é€ æˆäº†å¾ˆå¤§å½±å“ã€‚ 0.11 ç‰ˆæœ¬çš„ Kafkaï¼Œå¼•å…¥äº†ä¸€é¡¹é‡å¤§ç‰¹æ€§ï¼š<strong>å¹‚ç­‰æ€§</strong>ã€‚æ‰€è°“çš„å¹‚ç­‰æ€§å°±æ˜¯æŒ‡ Producer ä¸è®º å‘ Server å‘é€å¤šå°‘æ¬¡é‡å¤æ•°æ®ï¼ŒServer ç«¯éƒ½åªä¼šæŒä¹…åŒ–ä¸€æ¡ã€‚å¹‚ç­‰æ€§ç»“åˆ At Least Once è¯­ ä¹‰ï¼Œå°±æ„æˆäº† Kafka çš„ Exactly Once è¯­ä¹‰ã€‚å³ï¼š</p><div style="text-align:center;font-weight:600;margin:1rem auto">At Least Once + å¹‚ç­‰æ€§ = Exactly Once</div><p>è¦å¯ç”¨å¹‚ç­‰æ€§ï¼Œåªéœ€è¦å°† Producer çš„å‚æ•°ä¸­ <code>enable.idompotence</code> è®¾ç½®ä¸º true å³å¯ã€‚Kafka çš„å¹‚ç­‰æ€§å®ç°å…¶å®å°±æ˜¯å°†åŸæ¥ä¸‹æ¸¸éœ€è¦åšçš„å»é‡æ”¾åœ¨äº†æ•°æ®ä¸Šæ¸¸ã€‚å¼€å¯å¹‚ç­‰æ€§çš„ Producer åœ¨ åˆå§‹åŒ–çš„æ—¶å€™ä¼šè¢«åˆ†é…ä¸€ä¸ª <strong>PID</strong>ï¼Œå‘å¾€åŒä¸€ Partition çš„æ¶ˆæ¯ä¼šé™„å¸¦ Sequence Numberã€‚è€Œ Broker ç«¯ä¼šå¯¹&lt;PID, Partition, SeqNumber&gt;åšç¼“å­˜ï¼Œå½“å…·æœ‰ç›¸åŒä¸»é”®çš„æ¶ˆæ¯æäº¤æ—¶ï¼ŒBroker åª ä¼šæŒä¹…åŒ–ä¸€æ¡ã€‚</p><div class="note danger">ä½†æ˜¯ Produceré‡å¯åï¼Œå…¶ PID å°±ä¼šå˜åŒ–ï¼ŒåŒæ—¶ä¸åŒçš„ Partition ä¹Ÿå…·æœ‰ä¸åŒä¸»é”®ï¼Œæ‰€ä»¥å¹‚ç­‰æ€§æ— æ³•ä¿è¯è·¨ åˆ†åŒºè·¨ä¼šè¯çš„ Exactly Onceã€‚</div><h2 id="ç”Ÿäº§è€…äº‹åŠ¡"><a href="#ç”Ÿäº§è€…äº‹åŠ¡" class="headerlink" title="ç”Ÿäº§è€…äº‹åŠ¡"></a>ç”Ÿäº§è€…äº‹åŠ¡</h2><p>Kafka ä» 0.11 ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†äº‹åŠ¡æ”¯æŒã€‚äº‹åŠ¡å¯ä»¥ä¿è¯ Kafka åœ¨ Exactly Once è¯­ä¹‰çš„åŸºç¡€ä¸Šï¼Œç”Ÿäº§å’Œæ¶ˆè´¹å¯ä»¥è·¨åˆ†åŒºå’Œä¼šè¯ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p><p>ä¸ºäº†å®ç°è·¨åˆ†åŒºè·¨ä¼šè¯çš„äº‹åŠ¡ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ Transaction IDï¼Œå¹¶å°† Producerè·å¾—çš„PID å’ŒTransaction ID ç»‘å®šã€‚è¿™æ ·å½“Producer é‡å¯åå°±å¯ä»¥é€šè¿‡æ­£åœ¨è¿›è¡Œçš„ Transaction ID è·å¾—åŸæ¥çš„ PIDã€‚</p><p>ä¸ºäº†ç®¡ç† Transactionï¼ŒKafka å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç»„ä»¶ Transaction Coordinatorã€‚Producer å°±æ˜¯é€šè¿‡å’Œ Transaction Coordinator äº¤äº’è·å¾— Transaction ID å¯¹åº”çš„ä»»åŠ¡çŠ¶æ€ã€‚Transaction Coordinator è¿˜è´Ÿè´£å°†äº‹åŠ¡æ‰€æœ‰å†™å…¥ Kafka çš„ä¸€ä¸ªå†…éƒ¨ Topicï¼Œè¿™æ ·å³ä½¿æ•´ä¸ªæœåŠ¡é‡å¯ï¼Œç”±äºäº‹åŠ¡çŠ¶æ€å¾—åˆ°ä¿å­˜ï¼Œè¿›è¡Œä¸­çš„äº‹åŠ¡çŠ¶æ€å¯ä»¥å¾—åˆ°æ¢å¤ï¼Œä»è€Œç»§ç»­è¿›è¡Œã€‚</p><blockquote><p>ã€Œå°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹ Kafkaã€ å­¦ä¹ ç¬”è®°</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;Kafkaç”Ÿäº§è€…ç”¨äºç”Ÿäº§æ¶ˆæ¯ã€‚é€šè¿‡å‰é¢çš„å†…å®¹æˆ‘ä»¬çŸ¥é“ï¼ŒKafkaçš„topicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œé‚£ä¹ˆç”Ÿäº§è€…å¦‚ä½•å°†è¿™äº›æ•°æ®å¯é åœ°å‘é€åˆ°è¿™äº›åˆ†åŒºï¼Ÿç”Ÿäº§è€…å‘é€æ•°æ®çš„ä¸åŒçš„åˆ†åŒºçš„ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿé’ˆå¯¹è¿™ä¸¤ä¸ªç–‘é—®ï¼Œè¿™èŠ‚ç®€å•è®°å½•ä¸‹ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kafka" scheme="http://mrbird.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafkaå­˜å‚¨æœºåˆ¶</title>
    <link href="http://mrbird.cc/Kafka%E5%AD%98%E5%82%A8%E6%9C%BA%E5%88%B6.html"/>
    <id>http://mrbird.cc/Kafkaå­˜å‚¨æœºåˆ¶.html</id>
    <published>2020-03-25T14:07:16.000Z</published>
    <updated>2020-03-31T08:03:54.301Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p>Kafkaä¸­æ¶ˆæ¯æ˜¯ä»¥topicè¿›è¡Œåˆ†ç±»çš„ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ï¼Œéƒ½æ˜¯é¢å‘topicã€‚topicæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œè€Œpartitionæ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ªpartitionå¯¹åº”äºä¸€ä¸ªlogæ–‡ä»¶ï¼Œè¯¥logæ–‡ä»¶ä¸­å­˜å‚¨çš„å°±æ˜¯producerç”Ÿäº§çš„æ•°æ®ã€‚Producerç”Ÿäº§çš„æ•°æ®ä¼šè¢«ä¸æ–­è¿½åŠ åˆ°è¯¥logæ–‡ä»¶æœ«ç«¯ï¼Œä¸”æ¯æ¡æ•°æ®éƒ½æœ‰è‡ªå·±çš„offsetã€‚æ¶ˆè´¹è€…ç»„ä¸­çš„æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œéƒ½ä¼šå®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°äº†å“ªä¸ªoffsetï¼Œä»¥ä¾¿å‡ºé”™æ¢å¤æ—¶ï¼Œä»ä¸Šæ¬¡çš„ä½ç½®ç»§ç»­æ¶ˆè´¹ã€‚<a id="more"></a></p><h2 id="topicæ„æˆ"><a href="#topicæ„æˆ" class="headerlink" title="topicæ„æˆ"></a>topicæ„æˆ</h2><p>åœ¨Kafkaä¸­ï¼Œä¸€ä¸ªtopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartitionï¼Œä¸€ä¸ªpartitionåˆ†ä¸ºå¤šä¸ªsegmentï¼Œæ¯ä¸ªsegmentå¯¹åº”ä¸¤ä¸ªæ–‡ä»¶ï¼š.indexå’Œ.logæ–‡ä»¶ï¼š</p><p><img src="img/QQ20200330-183300@2x.png" alt="QQ20200330-183300@2x"></p><h2 id="æ¶ˆæ¯å­˜å‚¨åŸç†"><a href="#æ¶ˆæ¯å­˜å‚¨åŸç†" class="headerlink" title="æ¶ˆæ¯å­˜å‚¨åŸç†"></a>æ¶ˆæ¯å­˜å‚¨åŸç†</h2><p>ç”±äºç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸æ–­è¿½åŠ åˆ°logæ–‡ä»¶æœ«å°¾ï¼Œä¸ºé˜²æ­¢logæ–‡ä»¶è¿‡å¤§å¯¼è‡´æ•°æ®å®šä½æ•ˆç‡ä½ä¸‹ï¼ŒKafkaé‡‡å–äº†<strong>åˆ†ç‰‡</strong>å’Œ<strong>ç´¢å¼•</strong>æœºåˆ¶ï¼Œå°†æ¯ä¸ªpartitionåˆ†ä¸ºå¤šä¸ªsegmentã€‚å¦‚å‰é¢æ‰€è¯´ï¼Œæ¯ä¸ªsegmentå¯¹åº”.indexæ–‡ä»¶å’Œ.logæ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ä½äºä¸€ä¸ªä»¥ç‰¹å®šè§„åˆ™å‘½åçš„æ–‡ä»¶å¤¹ä¸‹ï¼Œè¯¥æ–‡ä»¶å¤¹çš„å‘½å è§„åˆ™ä¸ºï¼štopic åç§° + åˆ†åŒºåºå·ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚åˆ›å»ºäº†ä¸€ä¸ªåç§°ä¸ºtestçš„topicï¼Œè¯¥topicåªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥åœ¨Kafkaæ—¥ä¼šå¿—ç›®å½•ä¸‹ä¼šæœ‰ä¸ªåä¸ºtest-0çš„æ–‡ä»¶å¤¹ï¼š</p><p><img src="img/QQ20200330-183839@2x.png" alt="QQ20200330-183839@2x"></p><p>è¿™äº›æ–‡ä»¶çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç±»åˆ«</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>.index</td><td>åç§»é‡ç´¢å¼•æ–‡ä»¶ï¼Œå­˜å‚¨æ•°æ®å¯¹åº”çš„åç§»é‡</td></tr><tr><td>.timestamp</td><td>æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶</td></tr><tr><td>.log</td><td>æ—¥å¿—æ–‡ä»¶ï¼Œå­˜å‚¨ç”Ÿäº§è€…ç”Ÿäº§çš„æ•°æ®</td></tr><tr><td>.snaphot</td><td>å¿«ç…§æ–‡ä»¶</td></tr><tr></tr><tr><td>Leader-epoch-checkpoint</td><td>ä¿å­˜äº†æ¯ä¸€ä»»leaderå¼€å§‹å†™å…¥æ¶ˆæ¯æ—¶çš„offsetï¼Œä¼šå®šæ—¶æ›´æ–°ã€‚ followerè¢«é€‰ä¸ºleaderæ—¶ä¼šæ ¹æ®è¿™ä¸ªç¡®å®šå“ªäº›æ¶ˆæ¯å¯ç”¨</td></tr></tbody></table><p>indexå’Œlogæ–‡ä»¶ä»¥å½“å‰segmentçš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„åç§»é‡offsetå‘½åã€‚åç§»é‡offsetæ˜¯ä¸€ä¸ª64ä½çš„é•¿æ•´å½¢æ•°ï¼Œå›ºå®šæ˜¯20ä½æ•°å­—ï¼Œé•¿åº¦æœªè¾¾åˆ°ï¼Œç”¨0è¿›è¡Œå¡«è¡¥ï¼Œç´¢å¼•æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶éƒ½ç”±è¯¥ä½œä¸ºæ–‡ä»¶åå‘½åè§„åˆ™ã€‚æ‰€ä»¥ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„åç§»é‡æ˜¯ä»0å¼€å§‹çš„ï¼Œ.indexå’Œ.logæ–‡ä»¶åç§°éƒ½ä¸º00000000000000000000ã€‚</p><p>ä¸ŠèŠ‚ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç”Ÿäº§è€…å‘é€äº†helloå’Œworldä¸¤ä¸ªæ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸‹.logæ–‡ä»¶ä¸‹æ˜¯å¦æœ‰è¿™ä¸¤æ¡æ•°æ®ï¼š</p><p><img src="img/QQ20200331-151427@2x.png" alt="QQ20200331-151427@2x"></p><p>å†…å®¹å­˜åœ¨ä¸€äº›â€ä¹±ç â€œï¼Œå› ä¸ºæ•°æ®æ˜¯ç»è¿‡åºåˆ—åŒ–å‹ç¼©çš„ã€‚</p><p>é‚£ä¹ˆæ•°æ®æ–‡ä»¶.logå¤§å°æœ‰é™åˆ¶å—ï¼Œèƒ½ä¿å­˜å¤šä¹…æ—¶é—´ï¼Ÿè¿™äº›æˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡Kafkaç›®å½•ä¸‹conf/server.propertiesé…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># logæ–‡ä»¶å­˜å‚¨æ—¶é—´ï¼Œå•ä½ä¸ºå°æ—¶ï¼Œè¿™é‡Œè®¾ç½®ä¸º1å‘¨</span><br><span class="line">log.retention.hours=168</span><br><span class="line"></span><br><span class="line"># logæ–‡ä»¶å¤§å°çš„æœ€å¤§å€¼ï¼Œè¿™é‡Œä¸º1gï¼Œè¶…è¿‡è¿™ä¸ªå€¼ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„segmentï¼ˆä¹Ÿå°±æ˜¯æ–°çš„.indexå’Œ.logæ–‡ä»¶ï¼‰</span><br><span class="line">log.segment.bytes=1073741824</span><br></pre></td></tr></table></figure><p></p><p>æ¯”å¦‚ï¼Œå½“ç”Ÿäº§è€…ç”Ÿäº§æ•°æ®é‡è¾ƒå¤šï¼Œä¸€ä¸ªsegmentå­˜å‚¨ä¸ä¸‹è§¦å‘åˆ†ç‰‡æ—¶ï¼Œåœ¨æ—¥å¿—topicç›®å½•ä¸‹ä½ ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹æ‰€ç¤ºçš„æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00000000000000000000.index</span><br><span class="line">00000000000000000000.log</span><br><span class="line">00000000000000170410.index</span><br><span class="line">00000000000000170410.log</span><br><span class="line">00000000000000239430.index</span><br><span class="line">00000000000000239430.log</span><br></pre></td></tr></table></figure><p></p><p>ä¸‹å›¾å±•ç¤ºäº†KafkaæŸ¥æ‰¾æ•°æ®çš„è¿‡ç¨‹ï¼š</p><p><img src="img/QQ20200331-155820@2x.png" alt="QQ20200331-155820@2x"></p><p>æ¯”å¦‚ç°åœ¨è¦æŸ¥æ‰¾åç§»é‡offsetä¸º3çš„æ¶ˆæ¯ï¼Œæ ¹æ®.indexæ–‡ä»¶å‘½åæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œoffsetä¸º3çš„ç´¢å¼•åº”è¯¥ä»0000000000000000000<span style="color:red">0</span>.indexé‡ŒæŸ¥æ‰¾ã€‚æ ¹æ®ä¸Šå›¾æ‰€ç¤ºï¼Œå…¶å¯¹åº”çš„ç´¢å¼•åœ°å€ä¸º756~911ï¼Œæ‰€ä»¥Kafkaå°†è¯»å–0000000000000000000<span style="color:red">0</span>.log 756~911åŒºé—´çš„æ•°æ®ã€‚</p><blockquote><p>ã€Œå°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹ Kafkaã€ å­¦ä¹ ç¬”è®°</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;Kafkaä¸­æ¶ˆæ¯æ˜¯ä»¥topicè¿›è¡Œåˆ†ç±»çš„ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ï¼Œéƒ½æ˜¯é¢å‘topicã€‚topicæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œè€Œpartitionæ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ªpartitionå¯¹åº”äºä¸€ä¸ªlogæ–‡ä»¶ï¼Œè¯¥logæ–‡ä»¶ä¸­å­˜å‚¨çš„å°±æ˜¯producerç”Ÿäº§çš„æ•°æ®ã€‚Producerç”Ÿäº§çš„æ•°æ®ä¼šè¢«ä¸æ–­è¿½åŠ åˆ°è¯¥logæ–‡ä»¶æœ«ç«¯ï¼Œä¸”æ¯æ¡æ•°æ®éƒ½æœ‰è‡ªå·±çš„offsetã€‚æ¶ˆè´¹è€…ç»„ä¸­çš„æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œéƒ½ä¼šå®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°äº†å“ªä¸ªoffsetï¼Œä»¥ä¾¿å‡ºé”™æ¢å¤æ—¶ï¼Œä»ä¸Šæ¬¡çš„ä½ç½®ç»§ç»­æ¶ˆè´¹ã€‚
    
    </summary>
    
    
      <category term="Kafka" scheme="http://mrbird.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafkaå…¥é—¨</title>
    <link href="http://mrbird.cc/Kafka%E5%85%A5%E9%97%A8.html"/>
    <id>http://mrbird.cc/Kafkaå…¥é—¨.html</id>
    <published>2020-03-24T12:07:52.000Z</published>
    <updated>2020-04-01T11:45:55.460Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p><a href="http://kafka.apache.org/" target="_blank" rel="noopener">Kafka</a>æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„åŸºäºå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œä¸»è¦åº”ç”¨äºå¤§æ•°æ®å®æ—¶å¤„ç†é¢†åŸŸã€‚</p><a id="more"></a><h2 id="æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼"><a href="#æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼"></a>æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼</h2><ol><li>ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆä¸€å¯¹ä¸€ï¼Œæ¶ˆè´¹è€…ä¸»åŠ¨æ‹‰å–æ•°æ®ï¼Œæ¶ˆæ¯æ”¶åˆ°åæ¶ˆæ¯æ¸…é™¤ï¼‰ã€‚</li></ol><p>æ¶ˆæ¯ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯å‘é€åˆ°Queueä¸­ï¼Œç„¶åæ¶ˆæ¯æ¶ˆè´¹è€…ä»Queueä¸­å–å‡ºå¹¶ä¸”æ¶ˆè´¹æ¶ˆæ¯ã€‚ æ¶ˆæ¯è¢«æ¶ˆè´¹ä»¥åï¼Œqueue ä¸­ä¸å†æœ‰å­˜å‚¨ï¼Œæ‰€ä»¥æ¶ˆæ¯æ¶ˆè´¹è€…ä¸å¯èƒ½æ¶ˆè´¹åˆ°å·²ç»è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚ Queue æ”¯æŒå­˜åœ¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œä½†æ˜¯å¯¹ä¸€ä¸ªæ¶ˆæ¯è€Œè¨€ï¼Œåªä¼šæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹ã€‚</p><p><img src="img/QQ20200324-202328@2x.png" alt="QQ20200324-202328@2x"></p><ol start="2"><li>å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼ˆä¸€å¯¹å¤šï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®ä¹‹åä¸ä¼šæ¸…é™¤æ¶ˆæ¯ï¼‰ã€‚</li></ol><p>æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆå‘å¸ƒï¼‰å°†æ¶ˆæ¯å‘å¸ƒåˆ° topic ä¸­ï¼ŒåŒæ—¶æœ‰å¤šä¸ªæ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆè®¢é˜…ï¼‰æ¶ˆè´¹è¯¥æ¶ˆæ¯ã€‚å’Œç‚¹å¯¹ç‚¹æ–¹å¼ä¸åŒï¼Œå‘å¸ƒåˆ° topic çš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰è®¢é˜…è€…æ¶ˆè´¹ã€‚</p><p><img src="img/QQ20200324-203201@2x.png" alt="QQ20200324-203103@2x"></p><p>Kafkaå±äºç¬¬2ç§æ¨¡å¼ã€‚</p><h2 id="Kafkaæ¶æ„"><a href="#Kafkaæ¶æ„" class="headerlink" title="Kafkaæ¶æ„"></a>Kafkaæ¶æ„</h2><p><img src="img/QQ20200324-210522@2x.png" alt="QQ20200324-210522@2x"></p><ol><li>Producer ï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯å‘ kafka broker å‘æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼›</li><li>Consumer ï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå‘ kafka broker å–æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼›</li><li>Consumer Group ï¼ˆCGï¼‰ï¼šæ¶ˆè´¹è€…ç»„ï¼Œç”±å¤šä¸ª consumer ç»„æˆã€‚<span style="color:red">æ¶ˆè´¹è€…ç»„å†…æ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®ï¼Œä¸€ä¸ªåˆ†åŒºåªèƒ½ç”±æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼›æ¶ˆè´¹è€…ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚</span>æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½å±äºæŸä¸ªæ¶ˆè´¹è€…ç»„ï¼Œå³æ¶ˆè´¹è€…ç»„æ˜¯é€»è¾‘ä¸Šçš„ä¸€ä¸ªè®¢é˜…è€…ï¼›</li><li>Broker ï¼šä¸€å° kafka æœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ª brokerã€‚ä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ª broker ç»„æˆã€‚ä¸€ä¸ª brokerå¯ä»¥å®¹çº³å¤šä¸ªtopicï¼›</li><li>Topic ï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é¢å‘çš„éƒ½æ˜¯ä¸€ä¸ª topicï¼›</li><li>Partitionï¼šä¸ºäº†å®ç°æ‰©å±•æ€§ï¼Œä¸€ä¸ªéå¸¸å¤§çš„ topic å¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ª brokerï¼ˆå³æœåŠ¡å™¨ï¼‰ä¸Šï¼Œä¸€ä¸ª topic å¯ä»¥åˆ†ä¸ºå¤šä¸ª partitionï¼Œæ¯ä¸ª partition æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼›</li><li>Replicaï¼šå‰¯æœ¬ï¼Œä¸ºä¿è¯é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„ partition æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸” kafka ä»ç„¶èƒ½å¤Ÿç»§ç»­å·¥ä½œï¼Œkafkaæä¾›äº†å‰¯æœ¬æœºåˆ¶ï¼Œä¸€ä¸ª topic çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‹¥å¹²ä¸ªå‰¯æœ¬ï¼Œä¸€ä¸ª leader å’Œè‹¥å¹²ä¸ª followerã€‚</li><li>leaderï¼šæ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬çš„â€œä¸»â€ï¼Œç”Ÿäº§è€…å‘é€æ•°æ®çš„å¯¹è±¡ï¼Œä»¥åŠæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„å¯¹è±¡éƒ½æ˜¯ leaderã€‚</li><li>followerï¼šæ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬ä¸­çš„â€œä»â€ï¼Œå®æ—¶ä» leader ä¸­åŒæ­¥æ•°æ®ï¼Œä¿æŒå’Œ leader æ•°æ®çš„åŒæ­¥ã€‚leader å‘ç”Ÿæ•…éšœæ—¶ï¼ŒæŸä¸ª follower ä¼šæˆä¸ºæ–°çš„followerã€‚</li></ol><p>å¯¹äºæ¯ä¸€ä¸ªtopicï¼Œ Kafkaé›†ç¾¤éƒ½ä¼šç»´æŒä¸€ä¸ªåˆ†åŒºæ—¥å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200331-150027@2x.png" alt="QQ20200331-150027@2x"></p><p>æ¯ä¸ªåˆ†åŒºéƒ½æ˜¯æœ‰åºä¸”é¡ºåºä¸å¯å˜çš„è®°å½•é›†ï¼Œå¹¶ä¸”ä¸æ–­åœ°è¿½åŠ åˆ°ç»“æ„åŒ–çš„commit logæ–‡ä»¶ã€‚åˆ†åŒºä¸­çš„æ¯ä¸€ä¸ªè®°å½•éƒ½ä¼šåˆ†é…ä¸€ä¸ªidå·æ¥è¡¨ç¤ºé¡ºåºï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºoffsetï¼Œoffsetç”¨æ¥å”¯ä¸€çš„æ ‡è¯†åˆ†åŒºä¸­æ¯ä¸€æ¡è®°å½•ã€‚</p><p>Kafkaæ¯ä¸ªåˆ†åŒºçš„æ•°æ®æ˜¯ä¸¥æ ¼æœ‰åºçš„ï¼Œä½†å¤šåˆ†åŒºä¹‹é—´ä¸èƒ½ç¡®ä¿æœ‰åºã€‚</p><h2 id="å®‰è£…ä¸å¯åŠ¨"><a href="#å®‰è£…ä¸å¯åŠ¨" class="headerlink" title="å®‰è£…ä¸å¯åŠ¨"></a>å®‰è£…ä¸å¯åŠ¨</h2><p>æ¼”ç¤ºåœ¨unixç¯å¢ƒä¸‹å®‰è£…ä¸å¯åŠ¨Kafkaã€‚Kafkaä¸‹è½½åœ°å€ï¼š<a href="http://kafka.apache.org/downloadsï¼Œé€‰æ‹©äºŒè¿›åˆ¶æ–‡ä»¶ä¸‹è½½ï¼ˆBinary" target="_blank" rel="noopener">http://kafka.apache.org/downloadsï¼Œé€‰æ‹©äºŒè¿›åˆ¶æ–‡ä»¶ä¸‹è½½ï¼ˆBinary</a> downloadsï¼‰ï¼Œç„¶åè§£å‹å³å¯ã€‚</p><p>Kafkaçš„é…ç½®æ–‡ä»¶ä½äºconfigç›®å½•ä¸‹ï¼Œå› ä¸ºKafkaé›†æˆäº†Zookeeperï¼Œæ‰€ä»¥configç›®å½•ä¸‹é™¤äº†æœ‰Kafkaçš„é…ç½®æ–‡ä»¶server.propertieså¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°ä¸€ä¸ªZookeeperé…ç½®æ–‡ä»¶zookeeper.propertiesã€‚</p><p>åœ¨å¯åŠ¨Kafkaå’ŒZookeeperä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåœ¨Kafkaè§£å‹ç›®å½•ä¸‹åˆ›å»ºå¦‚ä¸‹ä¸¤ä¸ªæ—¥å¿—ç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /Users/mrbird/software/kafka_2.4.1/logs/kafka-logs mkdir /Users/mrbird/software/kafka_2.4.1/logs/zk-logs</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«ç”¨äºå­˜æ”¾Kafkaå’ŒZookeeperæ—¥å¿—ã€‚</p><p>ä¿®æ”¹config/zookeeper.propertiesï¼š</p><p><img src="img/QQ20200324-213631@2x.png" alt="QQ20200324-213631@2x"></p><p>ä¿®æ”¹config/server.properties</p><p><img src="img/QQ20200324-213803@2x.png" alt="QQ20200324-213803@2x"> <img src="img/QQ20200324-213840@2x.png" alt="QQ20200324-213840@2x"></p><p>server.propertiesæ›´å¤šå¯ç”¨é…ç½®åŠå«ä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#broker çš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤</span></span><br><span class="line"><span class="string">broker.id=0</span></span><br><span class="line"><span class="comment">#åˆ é™¤ topic åŠŸèƒ½ä½¿èƒ½</span></span><br><span class="line"><span class="string">delete.topic.enable=true</span></span><br><span class="line"><span class="comment">#å¤„ç†ç½‘ç»œè¯·æ±‚çš„çº¿ç¨‹æ•°é‡</span></span><br><span class="line"><span class="string">num.network.threads=3</span></span><br><span class="line"><span class="comment">#ç”¨æ¥å¤„ç†ç£ç›˜ IO çš„ç°æˆæ•°é‡</span></span><br><span class="line"><span class="string">num.io.threads=8</span></span><br><span class="line"><span class="comment">#å‘é€å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line"><span class="string">socket.send.buffer.bytes=102400</span></span><br><span class="line"><span class="comment">#æ¥æ”¶å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line"><span class="string">socket.receive.buffer.bytes=102400</span></span><br><span class="line"><span class="comment">#è¯·æ±‚å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line"><span class="string">socket.request.max.bytes=104857600</span></span><br><span class="line"><span class="comment">#topic åœ¨å½“å‰ broker ä¸Šçš„åˆ†åŒºä¸ªæ•°</span></span><br><span class="line"><span class="string">num.partitions=1</span></span><br><span class="line"><span class="comment">#ç”¨æ¥æ¢å¤å’Œæ¸…ç† data ä¸‹æ•°æ®çš„çº¿ç¨‹æ•°é‡</span></span><br><span class="line"><span class="string">num.recovery.threads.per.data.dir=1</span></span><br><span class="line"><span class="comment">#segment æ–‡ä»¶ä¿ç•™çš„æœ€é•¿æ—¶é—´ï¼Œè¶…æ—¶å°†è¢«åˆ é™¤</span></span><br><span class="line"><span class="string">log.retention.hours=168</span></span><br></pre></td></tr></table></figure><p></p><p>ä¿®æ”¹å¥½åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å¯åŠ¨Kafkaäº†ã€‚</p><p><strong>1.å¯åŠ¨Zookeeper</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/zookeeper-server-start.sh config/zookeeper.properties</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœè¦åœ¨åå°å¯åŠ¨Zookeeperï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/zookeeper-server-start.sh -daemon config/zookeeper.properties</span><br></pre></td></tr></table></figure><p></p><p><strong>2.å¯åŠ¨Kafka</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure><p></p><p><strong>3.åˆ›å»ºtopic</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/kafka-topics.sh --zookeeper localhost:2181 --create --replication-factor 1 --partitions 1 --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p></p><ul><li>â€“create åˆ›å»º</li><li>â€“topic æŒ‡å®š topic å</li><li>â€“replication-factor å®šä¹‰å‰¯æœ¬æ•°</li><li>â€“partitions å®šä¹‰åˆ†åŒºæ•°</li></ul><p>ä¸Šé¢åˆ›å»ºäº†ä¸€ä¸ªåç§°ä¸ºtestçš„topicï¼Œå‰¯æœ¬æ•°å’Œåˆ†åŒºæ•°éƒ½æ˜¯1ã€‚</p><p><strong>4.å¯åŠ¨ç”Ÿäº§è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p></p><p>9092ä¸ºç”Ÿäº§è€…çš„é»˜è®¤ç«¯å£å·ï¼ŒæŒ‡å®štopicä¸ºåˆšåˆšåˆ›å»ºçš„testã€‚</p><p><strong>5.å¯åŠ¨æ¶ˆè´¹è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span> --from-beginning</span><br></pre></td></tr></table></figure><p></p><p>â€“from-beginningï¼šä¼šæŠŠä¸»é¢˜ä¸­ä»¥å¾€æ‰€æœ‰çš„æ•°æ®éƒ½è¯»å–å‡ºæ¥ã€‚</p><p>å¯åŠ¨å¥½ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åæˆ‘ä»¬åœ¨ç”Ÿäº§è€…é‡Œç”Ÿäº§å‡ æ¡æ•°æ®:</p><p><img src="img/QQ20200324-220247@2x.png" alt="QQ20200324-220247@2x"></p><p>æ¶ˆè´¹è€…æˆåŠŸæ¥æ”¶åˆ°æ•°æ®ï¼š</p><p><img src="img/QQ20200324-220314@2x.png" alt="QQ20200324-220314@2x"></p><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><p>æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰ topicï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/kafka-topics.sh --zookeeper localhsot:2181 --list</span><br></pre></td></tr></table></figure><p></p><p>åˆ é™¤ topicï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p></p><p>éœ€è¦ server.properties ä¸­è®¾ç½®<code>delete.topic.enable=true</code>å¦åˆ™åªæ˜¯æ ‡è®°åˆ é™¤ã€‚</p><p>æŸ¥çœ‹æŸä¸ª Topic çš„è¯¦æƒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/kafka-topics.sh --zookeeper localhost:2181 --describe --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p></p><p>ä¿®æ”¹åˆ†åŒºæ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/kafka-topics.sh --zookeeper localhost:2181 --alter --topic <span class="built_in">test</span> --partitions 2</span><br></pre></td></tr></table></figure><p></p><h2 id="ZKçš„ä½œç”¨"><a href="#ZKçš„ä½œç”¨" class="headerlink" title="ZKçš„ä½œç”¨"></a>ZKçš„ä½œç”¨</h2><p>Kafka é›†ç¾¤ä¸­æœ‰ä¸€ä¸ª broker ä¼šè¢«é€‰ä¸¾ä¸º Controllerï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤ broker çš„ä¸Šä¸‹çº¿ï¼Œæ‰€æœ‰ topic çš„åˆ†åŒºå‰¯æœ¬åˆ†é…å’Œ leader é€‰ä¸¾ç­‰å·¥ä½œã€‚Controller çš„ç®¡ç†å·¥ä½œéƒ½æ˜¯ä¾èµ–äº Zookeeper çš„ã€‚</p><blockquote><p>ã€Œå°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹ Kafkaã€ å­¦ä¹ ç¬”è®°</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;a href=&quot;http://kafka.apache.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Kafka&lt;/a&gt;æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„åŸºäºå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œä¸»è¦åº”ç”¨äºå¤§æ•°æ®å®æ—¶å¤„ç†é¢†åŸŸã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kafka" scheme="http://mrbird.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud Alibaba Sentinel @SentinelResource</title>
    <link href="http://mrbird.cc/Spring-Cloud-Alibaba-Sentinel-SentinelResource.html"/>
    <id>http://mrbird.cc/Spring-Cloud-Alibaba-Sentinel-SentinelResource.html</id>
    <published>2020-03-19T08:16:07.000Z</published>
    <updated>2020-03-20T08:50:13.262Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --><p>Sentinelæä¾›äº†<a href="https://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81" target="_blank" rel="noopener">@SentinelResource</a>æ³¨è§£ç”¨äºå®šä¹‰èµ„æºï¼Œå¹¶æä¾›å¯é€‰çš„å¼‚å¸¸å›é€€å’ŒBlockå›é€€ã€‚å¼‚å¸¸å›é€€æŒ‡çš„æ˜¯<code>@SentinelResource</code>æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•å‘ç”ŸJavaå¼‚å¸¸æ—¶çš„å›é€€å¤„ç†ï¼›Blockå›é€€æŒ‡çš„æ˜¯å½“<code>@SentinelResource</code>èµ„æºè®¿é—®ä¸ç¬¦åˆSentinelæ§åˆ¶å°å®šä¹‰çš„è§„åˆ™æ—¶çš„å›é€€ï¼ˆé»˜è®¤è¿”å›Blocked by Sentinel (flow limiting)ï¼‰ã€‚è¿™èŠ‚ç®€å•è®°å½•ä¸‹è¯¥æ³¨è§£çš„ç”¨æ³•ã€‚</p><a id="more"></a><h2 id="æ¡†æ¶æ­å»º"><a href="#æ¡†æ¶æ­å»º" class="headerlink" title="æ¡†æ¶æ­å»º"></a>æ¡†æ¶æ­å»º</h2><p>ä½¿ç”¨IDEAåˆ›å»ºä¸€ä¸ªmavené¡¹ç›®ï¼ŒartifactIdä¸ºspring-cloud-alibaba-sentinelresourceï¼Œç„¶ååœ¨å…¶ä¸‹é¢åˆ›å»ºä¸¤ä¸ªModuleï¼ˆSpring Booté¡¹ç›®ï¼‰ï¼ŒartifactIdåˆ†åˆ«ä¸ºconsumerå’Œproviderï¼Œå……å½“æœåŠ¡æ¶ˆè´¹ç«¯å’ŒæœåŠ¡æä¾›ç«¯ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200320-145134.png" alt="QQ20200320-145134"></p><p>spring-cloud-alibaba-sentinelresourceçš„pomå†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cc.mrbird<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-sentinelresource<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>provider<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>consumer<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Hoxton.SR3<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">com-alibaba-cloud.version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">com-alibaba-cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;com-alibaba-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>å¼•å…¥äº†spring-boot-starter-webå’Œspring-cloud-alibaba-nacos-discovery NacosæœåŠ¡æ³¨å†Œå‘ç°ä¾èµ–ã€‚</p><p>providerçš„pomçš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cc.mrbird<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-sentinelresource<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>provider<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>provider<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>æœåŠ¡æä¾›è€…<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>consumerçš„pomå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cc.mrbird<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-sentinelresource<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>consumer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>consumer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>æœåŠ¡æ¶ˆè´¹è€…<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>å› ä¸ºè¦æ¼”ç¤ºåœ¨æ¶ˆè´¹ç«¯ä½¿ç”¨<code>@SentinelResource</code>æ³¨è§£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥äº†spring-cloud-starter-alibaba-sentinelä¾èµ–ã€‚</p><p>providerçš„é…ç½®æ–‡ä»¶application.ymlå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">provider</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    nacos:</span></span><br><span class="line"><span class="attr">      server-addr:</span> <span class="attr">localhost:8848</span></span><br></pre></td></tr></table></figure><p></p><p>é…ç½®äº†ç«¯å£å·ï¼ŒæœåŠ¡åå’Œnacosåœ°å€ã€‚</p><p>consumerçš„é…ç½®æ–‡ä»¶application.ymlå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">9091</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">consumer</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    nacos:</span></span><br><span class="line"><span class="attr">      server-addr:</span> <span class="attr">localhost:8848</span></span><br><span class="line"><span class="attr">    sentinel:</span></span><br><span class="line"><span class="attr">      transport:</span></span><br><span class="line"><span class="attr">        dashboard:</span> <span class="attr">localhost:8080</span></span><br><span class="line"><span class="attr">        port:</span> <span class="number">8719</span></span><br></pre></td></tr></table></figure><p></p><p>é…ç½®äº†ç«¯å£å·ï¼ŒæœåŠ¡åï¼Œnacosåœ°å€å’Œsentinelæ§åˆ¶å°åœ°å€ç­‰ã€‚</p><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><p>æˆ‘ä»¬åœ¨providerä¸‹æ·»åŠ ä¸€ä¸ªRESTèµ„æºã€‚åœ¨providerçš„cc.mrbird.providerç›®å½•ä¸‹æ–°å»ºcontrolleråŒ…ï¼Œç„¶ååœ¨è¯¥åŒ…ä¸‹æ–°å»º<code>GoodsController</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"goods"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"buy/&#123;name&#125;/&#123;count&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">(@PathVariable String name, @PathVariable Integer count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"è´­ä¹°%dä»½%s"</span>, count, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ¥ç€åœ¨consumerç«¯é€šè¿‡Ribbonæ¶ˆè´¹è¿™ä¸ªèµ„æºã€‚åœ¨consumerçš„å¯åŠ¨ç±»<code>ConsumerApplication</code>é‡Œæ³¨å†Œ<code>RestTemplate</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConsumerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨consumerçš„cc.mrbird.consumerä¸‹æ–°å»ºcontrolleråŒ…ï¼Œç„¶ååœ¨è¯¥åŒ…ä¸‹æ–°å»º<code>BuyController</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"buy/&#123;name&#125;/&#123;count&#125;"</span>)</span><br><span class="line">    <span class="meta">@SentinelResource</span>(value = <span class="string">"buy"</span>, fallback = <span class="string">"buyFallback"</span>, blockHandler = <span class="string">"buyBlock"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">(@PathVariable String name, @PathVariable Integer count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (count &gt;= <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"è´­ä¹°æ•°é‡è¿‡å¤š"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"miband"</span>.equalsIgnoreCase(name)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"å·²å”®ç½„"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">        params.put(<span class="string">"name"</span>, name);</span><br><span class="line">        params.put(<span class="string">"count"</span>, count);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.restTemplate.getForEntity(<span class="string">"http://provider/goods/buy/&#123;name&#125;/&#123;count&#125;"</span>, String.class, params).getBody();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼‚å¸¸å›é€€</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyFallback</span><span class="params">(@PathVariable String name, @PathVariable Integer count, Throwable throwable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"ã€è¿›å…¥fallbackæ–¹æ³•ã€‘è´­ä¹°%dä»½%så¤±è´¥ï¼Œ%s"</span>, count, name, throwable.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sentinelå›é€€</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyBlock</span><span class="params">(@PathVariable String name, @PathVariable Integer count, BlockException e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"ã€è¿›å…¥blockHandleræ–¹æ³•ã€‘è´­ä¹°%dä»½%så¤±è´¥ï¼Œå½“å‰è´­ä¹°äººæ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•"</span>, count, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨<code>buy</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡Ribbonçš„<code>RestTemplate</code>è®¿é—®providerçš„<code>/goods/buy</code>æ¥å£ã€‚å½“countå‚æ•°å¤§äº20æˆ–è€…nameå‚æ•°çš„å€¼ä¸ºmibandçš„æ—¶å€™ï¼Œæ–¹æ³•å°†æŠ›å‡ºå¼‚å¸¸ã€‚<code>buy</code>æ–¹æ³•ä¸Šä½¿ç”¨<code>@SentinelResource</code>æ³¨è§£æ ‡æ³¨ï¼Œæ ‡è¯†ä¸ºä¸€ä¸ªsentinelèµ„æºï¼Œèµ„æºåç§°ä¸ºbuyï¼Œå¹¶ä¸”é…ç½®äº†fallbackæ–¹æ³•å’ŒblockHandleræ–¹æ³•ã€‚</p><p>å¦‚å‰é¢æ‰€è¯´ï¼Œå½“<code>buy</code>æ–¹æ³•æœ¬èº«æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œä¼šè¿›å…¥fallbackæŒ‡å®šçš„å›é€€æ–¹æ³•ä¸­ï¼›å½“<code>buy</code>æ–¹æ³•è°ƒç”¨ä¸ç¬¦åˆsentinelæ§åˆ¶å°è§„å®šçš„è§„åˆ™ï¼ˆå¦‚æµæ§è§„åˆ™ï¼Œé™çº§è§„åˆ™ç­‰ï¼‰æ—¶ï¼Œä¼šè¿›å…¥blockHanderæŒ‡å®šçš„blockæ–¹æ³•ä¸­ã€‚ä¸ºäº†ç¡®ä¿æˆåŠŸåœ°è¿›å…¥å›é€€æ–¹æ³•ï¼ˆæˆåŠŸåå°„ï¼‰ï¼Œå®ƒä»¬å¿…é¡»æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š</p><ul><li>å‡½æ•°è®¿é—®èŒƒå›´éœ€è¦æ˜¯<code>public</code>ï¼›</li><li>Fallbackå‡½æ•°ï¼Œå‡½æ•°ç­¾åä¸åŸå‡½æ•°ä¸€è‡´æˆ–æœ«å°¾åŠ ä¸€ä¸ª<code>Throwable</code>ç±»å‹çš„å‚æ•°ï¼›</li><li>Blockå¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå‚æ•°æœ€åå¤šä¸€ä¸ª<code>BlockException</code>ï¼Œå…¶ä½™ä¸åŸå‡½æ•°ä¸€è‡´ã€‚</li></ul><p>å¯åŠ¨providerã€consumerã€nacoså’Œsentinelæ§åˆ¶å°ï¼Œæµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:9091/buy/ipad/2" target="_blank" rel="noopener">http://localhost:9091/buy/ipad/2</a>ï¼š</p><p><img src="img/QQ20200320-151518.png" alt="QQ20200320-151518"></p><p>æˆ‘ä»¬åœ¨sentinelæ§åˆ¶å°ä¸­æ·»åŠ å¦‚ä¸‹æµæ§è§„åˆ™ï¼š</p><p><img src="img/QQ20200320-151651@2x.png" alt="QQ20200320-151651@2x.png"></p><p>QPSé˜ˆå€¼ä¸º2ã€‚</p><p>ç„¶åå¿«é€Ÿè®¿é—®<a href="http://localhost:9091/buy/ipad/2" target="_blank" rel="noopener">http://localhost:9091/buy/ipad/2</a>ï¼š</p><p><img src="img/QQ20200320-152106@2x.png" alt="QQ20200320-152106@2x"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“æ–¹æ³•è®¿é—®ä¸ç¬¦åˆsentinelæ§åˆ¶å°è§„åˆ™æ—¶ï¼Œè¿›å…¥çš„æ˜¯blockHandleræŒ‡å®šçš„å›é€€æ–¹æ³•ã€‚</p><p>å¦‚æœè®¿é—®ï¼š<a href="http://localhost:9091/buy/ipad/21" target="_blank" rel="noopener">http://localhost:9091/buy/ipad/21</a></p><p><img src="img/QQ20200320-152155@2x.png" alt="QQ20200320-152155@2x"> æˆ–è€…ï¼š<a href="http://localhost:9091/buy/miband/2" target="_blank" rel="noopener">http://localhost:9091/buy/miband/2</a></p><p><img src="img/QQ20200320-152224@2x.png" alt="QQ20200320-152224@2x"></p><p>æ–¹æ³•è‡ªèº«æŠ›å‡ºå¼‚å¸¸å¼•å‘å›é€€ï¼Œè¿›å…¥çš„æ˜¯fallbackæŒ‡å®šçš„å›é€€æ–¹æ³•ã€‚</p><h2 id="å…¶ä»–å±æ€§"><a href="#å…¶ä»–å±æ€§" class="headerlink" title="å…¶ä»–å±æ€§"></a>å…¶ä»–å±æ€§</h2><p>åœ¨å½“å‰ç±»ä¸­ç¼–å†™å›é€€æ–¹æ³•ä¼šä½¿å¾—ä»£ç å˜å¾—å†—ä½™è€¦åˆåº¦é«˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†å›é€€æ–¹æ³•æŠ½å–å‡ºæ¥åˆ°ä¸€ä¸ªæŒ‡å®šç±»ä¸­ã€‚</p><p>åœ¨cc.mrbird.consumeråŒ…ä¸‹æ–°å»ºrevealåŒ…ï¼Œç„¶ååœ¨è¯¥åŒ…ä¸‹æ–°å»º<code>BuyBlockHandler</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyBlockHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sentinelå›é€€</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">buyBlock</span><span class="params">(@PathVariable String name, @PathVariable Integer count, BlockException e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"ã€è¿›å…¥blockHandleræ–¹æ³•ã€‘è´­ä¹°%dä»½%så¤±è´¥ï¼Œå½“å‰è´­ä¹°äººæ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•"</span>, count, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªæ˜¯å°†<code>buyBlock</code>æ–¹æ³•æŒªåˆ°äº†<code>BuyBlockHandler</code>ä¸­ï¼Œä¸è¿‡è¿™é‡Œçš„æ–¹æ³•å¿…é¡»æ˜¯<code>static</code>çš„ã€‚</p><p>æ¥ç€æ–°å»º<code>BuyFallBack</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyFallBack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼‚å¸¸å›é€€</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">buyFallback</span><span class="params">(@PathVariable String name, @PathVariable Integer count, Throwable throwable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"ã€è¿›å…¥fallbackæ–¹æ³•ã€‘è´­ä¹°%dä»½%så¤±è´¥ï¼Œ%s"</span>, count, name, throwable.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™æ ·<code>BuyController</code>çš„ä»£ç å°±å¯ä»¥ç²¾ç®€ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"buy/&#123;name&#125;/&#123;count&#125;"</span>)</span><br><span class="line">    <span class="meta">@SentinelResource</span>(value = <span class="string">"buy"</span>,</span><br><span class="line">            fallback = <span class="string">"buyFallback"</span>,</span><br><span class="line">            fallbackClass = BuyFallBack.class,</span><br><span class="line">            blockHandler = <span class="string">"buyBlock"</span>,</span><br><span class="line">            blockHandlerClass = BuyBlockHandler.class</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">(@PathVariable String name, @PathVariable Integer count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (count &gt;= <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"è´­ä¹°æ•°é‡è¿‡å¤š"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"miband"</span>.equalsIgnoreCase(name)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"å·²å”®ç½„"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">        params.put(<span class="string">"name"</span>, name);</span><br><span class="line">        params.put(<span class="string">"count"</span>, count);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.restTemplate.getForEntity(<span class="string">"http://provider/goods/buy/&#123;name&#125;/&#123;count&#125;"</span>, String.class, params).getBody();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>fallbackClass</code>å’Œ<code>blockHandlerClass</code>æŒ‡å®šå›é€€æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚</p><p>æ­¤å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥å½“é‡åˆ°æŸä¸ªç±»å‹çš„å¼‚å¸¸æ—¶ï¼Œä¸è¿›è¡Œå›é€€ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"buy/&#123;name&#125;/&#123;count&#125;"</span>)</span><br><span class="line">    <span class="meta">@SentinelResource</span>(value = <span class="string">"buy"</span>,</span><br><span class="line">            fallback = <span class="string">"buyFallback"</span>,</span><br><span class="line">            fallbackClass = BuyFallBack.class,</span><br><span class="line">            blockHandler = <span class="string">"buyBlock"</span>,</span><br><span class="line">            blockHandlerClass = BuyBlockHandler.class,</span><br><span class="line">            exceptionsToIgnore = NullPointerException.class</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">(@PathVariable String name, @PathVariable Integer count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (count &gt;= <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"è´­ä¹°æ•°é‡è¿‡å¤š"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"miband"</span>.equalsIgnoreCase(name)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"å·²å”®ç½„"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">        params.put(<span class="string">"name"</span>, name);</span><br><span class="line">        params.put(<span class="string">"count"</span>, count);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.restTemplate.getForEntity(<span class="string">"http://provider/goods/buy/&#123;name&#125;/&#123;count&#125;"</span>, String.class, params).getBody();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>exceptionsToIgnore</code>æŒ‡å®šï¼Œå½“é‡åˆ°ç©ºæŒ‡é’ˆå¼‚å¸¸æ—¶ï¼Œä¸å›é€€ã€‚</p><p>é‡å¯consumerï¼Œæµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:9091/buy/miband/2" target="_blank" rel="noopener">http://localhost:9091/buy/miband/2</a>ï¼š</p><p><img src="img/QQ20200320-153530@2x.png" alt="QQ20200320-153530@2x"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ¬¡å¹¶æ²¡æœ‰è¿›è¡Œå›é€€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›error pageã€‚</p><blockquote><p>æœ¬èŠ‚æºç é“¾æ¥ï¼š<a href="https://github.com/wuyouzhuguli/SpringAll/tree/master/78.spring-cloud-alibaba-sentinelresource" target="_blank" rel="noopener">https://github.com/wuyouzhuguli/SpringAll/tree/master/78.spring-cloud-alibaba-sentinelresource</a></p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;Sentinelæä¾›äº†&lt;a href=&quot;https://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;@SentinelResource&lt;/a&gt;æ³¨è§£ç”¨äºå®šä¹‰èµ„æºï¼Œå¹¶æä¾›å¯é€‰çš„å¼‚å¸¸å›é€€å’ŒBlockå›é€€ã€‚å¼‚å¸¸å›é€€æŒ‡çš„æ˜¯&lt;code&gt;@SentinelResource&lt;/code&gt;æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•å‘ç”ŸJavaå¼‚å¸¸æ—¶çš„å›é€€å¤„ç†ï¼›Blockå›é€€æŒ‡çš„æ˜¯å½“&lt;code&gt;@SentinelResource&lt;/code&gt;èµ„æºè®¿é—®ä¸ç¬¦åˆSentinelæ§åˆ¶å°å®šä¹‰çš„è§„åˆ™æ—¶çš„å›é€€ï¼ˆé»˜è®¤è¿”å›Blocked by Sentinel (flow limiting)ï¼‰ã€‚è¿™èŠ‚ç®€å•è®°å½•ä¸‹è¯¥æ³¨è§£çš„ç”¨æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spring Cloud" scheme="http://mrbird.cc/tags/Spring-Cloud/"/>
    
      <category term="Spring Cloud Alibaba" scheme="http://mrbird.cc/tags/Spring-Cloud-Alibaba/"/>
    
      <category term="Sentinel" scheme="http://mrbird.cc/tags/Sentinel/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud Alibaba Sentinelæ§åˆ¶å°è¯¦è§£</title>
    <link href="http://mrbird.cc/Sentinel%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%AF%A6%E8%A7%A3.html"/>
    <id>http://mrbird.cc/Sentinelæ§åˆ¶å°è¯¦è§£.html</id>
    <published>2020-03-18T08:15:38.000Z</published>
    <updated>2020-03-20T08:49:57.585Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --><p><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener">Sentinel</a>æä¾›ä¸€ä¸ªè½»é‡çº§çš„å¼€æºæ§åˆ¶å°ï¼Œå®ƒæä¾›æœºå™¨å‘ç°ä»¥åŠå¥åº·æƒ…å†µç®¡ç†ã€ç›‘æ§ï¼ˆå•æœºå’Œé›†ç¾¤ï¼‰ï¼Œè§„åˆ™ç®¡ç†å’Œæ¨é€çš„åŠŸèƒ½ã€‚æœ¬èŠ‚å°†è¯¦ç»†è®°å½•ä½•å¦‚é€šè¿‡Sentinelæ§åˆ¶å°æ§åˆ¶Sentinelå®¢æˆ·ç«¯çš„å„ç§è¡Œä¸ºã€‚Sentinelæ§åˆ¶å°çš„åŠŸèƒ½ä¸»è¦åŒ…æ‹¬ï¼šæµé‡æ§åˆ¶ã€é™çº§æ§åˆ¶ã€çƒ­ç‚¹é…ç½®ã€ç³»ç»Ÿè§„åˆ™å’Œæˆæƒè§„åˆ™ç­‰ã€‚</p><a id="more"></a><h2 id="å®‰è£…æ§åˆ¶å°"><a href="#å®‰è£…æ§åˆ¶å°" class="headerlink" title="å®‰è£…æ§åˆ¶å°"></a>å®‰è£…æ§åˆ¶å°</h2><p>Sentinelæ§åˆ¶å°ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener">https://github.com/alibaba/Sentinel/releases</a>ï¼Œæœ¬èŠ‚æˆ‘ä»¬ä¸‹è½½sentinel-dashboard-1.7.1.jarç‰ˆæœ¬ï¼Œä¸‹è½½å¥½åä½¿ç”¨<code>java -jar sentinel-dashboard-1.7.1.jar</code>å‘½ä»¤å¯åŠ¨å³å¯ï¼Œé»˜è®¤çš„ç«¯å£å·ä¸º8080ï¼š</p><p><img src="img/QQ20200319-092904@2x.png" alt="QQ20200319-092904@2x"></p><p>è´¦å·å¯†ç éƒ½æ˜¯sentinelã€‚</p><p>æ›´å¤šå¯ç”¨çš„å¯åŠ¨å‚æ•°é…ç½®ï¼š</p><ul><li><code>Dsentinel.dashboard.auth.username=sentinel</code>ç”¨äºæŒ‡å®šæ§åˆ¶å°çš„ç™»å½•ç”¨æˆ·åä¸º sentinelï¼›</li><li><code>Dsentinel.dashboard.auth.password=123456</code>ç”¨äºæŒ‡å®šæ§åˆ¶å°çš„ç™»å½•å¯†ç ä¸º 123456ï¼Œå¦‚æœçœç•¥è¿™ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤ç”¨æˆ·å’Œå¯†ç å‡ä¸º sentinelï¼›</li><li><p><code>Dserver.servlet.session.timeout=7200</code>ç”¨äºæŒ‡å®š Spring Boot æœåŠ¡ç«¯ session çš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚ 7200 è¡¨ç¤º 7200 ç§’ï¼›60m è¡¨ç¤º 60 åˆ†é’Ÿï¼Œé»˜è®¤ä¸º 30 åˆ†é’Ÿï¼›</p></li><li><p><code>-Dcsp.sentinel.dashboard.server=consoleIp:port</code>æŒ‡å®šæ§åˆ¶å°åœ°å€å’Œç«¯å£ã€‚</p></li></ul><h2 id="æ­å»ºå®¢æˆ·ç«¯"><a href="#æ­å»ºå®¢æˆ·ç«¯" class="headerlink" title="æ­å»ºå®¢æˆ·ç«¯"></a>æ­å»ºå®¢æˆ·ç«¯</h2><p>æ–°å»ºä¸€ä¸ªSpring Booté¡¹ç›®ï¼ŒartifactIdä¸ºspring-cloud-alibaba-sentinel-dashboard-guideï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200319-094028@2x.png" alt="QQ20200319-094028@2x"></p><p>é¡¹ç›®pomå†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cc.mrbird<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-sentinel-dashboard-guide<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spring-cloud-alibaba-sentinel-dashboard-guide<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Hoxton.SR3<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">com-alibaba-cloud.version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">com-alibaba-cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;com-alibaba-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>å¼•å…¥äº†spring-cloud-starter-alibaba-sentinelå’Œspring-boot-starter-webä¾èµ–ã€‚</p><p>æ¥ç€åœ¨cc.mrbird.sentinelç›®å½•ä¸‹æ–°å»ºcontrolleråŒ…ï¼Œç„¶ååœ¨è¯¥åŒ…ä¸‹æ–°å»º<code>TestController</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"test1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test1"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æœ€ååœ¨é¡¹ç›®é…ç½®æ–‡ä»¶application.ymlä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">my-project</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    sentinel:</span></span><br><span class="line"><span class="attr">      transport:</span></span><br><span class="line"><span class="attr">        dashboard:</span> <span class="attr">localhost:8080</span></span><br><span class="line"><span class="attr">        port:</span> <span class="number">8719</span></span><br></pre></td></tr></table></figure><p></p><ul><li><p><code>spring.cloud.sentinel.transport.dashboard</code>ï¼ŒæŒ‡å®šäº†sentinelæ§åˆ¶å°çš„ipå’Œç«¯å£åœ°å€ï¼›</p></li><li><p><code>spring.cloud.sentinel.transport.port</code>ï¼Œsentinelå®¢æˆ·ç«¯å’Œæ§åˆ¶å°é€šä¿¡çš„ç«¯å£ï¼Œé»˜è®¤ä¸º8719ï¼Œå¦‚æœè¿™ä¸ªç«¯å£å·²ç»è¢«å ç”¨ï¼Œé‚£ä¹ˆsentinelä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€‚</p></li></ul><p>å¯åŠ¨é¡¹ç›®ï¼Œä½¿ç”¨æµè§ˆå™¨å¤šæ¬¡è®¿é—®ï¼š<a href="http://localhost:8081/test1" target="_blank" rel="noopener">http://localhost:8081/test1</a>ï¼Œç„¶åç™»å½•sentinelæ§åˆ¶å°ï¼š</p><p><img src="img/QQ20200319-100041@2x.png" alt="QQ20200319-100041@2x"></p><p>åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å¯ä»¥çœ‹åˆ°åˆšåˆšé‚£ç¬”è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å®ƒè¿›è¡Œæµæ§ã€é™çº§ã€æˆæƒã€çƒ­ç‚¹ç­‰é…ç½®ï¼ˆæ§åˆ¶å°æ˜¯æ‡’åŠ è½½çš„ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•è¯·æ±‚ï¼Œé‚£ä¹ˆæ§åˆ¶å°ä¹Ÿä¸ä¼šæœ‰ä»»ä½•å†…å®¹ï¼‰ã€‚</p><h2 id="æµæ§è§„åˆ™"><a href="#æµæ§è§„åˆ™" class="headerlink" title="æµæ§è§„åˆ™"></a>æµæ§è§„åˆ™</h2><p>åœ¨ç°‡ç‚¹é“¾è·¯åˆ—è¡¨ä¸­ï¼Œç‚¹å‡»<code>/test1</code>åé¢çš„æµæ§æŒ‰é’®ï¼š</p><p><img src="img/QQ20200319-100633@2x.png" alt="QQ20200319-100633@2x"></p><ul><li>èµ„æºåï¼šæ ‡è¯†èµ„æºçš„å”¯ä¸€åç§°ï¼Œé»˜è®¤ä¸ºè¯·æ±‚è·¯å¾„ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨<code>SentinelResource</code>é…ç½®ï¼›</li><li>é’ˆå¯¹æ¥æºï¼šSentinelå¯ä»¥é’ˆå¯¹æœåŠ¡è°ƒç”¨è€…è¿›è¡Œé™æµï¼Œå¡«å†™å¾®æœåŠ¡åç§°å³<code>spring.application.name</code>ï¼Œé»˜è®¤ä¸ºdefaultï¼Œä¸åŒºåˆ†æ¥æºï¼›</li><li><p>é˜ˆå€¼ç±»å‹ã€å•æœºé˜ˆå€¼ï¼š</p><ul><li>QPSï¼ˆQueries-per-secondï¼Œæ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡ï¼‰ï¼šå½“è°ƒç”¨è¯¥apiçš„QPSè¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµï¼›</li><li>çº¿ç¨‹æ•°ï¼šå½“è°ƒç”¨è¯¥apiçš„çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµã€‚</li></ul></li><li><p>æ˜¯å¦é›†ç¾¤ï¼šé»˜è®¤ä¸é›†ç¾¤ï¼›</p></li><li><p>æµæ§æ¨¡å¼ï¼š</p><ul><li>ç›´æ¥ï¼šå½“apiè°ƒç”¨è¾¾åˆ°é™æµæ¡ä»¶çš„æ—¶ï¼Œç›´æ¥é™æµï¼›</li><li>å…³è”ï¼šå½“å…³è”çš„èµ„æºè¯·æ±‚è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œé™æµè‡ªå·±ï¼›</li><li>é“¾è·¯ï¼šåªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡ï¼ˆæŒ‡å®šèµ„æºä»å…¥å£èµ„æºè¿›æ¥çš„æµé‡ï¼Œå¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™è¿›è¡Œé™æµï¼‰ã€‚</li></ul></li><li><p>æµæ§æ•ˆæœï¼š</p><ul><li>å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥å¤±è´¥ï¼›</li><li>Warm Upï¼šæ ¹æ®codeFactorï¼ˆå†·åŠ è½½å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰çš„å€¼ï¼Œä»é˜ˆå€¼/codeFactorï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿ï¼Œæ‰è¾¾åˆ°è®¾ç½®çš„QPSé˜ˆå€¼ï¼›</li><li>æ’é˜Ÿç­‰å¾…ï¼šåŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚åŒ€é€Ÿé€šè¿‡ï¼Œé˜ˆå€¼ç±»å‹å¿…é¡»è®¾ç½®ä¸ºQPSï¼Œå¦åˆ™æ— æ•ˆã€‚</li></ul></li></ul><h3 id="QPSç›´æ¥å¤±è´¥"><a href="#QPSç›´æ¥å¤±è´¥" class="headerlink" title="QPSç›´æ¥å¤±è´¥"></a>QPSç›´æ¥å¤±è´¥</h3><p>æ¼”ç¤ºä¸‹QPSç›´æ¥å¤±è´¥è®¾ç½®åŠæ•ˆæœã€‚ç‚¹å‡»ç°‡ç‚¹é“¾è·¯åˆ—è¡¨ä¸­<code>/test1</code>è¯·æ±‚åé¢çš„æµæ§æŒ‰é’®ï¼š</p><p><img src="img/QQ20200319-103726@2x.png" alt="QQ20200319-103726@2x"></p><p>ä¸Šé¢è®¾ç½®çš„æ•ˆæœæ˜¯ï¼Œ1ç§’é’Ÿå†…è¯·æ±‚/test1èµ„æºçš„æ¬¡æ•°è¾¾åˆ°2æ¬¡ä»¥ä¸Šçš„æ—¶å€™ï¼Œè¿›è¡Œé™æµã€‚</p><p>ç‚¹å‡»æ–°å¢æŒ‰é’®åï¼Œåˆ—è¡¨ä¼šè·³è½¬åˆ°â€æµæ§è§„åˆ™â€èœå•ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œè®¾ç½®æµæ§è§„åˆ™ï¼Œä¸è¿‡ä¸€èˆ¬è¿˜æ˜¯ä¹ æƒ¯ç›´æ¥åœ¨ç°‡ç‚¹é“¾è·¯åˆ—è¡¨ä¸­ç›´æ¥é€‰ä¸­èµ„æºæ·»åŠ æµæ§è§„åˆ™ã€‚æ–°å¢åï¼Œæˆ‘ä»¬è®¿é—®<a href="http://localhost:8081/test1" target="_blank" rel="noopener">http://localhost:8081/test1</a>ï¼Œçœ‹çœ‹æ•ˆæœï¼š</p><p><img src="img/2020-03-19 10.47.02.gif" alt="2020-03-19 10.47.02.gif"></p><p>å½“æ‰‹é€Ÿå¿«ç‚¹çš„æ—¶å€™ï¼ˆ1ç§’è¶…è¿‡2æ¬¡ï¼‰ï¼Œé¡µé¢è¿”å›Blocked by Sentinel (flow limiting)ã€‚</p><h3 id="çº¿ç¨‹æ•°ç›´æ¥å¤±è´¥"><a href="#çº¿ç¨‹æ•°ç›´æ¥å¤±è´¥" class="headerlink" title="çº¿ç¨‹æ•°ç›´æ¥å¤±è´¥"></a>çº¿ç¨‹æ•°ç›´æ¥å¤±è´¥</h3><p>æ”¹é€ ä¸‹<code>TestController</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"test1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test1"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è®©æ–¹æ³•ä¼‘çœ 1ç§’ï¼Œæ›´å®¹æ˜“å‡ºç°æ•ˆæœã€‚é‡å¯é¡¹ç›®ï¼Œç„¶ååœ¨sentinelæ§åˆ¶å°ä¸­æ·»åŠ å¦‚ä¸‹æµæ§è§„åˆ™ï¼š</p><p><img src="img/QQ20200319-105234@2x.png" alt="QQ20200319-105234@2x"></p><p>å¤šæ¬¡è®¿é—®<a href="http://localhost:8081/test1" target="_blank" rel="noopener">http://localhost:8081/test1</a>ï¼Œæ•ˆæœï¼š</p><p><img src="img/2020-03-19 10.57.46.gif" alt="2020-03-19 10.57.46.gif"></p><h3 id="å…³è”"><a href="#å…³è”" class="headerlink" title="å…³è”"></a>å…³è”</h3><p>æ”¹é€ <code>TestController</code>ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„apiæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"test1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test1"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"test2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test2"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é‡å¯é¡¹ç›®ï¼Œæµè§ˆå™¨ä¸­è®¿é—®ä¸‹è¿™ä¸¤ä¸ªè¯·æ±‚ï¼Œç„¶ååœ¨sentinelæ§åˆ¶å°ç°‡ç‚¹é“¾è·¯åˆ—è¡¨ä¸­ï¼Œç‚¹å‡»test1åçš„æµæ§æŒ‰é’®ï¼š</p><p><img src="img/QQ20200319-110332@2x.png" alt="QQ20200319-110332@2x"></p><p>ä¸Šè¿°æµæ§è§„åˆ™è¡¨ç¤ºï¼šå½“1ç§’å†…è®¿é—®/test2çš„æ¬¡æ•°å¤§äº2çš„æ—¶å€™ï¼Œé™æµ/test1ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨postmanæ¥å¯†é›†è®¿é—®/test2ï¼Œç„¶åæˆ‘ä»¬æ‰‹åŠ¨æµè§ˆå™¨è¯·æ±‚/test1ï¼Œçœ‹çœ‹æ•ˆæœã€‚postmanè®¾ç½®å¦‚ä¸‹è§„åˆ™ï¼š</p><p><img src="img/QQ20200319-111530@2x.png" alt="QQ20200319-111530@2x"></p><p>ç„¶åç‚¹å‡»RunæŒ‰é’®ï¼Œæˆ‘ä»¬å›åˆ°æµè§ˆå™¨ï¼Œè®¿é—®ï¼š<a href="http://localhost:8081/test1" target="_blank" rel="noopener">http://localhost:8081/test1</a>ï¼š</p><p><img src="img/2020-03-19 11.17.11.gif" alt="2020-03-19 11.17.11.gif"></p><p>å¯ä»¥çœ‹åˆ°/test1å·²ç»è¢«é™æµäº†ã€‚</p><h3 id="é“¾è·¯"><a href="#é“¾è·¯" class="headerlink" title="é“¾è·¯"></a>é“¾è·¯</h3><p>åœ¨æ¼”ç¤ºé“¾è·¯é™æµä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ”¹é€ æ”¹é€ sentinelå®¢æˆ·ç«¯ä»£ç ã€‚åœ¨é¡¹ç›®çš„cc.mrbird.sentinelç›®å½•ä¸‹æ–°å»ºserviceåŒ…ï¼Œç„¶ååœ¨è¯¥åŒ…ä¸‹æ–°å»º<code>HelloService</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SentinelResource</span>(<span class="string">"hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>@SentinelResource(&quot;hello&quot;)</code>å°†è¯¥æ–¹æ³•æ ‡è¯†ä¸ºä¸€ä¸ªsentinelèµ„æºï¼Œåç§°ä¸ºhelloã€‚</p><p>æ¥ç€åœ¨<code>TestController</code>ä¸­ä½¿ç”¨è¯¥èµ„æºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"test1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test1 "</span> + helloService.hello();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"test2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test2 "</span> + helloService.hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é‡å¯é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨ä¸­å¤šæ¬¡è®¿é—®è¿™ä¸¤ä¸ªapiï¼Œç„¶åæŸ¥çœ‹sentinelæ§åˆ¶å°ç°‡ç‚¹é“¾è·¯ï¼š</p><p><img src="img/c.png" alt="QQ20200319-151619@2x"></p><p>ç„¶åç‚¹å‡»helloèµ„æºåé¢çš„æµæ§æŒ‰é’®ï¼š</p><p><img src="img/QQ20200319-151704@2x.png" alt="QQ20200319-151704@2x"></p><p>ä¸Šè¿°é…ç½®çš„æ„æ€æ˜¯ï¼Œå½“é€šè¿‡/test1è®¿é—®helloçš„æ—¶å€™ï¼ŒQPSå¤§äº1åˆ™è¿›è¡Œé™æµï¼›è¨€å¤–ä¹‹æ„å°±æ˜¯/test2è®¿é—®helloè¯·æ±‚å¹¶ä¸å—å½±å“ã€‚</p><p>ä½†æ˜¯å®é™…æµ‹è¯•å¹¶æ²¡æœ‰ç”Ÿæ•ˆğŸ˜¡ï¼Œå…·ä½“å¯ä»¥å‚è€ƒissueï¼š<a href="https://github.com/alibaba/Sentinel/issues/1213" target="_blank" rel="noopener">https://github.com/alibaba/Sentinel/issues/1213</a>ã€‚</p><h3 id="é¢„çƒ­Warm-Up"><a href="#é¢„çƒ­Warm-Up" class="headerlink" title="é¢„çƒ­Warm Up"></a>é¢„çƒ­Warm Up</h3><p>æµæ§æ•ˆæœé™¤äº†ç›´æ¥å¤±è´¥å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©é¢„çƒ­Warm Upã€‚</p><div class="note info">Warm Upï¼ˆRuleConstant.CONTROL_BEHAVIOR_WARM_UPï¼‰æ–¹å¼ï¼Œå³é¢„çƒ­/å†·å¯åŠ¨æ–¹å¼ã€‚å½“ç³»ç»Ÿé•¿æœŸå¤„äºä½æ°´ä½çš„æƒ…å†µä¸‹ï¼Œå½“æµé‡çªç„¶å¢åŠ æ—¶ï¼Œç›´æ¥æŠŠç³»ç»Ÿæ‹‰å‡åˆ°é«˜æ°´ä½å¯èƒ½ç¬é—´æŠŠç³»ç»Ÿå‹å®ã€‚é€šè¿‡â€å†·å¯åŠ¨â€ï¼Œè®©é€šè¿‡çš„æµé‡ç¼“æ…¢å¢åŠ ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…é€æ¸å¢åŠ åˆ°é˜ˆå€¼ä¸Šé™ï¼Œç»™å†·ç³»ç»Ÿä¸€ä¸ªé¢„çƒ­çš„æ—¶é—´ï¼Œé¿å…å†·ç³»ç»Ÿè¢«å‹å®ã€‚</div><p>sentinelå®¢æˆ·ç«¯çš„é»˜è®¤å†·åŠ è½½å› å­coldFactorä¸º3ï¼Œå³è¯·æ±‚QPSä» threshold / 3 å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„QPSé˜ˆå€¼ã€‚</p><p>æ¯”å¦‚ï¼š</p><p><img src="img/QQ20200319-152842@2x.png" alt="QQ20200319-152842@2x"></p><p>ä¸Šé¢çš„é…ç½®æ„æ€æ˜¯ï¼šå¯¹äº/test1èµ„æºï¼Œä¸€å¼€å§‹çš„QPSé˜ˆå€¼ä¸º3ï¼ˆ10/3ï¼‰ï¼Œç»è¿‡10ç§’åï¼ŒQPSé˜ˆå€¼è¾¾åˆ°10ï¼Œè¿‡ç¨‹ç±»ä¼¼äºä¸‹å›¾ï¼š</p><p><img src="img/QQ20200319-153013@2x.png" alt="QQ20200319-153013@2x"></p><p>æ•ˆæœæˆ‘å°±ä¸æ¼”ç¤ºäº†ï¼Œå¤§æ¦‚æ•ˆæœå°±æ˜¯ä½¿ç”¨æµè§ˆå™¨è®¿é—®<a href="http://localhost:8081/test1" target="_blank" rel="noopener">http://localhost:8081/test1</a>ï¼Œä»¥æœ€å¿«çš„æ‰‹é€Ÿç‚¹åˆ·æ–°ï¼Œä¸€å¼€å§‹ä¼šå¸¸çœ‹åˆ°Blocked by Sentinel (flow limiting)çš„æç¤ºï¼Œ10ç§’åå‡ ä¹ä¸å†å‡ºç°ï¼ˆå› ä¸ºä½ çš„æ‰‹é€Ÿå¾ˆéš¾è¾¾åˆ°1ç§’10ä¸‹ï¼‰ã€‚</p><h3 id="æ’é˜Ÿç­‰å¾…"><a href="#æ’é˜Ÿç­‰å¾…" class="headerlink" title="æ’é˜Ÿç­‰å¾…"></a>æ’é˜Ÿç­‰å¾…</h3><p>æ’é˜Ÿç­‰å¾…æ–¹å¼ä¸ä¼šæ‹’ç»è¯·æ±‚ï¼Œè€Œæ˜¯ä¸¥æ ¼æ§åˆ¶è¯·æ±‚é€šè¿‡çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå³æ˜¯è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ã€‚</p><p>ä¿®æ”¹<code>TestController</code>çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger log = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"test1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"test1"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test1"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é‡å¯é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®<a href="localhost:8081/test1" target="_blank" rel="noopener">localhost:8081/test1</a>ï¼Œç„¶åç‚¹å‡»sentinelæ§åˆ¶å°ç°‡ç‚¹é“¾è·¯åˆ—è¡¨çš„/test1æµæ§æŒ‰é’®ï¼š</p><p><img src="img/QQ20200319-161608@2x.png" alt="QQ20200319-161608@2x"></p><p>ä¸Šè¿°é…ç½®çš„å«ä¹‰æ˜¯ï¼Œè®¿é—®/test1è¯·æ±‚æ¯ç§’é’Ÿæœ€å¤šåªèƒ½1æ¬¡ï¼Œè¶…è¿‡çš„è¯·æ±‚æ’é˜Ÿç­‰å¾…ï¼Œç­‰å¾…è¶…è¿‡1000æ¯«ç§’åˆ™è¶…æ—¶ã€‚æ–°å¢è¯¥è§„åˆ™åï¼Œå¤šæ¬¡å¿«é€Ÿè®¿é—®<a href="localhost:8081/test1" target="_blank" rel="noopener">localhost:8081/test1</a>ï¼Œsentinelå®¢æˆ·ç«¯æ§åˆ¶å°æ—¥å¿—æ‰“å°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-03-18 16:17:23.247  INFO 44688 --- [nio-8081-exec-2] c.m.sentinel.controller.TestController   : test1</span><br><span class="line">2020-03-18 16:17:24.250  INFO 44688 --- [nio-8081-exec-6] c.m.sentinel.controller.TestController   : test1</span><br><span class="line">2020-03-18 16:17:25.251  INFO 44688 --- [nio-8081-exec-5] c.m.sentinel.controller.TestController   : test1</span><br><span class="line">2020-03-18 16:17:26.251  INFO 44688 --- [nio-8081-exec-7] c.m.sentinel.controller.TestController   : test1</span><br><span class="line">2020-03-18 16:17:27.251  INFO 44688 --- [nio-8081-exec-8] c.m.sentinel.controller.TestController   : test1</span><br></pre></td></tr></table></figure><p></p><p>æ¯ç¬”è¯·æ±‚æ—¶é—´é—´éš”1ç§’ã€‚</p><h2 id="é™çº§è§„åˆ™"><a href="#é™çº§è§„åˆ™" class="headerlink" title="é™çº§è§„åˆ™"></a>é™çº§è§„åˆ™</h2><p>é™çº§é…ç½®é¡µé¢ï¼š</p><p><img src="img/QQ20200319-164303@2x.png" alt="QQ20200319-164303@2x"></p><p>é™çº§ç­–ç•¥åˆ†ä¸º3ç§ï¼š</p><ul><li>RTï¼Œå¹³å‡å“åº”æ—¶é—´ (DEGRADE_GRADE_RT)ï¼šå½“ 1s å†…æŒç»­è¿›å…¥ 5 ä¸ªè¯·æ±‚ï¼Œå¯¹åº”æ—¶åˆ»çš„å¹³å‡å“åº”æ—¶é—´ï¼ˆç§’çº§ï¼‰å‡è¶…è¿‡é˜ˆå€¼ï¼ˆcountï¼Œä»¥ ms ä¸ºå•ä½ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ï¼ˆDegradeRule ä¸­çš„ timeWindowï¼Œä»¥ s ä¸ºå•ä½ï¼‰ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°ç†”æ–­ï¼ˆæŠ›å‡º DegradeExceptionï¼‰ã€‚æ³¨æ„ Sentinel é»˜è®¤ç»Ÿè®¡çš„ RT ä¸Šé™æ˜¯ 4900 msï¼Œè¶…å‡ºæ­¤é˜ˆå€¼çš„éƒ½ä¼šç®—ä½œ 4900 msï¼Œè‹¥éœ€è¦å˜æ›´æ­¤ä¸Šé™å¯ä»¥é€šè¿‡å¯åŠ¨é…ç½®é¡¹ <code>-Dcsp.sentinel.statistic.max.rt=xxx</code> æ¥é…ç½®ã€‚</li><li>å¼‚å¸¸æ¯”ä¾‹ (DEGRADE_GRADE_EXCEPTION_RATIO)ï¼šå½“èµ„æºçš„æ¯ç§’è¯·æ±‚é‡ &gt;= 5ï¼Œå¹¶ä¸”æ¯ç§’å¼‚å¸¸æ€»æ•°å é€šè¿‡é‡çš„æ¯”å€¼è¶…è¿‡é˜ˆå€¼ï¼ˆDegradeRule ä¸­çš„ countï¼‰ä¹‹åï¼Œèµ„æºè¿›å…¥é™çº§çŠ¶æ€ï¼Œå³åœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ï¼ˆDegradeRule ä¸­çš„ timeWindowï¼Œä»¥ s ä¸ºå•ä½ï¼‰ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°è¿”å›ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ [0.0, 1.0]ï¼Œä»£è¡¨ 0% - 100%ã€‚</li><li>å¼‚å¸¸æ•° (DEGRADE_GRADE_EXCEPTION_COUNT)ï¼šå½“èµ„æºè¿‘ 1 åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­ã€‚æ³¨æ„ç”±äºç»Ÿè®¡æ—¶é—´çª—å£æ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼Œè‹¥ timeWindow å°äº 60sï¼Œåˆ™ç»“æŸç†”æ–­çŠ¶æ€åä»å¯èƒ½å†è¿›å…¥ç†”æ–­çŠ¶æ€ã€‚</li></ul><h3 id="RT"><a href="#RT" class="headerlink" title="RT"></a>RT</h3><p>ä¿®æ”¹<code>TestController</code>çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"test1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    	<span class="comment">// ä¼‘çœ 1ç§’</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test1"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é‡å¯é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®<a href="localhost:8081/test1" target="_blank" rel="noopener">localhost:8081/test1</a>ï¼Œç„¶åç‚¹å‡»sentinelæ§åˆ¶å°ç°‡ç‚¹é“¾è·¯åˆ—è¡¨çš„/test1é™çº§æŒ‰é’®ï¼š</p><p><img src="img/QQ20200319-171421@2x.png" alt="QQ20200319-171421@2x"></p><p>ä¸Šé¢é…ç½®çš„å«ä¹‰æ˜¯ï¼šå¦‚æœ/test1çš„QPSå¤§äº5ï¼Œå¹¶ä¸”å¹³å‡å“åº”æ—¶é—´ï¼ˆä»¥ç§’çº§ç»Ÿè®¡ï¼‰å¤§äº500ï¼ˆRTï¼‰æ¯«ç§’ï¼Œé‚£ä¹ˆåœ¨æœªæ¥çš„1ç§’é’Ÿï¼ˆæ—¶é—´çª—å£ï¼‰å†…ï¼Œsentinelæ–­è·¯å™¨æ‰“å¼€ï¼Œè¯¥apiæ¥å£ä¸å¯ç”¨ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨JMeteræ¨¡æ‹Ÿå¹¶å‘è®¿é—®æƒ…å½¢ï¼š</p><p><img src="img/QQ20200319-171907@2x.png" alt="QQ20200319-171907@2x"></p><p><img src="img/QQ20200319-171941@2x.png" alt="QQ20200319-171941@2x"></p><p>ä¸Šé¢çš„QPSä¸º10ï¼Œè€Œä¸”æˆ‘ä»¬çš„/test1æ¥å£å“åº”æ—¶é—´åœ¨1ç§’å·¦å³ï¼Œæ ¹æ®æˆ‘ä»¬ä¸Šé¢é…ç½®çš„é™çº§è§„åˆ™ï¼Œè‚¯å®šä¼šè§¦å‘é™çº§ï¼Œä½¿ç”¨JMeteræµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="img/QQ20200319-172138@2x.png" alt="QQ20200319-172138@2x"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºå¾ˆå¿«å°±è§¦å‘äº†é™çº§ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œåç»­çš„è¯·æ±‚éƒ½è¿”å›äº†Blocked by Sentinel (flow limiting)ã€‚åœæ‰JMeterï¼Œæµè§ˆå™¨è®¿é—®<a href="localhost:8081/test1" target="_blank" rel="noopener">localhost:8081/test1</a></p><p><img src="img/QQ20200319-172646@2x.png" alt="QQ20200319-172646@2x"></p><p>é™çº§è§„åˆ™ä¸å†ç¬¦åˆï¼Œæ‰€ä»¥æ–­è·¯å™¨åˆä¸Šï¼Œè¯·æ±‚æ­£å¸¸å“åº”ã€‚</p><h3 id="å¼‚å¸¸æ¯”ä¾‹"><a href="#å¼‚å¸¸æ¯”ä¾‹" class="headerlink" title="å¼‚å¸¸æ¯”ä¾‹"></a>å¼‚å¸¸æ¯”ä¾‹</h3><p>ä¿®æ”¹<code>TestController</code>çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"test1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	<span class="comment">// æ¯æ¬¡è¯·æ±‚éƒ½æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"æœåŠ¡å¼‚å¸¸"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é‡å¯é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®<a href="localhost:8081/test1" target="_blank" rel="noopener">localhost:8081/test1</a>ï¼Œç„¶åç‚¹å‡»sentinelæ§åˆ¶å°ç°‡ç‚¹é“¾è·¯åˆ—è¡¨çš„/test1é™çº§æŒ‰é’®ï¼š</p><p><img src="img/QQ20200319-173124@2x.png" alt="QQ20200319-173124@2x"></p><p>ä¸Šé¢çš„é…ç½®å«ä¹‰æ˜¯ï¼šå¦‚æœ/test1çš„QPSå¤§äº5ï¼Œå¹¶ä¸”æ¯ç§’é’Ÿçš„è¯·æ±‚å¼‚å¸¸æ¯”ä¾‹å¤§äº0.5çš„è¯ï¼Œé‚£ä¹ˆåœ¨æœªæ¥çš„1ç§’é’Ÿï¼ˆæ—¶é—´çª—å£ï¼‰å†…ï¼Œsentinelæ–­è·¯å™¨æ‰“å¼€ï¼Œè¯¥apiæ¥å£ä¸å¯ç”¨ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ç§’å†…æœ‰10ä¸ªè¯·æ±‚è¿›æ¥ï¼Œè¶…è¿‡5ä¸ªä»¥ä¸Šéƒ½å‡ºé”™ï¼Œé‚£ä¹ˆä¼šè§¦å‘ç†”æ–­ï¼Œ1ç§’é’Ÿå†…è¿™ä¸ªæ¥å£ä¸å¯ç”¨ã€‚</p><p>è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„JMeteræµ‹è¯•ï¼Œå¼€å¯JMeteråï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8081/test1" target="_blank" rel="noopener">http://localhost:8081/test1</a></p><p><img src="img/QQ20200319-173524@2x.png" alt="QQ20200319-173524@2x"></p><p>å…³æ‰JMeteråï¼Œå†æ¬¡è®¿é—®<a href="http://localhost:8081/test1" target="_blank" rel="noopener">http://localhost:8081/test1</a>ï¼š</p><p><img src="img/QQ20200319-173631@2x.png" alt="QQ20200319-173631@2x"></p><h3 id="å¼‚å¸¸æ•°"><a href="#å¼‚å¸¸æ•°" class="headerlink" title="å¼‚å¸¸æ•°"></a>å¼‚å¸¸æ•°</h3><p>å¥–åŠç­–ç•¥ä¸ºå¼‚å¸¸æ•°æ—¶è¡¨ç¤ºï¼šå½“æŒ‡å®šæ—¶é—´çª—å£å†…ï¼Œè¯·æ±‚å¼‚å¸¸æ•°å¤§äºç­‰äºæŸä¸ªå€¼æ—¶ï¼Œè§¦å‘é™çº§ã€‚æ¯”å¦‚æœ‰å¦‚ä¸‹è§„åˆ™ï¼š</p><p><img src="img/QQ20200319-182819@2x.png" alt="QQ20200319-182819@2x"></p><p>ä¸Šé¢çš„è§„åˆ™è¡¨ç¤ºï¼šåœ¨70ç§’å†…ï¼Œè®¿é—®/test1è¯·æ±‚å¼‚å¸¸çš„æ¬¡æ•°å¤§äºç­‰äº5ï¼Œåˆ™è§¦å‘é™çº§ã€‚æµ‹è¯•ä¸€æ³¢ï¼š</p><p><img src="img/2020-03-19 18.28.50.gif" alt="2020-03-19 18.28.50.gif"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ç¬¬5æ¬¡è®¿é—®çš„æ—¶å€™æˆåŠŸè§¦å‘äº†é™çº§ã€‚</p><h2 id="çƒ­ç‚¹è§„åˆ™"><a href="#çƒ­ç‚¹è§„åˆ™" class="headerlink" title="çƒ­ç‚¹è§„åˆ™"></a>çƒ­ç‚¹è§„åˆ™</h2><p>çƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚</p><p>æ¯”å¦‚åœ¨<code>TestController</code>ä¸­æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"buy"</span>)</span><br><span class="line"><span class="meta">@SentinelResource</span>(value = <span class="string">"buy"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">(String goodName, Integer count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"ä¹°"</span> + count + <span class="string">"ä»½"</span> + goodName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯¹è¿™ä¸ªèµ„æºæ·»åŠ çƒ­ç‚¹è§„åˆ™ï¼š</p><p><img src="img/QQ20200319-185115@2x.png" alt="QQ20200319-185115@2x"></p><p>ä¸Šé¢çš„é…ç½®å«ä¹‰æ˜¯ï¼šå¯¹buyèµ„æºæ·»åŠ çƒ­ç‚¹è§„åˆ™ï¼Œå½“ç¬¬0ä¸ªå‚æ•°çš„å€¼ä¸ºmibandçš„æ—¶å€™QPSé˜ˆå€¼ä¸º10ï¼Œå¦åˆ™ä¸º1ã€‚æ­¤å¤–ï¼Œå¦‚æœç¬¬0ä¸ªå‚æ•°ä¸ä¼ ï¼Œé‚£ä¹ˆè¿™ç¬”è¯·æ±‚ä¸å—è¯¥çƒ­ç‚¹è§„åˆ™é™åˆ¶ã€‚æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="img/2020-03-19 18.58.12.gif" alt="2020-03-19 18.58.12.gif"></p><h2 id="ç³»ç»Ÿè§„åˆ™"><a href="#ç³»ç»Ÿè§„åˆ™" class="headerlink" title="ç³»ç»Ÿè§„åˆ™"></a>ç³»ç»Ÿè§„åˆ™</h2><p>ç³»ç»Ÿè§„åˆ™åˆ™æ˜¯é’ˆå¯¹æ•´ä¸ªç³»ç»Ÿè®¾ç½®é™æµè§„åˆ™ï¼Œå¹¶ä¸é’ˆå¯¹æŸä¸ªèµ„æºï¼Œè®¾ç½®é¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="img/QQ20200319-190751@2x.png" alt="QQ20200319-190751@2x"></p><p>é˜ˆå€¼ç±»å‹åŒ…å«ä»¥ä¸‹äº”ç§ï¼š</p><ul><li>Load è‡ªé€‚åº”ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ maxQps <em>minRt ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ CPU cores </em>2.5ã€‚</li><li>CPU usageï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚</li><li>å¹³å‡ RTï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li><li>å¹¶å‘çº¿ç¨‹æ•°ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li><li>å…¥å£ QPSï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li></ul><p>æ¯”è¾ƒç›´è§‚å°±ä¸æ¼”ç¤ºäº†ã€‚</p><h2 id="æˆæƒè§„åˆ™"><a href="#æˆæƒè§„åˆ™" class="headerlink" title="æˆæƒè§„åˆ™"></a>æˆæƒè§„åˆ™</h2><p>æˆæƒè§„åˆ™ç”¨äºé…ç½®èµ„æºçš„é»‘ç™½åå•ï¼š</p><p><img src="img/QQ20200319-191154@2x.png" alt="QQ20200319-191154@2x"></p><p>ä¸Šè¿°é…ç½®è¡¨ç¤ºï¼šåªæœ‰appAå’ŒappBæ‰èƒ½è®¿é—®helloèµ„æºã€‚</p><div class="note danger">sentinelæ§åˆ¶å°è§„åˆ™ä¼šåœ¨å®¢æˆ·ç«¯é‡å¯åä¸¢å¤±ï¼Œå¯ä»¥é…åˆnacosç­‰è¿›è¡Œé…ç½®æŒä¹…åŒ–ï¼Œå…·ä½“å¯ä»¥å‚è€ƒäº‘å¤§ä½¬çš„åšå®¢ï¼š<a href="https://www.sonake.com/2019/12/16/Sentinel-Nacos%E5%AE%9E%E7%8E%B0%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96/" target="_blank" rel="noopener">https://www.sonake.com/2019/12/16/Sentinel-Nacos%E5%AE%9E%E7%8E%B0%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96/</a>ã€‚</div><blockquote><p>å‚è€ƒé“¾æ¥ <a href="https://github.com/alibaba/Sentinel/wiki" target="_blank" rel="noopener">https://github.com/alibaba/Sentinel/wiki</a></p></blockquote><blockquote><p>æœ¬èŠ‚æºç é“¾æ¥ï¼š<a href="https://github.com/wuyouzhuguli/SpringAll/tree/master/77.spring-cloud-alibaba-sentinel-dashboard-guide" target="_blank" rel="noopener">https://github.com/wuyouzhuguli/SpringAll/tree/master/77.spring-cloud-alibaba-sentinel-dashboard-guide</a>ã€‚</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:17 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alibaba/Sentinel&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Sentinel&lt;/a&gt;æä¾›ä¸€ä¸ªè½»é‡çº§çš„å¼€æºæ§åˆ¶å°ï¼Œå®ƒæä¾›æœºå™¨å‘ç°ä»¥åŠå¥åº·æƒ…å†µç®¡ç†ã€ç›‘æ§ï¼ˆå•æœºå’Œé›†ç¾¤ï¼‰ï¼Œè§„åˆ™ç®¡ç†å’Œæ¨é€çš„åŠŸèƒ½ã€‚æœ¬èŠ‚å°†è¯¦ç»†è®°å½•ä½•å¦‚é€šè¿‡Sentinelæ§åˆ¶å°æ§åˆ¶Sentinelå®¢æˆ·ç«¯çš„å„ç§è¡Œä¸ºã€‚Sentinelæ§åˆ¶å°çš„åŠŸèƒ½ä¸»è¦åŒ…æ‹¬ï¼šæµé‡æ§åˆ¶ã€é™çº§æ§åˆ¶ã€çƒ­ç‚¹é…ç½®ã€ç³»ç»Ÿè§„åˆ™å’Œæˆæƒè§„åˆ™ç­‰ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spring Cloud" scheme="http://mrbird.cc/tags/Spring-Cloud/"/>
    
      <category term="Spring Cloud Alibaba" scheme="http://mrbird.cc/tags/Spring-Cloud-Alibaba/"/>
    
      <category term="Sentinel" scheme="http://mrbird.cc/tags/Sentinel/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud Alibaba Nacosé…ç½®ä¸­å¿ƒ</title>
    <link href="http://mrbird.cc/Spring-Cloud-Alibaba-Nacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html"/>
    <id>http://mrbird.cc/Spring-Cloud-Alibaba-Nacosé…ç½®ä¸­å¿ƒ.html</id>
    <published>2020-03-13T07:53:34.000Z</published>
    <updated>2020-03-19T01:19:50.166Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --><p>ä¸Šä¸€èŠ‚<a href="Spring-Cloud-Alibaba-Nacosæ³¨å†Œä¸­å¿ƒ.html">Spring Cloud Alibaba Nacosæ³¨å†Œä¸­å¿ƒ</a>è®°å½•äº†Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ä½¿ç”¨æ–¹å¼ï¼Œè¿™èŠ‚ç»§ç»­è®°å½•ä¸‹Nacosä½œä¸ºé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨æ–¹å¼ã€‚æœ¬èŠ‚ä½¿ç”¨çš„Spring Cloudç‰ˆæœ¬ä¸ºHoxton.SR3ï¼ŒSpring Cloud Alibabaç‰ˆæœ¬ä¸º2.2.0.RELEASEï¼ŒSpring Bootç‰ˆæœ¬ä¸º2.2.3.RELEASEã€‚</p><a id="more"></a><h2 id="æ¡†æ¶æ­å»º"><a href="#æ¡†æ¶æ­å»º" class="headerlink" title="æ¡†æ¶æ­å»º"></a>æ¡†æ¶æ­å»º</h2><p>æ–°å»ºä¸€ä¸ªSpring Booté¡¹ç›®ï¼ŒartifactIdä¸ºspring-cloud-alibaba-nacos-configï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="img/QQ20200313-161613@2x.png" alt="QQ20200313-161613@2x"></p><p>é¡¹ç›®çš„pomå†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cc.mrbird<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spring-cloud-alibaba-nacos-config<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Hoxton.SR3<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">com-alibaba-cloud.version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">com-alibaba-cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;com-alibaba-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>å› ä¸ºè¿™èŠ‚è®°å½•çš„æ˜¯Nacosä½œä¸ºé…ç½®ä¸­å¿ƒçš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¼•å…¥çš„æ˜¯<code>spring-cloud-alibaba-nacos-config</code>ä¾èµ–ã€‚</p><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><p>åœ¨é¡¹ç›®é…ç½®æ–‡ä»¶application.ymlä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">my-project</span></span><br></pre></td></tr></table></figure><p></p><p>ä¸Šé¢é…ç½®æŒ‡å®šåº”ç”¨ç«¯å£ä¸º8080ï¼Œåº”ç”¨åç§°ä¸ºmy-projectã€‚</p><p>æ¥ç€åœ¨resourcesç›®å½•ä¸‹æ–°å»ºé…ç½®æ–‡ä»¶bootstrap.ymlï¼Œåœ¨é‡Œé¢æ·»åŠ å¦‚ä¸‹Nacos configé…ç½®ï¼ˆå¿…é¡»åœ¨bootstrap.ymlä¸­é…ç½®ï¼Œbootstrap.ymlä¼˜å…ˆçº§æ¯”application.ymlé«˜ï¼‰ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    nacos:</span></span><br><span class="line"><span class="attr">      config:</span></span><br><span class="line"><span class="attr">        server-addr:</span> <span class="attr">localhost:8848</span></span><br><span class="line"><span class="attr">        file-extension:</span> <span class="string">yaml</span></span><br></pre></td></tr></table></figure><p></p><ul><li><p><code>spring.cloud.nacos.config.server-addr</code>é…ç½®äº†Nacosé…ç½®ä¸­å¿ƒçš„åœ°å€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>spring.cloud.nacos.server-addr</code>æŒ‡å®šï¼Œå®ƒä»¬ä¸¤ä¸ªæ˜¯ç­‰ä»·çš„ï¼›</p></li><li><p><code>spring.cloud.nacos.config.file-extension</code>æŒ‡å®šå¾…ä¼šåœ¨Nacosé…ç½®ä¸­å¿ƒè¯»å–çš„é…ç½®çš„æ ¼å¼ä¸ºyamlæ ¼å¼ã€‚</p></li></ul><p>æˆ‘ä»¬å›åˆ°Nacosæ§åˆ¶å°<a href="http://localhost:8848/nacos" target="_blank" rel="noopener">http://localhost:8848/nacos</a>ï¼Œåœ¨é…ç½®åˆ—è¡¨ä¸­æ–°å»ºä¸€ä¸ªé…ç½®ï¼š</p><p><img src="img/QQ20200316-091128@2x.png" alt="QQ20200316-091128@2x"></p><p><img src="img/QQ20200316-091434@2x.png" alt="QQ20200316-091434@2x"></p><p>æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªmy-project.yamlé…ç½®ï¼ˆdataIdä¸ºmy-project.yamlï¼Œgroupä¸ºDEFAULT_GROUPï¼Œå®ƒä»¬çš„å…·ä½“å«ä¹‰ä¸‹é¢ä¼šä»‹ç»åˆ°ï¼‰ï¼Œé…ç½®äº†<code>message: &#39;hello nacos config&#39;</code>ï¼Œåˆ›å»ºå¥½åï¼Œç‚¹å‡»å‘å¸ƒå³å¯ã€‚</p><p>æ¥ç€å›åˆ°æˆ‘ä»¬çš„é¡¹ç›®ï¼Œåœ¨cc.mrbird.nacosç›®å½•ä¸‹æ–°å»ºcontrolleråŒ…ï¼Œç„¶ååœ¨è¯¥åŒ…ä¸‹æ–°å»º<code>TestController</code>ç”¨äºæµ‹è¯•é…ç½®è·å–è§„åˆ™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;message:null&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"message"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¸Šé¢ä»£ç æˆ‘ä»¬ä»åˆšåˆšåœ¨Nacosæ§åˆ¶å°é…ç½®çš„é…ç½®æ–‡ä»¶ä¸­è·å–<code>message</code>é…ç½®çš„å€¼ï¼Œ<code>@RefreshScope</code>ç”¨äºåˆ·æ–°é…ç½®ï¼Œå³æˆ‘ä»¬åœ¨Nacosæ§åˆ¶å°ä¿®æ”¹äº†ç›¸å…³é…ç½®ç‚¹å‡»å‘å¸ƒåï¼Œæˆ‘ä»¬çš„åº”ç”¨èƒ½å¤Ÿåœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹è·å–åˆ°æœ€æ–°çš„é…ç½®ã€‚</p><p>å¯åŠ¨é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š<a href="http://localhost:8080/message" target="_blank" rel="noopener">http://localhost:8080/message</a>ï¼š</p><p><img src="img/QQ20200316-092401@2x.png" alt="QQ20200316-092401@2x"></p><p>é…ç½®è·å–æˆåŠŸï¼Œåœ¨Nacosæ§åˆ¶å°ä¸­å°†<code>message</code>å€¼ä¿®æ”¹ä¸º<code>hello world</code>åå‘å¸ƒï¼Œå†æ¬¡è®¿é—®<a href="http://localhost:8080/message" target="_blank" rel="noopener">http://localhost:8080/message</a>ï¼š</p><p><img src="img/QQ20200316-092754@2x.png" alt="QQ20200316-092754@2x"></p><h2 id="è·å–é…ç½®è§„åˆ™"><a href="#è·å–é…ç½®è§„åˆ™" class="headerlink" title="è·å–é…ç½®è§„åˆ™"></a>è·å–é…ç½®è§„åˆ™</h2><p>Nacosé…ç½®ä¸­å¿ƒé€šè¿‡namespaceã€dataIdå’Œgroupæ¥å”¯ä¸€ç¡®å®šä¸€æ¡é…ç½®ã€‚</p><ol><li>namespaceï¼Œå³å‘½åç©ºé—´ã€‚é»˜è®¤çš„å‘½åç©ºé—´ä¸ºpublicï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Nacosæ§åˆ¶å°ä¸­æ–°å»ºå‘½åç©ºé—´ï¼›</li><li><p>dataIdï¼Œå³é…ç½®æ–‡ä»¶åç§°ï¼ŒdataIdçš„æ‹¼æ¥æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$&#123;prefix&#125;</span> <span class="bullet">-</span> <span class="string">$&#123;spring.profiles.active&#125;</span> <span class="string">.</span> <span class="string">$&#123;file-extension&#125;</span></span><br></pre></td></tr></table></figure><ul><li><p><code>prefix</code>é»˜è®¤ä¸º<code>pring.application.name</code>çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹<code>spring.cloud.nacos.config.prefix</code>æ¥é…ç½®ï¼›</p></li><li><p><code>spring.profiles.active</code>å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„<code>profile</code>ã€‚<strong>æ³¨æ„ï¼Œå½“<code>spring.profiles.active</code>ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦<code>-</code>ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataIdçš„æ‹¼æ¥æ ¼å¼å˜æˆ<code>${prefix}.${file-extension}</code></strong>ï¼›</p></li><li><p><code>file-extension</code>ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹<code>spring.cloud.nacos.config.file-extension</code>æ¥é…ç½®ã€‚</p></li></ul></li><li><p>groupï¼Œå³é…ç½®åˆ†ç»„ï¼Œé»˜è®¤ä¸ºDEFAULT_GROUPï¼Œå¯ä»¥é€šè¿‡<code>spring.cloud.nacos.config.group</code>é…ç½®ã€‚</p></li></ol><p>æ‰€ä»¥æ ¹æ®è¿™äº›è§„åˆ™ï¼Œä¸Šé¢ç¤ºä¾‹ä¸­æˆ‘ä»¬çš„åº”ç”¨åç§°<code>spring.application.name</code>ä¸ºmy-projectï¼Œ<code>spring.cloud.nacos.config.file-extension</code>çš„å€¼ä¸ºyamlï¼Œæ²¡æœ‰æŒ‡å®š<code>spring.profiles.active</code>ï¼Œäºæ˜¯dataIdä¸ºmy-project.yamlï¼Œåˆ†ç»„ä¸ºé»˜è®¤çš„DEFAULT_GROUPï¼Œå‘½åç©ºé—´ä¸ºé»˜è®¤çš„publicã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨Nacosæ§åˆ¶å°ä¸­æ–°å»ºé…ç½®æ—¶çš„æ ¹æ®ã€‚</p><h2 id="é…ç½®åˆ’åˆ†å®æˆ˜"><a href="#é…ç½®åˆ’åˆ†å®æˆ˜" class="headerlink" title="é…ç½®åˆ’åˆ†å®æˆ˜"></a>é…ç½®åˆ’åˆ†å®æˆ˜</h2><p>Nacosé…ç½®ä¸­å¿ƒçš„namespaceã€dataIdå’Œgroupå¯ä»¥æ–¹ä¾¿çµæ´»åœ°åˆ’åˆ†é…ç½®ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªé¡¹ç›®éœ€è¦å¼€å‘ï¼Œé¡¹ç›®åç§°ä¸ºfebsï¼Œé¡¹ç›®å¼€å‘äººå‘˜åˆ†ä¸ºä¸¤ä¸ªç»„ï¼šGROUP_Aå’ŒGROUP_Bï¼Œé¡¹ç›®åˆ†ä¸ºä¸‰ä¸ªç¯å¢ƒï¼šå¼€å‘ç¯å¢ƒdevã€æµ‹è¯•ç¯å¢ƒtestå’Œç”Ÿäº§ç¯å¢ƒprodã€‚</p><p>å‡å¦‚ç°åœ¨GROUP_Aç»„çš„ç»„é•¿éœ€è¦åœ¨Nacosä¸­æ–°å»ºä¸€ä¸ªå¼€å‘ç¯å¢ƒçš„febsé¡¹ç›®é…ç½®ï¼Œé‚£ä¹ˆä»–å¯ä»¥è¿™æ ·åšï¼š</p><ol><li>åœ¨Nacosæ§åˆ¶å°ä¸­æ–°å»ºä¸€ä¸ªåç§°ä¸ºfebsçš„å‘½åç©ºé—´ï¼š</li></ol><p><img src="img/QQ20200316-094921@2x.png" alt="QQ20200316-094921@2x"></p><p><img src="img/QQ20200316-094952@2x.png" alt="QQ20200316-094952@2x"></p><p><img src="img/QQ20200316-095015@2x.png" alt="QQ20200316-095015@2x"></p><p>æ–°å»ºfebså‘½åç©ºé—´åï¼Œä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€æ ‡è¯†è¯¥å‘½åç©ºé—´çš„å‘½åç©ºé—´id<code>2ef2186e-078c-4904-8643-ff5e90555456</code>ã€‚</p><ol start="2"><li>åœ¨Nacosæ§åˆ¶å°ä¸­æ–°å»ºä¸€ä¸ªé…ç½®ï¼š</li></ol><p><img src="img/QQ20200316-100032@2x.png" alt="QQ20200316-100032@2x"></p><p><img src="img/QQ20200316-095417@2x.png" alt="QQ20200316-095417@2x"></p><ol start="3"><li>æœ€ååœ¨febsé¡¹ç›®çš„bootstrap.ymlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®å³å¯ï¼š<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    nacos:</span></span><br><span class="line"><span class="attr">      config:</span></span><br><span class="line"><span class="attr">        server-addr:</span> <span class="attr">localhost:8848</span></span><br><span class="line"><span class="attr">        file-extension:</span> <span class="string">yaml</span></span><br><span class="line"><span class="attr">        prefix:</span> <span class="string">febs</span></span><br><span class="line"><span class="attr">        namespace:</span> <span class="string">'2ef2186e-078c-4904-8643-ff5e90555456'</span></span><br><span class="line"><span class="attr">        group:</span> <span class="string">GROUP_A</span></span><br></pre></td></tr></table></figure></li></ol><p><img src="img/QQ20200316-100224@2x.png" alt="QQ20200316-100224@2x"></p><h2 id="é…ç½®å›æ»š"><a href="#é…ç½®å›æ»š" class="headerlink" title="é…ç½®å›æ»š"></a>é…ç½®å›æ»š</h2><p>Nacosä¸­ï¼Œä¿®æ”¹é…ç½®ç‚¹å‡»å‘å¸ƒåä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„å†å²ç‰ˆæœ¬å¿«ç…§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Nacosæ§åˆ¶å°çš„å†å²ç‰ˆæœ¬åˆ—è¡¨ä¸­æ‰¾åˆ°è¿™äº›å¿«ç…§ï¼š</p><p><img src="img/QQ20200316-100425@2x.png" alt="QQ20200316-100425@2x"></p><p>ç‚¹å‡»å›æ»šæŒ‰é’®å³å¯å°†é…ç½®æ¢å¤åˆ°æŒ‡å®šçš„ç‰ˆæœ¬ã€‚</p><h2 id="è·å–å¤šä¸ªé…ç½®"><a href="#è·å–å¤šä¸ªé…ç½®" class="headerlink" title="è·å–å¤šä¸ªé…ç½®"></a>è·å–å¤šä¸ªé…ç½®</h2><p>é™¤äº†é€šè¿‡ä¸Šé¢çš„æ–¹å¼æŒ‡å®šä¸€ä¸ªå”¯ä¸€é…ç½®å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŒæ—¶è·å–å¤šä¸ªé…ç½®æ–‡ä»¶çš„å†…å®¹ï¼Œæ¯”å¦‚ï¼Œå°†é¡¹ç›®çš„bootstrap.ymlå†…å®¹ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    nacos:</span></span><br><span class="line"><span class="attr">      config:</span></span><br><span class="line"><span class="attr">        server-addr:</span> <span class="attr">localhost:8848</span></span><br><span class="line"><span class="attr">        extension-configs:</span></span><br><span class="line"><span class="attr">          - dataId:</span> <span class="string">ext-config-one.yaml</span></span><br><span class="line"><span class="attr">            group:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line"><span class="attr">            refresh:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">          - dataId:</span> <span class="string">ext-config-two.yaml</span></span><br><span class="line"><span class="attr">            group:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line"><span class="attr">            refresh:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p></p><ul><li><p><code>spring.cloud.nacos.config.extension-configs[n].dataId</code>ï¼ŒæŒ‡å®šå¤šä¸ªé…ç½®çš„dataIdï¼Œå¿…é¡»åŒ…å«æ–‡ä»¶æ ¼å¼ï¼Œæ”¯æŒpropertiesã€yamlæˆ–ymlï¼›</p></li><li><p><code>spring.cloud.nacos.config.extension-configs[n].group</code>ï¼ŒæŒ‡å®šåˆ†ç»„ï¼›</p></li><li><p><code>spring.cloud.nacos.config.extension-configs[n].refresh</code>ï¼Œæ˜¯å¦æ”¯æŒåˆ·æ–°ã€‚</p></li></ul><p>ä¸Šé¢çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»DEFAULT_GROUPä¸­è·å–äº†<code>ext-config-one.yaml</code>å’Œ<code>ext-config-two.yaml</code>é…ç½®å†…å®¹ï¼Œå¹¶ä¸”<code>ext-config-one.yaml</code>æ”¯æŒåˆ·æ–°ï¼Œ<code>ext-config-two.yaml</code>ä¸æ”¯æŒåˆ·æ–°ã€‚</p><div class="note danger">æ²¡æœ‰namespaceçš„é…ç½®ï¼Œè¨€å¤–ä¹‹æ„å°±æ˜¯Nacosç›®å‰è¿˜ä¸æ”¯æŒå¤šä¸ªé…ç½®æŒ‡å®šä¸åŒçš„å‘½åç©ºé—´ã€‚</div><p>æˆ‘ä»¬åœ¨Nacosæ§åˆ¶å°ä¸­æ–°å»ºè¿™ä¸¤ä¸ªé…ç½®ï¼š</p><p><img src="img/QQ20200316-105741@2x.png" alt="QQ20200316-105741@2x"></p><p><code>ext-config-one.yaml</code>é…ç½®å†…å®¹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ext1:</span> <span class="string">'hello'</span></span><br></pre></td></tr></table></figure><p></p><p><code>ext-config-two.yaml</code>é…ç½®å†…å®¹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ext2:</span> <span class="string">'world'</span></span><br></pre></td></tr></table></figure><p></p><p>åœ¨é¡¹ç›®çš„<code>TestController</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;ext1:null&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String ext1;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;ext2:null&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String ext2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"multi"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">multiConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"ext1: %s ext2: %s"</span>, ext1, ext2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯åŠ¨é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8080/multi" target="_blank" rel="noopener">http://localhost:8080/multi</a>ï¼š</p><p><img src="img/QQ20200316-112930@2x.png" alt="QQ20200316-112930@2x"></p><p>å°†<code>ext1</code>çš„å€¼ä¿®æ”¹ä¸º<code>nice</code>ï¼Œ<code>ext2</code>çš„å€¼ä¿®æ”¹ä¸º<code>job</code>ï¼š</p><p><img src="img/QQ20200316-113120@2x.png" alt="QQ20200316-113120@2x"></p><p>å¯ä»¥çœ‹åˆ°<code>ext1</code>çš„å€¼æ›´æ–°äº†ï¼Œ<code>ext2</code>æ²¡æœ‰æ›´æ–°ã€‚</p><h2 id="å¤šé…ç½®å…±äº«"><a href="#å¤šé…ç½®å…±äº«" class="headerlink" title="å¤šé…ç½®å…±äº«"></a>å¤šé…ç½®å…±äº«</h2><p>å¤šé…ç½®å…±äº«å…¶å®å’Œè·å–å¤šä¸ªæ–‡ä»¶é…ç½®ä½œç”¨å·®ä¸å¤šï¼Œä¸‹é¢æ¼”ç¤ºä¸‹å¤šé…ç½®å…±äº«ã€‚</p><p>å°†bootstrap.ymlé…ç½®ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    nacos:</span></span><br><span class="line"><span class="attr">      config:</span></span><br><span class="line"><span class="attr">        server-addr:</span> <span class="attr">localhost:8848</span></span><br><span class="line"><span class="attr">        shared-configs:</span> <span class="string">ext-config-one.yaml,ext-config-two.yaml</span></span><br></pre></td></tr></table></figure><p></p><p><code>spring.cloud.nacos.config.shared-configs</code>æŒ‡å®šäº†å…±äº«<code>ext-config-one.yaml</code>å’Œ<code>ext-config-two.yaml</code>çš„é…ç½®ã€‚</p><p>é‡å¯é¡¹ç›®ï¼Œè®¿é—®<a href="http://localhost:8080/multi" target="_blank" rel="noopener">http://localhost:8080/multi</a>ï¼š</p><p><img src="img/QQ20200316-134742@2x.png" alt="QQ20200316-134742@2x"></p><p>ä¹Ÿå¯ä»¥æ­£å¸¸è·å–ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯å¤šé…ç½®å…±äº«è¿˜æ˜¯è·å–å¤šä¸ªé…ç½®ï¼Œè¦å®Œæˆçš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡å®ƒä»¬éƒ½æœ‰å„è‡ªçš„å±€é™æ€§ã€‚å¤šé…ç½®å…±äº«æ— æ³•æŒ‡å®šåˆ†ç»„ã€æ— æ³•æŒ‡å®šå‘½åç©ºé—´ã€æ— æ³•é…ç½®æ˜¯å¦åˆ·æ–°ï¼›è·å–å¤šä¸ªé…ç½®ç›¸å¯¹è¾ƒä¸ºçµæ´»ï¼Œä¸è¿‡ä¹Ÿä¸èƒ½é…ç½®å‘½åç©ºé—´ã€‚å…·ä½“ç›¸å…³çš„è®¨è®ºå¯ä»¥å‚è€ƒï¼š<a href="https://github.com/alibaba/spring-cloud-alibaba/issues/141" target="_blank" rel="noopener">https://github.com/alibaba/spring-cloud-alibaba/issues/141</a></p><h2 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h2><table><thead><tr><th>é…ç½®é¡¹</th><th>key</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœåŠ¡ç«¯åœ°å€</td><td>spring.cloud.nacos.config.server-addr</td><td></td><td></td></tr><tr><td>DataIdå‰ç¼€</td><td>spring.cloud.nacos.config.prefix</td><td></td><td>spring.application.name</td></tr><tr><td>Group</td><td>spring.cloud.nacos.config.group</td><td>DEFAULT_GROUP</td><td></td></tr><tr><td>dataIDåç¼€åŠå†…å®¹æ–‡ä»¶æ ¼å¼</td><td>spring.cloud.nacos.config.file-extension</td><td>properties</td><td>dataIdçš„åç¼€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯é…ç½®å†…å®¹çš„æ–‡ä»¶æ ¼å¼ï¼Œç›®å‰åªæ”¯æŒ properties</td></tr><tr><td>é…ç½®å†…å®¹çš„ç¼–ç æ–¹å¼</td><td>spring.cloud.nacos.config.encode</td><td>UTF-8</td><td>é…ç½®çš„ç¼–ç </td></tr><tr><td>è·å–é…ç½®çš„è¶…æ—¶æ—¶é—´</td><td>spring.cloud.nacos.config.timeout</td><td>3000</td><td>å•ä½ä¸º ms</td></tr><tr><td>é…ç½®çš„å‘½åç©ºé—´</td><td>spring.cloud.nacos.config.namespace</td><td></td><td>å¸¸ç”¨åœºæ™¯ä¹‹ä¸€æ˜¯ä¸åŒç¯å¢ƒçš„é…ç½®çš„åŒºåˆ†éš”ç¦»ï¼Œä¾‹å¦‚å¼€å‘æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„èµ„æºéš”ç¦»ç­‰ã€‚</td></tr><tr><td>AccessKey</td><td>spring.cloud.nacos.config.access-key</td><td></td><td></td></tr><tr><td>SecretKey</td><td>spring.cloud.nacos.config.secret-key</td><td></td><td></td></tr><tr><td>ç›¸å¯¹è·¯å¾„</td><td>spring.cloud.nacos.config.context-path</td><td></td><td>æœåŠ¡ç«¯ API çš„ç›¸å¯¹è·¯å¾„</td></tr><tr><td>æ¥å…¥ç‚¹</td><td>spring.cloud.nacos.config.endpoint</td><td></td><td>åœ°åŸŸçš„æŸä¸ªæœåŠ¡çš„å…¥å£åŸŸåï¼Œé€šè¿‡æ­¤åŸŸåå¯ä»¥åŠ¨æ€åœ°æ‹¿åˆ°æœåŠ¡ç«¯åœ°å€</td></tr><tr><td>æ˜¯å¦å¼€å¯ç›‘å¬å’Œè‡ªåŠ¨åˆ·æ–°</td><td>spring.cloud.nacos.config.refresh.enabled</td><td>true</td><td></td></tr></tbody></table><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-examples/nacos-example/nacos-config-example/readme-zh.md" target="_blank" rel="noopener">https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-examples/nacos-example/nacos-config-example/readme-zh.md</a></p><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_config" target="_blank" rel="noopener">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_config</a></p><blockquote><p>æœ¬èŠ‚æºç é“¾æ¥ï¼š<a href="https://github.com/wuyouzhuguli/SpringAll/tree/master/75.spring-cloud-alibaba-nacos-config" target="_blank" rel="noopener">https://github.com/wuyouzhuguli/SpringAll/tree/master/75.spring-cloud-alibaba-nacos-config</a>ã€‚</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Thu Dec 24 2020 11:04:18 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;ä¸Šä¸€èŠ‚&lt;a href=&quot;Spring-Cloud-Alibaba-Nacosæ³¨å†Œä¸­å¿ƒ.html&quot;&gt;Spring Cloud Alibaba Nacosæ³¨å†Œä¸­å¿ƒ&lt;/a&gt;è®°å½•äº†Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ä½¿ç”¨æ–¹å¼ï¼Œè¿™èŠ‚ç»§ç»­è®°å½•ä¸‹Nacosä½œä¸ºé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨æ–¹å¼ã€‚æœ¬èŠ‚ä½¿ç”¨çš„Spring Cloudç‰ˆæœ¬ä¸ºHoxton.SR3ï¼ŒSpring Cloud Alibabaç‰ˆæœ¬ä¸º2.2.0.RELEASEï¼ŒSpring Bootç‰ˆæœ¬ä¸º2.2.3.RELEASEã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Spring Cloud" scheme="http://mrbird.cc/tags/Spring-Cloud/"/>
    
      <category term="Spring Cloud Alibaba" scheme="http://mrbird.cc/tags/Spring-Cloud-Alibaba/"/>
    
      <category term="Nacos" scheme="http://mrbird.cc/tags/Nacos/"/>
    
  </entry>
  
</feed>
